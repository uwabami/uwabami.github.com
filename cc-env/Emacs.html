<!doctype html>
<html ⚡ lang="ja">
    <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <title>Emacs の設定</title>
  <meta name="description" content="My Interest: Fluid Dynamics, Convection, MHD Dynamo, Numerical Computing, Unix, Linux, Debian">
  <link rel="canonical" href="/cc-env/Emacs.html">
  
  <link rel="alternate" hreflang="ja" href="/cc-env/Emacs.html" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <script type="application/ld+json">
        {
      "@context": "http://schema.org",
      "@type": "NewsArticle",
      "mainEntityOfPage": "/cc-env/Emacs.html",
      "headline": "Emacs の設定",
      "datePublished": "2018-10-16T19:46:27+00:00",
      "dateModified": "2018-10-16T19:46:27+00:00",
      "description": "My Interest: Fluid Dynamics, Convection, MHD Dynamo, Numerical Computing, Unix, Linux, Debian",
      "author": {
        "@type": "Person",
        "name": ""
      },
      "publisher": {
        "@type": "Organization",
        "name": "Youhei SASAKI's official site",
        "logo": {
          "@type": "ImageObject",
          "url": "",
          "width": "60",
          "height": "60"
        }
      },
      "image": {
        "@type": "ImageObject",
        "url": "",
        "height": "60",
        "width": "60"
      }
    }

  </script>
  <style amp-custom>
    
    .h1{font-size:2rem}.h2{font-size:1.5rem}.h3{font-size:1.25rem}.h4{font-size:1rem}.h5{font-size:.875rem}.h6{font-size:.75rem}.font-family-inherit{font-family:inherit}.font-size-inherit{font-size:inherit}.text-decoration-none{text-decoration:none}.bold{font-weight:bold}.regular{font-weight:normal}.italic{font-style:italic}.caps{text-transform:uppercase;letter-spacing:.2em}.left-align{text-align:left}.center{text-align:center}.right-align{text-align:right}.justify{text-align:justify}.nowrap{white-space:nowrap}.break-word{word-wrap:break-word}.line-height-1{line-height:1}.line-height-2{line-height:1.125}.line-height-3{line-height:1.25}.line-height-4{line-height:1.5}.list-style-none{list-style:none}.underline{text-decoration:underline}.truncate{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.list-reset{list-style:none;padding-left:0}.inline{display:inline}.block{display:block}.inline-block{display:inline-block}.table{display:table}.table-cell{display:table-cell}.overflow-hidden{overflow:hidden}.overflow-scroll{overflow:scroll}.overflow-auto{overflow:auto}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.left{float:left}.right{float:right}.fit{max-width:100%}.max-width-1{max-width:24rem}.max-width-2{max-width:32rem}.max-width-3{max-width:48rem}.max-width-4{max-width:64rem}.border-box{box-sizing:border-box}.align-baseline{vertical-align:baseline}.align-top{vertical-align:top}.align-middle{vertical-align:middle}.align-bottom{vertical-align:bottom}.m0{margin:0}.mt0{margin-top:0}.mr0{margin-right:0}.mb0{margin-bottom:0}.ml0{margin-left:0}.mx0{margin-left:0;margin-right:0}.my0{margin-top:0;margin-bottom:0}.m1{margin:.5rem}.mt1{margin-top:.5rem}.mr1{margin-right:.5rem}.mb1{margin-bottom:.5rem}.ml1{margin-left:.5rem}.mx1{margin-left:.5rem;margin-right:.5rem}.my1{margin-top:.5rem;margin-bottom:.5rem}.m2{margin:1rem}.mt2{margin-top:1rem}.mr2{margin-right:1rem}.mb2{margin-bottom:1rem}.ml2{margin-left:1rem}.mx2{margin-left:1rem;margin-right:1rem}.my2{margin-top:1rem;margin-bottom:1rem}.m3{margin:2rem}.mt3{margin-top:2rem}.mr3{margin-right:2rem}.mb3{margin-bottom:2rem}.ml3{margin-left:2rem}.mx3{margin-left:2rem;margin-right:2rem}.my3{margin-top:2rem;margin-bottom:2rem}.m4{margin:4rem}.mt4{margin-top:4rem}.mr4{margin-right:4rem}.mb4{margin-bottom:4rem}.ml4{margin-left:4rem}.mx4{margin-left:4rem;margin-right:4rem}.my4{margin-top:4rem;margin-bottom:4rem}.mxn1{margin-left:-0.5rem;margin-right:-0.5rem}.mxn2{margin-left:-1rem;margin-right:-1rem}.mxn3{margin-left:-2rem;margin-right:-2rem}.mxn4{margin-left:-4rem;margin-right:-4rem}.ml-auto{margin-left:auto}.mr-auto{margin-right:auto}.mx-auto{margin-left:auto;margin-right:auto}.p0{padding:0}.pt0{padding-top:0}.pr0{padding-right:0}.pb0{padding-bottom:0}.pl0{padding-left:0}.px0{padding-left:0;padding-right:0}.py0{padding-top:0;padding-bottom:0}.p1{padding:.5rem}.pt1{padding-top:.5rem}.pr1{padding-right:.5rem}.pb1{padding-bottom:.5rem}.pl1{padding-left:.5rem}.py1{padding-top:.5rem;padding-bottom:.5rem}.px1{padding-left:.5rem;padding-right:.5rem}.p2{padding:1rem}.pt2{padding-top:1rem}.pr2{padding-right:1rem}.pb2{padding-bottom:1rem}.pl2{padding-left:1rem}.py2{padding-top:1rem;padding-bottom:1rem}.px2{padding-left:1rem;padding-right:1rem}.p3{padding:2rem}.pt3{padding-top:2rem}.pr3{padding-right:2rem}.pb3{padding-bottom:2rem}.pl3{padding-left:2rem}.py3{padding-top:2rem;padding-bottom:2rem}.px3{padding-left:2rem;padding-right:2rem}.p4{padding:4rem}.pt4{padding-top:4rem}.pr4{padding-right:4rem}.pb4{padding-bottom:4rem}.pl4{padding-left:4rem}.py4{padding-top:4rem;padding-bottom:4rem}.px4{padding-left:4rem;padding-right:4rem}.col{float:left;box-sizing:border-box}.col-right{float:right;box-sizing:border-box}.col-1{width:8.3333333333%}.col-2{width:16.6666666667%}.col-3{width:25%}.col-4{width:33.3333333333%}.col-5{width:41.6666666667%}.col-6{width:50%}.col-7{width:58.3333333333%}.col-8{width:66.6666666667%}.col-9{width:75%}.col-10{width:83.3333333333%}.col-11{width:91.6666666667%}.col-12{width:100%}@media (min-width: 40em){.sm-col{float:left;box-sizing:border-box}.sm-col-right{float:right;box-sizing:border-box}.sm-col-1{width:8.3333333333%}.sm-col-2{width:16.6666666667%}.sm-col-3{width:25%}.sm-col-4{width:33.3333333333%}.sm-col-5{width:41.6666666667%}.sm-col-6{width:50%}.sm-col-7{width:58.3333333333%}.sm-col-8{width:66.6666666667%}.sm-col-9{width:75%}.sm-col-10{width:83.3333333333%}.sm-col-11{width:91.6666666667%}.sm-col-12{width:100%}}@media (min-width: 52em){.md-col{float:left;box-sizing:border-box}.md-col-right{float:right;box-sizing:border-box}.md-col-1{width:8.3333333333%}.md-col-2{width:16.6666666667%}.md-col-3{width:25%}.md-col-4{width:33.3333333333%}.md-col-5{width:41.6666666667%}.md-col-6{width:50%}.md-col-7{width:58.3333333333%}.md-col-8{width:66.6666666667%}.md-col-9{width:75%}.md-col-10{width:83.3333333333%}.md-col-11{width:91.6666666667%}.md-col-12{width:100%}}@media (min-width: 64em){.lg-col{float:left;box-sizing:border-box}.lg-col-right{float:right;box-sizing:border-box}.lg-col-1{width:8.3333333333%}.lg-col-2{width:16.6666666667%}.lg-col-3{width:25%}.lg-col-4{width:33.3333333333%}.lg-col-5{width:41.6666666667%}.lg-col-6{width:50%}.lg-col-7{width:58.3333333333%}.lg-col-8{width:66.6666666667%}.lg-col-9{width:75%}.lg-col-10{width:83.3333333333%}.lg-col-11{width:91.6666666667%}.lg-col-12{width:100%}}.flex{display:flex}@media (min-width: 40em){.sm-flex{display:flex}}@media (min-width: 52em){.md-flex{display:flex}}@media (min-width: 64em){.lg-flex{display:flex}}.flex-column{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.self-start{align-self:flex-start}.self-end{align-self:flex-end}.self-center{align-self:center}.self-baseline{align-self:baseline}.self-stretch{align-self:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.content-start{align-content:flex-start}.content-end{align-content:flex-end}.content-center{align-content:center}.content-between{align-content:space-between}.content-around{align-content:space-around}.content-stretch{align-content:stretch}.flex-auto{flex:1 1 auto;min-width:0;min-height:0}.flex-none{flex:none}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-last{order:99999}.relative{position:relative}.absolute{position:absolute}.fixed{position:fixed}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.z1{z-index:1}.z2{z-index:2}.z3{z-index:3}.z4{z-index:4}.border{border-style:solid;border-width:1px}.border-top{border-top-style:solid;border-top-width:1px}.border-right{border-right-style:solid;border-right-width:1px}.border-bottom{border-bottom-style:solid;border-bottom-width:1px}.border-left{border-left-style:solid;border-left-width:1px}.border-none{border:0}.rounded{border-radius:3px}.circle{border-radius:50%}.rounded-top{border-radius:3px 3px 0 0}.rounded-right{border-radius:0 3px 3px 0}.rounded-bottom{border-radius:0 0 3px 3px}.rounded-left{border-radius:3px 0 0 3px}.not-rounded{border-radius:0}.hide{position:absolute !important;height:1px;width:1px;overflow:hidden;clip:rect(1px, 1px, 1px, 1px)}@media (max-width: 40em){.xs-hide{display:none !important}}@media (min-width: 40em) and (max-width: 52em){.sm-hide{display:none !important}}@media (min-width: 52em) and (max-width: 64em){.md-hide{display:none !important}}@media (min-width: 64em){.lg-hide{display:none !important}}.display-none{display:none !important}@media (min-width: 40em){.sm-p0{padding:0}.sm-pt0{padding-top:0}.sm-pr0{padding-right:0}.sm-pb0{padding-bottom:0}.sm-pl0{padding-left:0}.sm-px0{padding-left:0;padding-right:0}.sm-py0{padding-top:0;padding-bottom:0}.sm-p1{padding:.5rem}.sm-pt1{padding-top:.5rem}.sm-pr1{padding-right:.5rem}.sm-pb1{padding-bottom:.5rem}.sm-pl1{padding-left:.5rem}.sm-px1{padding-left:.5rem;padding-right:.5rem}.sm-py1{padding-top:.5rem;padding-bottom:.5rem}.sm-p2{padding:1rem}.sm-pt2{padding-top:1rem}.sm-pr2{padding-right:1rem}.sm-pb2{padding-bottom:1rem}.sm-pl2{padding-left:1rem}.sm-px2{padding-left:1rem;padding-right:1rem}.sm-py2{padding-top:1rem;padding-bottom:1rem}.sm-p3{padding:2rem}.sm-pt3{padding-top:2rem}.sm-pr3{padding-right:2rem}.sm-pb3{padding-bottom:2rem}.sm-pl3{padding-left:2rem}.sm-px3{padding-left:2rem;padding-right:2rem}.sm-py3{padding-top:2rem;padding-bottom:2rem}.sm-p4{padding:4rem}.sm-pt4{padding-top:4rem}.sm-pr4{padding-right:4rem}.sm-pb4{padding-bottom:4rem}.sm-pl4{padding-left:4rem}.sm-px4{padding-left:4rem;padding-right:4rem}.sm-py4{padding-top:4rem;padding-bottom:4rem}}@media (min-width: 52em){.md-p0{padding:0}.md-pt0{padding-top:0}.md-pr0{padding-right:0}.md-pb0{padding-bottom:0}.md-pl0{padding-left:0}.md-px0{padding-left:0;padding-right:0}.md-py0{padding-top:0;padding-bottom:0}.md-p1{padding:.5rem}.md-pt1{padding-top:.5rem}.md-pr1{padding-right:.5rem}.md-pb1{padding-bottom:.5rem}.md-pl1{padding-left:.5rem}.md-px1{padding-left:.5rem;padding-right:.5rem}.md-py1{padding-top:.5rem;padding-bottom:.5rem}.md-p2{padding:1rem}.md-pt2{padding-top:1rem}.md-pr2{padding-right:1rem}.md-pb2{padding-bottom:1rem}.md-pl2{padding-left:1rem}.md-px2{padding-left:1rem;padding-right:1rem}.md-py2{padding-top:1rem;padding-bottom:1rem}.md-p3{padding:2rem}.md-pt3{padding-top:2rem}.md-pr3{padding-right:2rem}.md-pb3{padding-bottom:2rem}.md-pl3{padding-left:2rem}.md-px3{padding-left:2rem;padding-right:2rem}.md-py3{padding-top:2rem;padding-bottom:2rem}.md-p4{padding:4rem}.md-pt4{padding-top:4rem}.md-pr4{padding-right:4rem}.md-pb4{padding-bottom:4rem}.md-pl4{padding-left:4rem}.md-px4{padding-left:4rem;padding-right:4rem}.md-py4{padding-top:4rem;padding-bottom:4rem}}@media (min-width: 64em){.lg-p0{padding:0}.lg-pt0{padding-top:0}.lg-pr0{padding-right:0}.lg-pb0{padding-bottom:0}.lg-pl0{padding-left:0}.lg-px0{padding-left:0;padding-right:0}.lg-py0{padding-top:0;padding-bottom:0}.lg-p1{padding:.5rem}.lg-pt1{padding-top:.5rem}.lg-pr1{padding-right:.5rem}.lg-pb1{padding-bottom:.5rem}.lg-pl1{padding-left:.5rem}.lg-px1{padding-left:.5rem;padding-right:.5rem}.lg-py1{padding-top:.5rem;padding-bottom:.5rem}.lg-p2{padding:1rem}.lg-pt2{padding-top:1rem}.lg-pr2{padding-right:1rem}.lg-pb2{padding-bottom:1rem}.lg-pl2{padding-left:1rem}.lg-px2{padding-left:1rem;padding-right:1rem}.lg-py2{padding-top:1rem;padding-bottom:1rem}.lg-p3{padding:2rem}.lg-pt3{padding-top:2rem}.lg-pr3{padding-right:2rem}.lg-pb3{padding-bottom:2rem}.lg-pl3{padding-left:2rem}.lg-px3{padding-left:2rem;padding-right:2rem}.lg-py3{padding-top:2rem;padding-bottom:2rem}.lg-p4{padding:4rem}.lg-pt4{padding-top:4rem}.lg-pr4{padding-right:4rem}.lg-pb4{padding-bottom:4rem}.lg-pl4{padding-left:4rem}.lg-px4{padding-left:4rem;padding-right:4rem}.lg-py4{padding-top:4rem;padding-bottom:4rem}}.navbar{background-color:#082d74;color:#ecf0f1}.navbar a{color:#ecf0f1;text-decoration:none}.navbar a:active,.navbar a:visited{color:inherit}.navbar a:hover{color:#18bc9c;text-decoration:underline}.navbar ul.navbar-items{display:flex}.navbar li{width:8rem}.navbar .navbar-button{font-size:1.25rem}.navbar .navbar-brand{font-size:1.25rem;weight:bold}.navbar amp-accordion{position:absolute}.navbar amp-accordion header{background-color:#082d74;color:#ecf0f1;border-style:none;padding:0}.navbar amp-accordion section{background-color:#082d74;color:#ecf0f1;border-style:none}.navbar amp-accordion .dropdonw-items{width:20rem}.navbar amp-accordion .dropdown-item{margin:.5rem;width:19rem}footer{line-height:1.5rem;background-color:#082d74;color:#ecf0f1}.breadcrumb{list-style:none}.breadcrumb>li{display:inline-block}.breadcrumb>li+li:before{content:"/ ";padding:0 .5rem;color:#ccc}body{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAAFXRFWHRDcmVhdGlvbiBUaW1lAAfbBhwTDDqAejMsAAAAB3RJTUUH2wYeEi8EgXgYKgAAAAlwSFlzAAAOdAAADnQBaySz1gAAABxJREFUeNpj/PLxFwNuwALEbJw4pZkY8IJhKw0AlAcDBIeyUC8AAAAASUVORK5CYII=)}span.anchor{display:none}main{line-height:1.5}dd{margin-left:.5rem}strong{font-size:1.5rem;line-height:30px;font-weight:normal}#gpgkey{font-size:85% !important;background:white}.helo-unit{background-color:#f2f2f2;border-bottom:3px solid #b4bcc2;box-shadow:0 0 5px 2px rgba(0,0,0,0.1);margin-top:3.375rem}h1{padding-top:2rem;font-weight:normal}h2{border-bottom:1px solid #5af;font-weight:normal}h3{border-bottom:1px dashed #4ae;font-weight:normal}@media (min-width: 52em){.helo-unit{margin-top:5.5rem}.h1{padding-top:2rem}}.bg-white{background-color:#fff}a,a:active,a:visited,a:hover{color:#18bc9c;text-decoration:none}a:hover{text-decoration:underline}.icon-envelop{color:#242424}.icon-key{color:#ff8c00}.icon-keybase{color:#ff8c00}.icon-twitter{color:#55acee}.icon-facebook{color:#3B5998}.icon-github{color:#4c4c4c}.icon-mastodon{color:#3B5998}
  </style>
  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
  <script async custom-element="amp-geo" src="https://cdn.ampproject.org/v0/amp-geo-0.1.js"></script>
  <script async custom-element="amp-consent" src="https://cdn.ampproject.org/v0/amp-consent-0.1.js"></script>
  <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
  <script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script>
  <script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script>
  <script async src="https://cdn.ampproject.org/v0.js"></script>

  <body>
        <!-- First we need to set up the amp-geo extension. We define a group: `eea` which includes all European Economic Area countries. You will need to keep this list up-to-date as membership in the EEA may change over time. -->
    <amp-geo layout="nodisplay">
      <script type="application/json">
      {
          "ISOCountryGroups": {
              "eea": [ "at", "be", "bg", "cy", "cz", "de", "dk", "ee", "es", "fi",
                       "fr", "gb", "gr", "hr", "hu", "ie", "is", "it", "li", "lt",
                       "lu", "lv", "mt", "nl", "no", "pl", "pt", "ro", "se", "si",
                       "sk"]
          }
      }

      </script>
    </amp-geo>
    <!-- Next we need to setup the consent for users in the “eea” country group -->
    <amp-consent layout="nodisplay" id="consent-element">
      <script type="application/json">
     {
         "consents": {
             "my_consent": {
                 "promptIfUnknownForGeoGroup": "eea",
                 "promptUI": "consent-ui"
             }
         }
     }
      </script>
      <div id="consent-ui">
        <button on="tap:consent-element.accept" role="button">Accept</button>
        <button on="tap:consent-element.reject" role="button">Reject</button>
        <button on="tap:consent-element.dismiss" role="button">Dismiss</button>
      </div>
    </amp-consent>

    <header class="navbar fixed flex flex-wrap items-center z4 top-0 left-0 right-0 sm-pl2 md-pl2 lg-pl4 py2">
  <div class="md-hide lg-hide px1 navbar-button" role="button" on="tap:sidebar.toggle" tabindex="0">☰</div>
  <div class="nowrap">
    <a class="navbar-brand" href="/index.html">
      Youhei SASAKI's official site
    </a>
  </div>
  <nav class="flex-auto lg-pl4 md-pl2 xs-hide sm-hide">
    <ul class="navbar-items list-reset">
      
      
      <li>
        <a href="/research/index.html">Research</a>
      </li>
      <!-- Start Dropdown -->
      <li>
        <amp-accordion layout="container" disable-session-states="">
          <section>
            <header>Software &#9662;</header>
            <ul class="list-reset dropdown-items">
              <li class="dropdown-item">
                <a href="/software/index.html">
                  Repository
                </a>
              </li>
              <li class="dropdown-item">
                <a href="/cc-env/index.html">
                  Computer Memo
                </a>
              </li>
            </ul>
          </section>
        </amp-accordion>
      </li>
      <!-- End Dropdown -->
      <li>
        <a href="https://uwabami.junkhub.org/log">Blog</a>
      </li>
      
    </ul>
  </nav>
  <div class="language-selector xs-hide sm-hide pr0">
    <ul class="navbar-items list-reset">
      <li>
        
        
        
        
      </li>
    </ul>
  </div>
</header>
<!-- End Navbar -->

    <!-- Start Sidebar -->
<amp-sidebar id="sidebar"
             layout="nodisplay"
             class="navbar px1 md-hide lg-hide">
  <nav>
    <div role="button"
         on="tap:sidebar.toggle"
         tabindex="0"
         class="navbar-button m2">✕</div>
    <ul class="list-reset m2 p2">
      
      
      <li class="pb1">
        <a href="/index.html">Top</a>
      </li>
      <li class="pb1">
        <a href="/research/index.html">Research</a>
      </li>
      <li class="pb1">
        Software &#9662;
        <ul class="px2">
          <li>
            <a  href="/software/index.html">
              Repository
            </a>
          </li>
          <li class="nowrap">
            <a  href="/cc-env/index.html">
              Computer Memo
            </a>
          </li>
        </ul>
      </li>
      <li class="pb1">
        <a href="https://uwabami.junkhub.org/log">Blog</a>
      </li>
      
    </ul>
    <hr />
    <ul class="list-reset m2 p2">
      <li>
        
        
        
        
      </li>
    </ul>
  </nav>
</amp-sidebar>
<!-- End Sidebar -->

    <main role="main" class="sm-px2 md-px2 lg-px4">
      <div class="helo-unit px1">
        
        <h1>Emacs の設定</h1>
        
        <ul class="breadcrumb list-reset z1 px1">
  
  <li><a href="/index.html">Top</a></li>
  
  
    
    
      
  <li><a href="/cc-env/index.html">Cc-env</a></li>
      
    
 
    
    
 
</ul>

      </div>
      <div class="clearfix px1 bg-white">
        <!-- main content -->
        <h2><a id="はじめに"><span class='anchor'>_</span></a>はじめに</h2>
<p>ここでは，私の Emacs の設定についてまとめています．</p>
<p>&#123;&#123;&#123;travis(uwabami/emacs)}}}
  <img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="https://img.shields.io/badge/License-GPLv3-blue.svg" />
  &#123;&#123;&#123;ghribbon(uwabami/emacs)}}}</p>
<p>基本方針は以下の通り:</p>
<h3><a id="Emacs のパッケージ(=package.el=)と [[https://github.com/quelpa/quelpa][quelpa]], [[https://github.com/jwiegley/use-package][use-package]] を使う"><span class='anchor'>_</span></a>Emacs のパッケージ(<code>package.el</code>)と <a href="https://github.com/quelpa/quelpa">quelpa</a>, <a href="https://github.com/jwiegley/use-package">use-package</a> を使う</h3>
<p>基本は <code>package.el</code> を使いますが、
  VCS からインストールしたいパッケージが幾つかあるので、
  それらについては <a href="https://github.com/quelpa/quelpa">quelpa</a> を使います。</p>
<h3><a id="Debian パッケージがインストールされているならば，それを優先する"><span class='anchor'>_</span></a>Debian パッケージがインストールされているならば，それを優先する</h3>
<p>:<a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">Eating your own dog food - Wikipedia</a></p>
<p>Emacsに関連するDebianパッケージを幾つかメンテナンスしているので，
  可能な限りDebianパッケージを使うことにしています.</p>
<h3><a id="設定は [[http://orgmode.org/][Org mode]] で書きたい"><span class='anchor'>_</span></a>設定は <a href="http://orgmode.org/">Org mode</a> で書きたい</h3>
<p>以前こんなブログ記事を書きました: <a href="http://uwabami.junkhub.org/log/20111213.html#p01">Emacsの設定ファイルをorgで書く</a></p>
<p>というわけで，設定は <a href="http://orgmode.org/worg/org-contrib/babel/intro.html">Org Babel</a> で書いています．
  本ファイル(<code>README.org</code>) から，
  Makefile 内の以下のスクリプトで <code>~/init.el</code> を生成し，byte-compile します．</p>
<div class="highlight"><pre><span></span>init.el: README.org
	$(EMACS) -q --batch --eval \
		 &quot;(progn \
		    (require &#39;ob-tangle) \
		    (org-babel-tangle-file \&quot;$&lt;\&quot; \&quot;$@\&quot; \&quot;emacs-lisp\&quot;)))&quot;
%.elc: %.el
	$(EMACS) -l $&lt; -batch -f batch-byte-compile $&lt;
</pre></div>
<h2><a id="ディレクトリ構成"><span class='anchor'>_</span></a>ディレクトリ構成</h2>
<p>分割した設定ファイル群やパッケージで install したパッケージ
  の置き場所は <code>user-emacs-directory</code> 以下にまとめています．</p>
<p>試行錯誤の結果，ディレクトリ構成は以下のようにしました:</p>
<pre class="example">
~/.emacs.d/
 |-- Makefile    ←  byte-compile 用の rule
 |-- README.org  ←  本ファイル．`org-babel-tangle&#39; で init.el を生成
 |-- elpa/       ←  package.el で導入したパッケージが置かれる場所
 |-- quelpa/     ←  quelpa で導入したパッケージが置かれる場所
 |-- share/      ←  (基本的に)参照するだけの資源置き場所
 `-- tmp/        ←  一次ファイルの置き場所
</pre>
<p>上記ディレクトリ構成を設定ファイルで使用するためにディレクトリ配置を宣言しておきます．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">when</span> <span class="nv">load-file-name</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">user-emacs-directory</span> <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nv">load-file-name</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">defconst</span> <span class="nv">my:d:share</span>
  <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;share/&quot;</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
<span class="p">(</span><span class="nf">defconst</span> <span class="nv">my:d:tmp</span>
  <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;tmp/&quot;</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
</pre></div>
<p>ついでに，
  <code>custom-set-variables</code> は別ファイルに出力，終了時に削除するようにしています．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">custom-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;custom.el&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;kill-emacs-hook</span>
          <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
            <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">custom-file</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">custom-file</span><span class="p">))))</span>
</pre></div>
<p><del>init.elが汚れる気がしてあまり好きではないのですが&#8230;皆さん気にしてないんですかね</del></p>
<h2><a id="Package 関連: =package.el=, [[https://github.com/jwiegley/use-package][use-package]], [[https://github.com/quelpa/quelpa][quelpa]]"><span class='anchor'>_</span></a>Package 関連: <code>package.el</code>, <a href="https://github.com/jwiegley/use-package">use-package</a>, <a href="https://github.com/quelpa/quelpa">quelpa</a></h2>
<p><a href="https://github.com/jwiegley/use-package">use-package</a> のおかけで、
  無いと途方に暮れるパッケージ以外のインストールは無視できるようになります。</p>
<h3><a id="=package.el="><span class='anchor'>_</span></a><code>package.el</code></h3>
<p>パッケージは基本的に <code>pacakge.el</code> で導入するので、先ずはその設定.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">url-http-attempt-keepalives</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;package</span> <span class="nv">nil</span> <span class="ss">&#39;noerror</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">package-enable-at-startup</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;package-archives</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;melpa&quot;</span> <span class="o">.</span> <span class="s">&quot;https://melpa.org/packages/&quot;</span><span class="p">)</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;package-archives</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;org&quot;</span>   <span class="o">.</span> <span class="s">&quot;http://orgmode.org/elpa/&quot;</span><span class="p">)</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">eval-when-compile</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">user-emacs-directory</span> <span class="s">&quot;tmp/bootstrap-stamp&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">package-refresh-contents</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">package-initialize</span><span class="p">)</span>
<span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">package-installed-p</span> <span class="ss">&#39;package-utils</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">package-install</span> <span class="ss">&#39;package-utils</span><span class="p">))</span>
</pre></div>
<p>また，初回起動時に <code>make</code> で org の最新版等を導入するために
  batch でインストールできる様に，以下を <code>emacs-batch-install.el</code> として出力します．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">url-http-attempt-keepalives</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;package</span> <span class="nv">nil</span> <span class="ss">&#39;noerror</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;package-archives</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;melpa&quot;</span> <span class="o">.</span> <span class="s">&quot;https://melpa.org/packages/&quot;</span><span class="p">)</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;package-archives</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;org&quot;</span>   <span class="o">.</span> <span class="s">&quot;http://orgmode.org/elpa/&quot;</span><span class="p">)</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">package-refresh-contents</span><span class="p">)</span>
<span class="p">(</span><span class="nf">package-initialize</span><span class="p">)</span>
<span class="p">(</span><span class="nf">package-install</span> <span class="nv">pkg-install</span><span class="p">)</span>
</pre></div>
<p>batch でのインストールは例えば</p>
<div class="highlight"><pre><span></span>	<span class="k">$(</span>EMACS<span class="k">)</span> -q --batch --eval <span class="se">\</span>
	  <span class="s2">&quot;(deconst pkg-install &#39;org-plus-contrib)&quot;</span> -l emacs-batch-install.el
</pre></div>
<p>とすれば良いかと.</p>
<h3><a id="[[https://github.com/jwiegley/use-package][use-package]]"><span class='anchor'>_</span></a><a href="https://github.com/jwiegley/use-package">use-package</a></h3>
<p>個々のパッケージの設定には <a href="https://github.com/jwiegley/use-package">use-package</a> を利用します．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;use-package</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">package-install</span> <span class="ss">&#39;use-package</span><span class="p">))</span>
</pre></div>
<h3><a id="[[https://github.com/quelpa/quelpa][quelpa]]"><span class='anchor'>_</span></a><a href="https://github.com/quelpa/quelpa">quelpa</a></h3>
<p>melpa に登録されていないパッケージや自作の elisp 等をインストールできる様に
  <a href="https://github.com/quelpa/quelpa">quelpa</a> を入れておきます．とはいえ、これでパッケージを入れる訳ではないので、
  melpa の同期はしません。</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">quelpa</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">quelpa-upgrade-p</span> <span class="nv">nil</span>
        <span class="nv">quelpa-checkout-melpa-p</span> <span class="nv">nil</span>
        <span class="nv">quelpa-update-melpa-p</span> <span class="nv">nil</span>
        <span class="nv">quelpa-melpa-recipe-stores</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="独自関数"><span class='anchor'>_</span></a>独自関数</h2>
<p>細かい独自関数，など．</p>
<h3><a id="カーソルのある位置の face を調べる関数"><span class='anchor'>_</span></a>カーソルのある位置の face を調べる関数</h3>
<p>わりと良く使う. 地味に便利</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:describe-face-at-point</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;%s&quot;</span> <span class="p">(</span><span class="nf">get-char-property</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="ss">&#39;face</span><span class="p">)))</span>
</pre></div>
<h3><a id="機能を無効化するための関数の定義"><span class='anchor'>_</span></a>機能を無効化するための関数の定義</h3>
<p><code>line-number-mode</code> など「有効無効をtoggleする関数」は
  慣習的に <code>0</code> 以下の数字を指定すると明示的に無効化できるので，
  <code>-1</code> を設定する関数を定義しておく.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:disable-builtin-mode</span> <span class="p">(</span><span class="nf">mode</span><span class="p">)</span>
  <span class="s">&quot;与えられた mode が存在するのであれば -1 をセットして無効化&quot;</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">fboundp</span> <span class="nv">mode</span><span class="p">)</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">mode</span> <span class="mi">-1</span><span class="p">)))</span>
</pre></div>
<h3><a id="dpkg-status"><span class='anchor'>_</span></a>dpkg-status</h3>
<p>もっと良い方法がありそうなモンですが．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:dpkg-status</span> <span class="p">(</span><span class="nf">package</span><span class="p">)</span>
  <span class="s">&quot;Return the package status from dpkg --get-selections.&quot;</span>
  <span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^ii&quot;</span> <span class="p">(</span><span class="nf">shell-command-to-string</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;dpkg -l %s&quot;</span> <span class="nv">package</span><span class="p">))))</span>
</pre></div>
<h3><a id="行末の無駄な空白/改行を削除する"><span class='anchor'>_</span></a>行末の無駄な空白/改行を削除する</h3>
<p>@see <a href="http://d.hatena.ne.jp/tototoshi/20101202/1291289625">無駄な行末の空白を削除する(Emacs Advent Calendar jp:2010)</a></p>
<p>ただし, RD や Markdown だと空白行に意味があったりするので，
  必要に応じて拡張子で判断して外している．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defvar</span> <span class="nv">my:delete-trailing-whitespace-exclude-suffix</span>
  <span class="p">(</span><span class="nb">list </span><span class="s">&quot;\\.rd$&quot;</span> <span class="s">&quot;\\.md$&quot;</span> <span class="s">&quot;\\.rbt$&quot;</span> <span class="s">&quot;\\.rab$&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:delete-trailing-whitespace</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">cond</span>
   <span class="p">((</span><span class="nf">equal</span> <span class="nv">nil</span>
           <span class="p">(</span><span class="nf">cl-loop</span> <span class="nv">for</span> <span class="nv">pattern</span> <span class="nv">in</span> <span class="nv">my:delete-trailing-whitespace-exclude-suffix</span>
                    <span class="nv">thereis</span> <span class="p">(</span><span class="nf">string-match</span> <span class="nv">pattern</span> <span class="nv">buffer-file-name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">delete-trailing-whitespace</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;before-save-hook</span> <span class="ss">&#39;my:delete-trailing-whitespace</span><span class="p">)</span>
</pre></div>
<h3><a id="空になったファイルを尋ねずに自動削除"><span class='anchor'>_</span></a>空になったファイルを尋ねずに自動削除</h3>
<p>ゴミが残らないし，地味に便利．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:delete-file-if-no-contents</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">delete-file</span>
     <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">memq </span><span class="ss">&#39;my:delete-file-if-no-contents</span> <span class="nv">after-save-hook</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">after-save-hook</span>
          <span class="p">(</span><span class="nb">cons </span><span class="ss">&#39;my:delete-file-if-no-contents</span> <span class="nv">after-save-hook</span><span class="p">)))</span>
</pre></div>
<h3><a id="scratch を殺さない. 消したら再生成"><span class='anchor'>_</span></a>scratch を殺さない. 消したら再生成</h3>
<p>&#8230;元ネタがどこだったのか忘れてしまった&#8230;</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:make-scratch</span> <span class="p">(</span><span class="nf">&amp;optional</span> <span class="nv">arg</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">progn</span>
    <span class="c1">;; &quot;*scratch*&quot; を作成して buffer-list に放り込む</span>
    <span class="p">(</span><span class="nf">set-buffer</span> <span class="p">(</span><span class="nf">get-buffer-create</span> <span class="s">&quot;*scratch*&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">funcall</span> <span class="nv">initial-major-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">erase-buffer</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="k">and </span><span class="nv">initial-scratch-message</span> <span class="p">(</span><span class="nb">not </span><span class="nv">inhibit-startup-message</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="nv">initial-scratch-message</span><span class="p">))</span>
    <span class="p">(</span><span class="k">or </span><span class="nv">arg</span>
        <span class="p">(</span><span class="nf">progn</span>
          <span class="p">(</span><span class="nf">setq</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">switch-to-buffer</span> <span class="s">&quot;*scratch*&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;*scratch* is cleared up.&quot;</span><span class="p">))</span>
          <span class="p">((</span><span class="nb">= </span><span class="nv">arg</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;another *scratch* is created&quot;</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:buffer-name-list</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="nf">function</span> <span class="nv">buffer-name</span><span class="p">)</span> <span class="p">(</span><span class="nf">buffer-list</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;kill-buffer-query-functions</span>
          <span class="c1">;; *scratch* バッファで kill-buffer したら内容を消去するだけにする</span>
          <span class="p">(</span><span class="nf">function</span> <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
                      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">string=</span> <span class="s">&quot;*scratch*&quot;</span> <span class="p">(</span><span class="nf">buffer-name</span><span class="p">))</span>
                          <span class="p">(</span><span class="nf">progn</span> <span class="p">(</span><span class="nf">my:make-scratch</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span>
                        <span class="nv">t</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;after-save-hook</span>
          <span class="c1">;; *scratch* バッファの内容を保存したら</span>
          <span class="c1">;; *scratch* バッファを新しく作る.</span>
          <span class="p">(</span><span class="nf">function</span>
           <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
             <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nb">member </span><span class="s">&quot;*scratch*&quot;</span> <span class="p">(</span><span class="nf">my:buffer-name-list</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">my:make-scratch</span> <span class="mi">1</span><span class="p">)))))</span>
</pre></div>
<h3><a id="ファイル名を minibuffer におさまる様に整形"><span class='anchor'>_</span></a>ファイル名を minibuffer におさまる様に整形</h3>
<p>zsh 風味</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:shorten-file-path</span> <span class="p">(</span><span class="nf">fpath</span> <span class="nv">max-length</span><span class="p">)</span>
  <span class="s">&quot;Show up to `max-length&#39; characters of a directory name `fpath&#39; like zsh&quot;</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">path</span> <span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nf">split-string</span> <span class="p">(</span><span class="nf">abbreviate-file-name</span> <span class="nv">fpath</span><span class="p">)</span> <span class="s">&quot;/&quot;</span><span class="p">)))</span>
         <span class="p">(</span><span class="nf">output</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">top</span> <span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nf">last</span> <span class="nv">path</span> <span class="mi">3</span><span class="p">))</span> <span class="s">&quot;/&quot;</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">vmax</span> <span class="p">(</span><span class="nb">- </span><span class="nv">max-length</span> <span class="mi">4</span> <span class="p">(</span><span class="nb">length </span><span class="nv">top</span><span class="p">)))</span>
         <span class="p">(</span><span class="nf">path</span> <span class="p">(</span><span class="nf">butlast</span> <span class="nv">path</span> <span class="mi">3</span><span class="p">))</span>
         <span class="p">)</span>
    <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="k">and </span><span class="nv">path</span>
                <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">output</span><span class="p">)</span> <span class="nv">vmax</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;/&quot;</span> <span class="p">(</span><span class="nb">car </span><span class="nv">path</span><span class="p">)</span> <span class="nv">output</span><span class="p">))</span> <span class="nv">vmax</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">setq</span> <span class="nv">output</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;/&quot;</span> <span class="p">(</span><span class="nb">car </span><span class="nv">path</span><span class="p">)</span> <span class="nv">output</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">setq</span> <span class="nv">path</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">path</span><span class="p">)))</span>
    <span class="c1">;; 省略</span>
    <span class="p">(</span><span class="nf">when</span> <span class="nv">path</span>
      <span class="p">(</span><span class="nf">setq</span> <span class="nv">output</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;/...&quot;</span> <span class="nv">output</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s%s&quot;</span> <span class="nv">top</span> <span class="nv">output</span><span class="p">)</span>
    <span class="p">))</span>
</pre></div>
<h2><a id="常に =cl-lib= を読み込む"><span class='anchor'>_</span></a>常に <code>cl-lib</code> を読み込む</h2>
<p>以前は(今も?)「 <code>cl.el</code> は名前衝突があるので byte compile 時以外は読み込まない様にしよう」
  というお話でした．つまり，</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">eval-when-compile</span> <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;cl</span><span class="p">))</span>
</pre></div>
<p>としておくこと，という．</p>
<p>今は「 <code>cl.el</code> は deprecated なので <code>cl-lib</code> を使いましょう」ということみたいです．
  名前衝突の回避のために，関数の接頭詞として <code>cl-</code> が付くようになったのは御愛嬌．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">eval-and-compile</span> <span class="p">(</span><span class="nf">use-package</span> <span class="nv">cl-lib</span><span class="p">))</span>
</pre></div>
<h2><a id="後方互換性: =el-x="><span class='anchor'>_</span></a>後方互換性: <code>el-x</code></h2>
<p>古い <code>flet</code> と同じ挙動をする <code>dflet</code> を使うために <code>el-x</code> を導入しておく</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">el-x</span>
  <span class="nv">:ensure</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<h2><a id="環境変数の読み込み: =exec-path-from-shell="><span class='anchor'>_</span></a>環境変数の読み込み: <code>exec-path-from-shell</code></h2>
<p>zsh で設定した <code>PATH</code> などの環境変数を Emacs に引き継ぐために
  <a href="https://github.com/purcell/exec-path-from-shell">purcell/exec-path-from-shell</a> を使います．
  今の所</p>
<ul>
  <li><code>SHELL</code></li>
  <li><code>DEBFULLNAME</code></li>
  <li><code>DEBEMAIL</code></li>
  <li><code>TEXMFHOME</code></li>
  <li><code>SKKSERVER</code></li>
  <li><code>http_proxy</code></li>
  <li><code>GPG_KEY_ID</code></li>
  <li><code>GPG_AGENT_INFO</code></li>
  <li><code>PASSWORD_STORE_DIR</code></li>
  <li><code>PATH</code></li>
</ul>
<p>を読み込んでいます．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defvar</span> <span class="nv">my:d:password-store</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">exec-path-from-shell</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nb">memq </span><span class="nv">window-system</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">mac</span> <span class="nv">ns</span><span class="p">))</span> <span class="p">(</span><span class="nf">exec-path-from-shell-initialize</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">exec-path-from-shell-copy-envs</span>
   <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;SHELL&quot;</span>
     <span class="s">&quot;DEBFULLNAME&quot;</span>
     <span class="s">&quot;DEBEMAIL&quot;</span>
     <span class="s">&quot;SKKSERVER&quot;</span>
     <span class="s">&quot;TEXMFHOME&quot;</span>
     <span class="s">&quot;http_proxy&quot;</span>
     <span class="s">&quot;GPG_KEY_ID&quot;</span>
     <span class="s">&quot;GPG_AGENT_INFO&quot;</span>
     <span class="s">&quot;PASSWORD_STORE_DIR&quot;</span>
     <span class="s">&quot;PATH&quot;</span>
     <span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">user-full-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;DEBFULLNAME&quot;</span><span class="p">))</span>
        <span class="nv">user-mail-address</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;DEBEMAIL&quot;</span><span class="p">))</span>
        <span class="nv">my:d:password-store</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;PASSWORD_STORE_DIR&quot;</span><span class="p">)</span> <span class="s">&quot;/Emacs/&quot;</span> <span class="nv">system-name</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="言語の設定"><span class='anchor'>_</span></a>言語の設定</h2>
<p>日本語, UTF-8 にしています.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">set-language-environment</span> <span class="s">&quot;Japanese&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">prefer-coding-system</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nf">set-file-name-coding-system</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nf">set-keyboard-coding-system</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nf">set-terminal-coding-system</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
<span class="p">(</span><span class="nf">set-default</span> <span class="ss">&#39;buffer-file-coding-system</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
</pre></div>
<p>その他, 機種依存文字等についての設定をアレコレ.</p>
<h3><a id="cp5022x.el"><span class='anchor'>_</span></a>cp5022x.el</h3>
<p>Emacs23 から内部が Unicode ベースになっています．</p>
<p>しかし文字コードの変換は GNU libc の iconv をベースにしているため，
  環境によっては文字の変換がうまく行なえません．
  そこで言語設定前に <code>cp5022x.el</code> をインストールすることにしています．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">cp5022x</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">set-charset-priority</span> <span class="ss">&#39;ascii</span> <span class="ss">&#39;japanese-jisx0208</span> <span class="ss">&#39;latin-jisx0201</span>
                        <span class="ss">&#39;katakana-jisx0201</span> <span class="ss">&#39;iso-8859-1</span> <span class="ss">&#39;unicode</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">set-coding-system-priority</span> <span class="ss">&#39;utf-8</span> <span class="ss">&#39;euc-jp</span> <span class="ss">&#39;iso-2022-jp</span> <span class="ss">&#39;cp932</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="East Asian Ambiguos 対応"><span class='anchor'>_</span></a>East Asian Ambiguos 対応</h3>
<p>CJK 以外の East Asian Ambiguos，絵文字も2文字幅にするようにしています．
  拙作の修正ロケールはこちら: <a href="https://github.com/uwabami/locale-eaw-emoji">https://github.com/uwabami/locale-eaw-emoji</a></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">package-installed-p</span> <span class="ss">&#39;locale-eaw-emoji</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">locale-eaw-emoji</span>
            <span class="nv">:fetcher</span> <span class="nv">url</span>
            <span class="nv">:url</span> <span class="s">&quot;https://raw.githubusercontent.com/uwabami/locale-eaw-emoji/master/locale-eaw-emoji.el&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">locale-eaw-emoji</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">eaw-and-emoji-fullwidth</span><span class="p">))</span>
</pre></div>
<h3><a id="OSの違いに起因する条件分岐"><span class='anchor'>_</span></a>OSの違いに起因する条件分岐</h3>
<p>Mac と Linux では同じ Unicode でも正規化が異なります
  (具体的には Mac のファイルシステムである HFS+ では Unicode の正規化が異なります).
  Unicode の正規化と Mac OS X 特有の事情については</p>
<ul>
  <li><a href="http://homepage1.nifty.com/nomenclator/unicode/normalization.htm">Unicode正規化とは</a></li>
  <li><a href="http://www.sakito.com/2010/05/mac-os-x-normalization.html">Mac OS X におけるファイル名に関するメモ(NFC, NFD等)</a></li>
</ul>
<p>等が参考になるでしょう.</p>
<p>日本語のファイル名を扱うことは滅多にないものの,
  たまに祟りがあるのでそれを回避するための設定をしています.</p>
<p>Windows の場合はファイル名などは cp932 にしているものの,
  最近 Windows 使っていないので良く知りません(というわけで，設定を捨てました).
  <del>さらに，最近は Mac OS でも Emacs 使ってないから，これが正しのか良くわからない&#8230;</del></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ucs-normalize</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">system-type</span> <span class="ss">&#39;darwin</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">set-file-name-coding-system</span> <span class="ss">&#39;utf-8-hfs</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">locale-coding-system</span> <span class="ss">&#39;utf-8-hfs</span><span class="p">)</span>
  <span class="c1">;; ついでにキーバインド: Ctrl を Mac から奪い取る</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">mac-pass-control-to-system</span> <span class="nv">t</span><span class="p">)</span>
  <span class="c1">;; Cmd と Option を逆にする</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ns-command-modifier</span> <span class="ss">&#39;meta</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ns-alternate-modifier</span> <span class="ss">&#39;super</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">global-set-key</span> <span class="p">[</span><span class="nv">ns-drag-file</span><span class="p">]</span> <span class="ss">&#39;ns-find-file</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="主にEmacs本体に同梱されている拡張に関する設定"><span class='anchor'>_</span></a>主にEmacs本体に同梱されている拡張に関する設定</h2>最近ぼちぼち他の拡張も入れる様になってきた.
<h3><a id="標準機能の設定"><span class='anchor'>_</span></a>標準機能の設定</h3>
<h4><a id="表示関連"><span class='anchor'>_</span></a>表示関連</h4>
<p>起動時のスプラッシュ画面を表示しない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">inhibit-startup-screen</span> <span class="nv">t</span>
      <span class="nv">inhibit-startup-message</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>大抵の場合ターミナル内で <code>-nw</code> として起動するし,
  メニューは触ったことないので使わないので，
  フレーム, ツールバー等を非表示にする．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">my:disable-builtin-mode</span> <span class="ss">&#39;tool-bar-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">my:disable-builtin-mode</span> <span class="ss">&#39;scroll-bar-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">my:disable-builtin-mode</span> <span class="ss">&#39;menu-bar-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">my:disable-builtin-mode</span> <span class="ss">&#39;blink-cursor-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">my:disable-builtin-mode</span> <span class="ss">&#39;column-number-mode</span><span class="p">)</span>
</pre></div>
<p>ベル無効化</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">ring-bell-function</span> <span class="ss">&#39;ignore</span><span class="p">)</span>
</pre></div>
<p>現在行のハイライト</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">global-hl-line-mode</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>選択リージョンに色付け</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">transient-mark-mode</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>対応する括弧を強調表示</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">show-paren-mode</span> <span class="nv">+1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">show-paren-style</span> <span class="ss">&#39;mixed</span><span class="p">)</span>
</pre></div>
<p>行番号を表示する <code>linum-mode</code> は基本使わない(必要に応じて有効にする)
  ので通常はモードラインに行番号や桁番号を表示しないようする.
  ついでに <code>linum-mode</code> を有効にした場合の桁表示を 5 桁に.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">my:disable-builtin-mode</span> <span class="ss">&#39;line-number-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">linum-format</span> <span class="s">&quot;%5d &quot;</span><span class="p">)</span>
</pre></div>
<p>debug は表示しない: 必要に応じて t に変更する</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">debug-on-error</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>Compile-Log の非表示:     ほとんど見ないし．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">win</span> <span class="p">(</span><span class="nf">get-buffer-window</span> <span class="s">&quot;*Compile-Log*&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">when</span> <span class="nv">win</span> <span class="p">(</span><span class="nf">delete-window</span> <span class="nv">win</span><span class="p">)))</span>
</pre></div>
<p>Warning の抑制: これもほとんど見ないし．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">byte-compile-warnings</span>
      <span class="o">&#39;</span><span class="p">(</span><span class="nv">not</span>
        <span class="nv">free-vars</span>
        <span class="nv">unresolved</span>
        <span class="nv">callargs</span>
        <span class="nv">redefine</span>
        <span class="nv">obsolete</span>
        <span class="nv">noruntime</span>
        <span class="nv">cl-functions</span>
        <span class="nv">interactive-only</span>
        <span class="nv">make-local</span>
        <span class="p">))</span>
</pre></div>
<h4><a id="編集関連"><span class='anchor'>_</span></a>編集関連</h4>
<p>yes or no を y or n に</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">fset</span> <span class="ss">&#39;yes-or-no-p</span> <span class="ss">&#39;y-or-n-p</span><span class="p">)</span>
</pre></div>
<p>ファイル名の大文字小文字を区別しない(zsh風)</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">read-file-name-completion-ignore-case</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>tab 幅 4, tab でのインデントはしない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq-default</span> <span class="nv">tab-width</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq-default</span> <span class="nv">indent-tabs-mode</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>文字列は 72 文字で折り返し(RFC2822風味)</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq-default</span> <span class="nv">fill-column</span> <span class="mi">72</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">paragraph-start</span> <span class="o">&#39;</span><span class="s">&quot;^\\([ 　・○&lt;\t\n\f]\\|(?[0-9a-zA-Z]+)\\)&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq-default</span> <span class="nv">auto-fill-mode</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>長い行の折り返し:
  デフォルトは折り返し有で <code>\C-c M-l</code> で toggle</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">set-default</span> <span class="ss">&#39;truncate-lines</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">truncate-partial-width-windows</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nf">kbd</span> <span class="s">&quot;C-c M-l&quot;</span><span class="p">)</span> <span class="ss">&#39;toggle-truncate-lines</span><span class="p">)</span>
</pre></div>
<p>バッファ終端で newline を入れない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">next-line-add-newlines</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>symlink は常においかける</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">vc-follow-symlinks</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>変更のあったファイルの自動再読み込み</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">global-auto-revert-mode</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
<p>バックアップとauto-saveの作成/位置の変更:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">auto-save-list-file-prefix</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;.saves-&quot;</span><span class="p">)</span>
      <span class="nv">auto-save-default</span> <span class="nv">t</span>
      <span class="nv">auto-save-timeout</span> <span class="mi">15</span>
      <span class="nv">auto-save-interval</span> <span class="mi">60</span>
      <span class="nv">make-backup-files</span> <span class="nv">t</span>
      <span class="nv">backup-by-copying</span> <span class="nv">t</span> <span class="c1">; symlink は使わない</span>
      <span class="nv">backup-directory-alist</span> <span class="o">`</span><span class="p">((</span><span class="s">&quot;.&quot;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">my:d:tmp</span><span class="p">))</span>
      <span class="nv">auto-save-file-name-transforms</span> <span class="o">`</span><span class="p">((</span><span class="s">&quot;.*&quot;</span> <span class="o">,</span><span class="nv">my:d:tmp</span> <span class="nv">t</span><span class="p">))</span>
      <span class="nv">version-control</span> <span class="nv">t</span>
      <span class="nv">kept-new-versions</span> <span class="mi">5</span>
      <span class="nv">kept-old-versions</span> <span class="mi">5</span>
      <span class="nv">delete-old-versions</span> <span class="nv">t</span>
      <span class="nv">delete-auto-save-files</span> <span class="nv">t</span>
      <span class="p">)</span>
</pre></div>
<p>Undo/Redo:
  そのうち undohist と undo-tree を試そうと思っているのですが，
  今のところ特に弄ってません． <code>undo-limit</code> は無限大にしたいのですが，どうするのかな&#8230;?</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">undo-limit</span> <span class="mi">200000</span>
      <span class="nv">undo-strong-limit</span> <span class="mi">260000</span><span class="p">)</span>
<span class="p">(</span><span class="nf">savehist-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">history-length</span> <span class="nv">t</span>  <span class="c1">; t で無制限</span>
      <span class="nv">savehist-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;history&quot;</span><span class="p">))</span>
</pre></div>
<h3><a id="ファイル，デイレクトリ整理"><span class='anchor'>_</span></a>ファイル，デイレクトリ整理</h3>
<p><code>~/.emacs.d/</code> 以下にファイルが転がるのがなんか嫌なので, 気がつく度に設定している.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">url</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">url-configuration-directory</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;url&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">nsm</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">featurep</span> <span class="ss">&#39;nsm</span><span class="p">)</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">nsm-settings-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;network-settings.data&quot;</span><span class="p">)))</span>
</pre></div>
<p>他にもイロイロありそう．</p>
<h3><a id="=recentf=: 最近使ったファイル履歴の保管"><span class='anchor'>_</span></a><code>recentf</code>: 最近使ったファイル履歴の保管</h3>
<p>ファイルを開く際には <code>ido-recentf-open</code> を使うので,
  結局履歴を貯める設定をしている事になっている.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">recentf</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="ss">&#39;recentf-mode</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">defmacro</span> <span class="nv">my:suppressed-message</span> <span class="p">(</span><span class="nf">&amp;rest</span> <span class="nv">body</span><span class="p">)</span>
    <span class="s">&quot;Suppress new messages temporarily in the echo area and the `*Messages*&#39; buffer while BODY is evaluated.&quot;</span>
    <span class="p">(</span><span class="nf">declare</span> <span class="p">(</span><span class="nf">indent</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">message-log-max</span> <span class="nv">nil</span><span class="p">))</span>
      <span class="o">`</span><span class="p">(</span><span class="nf">with-temp-message</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">current-message</span><span class="p">)</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">,@</span><span class="nv">body</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">recentf-max-saved-items</span> <span class="mi">256</span>
        <span class="nv">recentf-save-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;recentf&quot;</span><span class="p">))</span>
        <span class="nv">recentf-auto-cleanup</span> <span class="ss">&#39;never</span>
        <span class="nv">recentf-exclude</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;.recentf&quot;</span>
                          <span class="s">&quot;^/tmp\\.*&quot;</span>
                          <span class="s">&quot;^/private\\.*&quot;</span>
                          <span class="s">&quot;^/var/folders\\.*&quot;</span>
                          <span class="s">&quot;/TAGS$&quot;</span>
                          <span class="s">&quot;^/home/uwabami/.mozilla/\\.*&quot;</span>
                          <span class="s">&quot;\\.*草稿\\.*&quot;</span>
                          <span class="p">))</span>
  <span class="p">(</span><span class="nf">run-with-idle-timer</span> <span class="mi">30</span> <span class="nv">t</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
                               <span class="p">(</span><span class="nf">my:suppressed-message</span> <span class="p">(</span><span class="nf">recentf-save-list</span><span class="p">))))</span>
  <span class="p">)</span>
</pre></div>
<p>ディレクトリの履歴も取れるので recentf-ext を入れておく</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">recentf-ext</span>
  <span class="nv">:ensure</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<h3><a id="=.elc= と =.el= の timestamp を比較し，新しい方を読み込む"><span class='anchor'>_</span></a><code>.elc</code> と <code>.el</code> の timestamp を比較し，新しい方を読み込む</h3>
<p><code>load-prefer-newer</code> は Emacs &gt;= 24.4 から．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nf">boundp</span> <span class="ss">&#39;load-prefer-newer</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">load-prefer-newer</span> <span class="nv">t</span><span class="p">))</span>
</pre></div>
<h3><a id="ガベージコレクションの +頻度を下げる+ 表示をしない"><span class='anchor'>_</span></a>ガベージコレクションの <del>頻度を下げる</del> 表示をしない</h3>
<p>message に gc が走っていることを表示しない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">gc-cons-threshold</span> <span class="p">(</span><span class="nb">* </span><span class="mi">8</span> <span class="mi">1024</span> <span class="mi">1024</span><span class="p">)</span>
      <span class="nv">garbage-collection-messages</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p><code>gc-cons-threshold</code> はとりあえず default の設定に.
  メモリ喰いな拡張を入れている場合には, 安易に <code>gc-cons-threshold</code> を上げるのは考えものである.
  「gc が走る→大きな領域を掃除するのでその間 emacs が止まる」という事を頻繁に経験することになるだろう.</p>
<h3><a id="=abbrev=: 略語展開"><span class='anchor'>_</span></a><code>abbrev</code>: 略語展開</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">abbrev</span>
  <span class="nv">:diminish</span> <span class="nv">abbrev-mode</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">abbrev-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:share</span> <span class="s">&quot;abbrev_defs&quot;</span><span class="p">)</span>
        <span class="nv">save-abbrevs</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq-default</span> <span class="nv">abbrev-mode</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=eldoc=: emacs-lisp document"><span class='anchor'>_</span></a><code>eldoc</code>: emacs-lisp document</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">eldoc</span>
  <span class="nv">:diminish</span> <span class="nv">eldoc-mode</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;emacs-lisp-mode-hook</span> <span class="ss">&#39;turn-on-eldoc-mode</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=midnight=: 一定期間使用しなかった buffer を自動削除"><span class='anchor'>_</span></a><code>midnight</code>: 一定期間使用しなかった buffer を自動削除</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">midnight</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">clean-buffer-list-delay-general</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
<h3><a id="=uniquify=: モードラインのファイル名にディレクトリも表示する"><span class='anchor'>_</span></a><code>uniquify</code>: モードラインのファイル名にディレクトリも表示する</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">uniquify</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">uniquify-buffer-name-style</span> <span class="ss">&#39;post-forward-angle-brackets</span>
        <span class="nv">uniquify-min-dir-content</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
<h3><a id="=whitespace=: 空白の強調表示"><span class='anchor'>_</span></a><code>whitespace</code>: 空白の強調表示</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">whitespace</span>
  <span class="nv">:diminish</span> <span class="nv">global-whitespace-mode</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">whitespace-line-column</span> <span class="mi">72</span>
        <span class="nv">whitespace-style</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span>              <span class="c1">; faceを使って視覚化する．</span>
                           <span class="nv">trailing</span>          <span class="c1">; 行末の空白を対象とする．</span>
                           <span class="nv">tabs</span>              <span class="c1">; tab</span>
                           <span class="nv">spaces</span>            <span class="c1">; space</span>
                           <span class="p">)</span>
        <span class="nv">whitespace-display-mappings</span> <span class="o">&#39;</span><span class="p">((</span><span class="nf">space-mark</span> <span class="nv">?</span><span class="err">\</span><span class="nv">u3000</span> <span class="p">[</span><span class="nv">?</span><span class="err">\□</span><span class="p">])</span>
                                      <span class="p">(</span><span class="nf">tab-mark</span> <span class="nv">?</span><span class="err">\</span><span class="nv">t</span> <span class="p">[</span><span class="nv">?</span><span class="err">\</span><span class="nv">u00BB</span> <span class="nv">?</span><span class="err">\</span><span class="nv">t</span><span class="p">]</span> <span class="p">[</span><span class="nv">?</span><span class="err">\\</span> <span class="nv">?</span><span class="err">\</span><span class="nv">t</span><span class="p">]))</span>
        <span class="nv">whitespace-space-regexp</span> <span class="s">&quot;\\(\u3000+\\)&quot;</span>
        <span class="nv">whitespace-global-modes</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">not</span>
                                  <span class="nv">eww-mode</span>
                                  <span class="nv">term-mode</span>
                                  <span class="nv">eshell-mode</span>
                                  <span class="nv">org-agenda-mode</span>
                                  <span class="nv">calendar-mode</span><span class="p">)</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="nf">global-whitespace-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=saveplace=: 前回の修正位置を記憶する."><span class='anchor'>_</span></a><code>saveplace</code>: 前回の修正位置を記憶する.</h3>
<p>記憶の保存先は <code>~/.emacs.d/tmp/emacs-places</code> に変更.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">saveplace</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq-default</span> <span class="nv">save-place</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">save-place-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;emacs-places&quot;</span><span class="p">)))</span>
</pre></div>
<h3><a id="=time-stamp=: 保存時に timestamp を自動更新"><span class='anchor'>_</span></a><code>time-stamp</code>: 保存時に timestamp を自動更新</h3>
<p>デフォルトではいろいろと衝突したので
  更新文字列を変更し， <code>＄Lastupdate: 2</code> (＄は半角) があったら timestamp を更新する様にした．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">time-stamp</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">time-stamp-active</span> <span class="nv">t</span>
        <span class="nv">time-stamp-line-limit</span> <span class="mi">10</span>
        <span class="nv">time-stamp-start</span> <span class="s">&quot;$Lastupdate: 2&quot;</span>
        <span class="nv">time-stamp-end</span> <span class="s">&quot;\\$&quot;</span>
        <span class="nv">time-stamp-format</span> <span class="s">&quot;%03y-%02m-%02d %02H:%02M:%02S&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;before-save-hook</span> <span class="ss">&#39;time-stamp</span><span class="p">))</span>
</pre></div>
<p>モード独自の設定(例えば Org とか)に関しては別途．</p>
<h3><a id="=tramp=: ssh 越しにファイルを編集"><span class='anchor'>_</span></a><code>tramp</code>: ssh 越しにファイルを編集</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">tramp</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">tramp-persistency-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;tramp&quot;</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=bookmark=: bookmark ファイル"><span class='anchor'>_</span></a><code>bookmark</code>: bookmark ファイル</h3>
<p>イマイチ使いこなせてない. 場所だけ変更しておく.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">bookmark-default-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:share</span> <span class="s">&quot;bookmarks&quot;</span><span class="p">))</span>
</pre></div>
<h3><a id="=eww=: 内蔵ブラウザ"><span class='anchor'>_</span></a><code>eww</code>: 内蔵ブラウザ</h3>
<p>幅と背景色の指定がメインだが、
  上手くうごいてくれていない、ような。</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">eww</span>
  <span class="nv">:config</span>
  <span class="c1">;; vi like &lt;- vimperator, vimium に慣れてしまったので</span>
  <span class="p">(</span><span class="nf">bind-keys</span> <span class="nv">:map</span> <span class="nv">eww-mode-map</span>
             <span class="p">(</span><span class="s">&quot;r&quot;</span>  <span class="o">.</span> <span class="nv">eww-reload</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;o&quot;</span>  <span class="o">.</span> <span class="nv">eww</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;&amp;&quot;</span>  <span class="o">.</span> <span class="nv">eww-browse-with-external-browser</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;b&quot;</span>  <span class="o">.</span> <span class="nv">eww-back-url</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;]&quot;</span>  <span class="o">.</span> <span class="nv">eww-next-url</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;[&quot;</span>  <span class="o">.</span> <span class="nv">eww-previous-url</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;g&quot;</span>  <span class="o">.</span> <span class="nv">eww-top-url</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;+&quot;</span>  <span class="o">.</span> <span class="nv">my:eww-increase-width</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;-&quot;</span>  <span class="o">.</span> <span class="nv">my:eww-decrease-width</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;h&quot;</span>  <span class="o">.</span> <span class="nv">backward-char</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;j&quot;</span>  <span class="o">.</span> <span class="nv">next-line</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;k&quot;</span>  <span class="o">.</span> <span class="nv">previous-line</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;l&quot;</span>  <span class="o">.</span> <span class="nv">forward-char</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;/&quot;</span>  <span class="o">.</span> <span class="nv">isearch-forward</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;?&quot;</span>  <span class="o">.</span> <span class="nv">isearch-backward</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;n&quot;</span>  <span class="o">.</span> <span class="nv">isearch-next</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;N&quot;</span>  <span class="o">.</span> <span class="nv">isearch-previous</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&quot;f&quot;</span>  <span class="o">.</span> <span class="nv">ace-link-eww</span><span class="p">)</span>
             <span class="p">)</span>
  <span class="c1">;; eww</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;eww&quot;</span> <span class="nv">my:d:tmp</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">make-directory</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;eww&quot;</span> <span class="nv">my:d:tmp</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">eww-bookmarks-directory</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;eww&quot;</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">eww-search-prefix</span> <span class="s">&quot;https://www.google.com/search?&amp;gws_rd=cr&amp;complete=0&amp;pws=0&amp;tbs=li:1&amp;lr=lang_ja|lang_en&amp;q=&quot;</span><span class="p">)</span>
  <span class="c1">;; 背景色の設定</span>
  <span class="p">(</span><span class="nf">defvar</span> <span class="nv">eww-disable-colorize</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">shr-colorize-region--disable</span> <span class="p">(</span><span class="nf">orig</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">fg</span> <span class="nv">&amp;optional</span> <span class="nv">bg</span> <span class="nv">&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">unless</span> <span class="nv">eww-disable-colorize</span>
      <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">fg</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;shr-colorize-region</span> <span class="nv">:around</span> <span class="ss">&#39;shr-colorize-region--disable</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;eww-colorize-region</span> <span class="nv">:around</span> <span class="ss">&#39;shr-colorize-region--disable</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">eww-disable-color</span> <span class="p">()</span>
    <span class="s">&quot;eww で文字色を反映させない&quot;</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq-local</span> <span class="nv">eww-disable-colorize</span> <span class="nv">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">eww-reload</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">eww-enable-color</span> <span class="p">()</span>
    <span class="s">&quot;eww で文字色を反映させる&quot;</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq-local</span> <span class="nv">eww-disable-colorize</span> <span class="nv">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">eww-reload</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">eww-disable-images</span> <span class="p">()</span>
    <span class="s">&quot;eww で画像表示させない&quot;</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq-local</span> <span class="nv">shr-put-image-function</span> <span class="ss">&#39;shr-put-image-alt</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">eww-reload</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">eww-enable-images</span> <span class="p">()</span>
    <span class="s">&quot;eww で画像表示させる&quot;</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq-local</span> <span class="nv">shr-put-image-function</span> <span class="ss">&#39;my:shr-put-image</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">eww-reload</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:shr-put-image</span> <span class="p">(</span><span class="nf">spec</span> <span class="nv">alt</span> <span class="nv">&amp;optional</span> <span class="nv">flags</span><span class="p">)</span>
    <span class="s">&quot;call xdg-open&quot;</span>
    <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;spec: %s&quot;</span> <span class="nv">spec</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">shr-put-image</span> <span class="p">(</span><span class="nf">spec</span> <span class="nv">alt</span> <span class="nv">&amp;optional</span> <span class="nv">flags</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">shr-put-image-alt</span> <span class="p">(</span><span class="nf">spec</span> <span class="nv">alt</span> <span class="nv">&amp;optional</span> <span class="nv">flags</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">alt</span><span class="p">))</span>
  <span class="c1">;; はじめから非表示</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">eww-mode-hook--disable-image</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">setq-local</span> <span class="nv">shr-put-image-function</span> <span class="ss">&#39;shr-put-image-alt</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;eww-mode-hook</span> <span class="ss">&#39;eww-mode-hook--disable-image</span><span class="p">)</span>
  <span class="c1">;; テキスト幅の指定</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">shr-width</span> <span class="mi">78</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defvar</span> <span class="nv">my:shr-width</span> <span class="mi">78</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:shr-insert-document</span> <span class="p">(</span><span class="nf">&amp;rest</span> <span class="nv">them</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">shr-width</span> <span class="p">(</span><span class="nb">min </span><span class="p">(</span><span class="mi">1</span><span class="nv">-</span> <span class="p">(</span><span class="nf">window-width</span><span class="p">))</span> <span class="nv">my:shr-width</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">apply </span><span class="nv">them</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">eww-display-html--fill-column</span> <span class="p">(</span><span class="nf">&amp;rest</span> <span class="nv">them</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;shr-insert-document</span> <span class="nv">:around</span> <span class="ss">&#39;my:shr-insert-document</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">unwind-protect</span>
        <span class="p">(</span><span class="nb">apply </span><span class="nv">them</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">advice-remove</span> <span class="ss">&#39;shr-insert-document</span> <span class="ss">&#39;my:shr-insert-document</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;eww-display-html</span> <span class="nv">:around</span> <span class="ss">&#39;eww-display-html--fill-column</span><span class="p">)</span>
  <span class="c1">;; increase</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:eww-increase-width</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;my:shr-width</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">my:shr-width</span>  <span class="p">(</span><span class="nb">+ </span><span class="mi">10</span> <span class="nv">my:shr-width</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">eww-reload</span><span class="p">))</span>
  <span class="c1">;; decrease</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:eww-decrease-width</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;my:shr-width</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">my:shr-width</span>  <span class="p">(</span><span class="nb">- </span><span class="nv">my:shr-width</span> <span class="mi">10</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">eww-reload</span><span class="p">))</span>
  <span class="c1">;; buffer を rename</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">eww-mode-hook--rename-buffer</span> <span class="p">()</span>
    <span class="s">&quot;Rename eww browser&#39;s buffer so sites open in new page.&quot;</span>
    <span class="p">(</span><span class="nf">rename-buffer</span> <span class="s">&quot;eww&quot;</span> <span class="nv">t</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;eww-mode-hook</span> <span class="ss">&#39;eww-mode-hook--rename-buffer</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=browse-url="><span class='anchor'>_</span></a><code>browse-url</code></h3>
<p>Firefox の呼び出し方が変わったので，そのために関数を追加．
  詳細は <a href="http://www.emacswiki.org/emacs/BrowseUrl">http://www.emacswiki.org/emacs/BrowseUrl</a> を参照のこと．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">browse-url</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-c C-j&quot;</span> <span class="o">.</span> <span class="nv">browse-url-at-point</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">browse-url-firefox</span> <span class="p">(</span><span class="nf">url</span> <span class="nv">&amp;optional</span> <span class="nv">new-window</span><span class="p">)</span>
    <span class="s">&quot;@see http://www.emacswiki.org/emacs/BrowseUrl&quot;</span>
    <span class="p">(</span><span class="nf">interactive</span> <span class="p">(</span><span class="nf">browse-url-interactive-arg</span> <span class="s">&quot;URL: &quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">url</span> <span class="p">(</span><span class="nf">browse-url-encode-url</span> <span class="nv">url</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">process-environment</span> <span class="p">(</span><span class="nf">browse-url-process-environment</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">window-args</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">browse-url-maybe-new-window</span> <span class="nv">new-window</span><span class="p">)</span>
                            <span class="p">(</span><span class="k">if </span><span class="nv">browse-url-firefox-new-window-is-tab</span>
                                <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;-new-tab&quot;</span><span class="p">)</span>
                              <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;-new-window&quot;</span><span class="p">))))</span>
           <span class="p">(</span><span class="nf">ff-args</span> <span class="p">(</span><span class="nb">append </span><span class="nv">browse-url-firefox-arguments</span> <span class="nv">window-args</span> <span class="p">(</span><span class="nb">list </span><span class="nv">url</span><span class="p">)))</span>
           <span class="p">(</span><span class="nf">process-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;firefox &quot;</span> <span class="nv">url</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">process</span> <span class="p">(</span><span class="nb">apply </span><span class="ss">&#39;start-process</span> <span class="nv">process-name</span> <span class="nv">nil</span>
                           <span class="nv">browse-url-firefox-program</span> <span class="nv">ff-args</span><span class="p">)</span> <span class="p">))))</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;firefox&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">&#39;browse-url-firefox</span>
            <span class="nv">shr-external-browser</span> <span class="ss">&#39;browse-url-firefox</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">browse-url-browser-function</span> <span class="ss">&#39;eww-browse-url</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=server=: Emacs server"><span class='anchor'>_</span></a><code>server</code>: Emacs server</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">server</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">server-running-p</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">server-start</span><span class="p">)))</span>
</pre></div>
<h2><a id="=ace-link=: ace によるリンク選択"><span class='anchor'>_</span></a><code>ace-link</code>: ace によるリンク選択</h2>
<p>eww では手放せないくらい便利</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ace-link</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">with-eval-after-load</span> <span class="ss">&#39;eww</span>
    <span class="o">&#39;</span><span class="p">(</span><span class="nv">define-key</span> <span class="nv">eww-mode-map</span> <span class="s">&quot;f&quot;</span> <span class="ss">&#39;ace-link-eww</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">ace-link-setup-default</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="Elscreen [/]"><span class='anchor'>_</span></a>Elscreen [/]</h2>
<p>modeline の表示そのものは無効化しておく．</p>
<ul>
  <li>[ ] Debian パッケージ版は古い．更新すべき</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">elscreen</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">use-package</span> <span class="nv">elscreen-multi-term</span>
    <span class="nv">:ensure</span> <span class="nv">t</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">elscreen-tab-display-control</span> <span class="nv">nil</span>
        <span class="nv">elscreen-prefix-key</span> <span class="p">(</span><span class="nf">kbd</span> <span class="s">&quot;C-o&quot;</span><span class="p">)</span>
        <span class="nv">elscreen-display-tab</span> <span class="mi">8</span>
        <span class="nv">elscreen-display-screen-number</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">elscreen-start</span><span class="p">))</span>
</pre></div>
<h2><a id="shell との連携"><span class='anchor'>_</span></a>shell との連携</h2>
<h3><a id="multi-term"><span class='anchor'>_</span></a>multi-term</h3>
<p>あまり使っていないけれど.
  <del>これをメインに使うようになったら, 多分 zsh は止めた方が良いかも</del></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">multi-term</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;term-mode-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="nf">bind-keys</span> <span class="nv">:map</span> <span class="nv">term-raw-map</span>
                         <span class="p">(</span><span class="s">&quot;C-y&quot;</span> <span class="o">.</span> <span class="nv">term-paste</span><span class="p">)</span>
                         <span class="p">)))</span>
  <span class="p">(</span><span class="nf">setq</span>  <span class="nv">multi-term-program</span> <span class="nv">shell-file-name</span>
         <span class="nv">multi-term-program</span> <span class="s">&quot;/bin/zsh&quot;</span>
         <span class="nv">term-unbind-key-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;C-o&quot;</span> <span class="s">&quot;C-z&quot;</span> <span class="s">&quot;C-x&quot;</span> <span class="s">&quot;C-c&quot;</span> <span class="s">&quot;C-h&quot;</span> <span class="s">&quot;C-y&quot;</span> <span class="s">&quot;&lt;ESC&gt;&quot;</span><span class="p">)</span>
         <span class="nv">ansi-color-names-vector</span>
         <span class="p">[</span><span class="nv">unspecified</span> <span class="s">&quot;#242424&quot;</span> <span class="s">&quot;#FF4c4c&quot;</span> <span class="s">&quot;#4cff4c&quot;</span> <span class="s">&quot;#ffff4c&quot;</span>
                      <span class="s">&quot;#4c4cff&quot;</span> <span class="s">&quot;#ff4cff&quot;</span> <span class="s">&quot;#4cffff&quot;</span> <span class="s">&quot;#f6f3e8&quot;</span><span class="p">]</span>
         <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="elscreen + zsh での連携"><span class='anchor'>_</span></a>elscreen + zsh での連携</h3>
<p>詳細は</p>
<ul>
  <li><a href="https://masutaka.net/chalow/2011-09-28-1.html">ターミナルの zsh と Emacs を風のように駆け抜ける！</a></li>
  <li><a href="http://syohex.hatenablog.com/entry/20111026/1319606395">cdeを改良</a></li>
  <li><a href="https://qiita.com/__hage/items/2dd732b4dd68e124e8bd">cdeとelscreen-separate-buffer-listの相性が悪い</a></li>
</ul>
<p>などを参考に.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">return-current-working-directory-to-shell</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">expand-file-name</span>
   <span class="p">(</span><span class="nf">with-current-buffer</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">featurep</span> <span class="ss">&#39;elscreen</span><span class="p">)</span>
           <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">frame-confs</span> <span class="p">(</span><span class="nf">elscreen-get-frame-confs</span> <span class="p">(</span><span class="nf">selected-frame</span><span class="p">)))</span>
                  <span class="p">(</span><span class="nf">num</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">&#39;screen-history</span> <span class="nv">frame-confs</span><span class="p">)))</span>
                  <span class="p">(</span><span class="nf">cur-window-conf</span>
                   <span class="p">(</span><span class="nb">assoc </span><span class="ss">&#39;window-configuration</span>
                          <span class="p">(</span><span class="nb">assoc </span><span class="nv">num</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">&#39;screen-property</span> <span class="nv">frame-confs</span><span class="p">))))</span>
                  <span class="p">(</span><span class="nf">marker</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="nv">cur-window-conf</span><span class="p">)))</span>
             <span class="p">(</span><span class="nf">marker-buffer</span> <span class="nv">marker</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span>
              <span class="p">(</span><span class="nb">assoc </span><span class="ss">&#39;buffer-list</span>
                     <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">current-frame-configuration</span><span class="p">))))))</span>
     <span class="nv">default-directory</span><span class="p">)))</span>
</pre></div>
<h2><a id="日本語入力: =ddskk="><span class='anchor'>_</span></a>日本語入力: <code>ddskk</code></h2>
<p><a href="http://openlab.ring.gr.jp/skk/ddskk-ja.html">Daredevil SKK (DDSKK)</a> をメインで使用中．無いと途方に暮れる．
  ちなみにGTKが有効になっていると <code>gtk-immodule</code> なんかと衝突するので
  <code>~/.Xresources</code> で xim を無効にしておくと良い．
  例えば以下の様に:</p>
<div class="highlight"><pre><span></span><span class="o">!</span> <span class="n">disable</span> <span class="no">XIM</span>
<span class="no">Emacs</span><span class="o">*</span><span class="ss">useXIM</span><span class="p">:</span> <span class="kp">false</span>
</pre></div>
<h3><a id="Emacs 本体側の設定"><span class='anchor'>_</span></a>Emacs 本体側の設定</h3>
<p>実際の設定は別ファイルで行なわれるため
  ここでは設定ファイルの位置変更を変更している．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">skk</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x j&quot;</span>   <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-x C-j&quot;</span> <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-\\&quot;</span>    <span class="o">.</span> <span class="nv">skk-mode</span><span class="p">))</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-user-directory</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;skk&quot;</span><span class="p">)</span>
        <span class="nv">skk-init-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">user-emacs-directory</span> <span class="s">&quot;init-ddskk&quot;</span><span class="p">)</span>
        <span class="nv">default-input-method</span> <span class="s">&quot;japanese-skk&quot;</span> <span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="DDSKK 本体の設定"><span class='anchor'>_</span></a>DDSKK 本体の設定</h3>
<p>sticky shift: <a href="http://homepage1.nifty.com/blankspace/emacs/sticky.html">sticky shift</a> を参照のこと.
  ddskk の 14.2 以降から同梱されるようになった(ありがたい)</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-sticky-key</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>
</pre></div>
<p>変換候補の表示位置</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-show-candidates-always-pop-to-buffer</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>候補表示件数を2列に</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-henkan-show-candidates-rows</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
<p>日本語表示しない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-japanese-message-and-error</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>メニューを日本語にしない -&gt; toolbar 非表示だし.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-show-japanese-menu</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>注釈の表示</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-show-annotation</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>インジケータの表示のカスタマイズ</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-latin-mode-string</span> <span class="s">&quot;[_A]&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-hiragana-mode-string</span> <span class="s">&quot;[あ]&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-katakana-mode-string</span> <span class="s">&quot;[ア]&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-jisx0208-latin-mode-string</span> <span class="s">&quot;[Ａ]&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-jisx0201-mode-string</span> <span class="s">&quot;[_ｱ]&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-abbrev-mode-string</span> <span class="s">&quot;[aA]&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-indicator-use-cursor-color</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>インジケータを左端に表示</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-status-indicator</span> <span class="ss">&#39;left</span><span class="p">)</span>
</pre></div>
<p>mode-line が動くのが許せないので，ちょっと修正</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defadvice</span> <span class="nv">skk-make-indicator-alist</span>
    <span class="p">(</span><span class="nf">after</span> <span class="nv">my:set-skk-default-indicator</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">dolist</span> <span class="p">(</span><span class="nf">elem</span>
           <span class="o">&#39;</span><span class="p">((</span><span class="nf">abbrev</span> <span class="s">&quot; [aA]&quot;</span> <span class="o">.</span> <span class="s">&quot;--[aA]:&quot;</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">latin</span> <span class="s">&quot; [_A]&quot;</span> <span class="o">.</span> <span class="s">&quot;--[_A]:&quot;</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">default</span> <span class="s">&quot; [--]&quot;</span> <span class="o">.</span> <span class="s">&quot;--[--]:&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">ad-return-value</span>
          <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">cons </span><span class="nv">elem</span> <span class="nv">nil</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">delq</span> <span class="p">(</span><span class="nb">assoc </span><span class="p">(</span><span class="nb">car </span><span class="nv">elem</span><span class="p">)</span> <span class="nv">ad-return-value</span><span class="p">)</span> <span class="nv">ad-return-value</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-show-inline</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>カーソルには色をつけない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-use-color-cursor</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h4><a id="編集関連"><span class='anchor'>_</span></a>編集関連</h4>
<p>キーバインド</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">global-set-key</span> <span class="s">&quot;\C-x\C-j&quot;</span> <span class="ss">&#39;skk-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">global-set-key</span> <span class="s">&quot;\C-xj&quot;</span> <span class="ss">&#39;skk-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">global-set-key</span> <span class="s">&quot;\C-j&quot;</span> <span class="ss">&#39;skk-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">global-set-key</span> <span class="s">&quot;\C-\\&quot;</span> <span class="ss">&#39;skk-mode</span><span class="p">)</span>
</pre></div>
<p>半角カナを入力</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-use-jisx0201-input-method</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>Enter で改行しない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-egg-like-newline</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>&#8220;「&#8221;を入力したら&#8221;」&#8221;も自動で挿入</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-auto-insert-paren</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>句読点変換ルール</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-kuten-touten-alist</span>
      <span class="o">&#39;</span><span class="p">(</span>
        <span class="p">(</span><span class="nf">jp</span>    <span class="o">.</span> <span class="p">(</span><span class="s">&quot;。&quot;</span> <span class="o">.</span> <span class="s">&quot;、&quot;</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">en-jp</span> <span class="o">.</span> <span class="p">(</span><span class="s">&quot;．&quot;</span> <span class="o">.</span> <span class="s">&quot;，&quot;</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">en</span>    <span class="o">.</span> <span class="p">(</span><span class="s">&quot;. &quot;</span> <span class="o">.</span> <span class="s">&quot;, &quot;</span><span class="p">))</span>
        <span class="p">))</span>
<span class="p">(</span><span class="nf">setq-default</span> <span class="nv">skk-kutouten-type</span> <span class="ss">&#39;en</span><span class="p">)</span>
</pre></div>
<p>全角記号の変換: @ での日付入力は使わない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-rom-kana-rule-list</span>
      <span class="p">(</span><span class="nb">append </span><span class="nv">skk-rom-kana-rule-list</span>
              <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;!&quot;</span> <span class="nv">nil</span> <span class="s">&quot;!&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="s">&quot;:&quot;</span> <span class="nv">nil</span> <span class="s">&quot;:&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="s">&quot;;&quot;</span> <span class="nv">nil</span> <span class="s">&quot;;&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="s">&quot;?&quot;</span> <span class="nv">nil</span> <span class="s">&quot;?&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="s">&quot;z &quot;</span> <span class="nv">nil</span> <span class="s">&quot;　&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="s">&quot;\\&quot;</span> <span class="nv">nil</span> <span class="s">&quot;\\&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="s">&quot;@&quot;</span> <span class="nv">nil</span> <span class="s">&quot;@&quot;</span><span class="p">)</span>
                <span class="p">)))</span>
</pre></div>
<p>送り仮名が厳密に正しい候補を優先</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-henkan-strict-okuri-precedence</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>辞書の共有</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-share-private-jisyo</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>変換候補を縦に表示</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-show-inline</span> <span class="ss">&#39;vertical</span><span class="p">)</span>
</pre></div>
<h4><a id="インクリメンタルサーチ"><span class='anchor'>_</span></a>インクリメンタルサーチ</h4>
<p>minibuffer 内では強制的に skk off.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;skk-mode-hook</span>
          <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
            <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">skk-in-minibuffer-p</span><span class="p">)</span>
                 <span class="p">(</span><span class="nf">skk-mode-exit</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-isearch-start-mode</span> <span class="ss">&#39;latin</span><span class="p">)</span>
</pre></div>
<p>インクリメンタルサーチは migemo に任せることに．</p>
<h4><a id="辞書の設定"><span class='anchor'>_</span></a>辞書の設定</h4>
<p>追加している辞書の一覧は</p>
<ul>
  <li><a href="http://www.chibutsu.org/jisho/">地球物理辞書</a></li>
  <li><a href="http://www.geocities.jp/living_with_plasma/tanudic.html">天文・天体物理用語の漢字変換用辞書</a></li>
  <li>はてなキーワード</li>
  <li><a href="http://matsucon.net/material/dic/">2ちゃんねる顔文字辞書 MatsuCon</a></li>
  <li><a href="http://matsucon.net/">MatsuCon</a></li>
</ul>
<p>といった所.
  はてなキーワードからの辞書の抽出は <a href="http://d.hatena.ne.jp/znz">znz</a> さんの</p>
<ul>
  <li><a href="http://rubyist.g.hatena.ne.jp/znz/20060924/p1">「はてなダイアリーキーワードふりがなリスト」を SKK の辞書に変換</a></li>
</ul>
<p>を参考に.
  <a href="http://matsucon.net/">MatsuCon</a> で公開されている顔文字に関しては
  顔文字に ; や が含まれている場合に, 適宜quoteする必要があるので
  以下のスクリプトで適当に変換.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env ruby</span>
<span class="nb">require</span> <span class="s1">&#39;nkf&#39;</span>
<span class="n">src</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="k">if</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1</span>
  <span class="nb">puts</span> <span class="s2">&quot;usage: ime2skk.rb ime_dictionary&quot;</span>
  <span class="nb">exit</span> <span class="mi">0</span>
<span class="k">end</span>
<span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="p">&#123;</span><span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="n">f</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
    <span class="n">line_euc</span> <span class="o">=</span> <span class="no">NKF</span><span class="o">.</span><span class="n">nkf</span><span class="p">(</span><span class="s2">&quot;-S -e&quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">line_euc</span> <span class="o">=~</span> <span class="sr">/^([^!]+?)\t(.+?)\t.+$/</span>
      <span class="n">entry</span> <span class="o">=</span> <span class="vg">$1</span>
      <span class="n">content</span> <span class="o">=</span> <span class="vg">$2</span>
      <span class="k">if</span> <span class="n">content</span> <span class="o">=~</span><span class="sr">/;/</span>
        <span class="nb">puts</span> <span class="n">entry</span> <span class="o">+</span> <span class="s2">&quot; /(concat </span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">content</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;\\\\073&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)/&quot;</span>
      <span class="k">elsif</span> <span class="n">content</span> <span class="o">=~</span><span class="sr">/\//</span>
        <span class="nb">puts</span> <span class="n">entry</span> <span class="o">+</span> <span class="s2">&quot; /(concat </span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">content</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;\\\\057&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)/&quot;</span>
      <span class="k">else</span>
        <span class="nb">puts</span> <span class="n">entry</span> <span class="o">+</span> <span class="s2">&quot; /&quot;</span> <span class="o">+</span> <span class="n">content</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="p">}</span>
</pre></div>
<p>他にも quote する必要あるような気もするけれど, それは気がついた時に.</p>
<p>辞書サーバの指定は以下.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">cond</span>
 <span class="p">((</span><span class="nf">getenv</span> <span class="s">&quot;SKKSERVER&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-server-host</span> <span class="s">&quot;127.0.0.1&quot;</span>
        <span class="nv">skk-server-portnum</span> <span class="s">&quot;1178&quot;</span>
        <span class="nv">skk-large-jisyo</span>  <span class="nv">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;skk-search-prog-list</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="nv">skk-server-completion-search</span><span class="p">)</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;skk-search-prog-list</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="nv">skk-comp-by-server-completion</span><span class="p">)</span> <span class="nv">t</span><span class="p">))</span>
 <span class="p">(</span><span class="nf">t</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-get-jisyo-directory</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;skk-jisyo&quot;</span><span class="p">)</span>
        <span class="nv">skk-large-jisyo</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">skk-get-jisyo-directory</span> <span class="s">&quot;/SKK-JISYO.L&quot;</span><span class="p">)))</span>
 <span class="p">)</span>
<span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="s">&quot;/usr/local/share/skkdic/SKK-JISYO.emoji.utf8&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-extra-jisyo-file-list</span>
        <span class="p">(</span><span class="nb">list </span><span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;/usr/local/share/skkdic/SKK-JISYO.emoji.utf8&quot;</span> <span class="o">.</span> <span class="nv">utf-8</span><span class="p">))))</span>
</pre></div>
<p>辞書登録の際に送り仮名を削除</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-check-okurigana-on-touroku</span> <span class="ss">&#39;auto</span><span class="p">)</span>
</pre></div>
<p>漢字登録のミスをチェックする</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-check-okurigana-on-touroku</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<h4><a id="動的補完"><span class='anchor'>_</span></a>動的補完</h4>
<p>まだ設定していない&#8230;</p>
<div class="highlight"><pre><span></span><span class="c1">;; ;; 動的補完</span>
<span class="c1">;; (setq skk-dcomp-activate t)</span>
<span class="c1">;; (setq skk-dcomp-multiple-activate t)</span>
<span class="c1">;; (setq skk-dcomp-multiple-rows 5)</span>
<span class="c1">;; ;; 動的補完の複数表示群のフェイス</span>
<span class="c1">;; (set-face-foreground &#39;skk-dcomp-multiple-face &quot;Black&quot;)</span>
<span class="c1">;; (set-face-background &#39;skk-dcomp-multiple-face &quot;LightGoldenrodYellow&quot;)</span>
<span class="c1">;; (set-face-bold-p &#39;skk-dcomp-multiple-face nil)</span>
<span class="c1">;; ;; 動的補完の複数表示郡の補完部分のフェイス</span>
<span class="c1">;; (set-face-foreground &#39;skk-dcomp-multiple-trailing-face &quot;dim gray&quot;)</span>
<span class="c1">;; (set-face-bold-p &#39;skk-dcomp-multiple-trailing-face nil)</span>
<span class="c1">;; ;; 動的補完の複数表示郡の選択対象のフェイス</span>
<span class="c1">;; (set-face-foreground &#39;skk-dcomp-multiple-selected-face &quot;White&quot;)</span>
<span class="c1">;; (set-face-background &#39;skk-dcomp-multiple-selected-face &quot;LightGoldenrod4&quot;)</span>
<span class="c1">;; (set-face-bold-p &#39;skk-dcomp-multiple-selected-face nil)</span>
</pre></div>
<h4><a id="部首変換, 総画数変換"><span class='anchor'>_</span></a>部首変換, 総画数変換</h4>
<p>上手く使いこなせていない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;skk-search-prog-list</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="nv">skk-tankan-search</span> <span class="ss">&#39;skk-search-jisyo-file</span>
                                 <span class="nv">skk-large-jisyo</span> <span class="mi">10000</span><span class="p">))</span>
</pre></div>
<h2><a id="Copy & Paste: =xclip="><span class='anchor'>_</span></a>Copy &amp; Paste: <code>xclip</code></h2>
<p><code>xclip</code> で clipboard とデータをやりとり．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">xclip</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;xclip&quot;</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">xclip-mode</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
<p>clipboard と PRIMARY の同期には <code>gpaste</code> を使っている．</p>
<h2><a id="インクリメンタル検索: =migemo="><span class='anchor'>_</span></a>インクリメンタル検索: <code>migemo</code></h2>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">migemo</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;cmigemo&quot;</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">migemo-command</span> <span class="s">&quot;cmigemo&quot;</span>
        <span class="nv">migemo-options</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;-q&quot;</span> <span class="s">&quot;--emacs&quot;</span><span class="p">)</span>
        <span class="nv">migemo-dictionary</span> <span class="s">&quot;/usr/share/cmigemo/utf-8/migemo-dict&quot;</span>
        <span class="nv">migemo-user-dictionary</span> <span class="nv">nil</span>
        <span class="nv">migemo-regex-dictionary</span> <span class="nv">nil</span>
        <span class="nv">migemo-coding-system</span> <span class="ss">&#39;utf-8-unix</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">migemo-init</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="補完: =ido="><span class='anchor'>_</span></a>補完: <code>ido</code></h2>
<p>補完は <code>ido</code> が軽いし速いので好み.
  見た目がちょっと簡素すぎる気もするので、なんとか弄りたい所ではある。</p>
<h3><a id="=ido= の設定"><span class='anchor'>_</span></a><code>ido</code> の設定</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ido</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x C-f&quot;</span> <span class="o">.</span> <span class="nv">ido-find-file</span><span class="p">)</span>
         <span class="c1">;; (&quot;C-x d&quot;   . ido-dired)</span>
         <span class="c1">;; (&quot;C-x C-d&quot; . ido-dired)</span>
         <span class="c1">;; (&quot;C-x b&quot;   . ibuffer)</span>
         <span class="c1">;; (&quot;C-x C-b&quot; . ibuffer)</span>
         <span class="c1">;; (&quot;C-x M-b&quot; . ibuffer)</span>
         <span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">ido-mode</span> <span class="nv">t</span><span class="p">)</span>
  <span class="c1">;; (ido-everywhere t)  &lt;- Wanderlust みたいに，過去の選択を覚えている奴と相性悪い.</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ido-enable-prefix</span> <span class="nv">nil</span>             <span class="c1">; prefix match 入力を先頭一致可能</span>
        <span class="nv">ido-confirm-unique-completion</span> <span class="nv">t</span>   <span class="c1">; TAB で名前の一致まで. その後 RET で実行</span>
        <span class="nv">ido-enable-flex-matching</span> <span class="nv">t</span>        <span class="c1">; flx matching を試す際には prefix を無効化すること</span>
        <span class="nv">ido-enable-dot-prefix</span> <span class="nv">t</span>           <span class="c1">; . を prefix として扱う</span>
        <span class="nv">ido-default-file-method</span>   <span class="ss">&#39;selected-window</span>
        <span class="nv">ido-default-buffer-method</span> <span class="ss">&#39;selected-window</span>
        <span class="nv">ido-max-directory-size</span> <span class="mi">10000</span>
        <span class="nv">ido-enable-tramp-completion</span> <span class="nv">nil</span>
        <span class="nv">ido-use-faces</span> <span class="nv">t</span>
        <span class="nv">ido-ignore-extensions</span> <span class="nv">t</span>
        <span class="nv">ido-cannot-complete-command</span> <span class="ss">&#39;ido-next-match</span>
        <span class="nv">ido-save-directory-list-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;ido.last&quot;</span><span class="p">))</span>
  <span class="c1">;; 補完で無視する拡張子の追加．そのうち増える．</span>
  <span class="p">(</span><span class="nf">cl-loop</span> <span class="nv">for</span> <span class="nv">ext</span> <span class="nv">in</span>
           <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;.dvi&quot;</span>
             <span class="s">&quot;.fdb_latexmk&quot;</span>
             <span class="s">&quot;.fls&quot;</span>
             <span class="s">&quot;.ilg&quot;</span>
             <span class="s">&quot;.jqz&quot;</span>
             <span class="s">&quot;.mod&quot;</span>
             <span class="s">&quot;.nav&quot;</span>
             <span class="s">&quot;.out&quot;</span>
             <span class="s">&quot;.snm&quot;</span>
             <span class="s">&quot;.synctex.gz&quot;</span>
             <span class="s">&quot;.vrb&quot;</span>
             <span class="p">)</span>
           <span class="k">do </span><span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;completion-ignored-extensions</span> <span class="nv">ext</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;ido-setup-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ido-completion-map</span> <span class="p">(</span><span class="nf">kbd</span> <span class="s">&quot;C-h&quot;</span><span class="p">)</span> <span class="ss">&#39;ido-delete-backward-updir</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">define-key</span> <span class="nv">ido-completion-map</span> <span class="p">(</span><span class="nf">kbd</span> <span class="s">&quot;C-l&quot;</span><span class="p">)</span> <span class="ss">&#39;ido-delete-backward-updir</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:ido-disable-line-trucation</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">set</span> <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;truncate-lines</span><span class="p">)</span> <span class="nv">nil</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;ido-minibuffer-setup-hook</span> <span class="ss">&#39;my:ido-disable-line-trucation</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=flx-ido=: flex match の強化"><span class='anchor'>_</span></a><code>flx-ido</code>: flex match の強化</h3>
<p>曖昧マッチが非常に直感的になった．地味に便利で手放せない．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">flx-ido</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">flx-ido-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">flx-ido-use-faces</span> <span class="nv">nil</span>
        <span class="nv">flx-ido-threshold</span> <span class="mi">10000</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=ido-grid-mode=: 候補を並べて表示"><span class='anchor'>_</span></a><code>ido-grid-mode</code>: 候補を並べて表示</h3>
<p>横に並ぶと正直シンドイので並べてみる。</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">package-installed-p</span> <span class="ss">&#39;ido-grid</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ido-grid</span>
            <span class="nv">:fetcher</span> <span class="nv">github</span>
            <span class="nv">:repo</span> <span class="s">&quot;larkery/ido-grid.el&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">ido-grid</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ido-grid-enabled</span> <span class="nv">t</span>
        <span class="nv">ido-grid-start-small</span> <span class="nv">nil</span>
        <span class="nv">ido-grid-rows</span> <span class="mf">0.15</span>
        <span class="nv">ido-grid-max-columns</span> <span class="nv">nil</span>
        <span class="nv">ido-grid-indent</span> <span class="mi">1</span>
        <span class="nv">ido-grid-column-padding</span> <span class="mi">3</span>
        <span class="nv">ido-grid-bind-keys</span> <span class="nv">t</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="nf">ido-grid-enable</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:ido-grid-force-one-columns</span> <span class="p">(</span><span class="nf">o</span> <span class="nv">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">ido-grid-max-columns</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">;; single vertical col</span>
          <span class="p">(</span><span class="nf">ido-grid-start-small</span> <span class="nv">nil</span><span class="p">)</span> <span class="c1">;; popup immediately</span>
          <span class="p">(</span><span class="nf">ido-grid-rows</span> <span class="mf">0.15</span><span class="p">))</span> <span class="c1">;; 15% of frame height</span>
      <span class="p">(</span><span class="nb">apply </span><span class="nv">o</span> <span class="nv">args</span><span class="p">)</span>
      <span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="=ido-recentf=: recentf を ido で"><span class='anchor'>_</span></a><code>ido-recentf</code>: recentf を ido で</h3>
<p>&#8220;recentf-list&#8221; の結果を整形して, minibuffer に納まる様に縮小したり</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">ido-recentf-open</span> <span class="p">()</span>
  <span class="s">&quot;Use `ido-completing-read&#39; to \\[find-file] a recent file&quot;</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">files</span> <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span>
                         <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">my:shorten-file-path</span> <span class="nv">f</span> <span class="mi">77</span><span class="p">)</span> <span class="nv">f</span><span class="p">))</span>
                       <span class="nv">recentf-list</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">selected</span> <span class="p">(</span><span class="nf">ido-completing-read</span> <span class="s">&quot;Files: &quot;</span> <span class="p">(</span><span class="nf">mapcar</span> <span class="o">#</span><span class="ss">&#39;car</span> <span class="nv">files</span><span class="p">))))</span>
      <span class="p">(</span><span class="nf">find-file</span> <span class="p">(</span><span class="nf">assoc-default</span> <span class="nv">selected</span> <span class="nv">files</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">bind-key</span> <span class="s">&quot;C-x C-r&quot;</span> <span class="ss">&#39;ido-recentf-open</span><span class="p">)</span>
</pre></div>
<h3><a id="=smex="><span class='anchor'>_</span></a><code>smex</code></h3>
<p>M-x を ido で。</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">smex</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;M-x&quot;</span> <span class="o">.</span> <span class="nv">smex</span><span class="p">))</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">smex-auto-update</span> <span class="nv">t</span>
        <span class="nv">smex-save-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;smex-items&quot;</span><span class="p">)</span>
        <span class="nv">smex-prompt-string</span> <span class="s">&quot;smex: &quot;</span>
        <span class="nv">smex-flex-matching</span> <span class="nv">nil</span>
        <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="[[http://syohex.hatenablog.com/entry/20130914/1379166283][zoom-window]]"><span class='anchor'>_</span></a><a href="http://syohex.hatenablog.com/entry/20130914/1379166283">zoom-window</a></h2>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">zoom-window</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:bind</span> <span class="p">(</span><span class="s">&quot;C-x C-z&quot;</span> <span class="o">.</span> <span class="nv">zoom-window-zoom</span><span class="p">)</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">zoom-window-use-elscreen</span> <span class="nv">t</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">zoom-window-setup</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">zoom-window-mode-line-color</span> <span class="s">&quot;#7fff7f&quot;</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="認証関連: =id-manager=, =plstore=, =oauth2=, =password-store="><span class='anchor'>_</span></a>認証関連: <code>id-manager</code>, <code>plstore</code>, <code>oauth2</code>, <code>password-store</code></h2>
<h3><a id="id-manager の設定"><span class='anchor'>_</span></a>id-manager の設定</h3>
<p>ID と Password の簡単な組の管理をするのに非常に重宝していました.
  最近は <code>password-store</code> を使う様になったので, そのうち移行します.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">id-manager</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="s">&quot;~/.gnupg/idm-db.gpg&quot;</span><span class="p">)</span>
  <span class="nv">:bind</span> <span class="p">(</span><span class="s">&quot;M-7&quot;</span> <span class="o">.</span> <span class="nv">idm-open-list-command</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">idm-database-file</span>
        <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;~/.gnupg/idm-db.gpg&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">idm-clipboard-expire-time-sec</span> <span class="mi">30</span><span class="p">))</span>
</pre></div>
<h3><a id="plstore"><span class='anchor'>_</span></a>plstore</h3>
<p>デフォルトは対称鍵暗号化なので， <code>GPG_KEY_ID</code> を設定しておく</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">plstore</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">plstore-secret-keys</span> <span class="ss">&#39;silent</span>
        <span class="nv">plstore-encrypt-to</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;GPG_KEY_ID&quot;</span><span class="p">)))</span>
</pre></div>
<h3><a id="oauth2"><span class='anchor'>_</span></a>oauth2</h3>
<p>oauth2 の認証情報は <code>plstore</code> で保存される．
  ファイルの置き場所と暗号鍵の設定をしておく</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">oauth2</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">oauth2-token-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;oauth2.plstore&quot;</span><span class="p">)))</span>
</pre></div>
<h3><a id="password-store"><span class='anchor'>_</span></a>password-store</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">password-store</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;pass&quot;</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="auth-password-store"><span class='anchor'>_</span></a>auth-password-store</h3>
<p>auth-source として <code>password-store</code> を使う拡張</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">auth-source-pass</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;pass&quot;</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="Emacs-w3m"><span class='anchor'>_</span></a>Emacs-w3m</h2>
<p>あまり使わないけれど, 一応設定しておく.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">w3m</span>
  <span class="nv">:defer</span> <span class="nv">t</span>
  <span class="nv">:disabled</span> <span class="nv">t</span>
  <span class="nv">:bind</span> <span class="p">(</span><span class="nf">:w3m-mode-map</span>
         <span class="p">(</span><span class="s">&quot;&lt;left&gt;&quot;</span>  <span class="o">.</span> <span class="nv">backward-char</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;&lt;right&gt;&quot;</span> <span class="o">.</span> <span class="nv">forward-char</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;&lt;up&gt;&quot;</span>    <span class="o">.</span> <span class="nv">previous-line</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;&lt;down&gt;&quot;</span>  <span class="o">.</span> <span class="nv">next-line</span><span class="p">)</span>
         <span class="nv">:w3m-minor-mode-map</span>
         <span class="p">(</span><span class="s">&quot;&lt;left&gt;&quot;</span>  <span class="o">.</span> <span class="nv">backward-char</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;&lt;right&gt;&quot;</span> <span class="o">.</span> <span class="nv">forward-char</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;&lt;up&gt;&quot;</span>    <span class="o">.</span> <span class="nv">previous-line</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;&lt;down&gt;&quot;</span>  <span class="o">.</span> <span class="nv">next-line</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">w3m-search-default-engine</span> <span class="s">&quot;google&quot;</span>
        <span class="nv">w3m-use-cookies</span> <span class="nv">t</span>
        <span class="c1">;; w3m-fill-column -4</span>
        <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="MUA の設定: =wanderlust="><span class='anchor'>_</span></a>MUA の設定: <code>wanderlust</code></h2>MUA として Wanderlust を使っている
<h3><a id="Emacs 本体側の設定"><span class='anchor'>_</span></a>Emacs 本体側の設定</h3>
<p>Emacs 本体での設定は以下の通り. Wanderlust 自体の設定は別ファイルで行なわれる．
  ここでは <code>wl-init-file</code> を指定することで，設定ファイルを明示している．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">wl</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">my:dpkg-status</span> <span class="s">&quot;wl&quot;</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">my:dpkg-status</span> <span class="s">&quot;wl-beta&quot;</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">my:dpkg-status</span> <span class="s">&quot;rail&quot;</span><span class="p">))</span>
  <span class="nv">:commands</span> <span class="p">(</span><span class="nf">wl</span> <span class="nv">wl-other-frame</span> <span class="nv">wl-draft</span> <span class="nv">wl-user-agent</span> <span class="nv">wl-user-agent-compose</span> <span class="nv">wl-draft-send</span> <span class="nv">wl-draft-kill</span><span class="p">)</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">define-mail-user-agent</span>
    <span class="ss">&#39;wl-user-agent</span>
    <span class="ss">&#39;wl-user-agent-compose</span>
    <span class="ss">&#39;wl-draft-send</span>
    <span class="ss">&#39;wl-draft-kill</span>
    <span class="ss">&#39;mail-send-hook</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-msgdb-directory</span> <span class="s">&quot;~/.cache/wanderlust&quot;</span>
        <span class="nv">elmo-maildir-folder-path</span> <span class="s">&quot;~/.cache/wanderlust&quot;</span>
        <span class="nv">elmo-cache-directory</span> <span class="s">&quot;~/.cache/wanderlust&quot;</span>
        <span class="nv">wl-score-files-directory</span> <span class="s">&quot;~/.cache/wanderlust&quot;</span>
        <span class="nv">wl-init-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">user-emacs-directory</span> <span class="s">&quot;init-wl&quot;</span><span class="p">)</span>
        <span class="nv">mail-user-agent</span> <span class="ss">&#39;wl-user-agent</span>
        <span class="nv">read-mail-command</span> <span class="ss">&#39;wl</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">elmo-msgdb-directory</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-directory</span> <span class="nv">elmo-msgdb-directory</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">elmo-msgdb-directory</span> <span class="s">&quot;/local&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">make-directory</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">elmo-msgdb-directory</span> <span class="s">&quot;/local&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">elmo-msgdb-directory</span> <span class="s">&quot;/local/Trash&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">make-directory</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">elmo-msgdb-directory</span> <span class="s">&quot;/local/Trash&quot;</span><span class="p">)))</span>
  <span class="p">)</span>
</pre></div>
<p>割と <code>/etc/emacs/site-start.d/65wl-beta.el</code> と重複している気がするが&#8230;</p>
<h3><a id="Wanderlust 本体の設定"><span class='anchor'>_</span></a>Wanderlust 本体の設定</h3>
<p>実際の設定は以下の通り</p>
<h4><a id="依存/追加ライブラリのインストールと読み込み"><span class='anchor'>_</span></a>依存/追加ライブラリのインストールと読み込み</h4>
<h5><a id="rail"><span class='anchor'>_</span></a>rail</h5>
<p>SEMI や FLIM などの UA の表示に <a href="http://uwabami.github.com/rail/">rail</a> を使っている.
  ちなみに rail を有効にすると, 以下の様に User-Agent が表示される</p>
<p><img src="https://uwabami.github.io/software/rail/images/wanderlust_with_or_without_rail.png" alt="https://uwabami.github.io/software/rail/images/wanderlust_with_or_without_rail.png" /></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">eval-when-compile</span> <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;mime-def</span><span class="p">))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">rail</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">rail-emulate-genjis</span> <span class="nv">t</span><span class="p">))</span>
</pre></div>
<h5><a id="cp5022x を使う"><span class='anchor'>_</span></a>cp5022x を使う</h5>
<p>ISO-2022-JP を CP50220 として扱う.
  <a href="http://d.hatena.ne.jp/kiwanami/20091103/1257243524">Wanderlustと文字コード</a> も参照のこと.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;mime-charset-coding-system-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">iso-2022-jp</span> <span class="o">.</span> <span class="nv">cp50220</span><span class="p">))</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-mime-charset</span> <span class="ss">&#39;iso-2022-jp</span><span class="p">)</span>
</pre></div>
<h5><a id="elscreen-wl"><span class='anchor'>_</span></a>elscreen-wl</h5>
<p>メール作成時に <code>elscreen</code> と連携してくれる．便利</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">elscreen-wl</span><span class="p">)</span>
</pre></div>
<h5><a id="SEMI の追加設定"><span class='anchor'>_</span></a>SEMI の追加設定</h5>
<p>HTML メールを表示するために eww を使う.
  mime-setup がロードされる前に記述する必要あり.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-view-text/html-previewer</span> <span class="ss">&#39;shr</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-setup-enable-inline-html</span> <span class="ss">&#39;shr</span><span class="p">)</span>
<span class="c1">;; 幅指定 → 実際の関数は eww の設定を参照</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:mime-shr-preview-text/html</span> <span class="p">(</span><span class="nf">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;shr-insert-document</span> <span class="nv">:around</span> <span class="ss">&#39;my:shr-insert-document</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">unwind-protect</span>
      <span class="p">(</span><span class="nb">apply </span><span class="nv">args</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">advice-remove</span> <span class="ss">&#39;shr-insert-document</span> <span class="ss">&#39;my:shr-insert-document</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;mime-shr-preview-text/html</span> <span class="nv">:around</span>
            <span class="ss">&#39;my:mime-shr-preview-text/html</span><span class="p">)</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">mime-setup</span><span class="p">)</span>
</pre></div>
<p>どのアプリケーションで開くか → <code>xdg-open</code> に丸投げ．</p>
<div class="highlight"><pre><span></span><span class="c1">;; (setq mime-view-mailcap-files &#39;(&quot;~/.mailcap&quot;))</span>
</pre></div>
<p><code>~/.mailcap</code> 自体は以下</p>
<div class="highlight"><pre><span></span><span class="n">applications</span><span class="o">/*</span><span class="p">;</span> <span class="n">xdg</span><span class="o">-</span><span class="nb">open</span> <span class="sx">%s;</span>
<span class="sx">image/*;</span> <span class="n">xdg</span><span class="o">-</span><span class="nb">open</span> <span class="sx">%s;</span>
<span class="sx">video/*;</span> <span class="n">xdg</span><span class="o">-</span><span class="nb">open</span> <span class="o">%</span><span class="n">s</span><span class="p">;</span>
</pre></div>
<p>MIME の例の保存先の変更</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-situation-examples-file</span>
      <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;mime-example&quot;</span><span class="p">))</span>
</pre></div>
<p>text/plain を html より優先</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-view-type-subtype-score-alist</span>
      <span class="o">&#39;</span><span class="p">(((</span><span class="nf">text</span> <span class="o">.</span> <span class="nv">plain</span><span class="p">)</span> <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">((</span><span class="nf">text</span> <span class="o">.</span> <span class="nv">html</span><span class="p">)</span>  <span class="o">.</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">))</span>
</pre></div>
<p>音を鳴らすアレやコレの無効化</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-play-find-every-situations</span> <span class="nv">nil</span>
      <span class="nv">mime-play-delete-file-immediately</span> <span class="nv">nil</span>
      <span class="nv">process-connection-type</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h4><a id="個人情報の設定"><span class='anchor'>_</span></a>個人情報の設定</h4>
<p>具体的な設定内容は以下のファイルに置いている</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">load </span><span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:password-store</span> <span class="s">&quot;/wl-info.gpg&quot;</span><span class="p">))</span>
</pre></div>
<p>設定している内容は以下の通り</p>
<h5><a id="自身のメールアドレスと購読メーリングリストの設定"><span class='anchor'>_</span></a>自身のメールアドレスと購読メーリングリストの設定</h5>
<div class="highlight"><pre><span></span><span class="c1">;; From: の設定</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-from</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">user-full-name</span> <span class="s">&quot; &lt;&quot;</span> <span class="nv">user-mail-address</span> <span class="s">&quot;&gt;&quot;</span><span class="p">))</span>
<span class="c1">;; (system-name) が FQDN を返さない場合、</span>
<span class="c1">;; `wl-local-domain&#39; にホスト名を除いたドメイン名を設定</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-local-domain</span> <span class="s">&quot;example.com&quot;</span><span class="p">)</span>
<span class="c1">;; 自分のメールアドレスのリスト</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-user-mail-address-list</span>
      <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">wl-address-header-extract-address</span> <span class="nv">wl-from</span><span class="p">)</span>
            <span class="c1">;; &quot;e-mail2@example.com&quot;</span>
            <span class="c1">;; &quot;e-mail3@example.net&quot; ...</span>
            <span class="p">))</span>
<span class="c1">;; 自分の参加しているメーリングリストのリスト</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-subscribed-mailing-list</span>
      <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;wl@lists.airs.net&quot;</span>
        <span class="s">&quot;apel-ja@m17n.org&quot;</span>
        <span class="s">&quot;emacs-mime-ja@m17n.org&quot;</span>
        <span class="c1">;; &quot;ml@example.com&quot; ...</span>
        <span class="p">))</span>
</pre></div>
<h5><a id="送受信用サーバの設定"><span class='anchor'>_</span></a>送受信用サーバの設定</h5>
<p>受信(IMAP)</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-imap4-default-server</span> <span class="s">&quot;your imap server&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-imap4-default-port</span> <span class="ss">&#39;993</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-imap4-default-stream-type</span> <span class="ss">&#39;ssl</span><span class="p">)</span>
</pre></div>
<p>送信(SMTP)</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-smtp-posting-server</span> <span class="s">&quot;your smtp server&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-smtp-posting-user</span> <span class="s">&quot;your account&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-smtp-posting-port</span> <span class="mi">587</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-smtp-connection-type</span> <span class="ss">&#39;starttls</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-smtp-authenticate-type</span> <span class="s">&quot;login&quot;</span><span class="p">)</span>
</pre></div>
<h5><a id="From に応じて送信サーバをきりかえる."><span class='anchor'>_</span></a>From に応じて送信サーバをきりかえる.</h5>
<p>本来はメール作成時/返信時の template の切り替えなのだれど,
  送信時の SMTP の設定を from に合わせてきりかえるようにする.
  default に二重に指定しているのは，
  一度別のアカウントに切り替えた後に再びトグルして戻って来た際に元に戻す(上書き)するため.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-template-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;default&quot;</span>
         <span class="p">(</span><span class="s">&quot;From&quot;</span> <span class="o">.</span> <span class="nv">wl-from</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">&quot;your smtp server&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">&quot;your account&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">&#39;starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">&quot;login&quot;</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;example1&quot;</span>
         <span class="p">(</span><span class="s">&quot;From&quot;</span> <span class="o">.</span> <span class="s">&quot;Your Name &lt;account@example1.com&gt;&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">&quot;smtp.example1.com&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">&quot;your account&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">&#39;starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">&quot;login&quot;</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;example2&quot;</span>
         <span class="p">(</span><span class="s">&quot;From&quot;</span> <span class="o">.</span> <span class="s">&quot;Your Name &lt;account@example2.com&gt;&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">&quot;smtp.example2.com&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">&quot;your account&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">587</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">&#39;starttls</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="s">&quot;plain&quot;</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;ssh:smtp&quot;</span>
         <span class="c1">;; need ssh tunnel</span>
         <span class="c1">;; ssh -f -N -L 20025:localhost:25 smtp.server.com</span>
         <span class="p">(</span><span class="s">&quot;From&quot;</span> <span class="o">.</span> <span class="s">&quot;Your Name &lt;account@example3.com&gt;&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-server</span> <span class="o">.</span> <span class="s">&quot;localhost&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-user</span> <span class="o">.</span> <span class="s">&quot;your ssh account&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-posting-port</span> <span class="o">.</span> <span class="mi">20025</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-connection-type</span> <span class="o">.</span> <span class="ss">&#39;nil</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">wl-smtp-authenticate-type</span> <span class="o">.</span> <span class="ss">&#39;nil</span><span class="p">)</span>
         <span class="p">)</span>
        <span class="p">))</span>
</pre></div>
<p>ssh tunnel を自動的にやる事はできないモンだろうか
  (送信時に open して, 送信後に close する, みたいなの).</p>
<p>ついでに template の切り替えに関して幾つか設定.</p>
<div class="highlight"><pre><span></span><span class="c1">;; template 切り替え時に 内容を表示</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-template-visible-select</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p><code>draft-mode</code> で <code>C-c C-n</code> をするとテンプレートを切り替え</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">&quot;\C-c\C-n&quot;</span> <span class="ss">&#39;wl-template-select</span><span class="p">)</span>
</pre></div>
<p>from に応じて wl-from, wl-envelope-from,
  送信 smtp サーバを変更する送信時に変更</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;wl-draft-send-hook</span>
          <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
            <span class="p">(</span><span class="nf">set</span> <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;wl-from</span><span class="p">)</span>
                 <span class="p">(</span><span class="nf">std11-fetch-field</span> <span class="s">&quot;From&quot;</span><span class="p">))))</span>
</pre></div>
<p>送信時に自動的に wl-draft-config-alist を適用&#8230;しない?</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">remove-hook</span> <span class="ss">&#39;wl-draft-send-hook</span> <span class="ss">&#39;wl-draft-config-exec</span><span class="p">)</span>
</pre></div>
<h4><a id="基本設定"><span class='anchor'>_</span></a>基本設定</h4>
<h5><a id="imap 関連"><span class='anchor'>_</span></a>imap 関連</h5>
<p>デフォルトの認証設定
  フォルダ名は UTF-7 でエンコードされているので,
  表示する際にこれをデコードする</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-imap4-use-modified-utf7</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<h5><a id="非同期チェック"><span class='anchor'>_</span></a>非同期チェック</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-folder-check-async</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<h5><a id="フォルダの位置の default からの変更"><span class='anchor'>_</span></a>フォルダの位置の default からの変更</h5>
<p><code>~/.cache/wanderlust/</code> に集約している
  local の Mail folder の位置</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-maildir-folder-path</span> <span class="s">&quot;~/.cache/wanderlust&quot;</span>
      <span class="nv">elmo-localdir-folder-path</span> <span class="s">&quot;~/.cache/wanderlust/local&quot;</span><span class="p">)</span>
</pre></div>
<p>local フォルダの設定:
  <code>.lost+found</code> は <code>elmo-maildir-folder-path</code> からの相対パスになっていることに注意</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-lost+found-folder</span> <span class="s">&quot;.lost+found&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-queue-folder</span> <span class="s">&quot;+queue&quot;</span><span class="p">)</span>
</pre></div>
<p>folders の位置の変更</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-folders-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:password-store</span> <span class="s">&quot;/wl-folders.gpg&quot;</span><span class="p">))</span>
</pre></div>
<p>Drafts, Trash の置き場所</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-draft-folder</span> <span class="s">&quot;+Drafts&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-trash-folder</span> <span class="s">&quot;+Trash&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-lost+found-folder</span> <span class="s">&quot;+lost+found&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-temporary-file-directory</span> <span class="s">&quot;~/Downloads/&quot;</span><span class="p">)</span>
</pre></div>
<p>アドレス帳</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-use-petname</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-address-file</span>  <span class="s">&quot;~/.mua/Address&quot;</span><span class="p">)</span>
</pre></div>
<p>LDAP サーバからアドレスを引くことも可能.
  以前は GCALDaemon を使って local に ldap サーバを上げていたのだけれども,
  Google Contacts の API が変わったらしく
  GCALDaemon で LDAP サーバは使えなくなったのでコメントアウト.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-use-ldap</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-ldap-server</span> <span class="s">&quot;localhost&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-ldap-port</span> <span class="s">&quot;389&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-ldap-base</span> <span class="s">&quot;dc=math,dc=kyoto-u,dc=ac,dc=jp&quot;</span><span class="p">)</span>
</pre></div>
<p>パスワードの保存先</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-passwd-alist-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:password-store</span> <span class="s">&quot;/wl-passwd.gpg&quot;</span><span class="p">))</span>
</pre></div>
<h5><a id="フォルダ編集時に backup を作成しない."><span class='anchor'>_</span></a>フォルダ編集時に backup を作成しない.</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-fldmgr-make-backup</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h5><a id="FCC, BCC の設定"><span class='anchor'>_</span></a>FCC, BCC の設定</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-fcc</span> <span class="nv">nil</span><span class="p">)</span>
     <span class="c1">;; (setq wl-fcc &quot;%Sent&quot;)</span>
</pre></div>
<p>fcc を既読にする場合は以下．=wl-fcc= が nil の場合には意味は無い</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-fcc-force-as-read</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>bcc は常に自身に.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-bcc</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">user-mail-address</span><span class="p">))</span>
</pre></div>
<h5><a id="起動時に =%INBOX= のみをチェック"><span class='anchor'>_</span></a>起動時に <code>%INBOX</code> のみをチェック</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-auto-check-folder-name</span> <span class="s">&quot;%INBOX&quot;</span><span class="p">)</span>
</pre></div>
<h5><a id="フォルダ選択時の初期設定"><span class='anchor'>_</span></a>フォルダ選択時の初期設定</h5>
<p>imap の namespace を毎度入力するのが面倒なので，これを追加しておく.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-default-spec</span> <span class="s">&quot;%&quot;</span><span class="p">)</span>
</pre></div>
<h5><a id="confirm 関連の設定"><span class='anchor'>_</span></a>confirm 関連の設定</h5>
<p>スキャン時の問い合わせの無効化.
  ちなみに confirm を nil にしても 問い合わせが無いだけで
  threshold は効くので, 明示的に nil に.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-folder-update-confirm</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-folder-update-threshold</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-message-fetch-confirm</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-message-fetch-threshold</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-prefetch-confirm</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-prefetch-threshold</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>終了時に確認しない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-interactive-exit</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>送信時は確認する   :tangle init-wl.el</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-interactive-send</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<h5><a id="misc."><span class='anchor'>_</span></a>misc.</h5>
<p>大きいメッセージを送信時に分割しない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-edit-split-message</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>スレッドは常に閉じる</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-thread-insert-opened</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>3 pain 表示 -&gt; 使わない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-stay-folder-window</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>未読を優先的に読む</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-move-order</span> <span class="ss">&#39;unread</span><span class="p">)</span>
</pre></div>
<p>改ページ無視</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-break-pages</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>icon を使わない → GUI でもメニュー表示してないし, 体感的には遅くなる</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-highlight-folder-with-icon</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h5><a id="dispose, delete の設定"><span class='anchor'>_</span></a>dispose, delete の設定</h5>
<p>Gmail用に%INBOXでは削除を <code>wl-trash-folder</code> への移動ではなく，「delete」に．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;wl-dispose-folder-alist</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;^%INBOX&quot;</span> <span class="o">.</span> <span class="nv">remove</span><span class="p">))</span>
</pre></div>
<p>迷惑メール関連も</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;wl-dispose-folder-alist</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;.*Junk$&quot;</span> <span class="o">.</span> <span class="nv">remove</span><span class="p">))</span>
</pre></div>
<h5><a id="折り返しの設定"><span class='anchor'>_</span></a>折り返しの設定</h5>
<p>message は折り返す.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-message-truncate-lines</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<p>draft も折り返す</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-draft-truncate-lines</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h5><a id="mode-line の設定"><span class='anchor'>_</span></a>mode-line の設定</h5>
<p>長いと嫌なのでイロイロ削る</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-mode-line-format</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="c1">; &quot;%f &#123;%t}(%n/%u/%a)&quot;</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-message-mode-line-format</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="c1">; &quot;&lt;&lt; %f:%F&gt;&gt; [%m]&quot;</span>
</pre></div>
<h4><a id="キーバインド関連"><span class='anchor'>_</span></a>キーバインド関連</h4>
<p><code>use-package</code> で設定しておいた方が良いかなぁ&#8230;
  <code>C-c C-j</code> を browse-url に明け渡す</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">&quot;\C-c\C-j&quot;</span> <span class="ss">&#39;browse-url-at-point</span><span class="p">)</span>
</pre></div>
<p><code>M-u</code> で unread にする</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">&quot;\M-u&quot;</span> <span class="ss">&#39;wl-summary-mark-as-unread</span><span class="p">)</span>
</pre></div>
<p><code>i</code> で sync &lt;- Mew 風</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">&quot;i&quot;</span> <span class="ss">&#39;wl-summary-sync-update</span><span class="p">)</span>
</pre></div>
<p><code>C-o</code> は elscreen で使う</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">&quot;\C-o&quot;</span> <span class="nv">nil</span> <span class="p">)</span>
</pre></div>
<p><code>M-o</code> で <code>auto-refile</code>  (Mew 風)</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">&quot;\M-o&quot;</span> <span class="ss">&#39;wl-summary-auto-refile</span><span class="p">)</span>
</pre></div>
<h4><a id="flag とフォルダを行き来する関数の追加"><span class='anchor'>_</span></a>flag とフォルダを行き来する関数の追加</h4>
<p>&#8221;=&#8221; でフラグ付きフォルダと
  実際にメッセージのあるフォルダを行き来する.
  Gmail の「スター付き」フォルダでも有効</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;elmo</span> <span class="nv">nil</span> <span class="ss">&#39;noerror</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:wl-summary-jump-to-referer-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nf">wl-summary-message-number</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">elmo-folder-type-internal</span> <span class="nv">wl-summary-buffer-elmo-folder</span><span class="p">)</span> <span class="ss">&#39;flag</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">progn</span>
          <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">referer</span> <span class="p">(</span><span class="nf">elmo-flag-folder-referrer</span>
                           <span class="nv">wl-summary-buffer-elmo-folder</span>
                           <span class="p">(</span><span class="nf">wl-summary-message-number</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nf">folder</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">referer</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
                             <span class="p">(</span><span class="nf">completing-read</span>
                              <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Jump to (%s): &quot;</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">car </span><span class="nv">referer</span><span class="p">)))</span>
                              <span class="nv">referer</span>
                              <span class="nv">nil</span> <span class="nv">t</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">car </span><span class="nv">referer</span><span class="p">)))</span>
                           <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">car </span><span class="nv">referer</span><span class="p">)))))</span>
            <span class="p">(</span><span class="nf">wl-summary-goto-folder-subr</span> <span class="nv">folder</span> <span class="ss">&#39;no-sync</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">wl-summary-jump-to-msg</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">assoc </span><span class="nv">folder</span> <span class="nv">referer</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">elmo-folder-type</span> <span class="nv">wl-summary-last-visited-folder</span><span class="p">)</span> <span class="ss">&#39;internal</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">wl-summary-goto-last-visited-folder</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-summary-mode-map</span> <span class="s">&quot;=&quot;</span> <span class="ss">&#39;my:wl-summary-jump-to-referer-message</span><span class="p">)</span>
</pre></div>
<h4><a id="summary-mode の表示のカスタマイズ"><span class='anchor'>_</span></a>summary-mode の表示のカスタマイズ</h4>
<h5><a id="自分が差出人である mail は To:某 と表示"><span class='anchor'>_</span></a>自分が差出人である mail は To:某 と表示</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-showto-folder-regexp</span> <span class="s">&quot;.*&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-from-function</span> <span class="ss">&#39;wl-summary-default-from</span><span class="p">)</span>
</pre></div>
<h5><a id="サマリ行の表示関連"><span class='anchor'>_</span></a>サマリ行の表示関連</h5>
<p>サマリ行のフォーマット指定</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-line-format</span>
      <span class="s">&quot;%T%P%1@%1&gt;%Y/%M/%D %21(%t%[%19(%c %f%)%]%) %#%~%s&quot;</span>
      <span class="nv">wl-summary-width</span> <span class="mi">84</span><span class="p">)</span>
</pre></div>
<p>サマリ表示は切り詰めない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-subject-length-limit</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>スレッドの幅の指定</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-thread-indent-level</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-thread-have-younger-brother-str</span> <span class="s">&quot;+&quot;</span>
      <span class="nv">wl-thread-youngest-child-str</span> <span class="s">&quot;+&quot;</span>
      <span class="nv">wl-thread-vertical-str</span> <span class="s">&quot;|&quot;</span>
      <span class="nv">wl-thread-horizontal-str</span> <span class="s">&quot;-&quot;</span>
      <span class="nv">wl-thread-space-str</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
</pre></div>
<p>以下の二つの設定を有効にするには
  <code>elmo-msgdb-extra-fields</code> を設定する必要がある.
  この変数は振り分け判定にも使用するのでそこで設定している</p>
<h5><a id="Gmail 風に, 自分宛のメールに ">&#8221; をつけて表示する&#8221;><span class='anchor'>_</span></a>Gmail 風に, 自分宛のメールに &#8220;&gt;&#8221; をつけて表示する</h5>
<p>元ネタ <a href="http://d.hatena.ne.jp/khiker/20080206/wanderlust">http://d.hatena.ne.jp/khiker/20080206/wanderlust</a></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-user-mail-address-regexp</span> <span class="s">&quot;^uwabami.*\\|^sasakyh.*&quot;</span><span class="p">)</span>
<span class="c1">;; 一覧表示での置き換え規則に追加</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:wl-summary-line-for-me</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">catch</span> <span class="ss">&#39;found</span>
        <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">to</span> <span class="p">(</span><span class="nf">elmo-message-entity-field</span> <span class="nv">wl-message-entity</span> <span class="ss">&#39;to</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nf">elmo-message-entity-field</span> <span class="nv">wl-message-entity</span> <span class="ss">&#39;cc</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">stringp</span> <span class="nv">to</span><span class="p">)</span> <span class="nv">cc</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">setq</span> <span class="nv">to</span>
                  <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">stringp</span> <span class="nv">to</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">to</span><span class="p">)</span> <span class="nv">to</span><span class="p">)</span>
                          <span class="p">(</span><span class="nf">when</span> <span class="nv">cc</span>
                            <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">stringp</span> <span class="nv">cc</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">cc</span><span class="p">)</span> <span class="nv">cc</span><span class="p">)))))</span>
          <span class="p">(</span><span class="nf">dolist</span> <span class="p">(</span><span class="nf">i</span> <span class="nv">to</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nf">wl-address-user-mail-address-p</span> <span class="p">(</span><span class="nf">eword-decode-string</span> <span class="nv">i</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">throw</span> <span class="ss">&#39;found</span> <span class="nv">t</span><span class="p">)))))</span>
      <span class="s">&quot;&gt;&quot;</span>
    <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="c1">;; &gt; を summary-line-format に追加</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-line-format-spec-alist</span>
      <span class="p">(</span><span class="nb">append </span><span class="nv">wl-summary-line-format-spec-alist</span>
              <span class="o">&#39;</span><span class="p">((</span><span class="nf">?&gt;</span> <span class="p">(</span><span class="nf">my:wl-summary-line-for-me</span><span class="p">)))))</span>
</pre></div>
<h5><a id="添付ファイルがあったら, サマリ行に "@" を付ける"><span class='anchor'>_</span></a>添付ファイルがあったら, サマリ行に &#8220;@&#8221; を付ける</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-line-format-spec-alist</span>
      <span class="p">(</span><span class="nb">append </span><span class="nv">wl-summary-line-format-spec-alist</span>
              <span class="o">&#39;</span><span class="p">((</span><span class="nf">?@</span> <span class="p">(</span><span class="nf">wl-summary-line-attached</span><span class="p">)))))</span>
</pre></div>
<h5><a id="クォートされた文字列もデコードする"><span class='anchor'>_</span></a>クォートされた文字列もデコードする</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-header-lexical-analyzer</span>
      <span class="o">&#39;</span><span class="p">(</span>
        <span class="c1">;; eword-analyze-quoted-string</span>
        <span class="nv">eword-analyze-domain-literal</span>
        <span class="nv">eword-analyze-comment</span>
        <span class="nv">eword-analyze-spaces</span>
        <span class="nv">eword-analyze-special</span>
        <span class="nv">eword-analyze-encoded-word</span>
        <span class="nv">eword-analyze-atom</span><span class="p">))</span>
</pre></div>
<h5><a id="Subject が変わってもスレッドを切らない"><span class='anchor'>_</span></a>Subject が変わってもスレッドを切らない</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-divide-thread-when-subject-changed</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h5><a id="Subject での Tab や複数スペースを無視"><span class='anchor'>_</span></a>Subject での Tab や複数スペースを無視</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defadvice</span> <span class="nv">std11-unfold-string</span> <span class="p">(</span><span class="nf">after</span> <span class="nv">simply</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ad-return-value</span>
        <span class="p">(</span><span class="nf">elmo-replace-in-string</span> <span class="nv">ad-return-value</span> <span class="s">&quot;[ \t]+&quot;</span> <span class="s">&quot; &quot;</span><span class="p">)))</span>
</pre></div>
<h5><a id="重複メッセージを非表示に"><span class='anchor'>_</span></a>重複メッセージを非表示に</h5>
<p>フォルダ内の Message-ID が同じメールを非表示にする</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-folder-process-duplicates-alist</span>
      <span class="o">&#39;</span><span class="p">(</span>
        <span class="p">(</span><span class="s">&quot;.*&quot;</span> <span class="o">.</span> <span class="nv">hide</span><span class="p">)</span>
        <span class="p">))</span>
</pre></div>
<h5><a id="sort 順: 返信が来た順"><span class='anchor'>_</span></a>sort 順: 返信が来た順</h5>
<p><code>flet</code> を書き換えるのが面倒で <code>el-x</code> にある <code>dflet</code> を使うように変更</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">wl-summary-overview-entity-compare-by-reply-date</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="s">&quot;Compare message A and B by latest date of replies including thread.&quot;</span>
  <span class="p">(</span><span class="nf">dflet</span> <span class="p">((</span><span class="nf">string-max2</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span>
                       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">string&lt;</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">y</span><span class="p">)</span>
                             <span class="p">(</span><span class="ss">&#39;t</span> <span class="nv">x</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">thread-number-get-date</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nf">timezone-make-date-sortable</span> <span class="p">(</span><span class="nf">elmo-msgdb-overview-entity-get-date</span>
                                                                <span class="p">(</span><span class="nf">elmo-message-entity</span>
                                                                 <span class="nv">wl-summary-buffer-elmo-folder</span> <span class="nv">x</span><span class="p">))))</span>
          <span class="p">(</span><span class="nf">thread-get-family</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
                             <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="p">(</span><span class="nf">wl-thread-entity-get-descendant</span> <span class="p">(</span><span class="nf">wl-thread-get-entity</span> <span class="nv">x</span><span class="p">))))</span>
          <span class="p">(</span><span class="nf">max-reply-date</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
                          <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">eq</span> <span class="ss">&#39;nil</span> <span class="nv">x</span><span class="p">)</span>
                                 <span class="ss">&#39;nil</span><span class="p">)</span>
                                <span class="p">((</span><span class="nf">eq</span> <span class="ss">&#39;nil</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nf">thread-number-get-date</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">)))</span>
                                <span class="p">(</span><span class="ss">&#39;t</span>
                                 <span class="p">(</span><span class="nf">string-max2</span> <span class="p">(</span><span class="nf">thread-number-get-date</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
                                              <span class="p">(</span><span class="nf">max-reply-date</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="nf">string&lt;</span>
     <span class="p">(</span><span class="nf">max-reply-date</span> <span class="p">(</span><span class="nf">thread-get-family</span> <span class="p">(</span><span class="nf">elmo-message-entity-number</span> <span class="nv">a</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">max-reply-date</span> <span class="p">(</span><span class="nf">thread-get-family</span> <span class="p">(</span><span class="nf">elmo-message-entity-number</span> <span class="nv">b</span><span class="p">))))))</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;wl-summary-sort-specs</span> <span class="ss">&#39;reply-date</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-default-sort-spec</span> <span class="ss">&#39;reply-date</span><span class="p">)</span>
</pre></div>
<h4><a id="振り分け設定"><span class='anchor'>_</span></a>振り分け設定</h4>
<p><code>$</code> 以外を振り分け対象に</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-summary-auto-refile-skip-marks</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;$&quot;</span><span class="p">))</span>
</pre></div>
<h5><a id="振り分け判定に使用するヘッダ"><span class='anchor'>_</span></a>振り分け判定に使用するヘッダ</h5>
<p>添付の有無の表示にも使うので <code>Content-Type</code> も登録.
  あと <code>Delivered-To</code> はメールの検索の時に結構重宝している.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-msgdb-extra-fields</span>
      <span class="o">&#39;</span><span class="p">(</span>
        <span class="s">&quot;List-Post&quot;</span>
        <span class="s">&quot;List-Id&quot;</span>
        <span class="s">&quot;List-ID&quot;</span>                  <span class="c1">;; たまに List-ID で来るメールあるよね?</span>
        <span class="s">&quot;Resent-CC&quot;</span>
        <span class="s">&quot;Mailing-List&quot;</span>
        <span class="s">&quot;X-Mailing-List&quot;</span>
        <span class="s">&quot;X-ML-Address&quot;</span>
        <span class="s">&quot;X-ML-Name&quot;</span>
        <span class="s">&quot;X-ML-To&quot;</span>
        <span class="s">&quot;Delivered-To&quot;</span>
        <span class="s">&quot;Content-Type&quot;</span>              <span class="c1">;; 添付の有無の表示の為に追加</span>
        <span class="s">&quot;X-Google-Appengine-App-Id&quot;</span> <span class="c1">;; GAEの送信するメールの振り分け用</span>
        <span class="s">&quot;To&quot;</span>
        <span class="s">&quot;Cc&quot;</span>
        <span class="s">&quot;From&quot;</span>
        <span class="s">&quot;Subject&quot;</span>
        <span class="s">&quot;Reply-To&quot;</span>
        <span class="s">&quot;Auto-Submitted&quot;</span>            <span class="c1">;; Git commit/Cron notify</span>
        <span class="p">))</span>
</pre></div>
<h4><a id="メッセージ表示"><span class='anchor'>_</span></a>メッセージ表示</h4>
<h5><a id="いったん全て非表示に"><span class='anchor'>_</span></a>いったん全て非表示に</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-message-ignored-field-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;^.*:&quot;</span><span class="p">))</span>
</pre></div>
<h5><a id="見たいヘッダだけ表示"><span class='anchor'>_</span></a>見たいヘッダだけ表示</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-message-visible-field-list</span>
      <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;^Subject:&quot;</span>
        <span class="s">&quot;^From:&quot;</span>
        <span class="s">&quot;^To:&quot;</span>
        <span class="s">&quot;^Cc:&quot;</span>
        <span class="s">&quot;^Date:&quot;</span>
        <span class="s">&quot;^Message-ID:&quot;</span>
        <span class="p">))</span>
</pre></div>
<h5><a id="表示順の変更"><span class='anchor'>_</span></a>表示順の変更</h5>
<p>Mew 風&#8230;</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-message-sort-field-list</span>
      <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;^Subject:&quot;</span>
        <span class="s">&quot;^From:&quot;</span>
        <span class="s">&quot;^To:&quot;</span>
        <span class="s">&quot;^Cc:&quot;</span>
        <span class="s">&quot;^Date:&quot;</span>
        <span class="s">&quot;^Message-ID:&quot;</span>
        <span class="p">))</span>
</pre></div>
<h5><a id="From, To を省略表示しない"><span class='anchor'>_</span></a>From, To を省略表示しない</h5>
<p>To や From にアドレスが沢山指定されていると省略されるので，これを無効化</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-message-use-header-narrowing</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h4><a id="作成/返信設定"><span class='anchor'>_</span></a>作成/返信設定</h4>
<p>自分宛のメールに返信する場合は <code>To:</code>, <code>Cc:</code> から自分のアドレスを削除</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-draft-always-delete-myself</span> <span class="nv">t</span><span class="p">)</span>
</pre></div>
<p>&#8220;a&#8221; (without-argument)では <code>Reply-To:</code> や <code>From:</code> などで
  指定された唯一人または唯一つの投稿先に返信.
  また, <code>X-ML-Name:</code> と <code>Reply-To:</code> がついているなら <code>Reply-To:</code> 宛に返信</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-draft-reply-without-argument-list</span>
      <span class="o">&#39;</span><span class="p">(((</span><span class="s">&quot;X-ML-Name&quot;</span> <span class="s">&quot;Reply-To&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;Reply-To&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">&quot;X-ML-Name&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;To&quot;</span> <span class="s">&quot;Cc&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">&quot;Followup-To&quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nf">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="s">&quot;Followup-To&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;Newsgroups&quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nf">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="s">&quot;Newsgroups&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;Reply-To&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;Reply-To&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">&quot;Mail-Reply-To&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;Mail-Reply-To&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
        <span class="p">(</span><span class="s">&quot;From&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;From&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))))</span>
</pre></div>
<p><code>C-u a</code> (with-argument)であれば関係する全ての人・投稿先に返信</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-draft-reply-with-argument-list</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;Followup-To&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;From&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="p">(</span><span class="s">&quot;Followup-To&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;Newsgroups&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;From&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="p">(</span><span class="s">&quot;Newsgroups&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;Mail-Followup-To&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;Mail-Followup-To&quot;</span><span class="p">)</span> <span class="nv">nil</span> <span class="p">(</span><span class="s">&quot;Newsgroups&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="s">&quot;From&quot;</span> <span class="o">.</span> <span class="p">((</span><span class="s">&quot;From&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;To&quot;</span> <span class="s">&quot;Cc&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Newsgroups&quot;</span><span class="p">)))))</span>
</pre></div>
<p>サマリ表示には petname を使うが, 引用には使わない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-default-draft-cite-decorate-author</span> <span class="nv">nil</span><span class="p">)</span>
</pre></div>
<h5><a id="メール本文の文字コード"><span class='anchor'>_</span></a>メール本文の文字コード</h5>
<p>丸囲み数字なんかが入ってしまうと
  勝手にエンコーディングが変わってしまって鬱陶しい. どうしたモンだろうかね.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;wl-draft-mode-hook</span>
          <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
            <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;mime-charset-type-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">utf-8</span> <span class="mi">8</span> <span class="nv">nil</span><span class="p">))))</span>
</pre></div>
<h5><a id="draft mode で orgtbl を有効に"><span class='anchor'>_</span></a>draft mode で orgtbl を有効に</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;wl-draft-mode-hook</span> <span class="ss">&#39;turn-on-orgtbl</span><span class="p">)</span>
</pre></div>
<h5><a id="c-sig"><span class='anchor'>_</span></a>c-sig</h5>
<p>署名の選択に c-sig を使用している.
  設定は以下の通り. Mew 風に <code>C-c &lt;tab&gt;</code> で signature を挿入するようにしている</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">c-sig</span>
  <span class="nv">:init</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">eval-when-compile</span> <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;wl</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">sig-insert-end</span> <span class="nv">t</span>
        <span class="nv">sig-save-to-sig-name-alist</span> <span class="nv">nil</span>
        <span class="nv">message-signature-file</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">wl-draft-mode-map</span> <span class="s">&quot;\C-c\t&quot;</span> <span class="ss">&#39;insert-signature-eref</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;wl-draft-mode-hook</span>
            <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
               <span class="p">(</span><span class="nf">define-key</span> <span class="p">(</span><span class="nf">current-local-map</span><span class="p">)</span> <span class="s">&quot;\C-c\C-w&quot;</span>
                 <span class="ss">&#39;insert-signature-eref</span><span class="p">)))</span>
  <span class="p">)</span>
</pre></div>
<h4><a id="Face の設定"><span class='anchor'>_</span></a>Face の設定</h4>
<p>デフォルトより細かく指定するために幾つかの face 定義を追加.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-highlight-message-header-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;Subject[ \t]*:&quot;</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-subject-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;From[ \t]*:&quot;</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-from-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;Date[ \t]*:&quot;</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-date-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\(.*To\\|Cc\\|Newsgroups\\)[ \t]*:&quot;</span>
         <span class="o">.</span> <span class="nv">wl-highlight-message-important-header-contents</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\\(User-Agent\\|X-Mailer\\|X-Newsreader\\)[ \t]*:&quot;</span> <span class="o">.</span>
         <span class="nv">wl-highlight-message-unimportant-header-contents</span><span class="p">)</span>
        <span class="p">))</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:wl-set-face</span> <span class="p">(</span><span class="nf">face</span> <span class="nv">spec</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-face</span> <span class="nv">face</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">fboundp</span> <span class="ss">&#39;face-spec-set</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">face-spec-set</span> <span class="nv">face</span> <span class="nv">spec</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">t</span>
         <span class="p">(</span><span class="nf">wl-declare-face</span> <span class="nv">face</span> <span class="nv">spec</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-folder-closed-face</span>                  <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4cff4c&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="nv">:weight</span> <span class="nv">normal</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-folder-few-face</span>                     <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FF4C4C&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="nv">:weight</span> <span class="nv">normal</span> <span class="p">))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-folder-killed-face                  &#39;((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-folder-many-face                    &#39;((t (:foreground ,my:h:magenta :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-folder-opened-face                  &#39;((t (:foreground &quot;#4cffff&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-folder-path-face                    &#39;((t (:underline t :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-folder-unknown-face                 &#39;((t (:foreground &quot;#4cffff&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-folder-unread-face                  &#39;((t (:foreground ,my:n:blue :bold nil :italic nil :weight normal ))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-folder-zero-face</span>                    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="nv">:weight</span> <span class="nv">normal</span> <span class="p">))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-header-separator-face               &#39;((t (:inherit highlight :bold t ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-message-citation-header             &#39;((t (:foreground ,my:h:green :bold nil :italic nil ))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-1</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7fff7f&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-2</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#ffff7f&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-3</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7f7fff&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-4</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7fffff&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-5</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#ff7fff&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-6</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#ff7f7f&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-7</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4cff4c&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-8</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#ffff4c&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-9</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4c4cff&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-10</span>               <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4cffff&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-11</span>               <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#ff4cff&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-cited-text-12</span>               <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#ff4c4c&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-date-header-contents</span>        <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4CFF4C&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-header-contents</span>             <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#aaaaaa&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-headers</span>                     <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4CFFFF&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-important-header-contents2</span>  <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4CFF4C&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-signature</span>                   <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#aaaaaa&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-important-header-contents</span>   <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FF4CFF&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-subject-header-contents</span>     <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FF4C4C&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-from-header-contents</span>        <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FFFF4C&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-message-unimportant-header-contents</span> <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#aaaaaa&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="p">))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-summary-answered-face</span>               <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4CFF4C&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="nv">:weight</span> <span class="nv">normal</span> <span class="p">))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-copied-face                 &#39;((t (:foreground &quot;#4CFFFF&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-deleted-face                &#39;((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-displaying-face             &#39;((t (:underline t :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-disposed-face               &#39;((t (:foreground &quot;#aaaaaa&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-flagged-face                &#39;((t (:foreground ,my:h:yellow :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-forwarded-face              &#39;((t (:foreground ,my:h:blue :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-high-read-face              &#39;((t (:foreground ,my:h:green :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-high-unread-face            &#39;((t (:foreground ,my:h:orange :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-important-face              &#39;((t (:foreground &quot;#ffff4c&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-important-flag-face         &#39;((t (:foreground &quot;#ffff4c&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-killed-face                 &#39;((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-l:read-face                 &#39;((t (:foreground &quot;#4CFF4C&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-l:unread-face               &#39;((t (:foreground ,my:h:lightb :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-new-face                    &#39;((t (:foreground &quot;#ff4c4c&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-normal-face                 &#39;((t (:foreground &quot;#f6f3e8&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-prefetch-face               &#39;((t (:foreground ,my:n:blue :bold nil :italic nil :weight normal ))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-summary-refiled-face</span>                <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7F7FFF&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="nv">:weight</span> <span class="nv">normal</span> <span class="p">))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-resend-face                 &#39;((t (:foreground ,my:h:orange :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-target-face                 &#39;((t (:foreground &quot;#4CFFFF&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-temp-face                   &#39;((t (:foreground ,my:n:violet :bold nil :italic nil :weight normal ))))</span>
<span class="p">(</span><span class="nf">my:wl-set-face</span> <span class="ss">&#39;wl-highlight-summary-thread-top-face</span>             <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:italic</span> <span class="nv">nil</span> <span class="nv">:weight</span> <span class="nv">normal</span> <span class="p">))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-summary-unread-face                 &#39;((t (:foreground &quot;#ff4c4c&quot; :bold nil :italic nil :weight normal ))))</span>
<span class="c1">;; (my:wl-set-face &#39;wl-highlight-thread-indent-face                  &#39;((t (:underline t :bold nil :italic nil :weight normal ))))</span>
</pre></div>
<h4><a id="GPG 署名"><span class='anchor'>_</span></a>GPG 署名</h4>
<p>以前は mailcrypt を使っていたけれど,
  epa があるので主にキーバインドの設定のみ.
  <code>draft-mode</code> の文字コードをあらかじめ指定しておかないと,
  送信時に文字コードが変換されるので不正な署名となってしまう.</p>
<p>もっとうまい方法/正攻法がありそうな気がするけれど,
  使えてるから, まあ良いかな, とか.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">mime-pgp-verify-when-preview</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:epa-wl-decrypt-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">save-window-excursion</span>
    <span class="p">(</span><span class="nf">wl-summary-jump-to-current-message</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">wl-message-decrypt-pgp-nonmime</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:epa-wl-verify-message</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">save-selected-window</span>
    <span class="p">(</span><span class="nf">wl-summary-jump-to-current-message</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">wl-message-verify-pgp-nonmime</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">bind-keys</span> <span class="nv">:map</span> <span class="nv">wl-summary-mode-map</span>
           <span class="p">(</span><span class="s">&quot;C-c : d&quot;</span> <span class="o">.</span> <span class="nv">my:epa-wl-decrypt-message</span><span class="p">)</span>
           <span class="p">(</span><span class="s">&quot;C-c : v&quot;</span> <span class="o">.</span> <span class="nv">my:epa-wl-verify-message</span><span class="p">))</span>
<span class="p">(</span><span class="nf">bind-keys</span> <span class="nv">:map</span> <span class="nv">wl-draft-mode-map</span>
           <span class="p">(</span><span class="s">&quot;C-c : s&quot;</span> <span class="o">.</span> <span class="nv">epa-mail-sign</span><span class="p">)</span>
           <span class="p">(</span><span class="s">&quot;C-c : e&quot;</span> <span class="o">.</span> <span class="nv">epa-mail-encrypt</span><span class="p">))</span>
</pre></div>
<h4><a id="検索"><span class='anchor'>_</span></a>検索</h4>
<p>notmuchを使う.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">elmo-search</span>
  <span class="nv">:bind</span> <span class="p">(</span><span class="nf">:map</span> <span class="nv">wl-summary-mode-map</span>
              <span class="p">(</span><span class="s">&quot;v&quot;</span> <span class="o">.</span> <span class="nv">wl-quicksearch-goto-search-folder-wrapper</span><span class="p">)</span>
              <span class="nv">:map</span> <span class="nv">wl-folder-mode-map</span>
              <span class="p">(</span><span class="s">&quot;v&quot;</span> <span class="o">.</span> <span class="nv">wl-quicksearch-goto-search-folder-wrapper</span><span class="p">))</span>
  <span class="nv">:config</span>
   <span class="c1">;; (elmo-search-register-engine</span>
   <span class="c1">;;  &#39;mu-custom &#39;local-file</span>
   <span class="c1">;;  :prog &quot;mu&quot;</span>
   <span class="c1">;;  :args &#39;(&quot;find&quot; &quot;-u&quot; elmo-search-split-pattern-list</span>
   <span class="c1">;;          &quot;--fields&quot; &quot;l&quot; &quot;--sortfield&quot; &quot;date&quot; &quot;-r&quot;)</span>
   <span class="c1">;;  :charset &#39;utf-8</span>
   <span class="c1">;;  )</span>
  <span class="p">(</span><span class="nf">elmo-search-register-engine</span>
   <span class="ss">&#39;notmuch-custom</span> <span class="ss">&#39;local-file</span>
   <span class="nv">:prog</span> <span class="s">&quot;notmuch-query-custom&quot;</span>
   <span class="nv">:args</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">elmo-search-split-pattern-list</span><span class="p">)</span>
   <span class="nv">:charset</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-search-default-engine</span> <span class="ss">&#39;notmuch-custom</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">wl-quicksearch-folder</span> <span class="s">&quot;[]&quot;</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<p>実際の呼び出しはスレッドを全部取得したいので以下を呼び出している</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="k">if</span> <span class="o">[</span> ! x<span class="s2">&quot;</span><span class="nv">$*</span><span class="s2">&quot;</span> <span class="o">=</span> x<span class="s2">&quot;&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nv">res</span><span class="o">=</span><span class="k">$(</span>notmuch search --output<span class="o">=</span>threads <span class="s2">&quot;</span><span class="nv">$*</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> ! x<span class="s2">&quot;</span><span class="nv">$res</span><span class="s2">&quot;</span> <span class="o">=</span> x<span class="s2">&quot;&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="nv">$res</span> <span class="p">|</span> xargs notmuch search --sort<span class="o">=</span>oldest-first --output<span class="o">=</span>files
<span class="k">fi</span>
</pre></div>
<p>検索時にメールが多すぎると怒られるので. 数字は適当.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-multi-divide-number</span> <span class="mi">2000000000</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elmo-multi-number</span> <span class="mi">2000000000</span><span class="p">)</span>
</pre></div>
<h3><a id="Linux Desktop で =mailto:= リンクを扱うために"><span class='anchor'>_</span></a>Linux Desktop で <code>mailto:</code> リンクを扱うために</h3>
<p>ついでに <code>mailto</code> のリンクを emacsclient で扱うために，以下の関数を定義しておく</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:mailto-compose-mail</span> <span class="p">(</span><span class="nf">mailto-url</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">stringp</span> <span class="nv">mailto-url</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;\\`mailto:&quot;</span> <span class="nv">mailto-url</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">progn</span>
        <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;rfc2368</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">headers</span> <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">h</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nb">car </span><span class="nv">h</span><span class="p">))</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">h</span><span class="p">)))</span>
                                <span class="p">(</span><span class="nf">rfc2368-parse-mailto-url</span> <span class="nv">mailto-url</span><span class="p">)))</span>
               <span class="p">(</span><span class="nf">good-headers</span> <span class="p">(</span><span class="nf">remove-if</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">h</span><span class="p">)</span> <span class="p">(</span><span class="nb">member </span><span class="p">(</span><span class="nb">car </span><span class="nv">h</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">Body</span><span class="p">)))</span> <span class="nv">headers</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">body</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">assoc </span><span class="ss">&#39;Body</span> <span class="nv">headers</span><span class="p">))))</span>
          <span class="p">(</span><span class="nf">wl-draft</span> <span class="nv">good-headers</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">body</span><span class="p">)))))</span>
</pre></div>
<p>Desktop の設定では</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1"># emacs-mailto-handler</span>

<span class="nv">mailto</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">mailto</span><span class="o">=</span><span class="s2">&quot;mailto:</span><span class="si">$&#123;</span><span class="nv">mailto</span><span class="p">#mailto:</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">mailto</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">&#39;%s\n&#39;</span> <span class="s2">&quot;</span><span class="nv">$mailto</span><span class="s2">&quot;</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/[\&quot;]/\\&amp;/g&#39;</span><span class="k">)</span>
<span class="nv">elisp_expr</span><span class="o">=</span><span class="s2">&quot;(my:mailto-compose-mail \&quot;</span><span class="nv">$mailto</span><span class="s2">\&quot;)&quot;</span>

emacsclient -a <span class="s2">&quot;&quot;</span> -n --eval <span class="s2">&quot;</span><span class="nv">$elisp_expr</span><span class="s2">&quot;</span> <span class="se">\</span>
	<span class="s1">&#39;(set-window-dedicated-p (selected-window) t)&#39;</span>
</pre></div>
<p>をメーラとして指定すれば良い．
  GNOME は <code>.desktop</code> ファイルが無いと「お気に入り」登録ができないので
  以下のファイルを適当な名前で <code>~/.local/share/applications/</code> 以下に放り込んでおくと良いだろう</p>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="no">Desktop</span> <span class="no">Entry</span><span class="o">]</span>
<span class="no">Name</span><span class="o">=</span><span class="no">Emacs</span> <span class="no">Mail</span> <span class="no">Handler</span>
<span class="no">GenericName</span><span class="o">=</span><span class="no">Mail</span> <span class="no">User</span> <span class="no">Agent</span>
<span class="n">X</span><span class="o">-</span><span class="no">GNOME</span><span class="o">-</span><span class="no">FullName</span><span class="o">=</span><span class="no">Emacs</span> <span class="no">Mail</span> <span class="no">Handler</span>
<span class="no">Comment</span><span class="o">=</span><span class="no">Use</span> <span class="n">emacsclient</span> <span class="n">as</span> <span class="no">MUA</span><span class="p">,</span> <span class="n">handling</span> <span class="n">mailto</span> <span class="n">link</span>
<span class="no">Keywords</span><span class="o">=</span><span class="n">email</span>
<span class="no">Exec</span><span class="o">=</span><span class="sr">/home/u</span><span class="n">wabami</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">emacs</span><span class="o">-</span><span class="n">mailto</span><span class="o">-</span><span class="n">handler</span> <span class="o">%</span><span class="n">U</span>
<span class="no">Icon</span><span class="o">=</span><span class="n">emacs25</span>
<span class="no">Terminal</span><span class="o">=</span><span class="kp">false</span>
<span class="no">Type</span><span class="o">=</span><span class="no">Application</span>
<span class="no">Categories</span><span class="o">=</span><span class="no">GNOME</span><span class="p">;</span><span class="no">GTK</span><span class="p">;</span><span class="no">Office</span><span class="p">;</span><span class="no">Email</span><span class="p">;</span>
<span class="no">StartupNotify</span><span class="o">=</span><span class="kp">false</span>
<span class="no">MimeType</span><span class="o">=</span><span class="n">application</span><span class="o">/</span><span class="n">mbox</span><span class="p">;</span><span class="n">message</span><span class="o">/</span><span class="n">rfc822</span><span class="p">;</span><span class="n">x</span><span class="o">-</span><span class="n">scheme</span><span class="o">-</span><span class="n">handler</span><span class="o">/</span><span class="n">mailto</span><span class="p">;</span>
</pre></div>
<h3><a id="メールからの予定の取り込み: =mhc="><span class='anchor'>_</span></a>メールからの予定の取り込み: <code>mhc</code></h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">mhc</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;HOME&quot;</span><span class="p">)</span> <span class="s">&quot;/.config/mhc&quot;</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">mhc-calendar-day-strings</span> <span class="p">[</span><span class="s">&quot;日&quot;</span> <span class="s">&quot;月&quot;</span> <span class="s">&quot;火&quot;</span> <span class="s">&quot;水&quot;</span> <span class="s">&quot;木&quot;</span> <span class="s">&quot;金&quot;</span> <span class="s">&quot;土&quot;</span><span class="p">]</span>
        <span class="nv">mhc-calendar-header-function</span> <span class="ss">&#39;mhc-calendar-make-header-ja</span>
        <span class="nv">mhc-calendar-language</span> <span class="ss">&#39;japanese</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="校正，辞書等"><span class='anchor'>_</span></a>校正，辞書等</h2>
<h3><a id="spell checker"><span class='anchor'>_</span></a>spell checker</h3>
<p>ispell はコマンドとして <code>aspell</code> を利用する．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ispell</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq-default</span> <span class="nv">ispell-program-name</span> <span class="s">&quot;aspell&quot;</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;ispell-skip-region-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;[^\000-\377]+&quot;</span><span class="p">)))</span>
</pre></div>
<p>flyspell-mode は別途有効化しておいた方が良いのかもしれない</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">flyspell</span>
  <span class="nv">:diminish</span> <span class="nv">flyspell-mode</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:flyspell-popup-choose</span> <span class="p">(</span><span class="nf">orig</span> <span class="nv">event</span> <span class="nv">poss</span> <span class="nv">word</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">window-system</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">funcall</span> <span class="nv">orig</span> <span class="nv">event</span> <span class="nv">poss</span> <span class="nv">word</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">flyspell-emacs-popup-textual</span> <span class="nv">event</span> <span class="nv">poss</span> <span class="nv">word</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;flyspell-emacs-popup</span> <span class="nv">:around</span> <span class="o">#</span><span class="ss">&#39;my:flyspell-popup-choose</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="辞書"><span class='anchor'>_</span></a>辞書</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">lookup</span>
  <span class="nv">:commands</span> <span class="p">(</span><span class="nf">lookup</span> <span class="nv">lookup-region</span> <span class="nv">lookup-pattern</span><span class="p">)</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">my:dpkg-status</span> <span class="s">&quot;lookup-el&quot;</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">file-exists-p</span> <span class="s">&quot;/usr/local/share/dict/lookup-enabled&quot;</span><span class="p">))</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-c w&quot;</span> <span class="o">.</span> <span class="nv">lookup-pattern</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-c W&quot;</span> <span class="o">.</span> <span class="nv">lookup-word</span><span class="p">))</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">lookup-search-agents</span>
        <span class="o">&#39;</span><span class="p">(</span>
          <span class="p">(</span><span class="nf">ndeb</span>   <span class="s">&quot;/usr/local/share/dict/eijiro&quot;</span>    <span class="nv">:alias</span> <span class="s">&quot;英辞郎&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ndeb</span>   <span class="s">&quot;/usr/local/share/dict/waeijiro&quot;</span>  <span class="nv">:alias</span> <span class="s">&quot;和英辞郎&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ndeb</span>   <span class="s">&quot;/usr/local/share/dict/rikagaku5&quot;</span> <span class="nv">:alias</span> <span class="s">&quot;理化学辞典 第5版&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ndeb</span>   <span class="s">&quot;/usr/local/share/dict/koujien4&quot;</span>  <span class="nv">:alias</span> <span class="s">&quot;広辞苑 第4版&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ndeb</span>   <span class="s">&quot;/usr/local/share/dict/wadai5&quot;</span>    <span class="nv">:alias</span> <span class="s">&quot;研究社 和英大辞典 第5版&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ndeb</span>   <span class="s">&quot;/usr/local/share/dict/eidai6&quot;</span>    <span class="nv">:alias</span> <span class="s">&quot;研究社 英和大辞典 第6版&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">ndeb</span>   <span class="s">&quot;/usr/local/share/dict/colloc&quot;</span>    <span class="nv">:alias</span> <span class="s">&quot;研究社 英和活用大辞典 &quot;</span><span class="p">)</span>
          <span class="p">)))</span>
</pre></div>
<h2><a id="カレンダー: =japanese-holidays="><span class='anchor'>_</span></a>カレンダー: <code>japanese-holidays</code></h2>
<p>日本の祝日を表示するために <code>japanese-holidays</code> をインストール</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">japanese-holidays</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;calendar-today-visible-hook</span>   <span class="ss">&#39;japanese-holiday-mark-weekend</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;calendar-today-invisible-hook</span> <span class="ss">&#39;japanese-holiday-mark-weekend</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;calendar-today-visible-hook</span>   <span class="ss">&#39;calendar-mark-today</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">calendar-holidays</span>               <span class="c1">; とりあえず日本のみを表示</span>
        <span class="p">(</span><span class="nb">append </span><span class="nv">japanese-holidays</span> <span class="nv">holiday-local-holidays</span><span class="p">)</span>
        <span class="nv">mark-holidays-in-calendar</span> <span class="nv">t</span>     <span class="c1">; 祝日をカレンダーに表示</span>
        <span class="nv">calendar-month-name-array</span>       <span class="c1">; 月と曜日の表示調整</span>
        <span class="p">[</span><span class="s">&quot;01&quot;</span> <span class="s">&quot;02&quot;</span> <span class="s">&quot;03&quot;</span> <span class="s">&quot;04&quot;</span> <span class="s">&quot;05&quot;</span> <span class="s">&quot;06&quot;</span> <span class="s">&quot;07&quot;</span> <span class="s">&quot;08&quot;</span> <span class="s">&quot;09&quot;</span> <span class="s">&quot;10&quot;</span> <span class="s">&quot;11&quot;</span> <span class="s">&quot;12&quot;</span> <span class="p">]</span>
        <span class="nv">calendar-day-name-array</span>
        <span class="p">[</span><span class="s">&quot;日&quot;</span> <span class="s">&quot;月&quot;</span> <span class="s">&quot;火&quot;</span> <span class="s">&quot;水&quot;</span> <span class="s">&quot;木&quot;</span> <span class="s">&quot;金&quot;</span> <span class="s">&quot;土&quot;</span><span class="p">]</span>
        <span class="nv">calendar-day-header-array</span>
        <span class="p">[</span><span class="s">&quot;日&quot;</span> <span class="s">&quot;月&quot;</span> <span class="s">&quot;火&quot;</span> <span class="s">&quot;水&quot;</span> <span class="s">&quot;木&quot;</span> <span class="s">&quot;金&quot;</span> <span class="s">&quot;土&quot;</span><span class="p">]</span>
        <span class="nv">calendar-date-style</span> <span class="ss">&#39;iso</span>         <span class="c1">; ISO format (YYYY/MM/DD) に変更</span>
        <span class="nv">japanese-holiday-weekend</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1">; 土曜日・日曜日を祝日として表示</span>
        <span class="nv">japanese-holiday-weekend-marker</span>
        <span class="o">&#39;</span><span class="p">(</span><span class="nv">holiday</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">japanese-holiday-saturday</span><span class="p">)</span>
        <span class="c1">;; 日曜開始</span>
        <span class="nv">calendar-week-start-day</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">calendar-set-date-style</span> <span class="ss">&#39;iso</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="Org"><span class='anchor'>_</span></a>Org</h2>
<p><code>org-mode</code> が無いと生きていけない体になりました</p>
<h3><a id="基本設定: =org="><span class='anchor'>_</span></a>基本設定: <code>org</code></h3>
<p>目新しい設定はしていない，と思う．強いて言えば
  以前のメモの整理のために <a href="http://howm.osdn.jp/index-j.html">howm: Hitori Otegaru Wiki Modoki</a> も使っていたので,
  howm も有効にしている，ぐらい．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defvar</span> <span class="nv">my:d:org</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;HOME&quot;</span><span class="p">)</span> <span class="s">&quot;/Nextcloud/org/&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">org</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x n s&quot;</span> <span class="o">.</span> <span class="nv">org-narrow-to-subtree</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-x n w&quot;</span> <span class="o">.</span> <span class="nv">widen</span><span class="p">))</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">with-eval-after-load</span> <span class="s">&quot;org&quot;</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-file-apps-defaults</span> <span class="o">&#39;</span><span class="p">((</span><span class="nf">remote</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>  <span class="c1">;; xdg-open 任せ</span>
                                   <span class="p">(</span><span class="nf">system</span> <span class="o">.</span> <span class="s">&quot;xdg-open %s&quot;</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nf">t</span> <span class="o">.</span> <span class="s">&quot;xdg-open %s&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-file-apps-defaults-gnu</span> <span class="o">&#39;</span><span class="p">((</span><span class="nf">remote</span> <span class="o">.</span> <span class="nv">emacs</span><span class="p">)</span>  <span class="c1">;; xdg-open 任せ</span>
                                       <span class="p">(</span><span class="nf">system</span> <span class="o">.</span> <span class="s">&quot;xdg-open %s&quot;</span><span class="p">)</span>
                                       <span class="p">(</span><span class="nf">t</span> <span class="o">.</span> <span class="s">&quot;xdg-open %s&quot;</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-directory</span> <span class="nv">my:d:org</span>                 <span class="c1">;; Nextcloud に保存する</span>
        <span class="nv">org-return-follows-link</span> <span class="nv">t</span>              <span class="c1">;; return でリンクを辿る</span>
        <span class="nv">org-startup-folded</span> <span class="nv">t</span>                   <span class="c1">;; 見出しを畳んで表示</span>
        <span class="nv">org-startup-truncated</span> <span class="nv">t</span>                <span class="c1">;; 折り返し無し</span>
        <span class="nv">org-emphasis-alist</span>                     <span class="c1">;; 基本 &quot;-nw&quot; なので色変更</span>
        <span class="p">(</span><span class="nb">cons </span><span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;+&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">:strike-through</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#999999&quot;</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">cl-delete</span> <span class="s">&quot;+&quot;</span> <span class="nv">org-emphasis-alist</span> <span class="nv">:key</span> <span class="ss">&#39;car</span> <span class="nv">:test</span> <span class="ss">&#39;equal</span><span class="p">))</span>
        <span class="nv">org-completion-use-ido</span> <span class="nv">t</span>
        <span class="c1">;; GTD: 状態の追加</span>
        <span class="nv">org-todo-keywords</span>
        <span class="o">&#39;</span><span class="p">((</span><span class="nf">sequence</span> <span class="s">&quot;TODO(t)&quot;</span> <span class="s">&quot;WAIT(w)&quot;</span> <span class="s">&quot;|&quot;</span> <span class="s">&quot;DONE(d)&quot;</span> <span class="s">&quot;CANCEL(c)&quot;</span> <span class="s">&quot;SOMEDAY(s)&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">type</span> <span class="s">&quot;ARTICLE(a)&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">type</span> <span class="s">&quot;MEMO(m)&quot;</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="c1">;; GTD: タグの追加</span>
        <span class="nv">org-tag-alist</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;OFFICE&quot;</span>     <span class="o">.</span> <span class="nv">?o</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;HOME&quot;</span>       <span class="o">.</span> <span class="nv">?h</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;MAIL&quot;</span>       <span class="o">.</span> <span class="nv">?m</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;WORK&quot;</span>       <span class="o">.</span> <span class="nv">?w</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;Debian&quot;</span>     <span class="o">.</span> <span class="nv">?d</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;Computer&quot;</span>   <span class="o">.</span> <span class="nv">?c</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;Book&quot;</span>       <span class="o">.</span> <span class="nv">?b</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;Emacs&quot;</span>      <span class="o">.</span> <span class="nv">?e</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;TeX&quot;</span>        <span class="o">.</span> <span class="nv">?t</span><span class="p">)</span>
                        <span class="p">(</span><span class="s">&quot;Ruby&quot;</span>       <span class="o">.</span> <span class="nv">?r</span><span class="p">)</span>
                        <span class="p">)</span>
        <span class="p">)</span>
  <span class="c1">;; GTD: TODO→...→DONE としたエントリを =Arhive.org= に移動</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:org-archive-done-tasks</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="c1">;; ARCHIVE タグを付けるだけなら以下</span>
    <span class="c1">;;   (org-map-entries &#39;org-archive-set-tag &quot;/DONE&quot; &#39;file))</span>
    <span class="c1">;; org-archive-location に refile したいなら以下</span>
    <span class="p">(</span><span class="nf">org-map-entries</span> <span class="ss">&#39;org-archive-subtree</span> <span class="s">&quot;/DONE&quot;</span> <span class="ss">&#39;file</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-archive-location</span> <span class="s">&quot;Archive.org::&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-todo-statistics-hook</span> <span class="ss">&#39;my:org-archive-done-tasks</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-todo-after-statistics-hook</span> <span class="ss">&#39;my:org-archive-done-tasks</span><span class="p">)</span>
  <span class="c1">;; 文字コード強制 ... 今時いらないかも．</span>
  <span class="p">(</span><span class="nf">modify-coding-system-alist</span> <span class="ss">&#39;file</span> <span class="s">&quot;\\.org\\&#39;&quot;</span> <span class="ss">&#39;utf-8</span><span class="p">)</span>
  <span class="c1">;; howm ファイルも org-mode で．</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;auto-mode-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;\\.org$&quot;</span> <span class="o">.</span> <span class="nv">org-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;auto-mode-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;\\.howm$&quot;</span> <span class="o">.</span> <span class="nv">org-mode</span><span class="p">))</span>
  <span class="c1">;;; timestamp 更新文字列の変更</span>
  <span class="c1">;;  org-mode では ＃+DATE: をひっかける用に(＃は小文字)．</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:org-timestamp-hook</span> <span class="p">()</span>
    <span class="s">&quot;Change `time-stamp-start&#39; in org-mode&quot;</span>
    <span class="p">(</span><span class="nf">set</span> <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;time-stamp-start</span><span class="p">)</span> <span class="s">&quot;#\\+DATE: 2&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">set</span> <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;time-stamp-end</span><span class="p">)</span>   <span class="s">&quot;\$&quot;</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-mode-hook</span> <span class="ss">&#39;my:org-timestamp-hook</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="Org-Id, Orglink"><span class='anchor'>_</span></a>Org-Id, Orglink</h3>
<p>ファイル間のリンクを uuid で行なう設定</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-id</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-c l&quot;</span>   <span class="o">.</span> <span class="nv">org-store-link</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-c C-l&quot;</span> <span class="o">.</span> <span class="nv">org-insert-link</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-id-link-to-org-use-id</span> <span class="ss">&#39;create-if-interactive-and-no-custom-id</span>
        <span class="nv">org-id-track-globally</span> <span class="nv">t</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="s">&quot;~/Public/cc-env&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-id-extra-files</span> <span class="p">(</span><span class="nf">f-glob</span> <span class="s">&quot;*.org&quot;</span> <span class="s">&quot;~/Public/cc-env&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-id-extra-files</span>
                 <span class="p">(</span><span class="nf">concat</span> <span class="nv">user-emacs-directory</span> <span class="s">&quot;README.org&quot;</span><span class="p">)))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="Org-journal: 日記"><span class='anchor'>_</span></a>Org-journal: 日記</h3>
<p>単一ファイルに記述すること, および
  エントリ作成時に日付を入れるために <code>org-jounnal-new-entry</code> を <code>advice</code> している</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-journal</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-journal-mode-hook</span>
            <span class="p">(</span><span class="nf">setq</span> <span class="nv">truncate-lines</span> <span class="nv">t</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">unbind-key</span> <span class="s">&quot;C-c C-j&quot;</span> <span class="nv">org-journal-mode-map</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">bind-key</span>   <span class="s">&quot;C-c C-j&quot;</span> <span class="ss">&#39;browse-url-at-point</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-journal-dir</span> <span class="nv">my:d:org</span>
        <span class="nv">org-journal-file-format</span> <span class="s">&quot;journal.org&quot;</span>
        <span class="nv">org-journal-date-format</span> <span class="s">&quot;%x (%a)&quot;</span>
        <span class="nv">org-journal-date-prefix</span> <span class="s">&quot;* &quot;</span>
        <span class="nv">org-journal-time-format</span> <span class="s">&quot;&lt;%Y-%m-%d %R&gt; &quot;</span>
        <span class="nv">org-journal-time-prefix</span> <span class="s">&quot;** MEMO &quot;</span>
        <span class="nv">org-journal-find-file</span> <span class="ss">&#39;find-file</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:org-journal-add-date-entry</span> <span class="p">(</span><span class="nf">prefix</span> <span class="nv">&amp;optional</span> <span class="nv">time</span><span class="p">)</span>
    <span class="s">&quot;Insert date entry to `org-journal-file&#39;&quot;</span>
    <span class="p">(</span><span class="nf">find-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">org-journal-file-format</span> <span class="nv">org-journal-dir</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">org-journal-decrypt</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">unless</span>
        <span class="p">(</span><span class="nf">string-match</span> <span class="p">(</span><span class="nf">format-time-string</span> <span class="nv">org-journal-date-format</span><span class="p">)</span>
                      <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">progn</span>
        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;\n&quot;</span> <span class="nv">org-journal-date-prefix</span>
                        <span class="p">(</span><span class="nf">format-time-string</span> <span class="nv">org-journal-date-format</span><span class="p">)))</span>
        <span class="p">))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;org-journal-new-entry</span> <span class="nv">:before</span> <span class="ss">&#39;my:org-journal-add-date-entry</span><span class="p">)</span>
  <span class="p">)</span>
<span class="c1">;; Key bindings -- 使えてない...</span>
<span class="c1">;; (define-key org-journal-mode-map (kbd &quot;C-c C-f&quot;) &#39;org-journal-open-next-entry)</span>
<span class="c1">;; (define-key org-journal-mode-map (kbd &quot;C-c C-b&quot;) &#39;org-journal-open-previous-entry)</span>
<span class="c1">;; (define-key org-journal-mode-map (kbd &quot;C-c C-j&quot;) &#39;org-journal-new-entry)</span>
<span class="c1">;; (define-key calendar-mode-map &quot;j&quot; &#39;org-journal-read-entry)</span>
<span class="c1">;; (define-key calendar-mode-map (kbd &quot;C-j&quot;) &#39;org-journal-display-entry)</span>
<span class="c1">;; (define-key calendar-mode-map &quot;]&quot; &#39;org-journal-next-entry)</span>
<span class="c1">;; (define-key calendar-mode-map &quot;[&quot; &#39;org-journal-previous-entry)</span>
<span class="c1">;; (define-key calendar-mode-map (kbd &quot;i j&quot;) &#39;org-journal-new-date-entry)</span>
<span class="c1">;; (define-key calendar-mode-map (kbd &quot;f f&quot;) &#39;org-journal-search-forever)</span>
<span class="c1">;; (define-key calendar-mode-map (kbd &quot;f w&quot;) &#39;org-journal-search-calendar-week)</span>
<span class="c1">;; (define-key calendar-mode-map (kbd &quot;f m&quot;) &#39;org-journal-search-calendar-month)</span>
<span class="c1">;; (define-key calendar-mode-map (kbd &quot;f y&quot;) &#39;org-journal-search-calendar-year)))</span>
</pre></div>
<h3><a id="Capture: メモ取り"><span class='anchor'>_</span></a>Capture: メモ取り</h3>
<p>キーバインドは以前 changelog memo をやっていた時の癖で <code>C-x m</code> をメモにしている.
  他には wanderlust のメールを扱えるように <code>org-wl</code> を読み込んで template を追加したぐらい.
  notmuch のインデックスの方が良いかもしれない, と最近思っている.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-wl</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">my:dpkg-status</span> <span class="s">&quot;wl-beta&quot;</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-capture</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x m&quot;</span> <span class="o">.</span> <span class="nv">org-capture</span><span class="p">))</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:org-journal-add-date-entry-capture</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">my:org-journal-add-date-entry</span> <span class="nv">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
    <span class="p">)</span>
  <span class="c1">;; @see https://github.com/sprig/org-capture-extension/issues/37</span>
  <span class="c1">;; Brackets &#39;&#123;&#39; &#39;}&#39; in link description cause broken org-mode link #37]]</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">my:transform-square-brackets-to-round-ones</span> <span class="p">(</span><span class="nf">string-to-transform</span><span class="p">)</span>
  <span class="s">&quot;Transforms [ into ( and ] into ), other chars left unchanged.&quot;</span>
  <span class="p">(</span><span class="nf">concat</span>
   <span class="p">(</span><span class="nf">mapcar</span> <span class="o">#&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">equal</span> <span class="nv">c</span> <span class="nv">?</span><span class="p">[)</span> <span class="nv">?</span><span class="err">\</span><span class="p">(</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">equal</span> <span class="nv">c</span> <span class="nv">?</span><span class="p">])</span> <span class="nv">?</span><span class="err">\</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))</span>
           <span class="nv">string-to-transform</span><span class="p">))</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-default-notes-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:org</span> <span class="s">&quot;journal.org&quot;</span><span class="p">)</span>
        <span class="nv">org-capture-templates</span>
        <span class="o">`</span><span class="p">(</span>
          <span class="p">(</span><span class="s">&quot;t&quot;</span> <span class="s">&quot;TODO&quot;</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nf">function</span> <span class="nv">my:org-journal-add-date-entry-capture</span><span class="p">)</span>
           <span class="s">&quot;** TODO %^&#123;title} %^g\n  %?\n  %a&quot;</span>
           <span class="nv">:prepend</span> <span class="nv">nil</span>
           <span class="nv">:unnarrowed</span> <span class="nv">nil</span>
           <span class="nv">:kill-buffer</span> <span class="nv">t</span>
           <span class="p">)</span>
          <span class="c1">;; &quot;* TODO &lt;%&lt;%Y-%m-%d&gt;&gt; %:subject %^g\n  %?\n  %a\n  #+BEGIN_QUOTE\n%i\n  #+END_QUOTE&quot;</span>
          <span class="p">(</span><span class="s">&quot;e&quot;</span> <span class="s">&quot;Email TODO&quot;</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nf">function</span> <span class="nv">my:org-journal-add-date-entry-capture</span><span class="p">)</span>
           <span class="s">&quot;** TODO [[wl:\%5Bmsgid:%:message-id-no-brackets\%5D][%(my:transform-square-brackets-to-round-ones \&quot;%:subject\&quot;)]]\n  :PROPERTIES:\n  :CREATED: %u\n  :END:%?\n&quot;</span>
           <span class="nv">:prepend</span> <span class="nv">nil</span>
           <span class="nv">:unnarrowed</span> <span class="nv">nil</span>
           <span class="nv">:kill-buffer</span> <span class="nv">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">&quot;m&quot;</span> <span class="s">&quot;Memo/Journal Entry&quot;</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nf">function</span> <span class="nv">my:org-journal-add-date-entry-capture</span><span class="p">)</span>
           <span class="s">&quot;** MEMO %T %?&quot;</span>
           <span class="nv">:prepend</span> <span class="nv">nil</span>
           <span class="nv">:unnarrowed</span> <span class="nv">nil</span>
           <span class="nv">:kill-buffer</span> <span class="nv">t</span>
           <span class="p">)</span>
          <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="s">&quot;Aritcle Entry&quot;</span> <span class="nv">plain</span>
           <span class="p">(</span><span class="nf">function</span> <span class="nv">my:org-journal-add-date-entry-capture</span><span class="p">)</span>
           <span class="s">&quot;** ARTICLE %T %? &quot;</span>
           <span class="nv">:prepend</span> <span class="nv">nil</span>
           <span class="nv">:unnarrowed</span> <span class="nv">nil</span>
           <span class="nv">:kill-buffer</span> <span class="nv">t</span>
           <span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
<span class="p">)</span>
</pre></div>
<h3><a id="Agenda: スケジュール，TODO 表示"><span class='anchor'>_</span></a>Agenda: スケジュール，TODO 表示</h3>
<p>GTD 用の設定．後述の <code>org-gcal</code> と <code>orgmine</code> で取得したデータも表示している．
  ついでに</p>
<ul>
  <li>土曜日をの face を追加.</li>
  <li>祝日, 休日を日曜と同じfaceにする.</li>
</ul>
<p>なんて事もやっている．元ネタは <a href="https://julien.danjou.info/blog/2010/org-mode-and-holidays">Org-mode and holidays</a></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-agenda</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">)</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-c a&quot;</span> <span class="o">.</span> <span class="nv">org-agenda</span><span class="p">))</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-date-saturday</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FBFFF&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中の土曜日用のface&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-date-today-saturday</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">my:org-agenda-date-saturday</span> <span class="nv">:underline</span> <span class="nv">t</span><span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中の今日かつ土曜日用のface&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-date-today-weekend</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">org-agenda-date-weekend</span> <span class="nv">:underline</span> <span class="nv">t</span><span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中の今日かつ日・祝日用のface&quot;</span><span class="p">)</span>
  <span class="c1">;; こっからは org-gcal で同期したカレンダーの色</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-calendar-KUSM</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FFF7F&quot;</span><span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中, KUSM.org の表示 face&quot;</span>
    <span class="nv">:group</span> <span class="ss">&#39;org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-calendar-Schedule</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FFFFF&quot;</span><span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中, Schedule.org の表示 face&quot;</span>
    <span class="nv">:group</span> <span class="ss">&#39;org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-calendar-GFD</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FFFF7F&quot;</span><span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中, GFD.org の表示 face&quot;</span>
    <span class="nv">:group</span> <span class="ss">&#39;org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-calendar-DebianJP</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#BF7FFF&quot;</span><span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中, DebianJP.org の表示 face&quot;</span>
    <span class="nv">:group</span> <span class="ss">&#39;org-agenda</span> <span class="p">)</span>
  <span class="p">(</span><span class="nf">defface</span> <span class="nv">my:org-agenda-calendar-twitter</span>
    <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#CCCCCC&quot;</span><span class="p">)))</span>
    <span class="s">&quot;Agenda 表示中, Twitter log の表示 face&quot;</span>
    <span class="nv">:group</span> <span class="ss">&#39;org-agenda</span> <span class="p">)</span>
  <span class="c1">;; 更新用の関数 - とりあえず動いているので良しとするが，リファクタリングしたい</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:org-agenda-day-face-function</span> <span class="p">(</span><span class="nf">date</span><span class="p">)</span>
    <span class="s">&quot;Compute DATE face for saturday, holidays.&quot;</span>
    <span class="p">(</span><span class="nf">cl-dolist</span> <span class="p">(</span><span class="nf">file</span> <span class="p">(</span><span class="nf">org-agenda-files</span> <span class="nv">nil</span> <span class="ss">&#39;ifmode</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">cond</span>
       <span class="p">((</span><span class="nb">member </span><span class="p">(</span><span class="nf">calendar-day-of-week</span> <span class="nv">date</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">org-agenda-todayp</span> <span class="nv">date</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">cl-return</span> <span class="ss">&#39;my:org-agenda-date-today-weekend</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">cl-return</span> <span class="ss">&#39;org-agenda-date-weekend</span><span class="p">))</span>
       <span class="p">((</span><span class="nb">member </span><span class="p">(</span><span class="nf">calendar-day-of-week</span> <span class="nv">date</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">org-agenda-todayp</span> <span class="nv">date</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">cl-return</span> <span class="ss">&#39;my:org-agenda-date-today-saturday</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">cl-return</span> <span class="ss">&#39;my:org-agenda-date-saturday</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">face</span>
             <span class="p">(</span><span class="nf">cl-dolist</span> <span class="p">(</span><span class="nf">entry</span> <span class="p">(</span><span class="nf">org-agenda-get-day-entries</span> <span class="nv">file</span> <span class="nv">date</span><span class="p">))</span>
               <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">category</span> <span class="p">(</span><span class="nf">with-temp-buffer</span>
                                 <span class="p">(</span><span class="nf">insert</span> <span class="nv">entry</span><span class="p">)</span>
                                 <span class="p">(</span><span class="nf">org-get-category</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)))))</span>
                 <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string=</span> <span class="s">&quot;祝日&quot;</span> <span class="nv">category</span><span class="p">)</span>
                           <span class="p">(</span><span class="nf">string=</span> <span class="s">&quot;休日&quot;</span> <span class="nv">category</span><span class="p">))</span>
                   <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">org-agenda-todayp</span> <span class="nv">date</span><span class="p">)</span>
                       <span class="p">(</span><span class="nf">cl-return</span> <span class="ss">&#39;my:org-agenda-date-today-weekend</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">cl-return</span> <span class="ss">&#39;org-agenda-date-weekend</span><span class="p">)))))))</span>
        <span class="p">(</span><span class="nf">when</span> <span class="nv">face</span> <span class="p">(</span><span class="nf">cl-return</span> <span class="nv">face</span><span class="p">)))))</span>
  <span class="nv">:config</span>
  <span class="c1">;; 使用するファイル</span>
  <span class="p">(</span><span class="nf">dolist</span> <span class="p">(</span><span class="nf">file</span>
           <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Archive.org&quot;</span>
             <span class="s">&quot;Holidays.org&quot;</span>
             <span class="s">&quot;Memo.org&quot;</span>
             <span class="s">&quot;Schedule.org&quot;</span>
             <span class="s">&quot;MHC.org&quot;</span>
             <span class="s">&quot;GFD.org&quot;</span>
             <span class="s">&quot;KUSM.org&quot;</span>
             <span class="s">&quot;DebianJP.org&quot;</span>
             <span class="s">&quot;twitter.org&quot;</span>
             <span class="s">&quot;journal.org&quot;</span>
             <span class="s">&quot;redmine_GFD.org&quot;</span>
             <span class="s">&quot;redmine_FluidSoc.org&quot;</span>
             <span class="s">&quot;redmine_KUSM.org&quot;</span>
             <span class="p">))</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-agenda-files</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:org</span> <span class="nv">file</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-agenda-files</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;README.org&quot;</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
  <span class="c1">;; 表示のカスタマイズ</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-agenda-span</span> <span class="ss">&#39;day</span>                   <span class="c1">;; day or week</span>
        <span class="nv">org-agenda-format-date</span> <span class="s">&quot;%Y/%m/%d (%a)&quot;</span> <span class="c1">;; YY/MM/DD (曜)</span>
        <span class="nv">org-agenda-weekend-days</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           <span class="c1">;; 日曜始まり</span>
        <span class="c1">;; 表示関数</span>
        <span class="nv">org-agenda-day-face-function</span> <span class="ss">&#39;my:org-agenda-day-face-function</span>
        <span class="nv">org-agenda-custom-commands</span>             <span class="c1">;; GTD 用の設定</span>
        <span class="o">&#39;</span><span class="p">(</span>
          <span class="p">(</span><span class="s">&quot;n&quot;</span> <span class="s">&quot;agenda and all TODO list&quot;</span>
           <span class="p">(</span>
            <span class="p">(</span><span class="nf">agenda</span> <span class="s">&quot;&quot;</span>
                    <span class="p">((</span><span class="nf">org-agenda-ndays</span> <span class="mi">1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">org-agenda-entry-types</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">:timestamp</span> <span class="nv">:sexp</span><span class="p">))))</span>
            <span class="p">(</span><span class="nf">todo</span> <span class="s">&quot;TODO&quot;</span>
                  <span class="p">((</span><span class="nf">org-agenda-prefix-format</span> <span class="s">&quot; %i %-22:c&quot;</span><span class="p">))</span>
                  <span class="p">)</span>
            <span class="p">(</span><span class="nf">todo</span> <span class="s">&quot;新規|着手|進行中|確認&quot;</span>
                  <span class="p">((</span><span class="nf">org-agenda-prefix-format</span> <span class="s">&quot; %i %-22:c&quot;</span><span class="p">))</span>
                  <span class="p">)</span>
            <span class="p">(</span><span class="nf">todo</span> <span class="s">&quot;WAIT&quot;</span>
                  <span class="p">((</span><span class="nf">org-agenda-prefix-format</span> <span class="s">&quot; %i %-22:c&quot;</span><span class="p">))</span>
                  <span class="p">)</span>
            <span class="p">(</span><span class="nf">todo</span> <span class="s">&quot;SOMEDAY&quot;</span>
                  <span class="p">((</span><span class="nf">org-agenda-prefix-format</span> <span class="s">&quot; %i %-22:c&quot;</span><span class="p">))</span>
                  <span class="p">)</span>
            <span class="p">))</span>
          <span class="p">(</span><span class="s">&quot;N&quot;</span> <span class="s">&quot;All memo entry&quot;</span>
           <span class="p">(</span><span class="c1">;;</span>
            <span class="p">(</span><span class="nf">todo</span> <span class="s">&quot;MEMO&quot;</span><span class="p">)</span>
            <span class="p">))</span>
           <span class="p">)</span>
        <span class="p">)</span>
  <span class="c1">;; 色付け</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-agenda-finalize-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="nf">save-excursion</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;KUSM:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                     <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-KUSM</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;Schedule:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-Schedule</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;MHC:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-Schedule</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;DebianJP:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-DebianJP</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;GFD:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-GFD</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;twitter:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">my:org-agenda-calendar-twitter</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;誕生日:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">org-agenda-date-weekend</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;祝日:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">org-agenda-date-weekend</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;休日:&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">add-text-properties</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-at-eol</span><span class="p">)</span>
                                       <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="nv">org-agenda-date-weekend</span><span class="p">)))</span>
                <span class="p">)))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="Babel"><span class='anchor'>_</span></a>Babel</h3>
<h4><a id="org-src"><span class='anchor'>_</span></a>org-src</h4>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-src</span>
  <span class="nv">:diminish</span> <span class="nv">org-src-mode</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-src-fontify-natively</span> <span class="nv">t</span>       <span class="c1">;; font-lock</span>
        <span class="nv">org-src-tab-acts-natively</span> <span class="nv">t</span>      <span class="c1">;; indent</span>
        <span class="nv">org-edit-src-content-indentation</span> <span class="mi">0</span>
        <span class="nv">org-src-preserve-indentation</span> <span class="nv">t</span>
        <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h4><a id="org-ditaa"><span class='anchor'>_</span></a>org-ditaa</h4>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ob-ditaa</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;HOME&quot;</span><span class="p">)</span> <span class="s">&quot;/bin/jditaa.jar&quot;</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-ditaa-jar-path</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;HOME&quot;</span><span class="p">)</span> <span class="s">&quot;/bin/jditaa.jar&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">org-babel-do-load-languages</span> <span class="ss">&#39;org-babel-load-languages</span>
                               <span class="o">&#39;</span><span class="p">((</span><span class="nf">ditaa</span> <span class="o">.</span> <span class="nv">t</span><span class="p">)))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="OrgとGoogle カレンダーの連携: =org-gcal="><span class='anchor'>_</span></a>OrgとGoogle カレンダーの連携: <code>org-gcal</code></h3>
<h4><a id="token 等の置き場所の変更"><span class='anchor'>_</span></a>token 等の置き場所の変更</h4>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">request</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">request-storage-directory</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;request&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">request-storage-directory</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-directory</span> <span class="nv">request-storage-directory</span><span class="p">)))</span>
</pre></div>
<h4><a id="org-gcal 本体の設定"><span class='anchor'>_</span></a>org-gcal 本体の設定</h4>
<p>実際の情報等は <code>password-store</code> を使って設定しておく.
  ついでに agenda 表示の際の色付けを設定．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-gcal</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">))</span>
  <span class="nv">:commands</span> <span class="p">(</span><span class="nf">org-gcal-fetch</span><span class="p">)</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-gcal-dir</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;org-gcal&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="nv">org-gcal-dir</span>
    <span class="p">(</span><span class="nf">make-directory</span> <span class="nv">org-gcal-dir</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-gcal-token-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;.org-gcal-token&quot;</span> <span class="nv">org-gcal-dir</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">alert-log-messages</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">alert-default-style</span> <span class="ss">&#39;log</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-gcal-down-days</span>   <span class="mi">90</span><span class="p">)</span> <span class="c1">;; 過去 3 month</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-gcal-up-days</span>    <span class="mi">180</span><span class="p">)</span> <span class="c1">;; 未来 6 month</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-gcal-auto-archive</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nb">load </span><span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:password-store</span> <span class="s">&quot;/org-gcal.gpg&quot;</span><span class="p">)))</span>
</pre></div>
<p>password-store には multiline で設定を書く．例えば以下:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">setq</span> <span class="nv">org-gcal-client-id</span> <span class="s">&quot;XXXXXXXXXXX&quot;</span>
      <span class="nv">org-gcal-client-secret</span> <span class="s">&quot;XXXXXXXXXXX&quot;</span>
      <span class="nv">org-gcal-file-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;XXXXX@gmail.com&quot;</span> <span class="o">.</span> <span class="s">&quot;~/org/Schedule.org&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;YYYYY@group.calendar.google.com&quot;</span> <span class="o">.</span> <span class="s">&quot;~/org/Project1.org&quot;</span><span class="p">)))</span>
</pre></div>
<h3><a id="OrgとRedmine の連携: =orgmine="><span class='anchor'>_</span></a>OrgとRedmine の連携: <code>orgmine</code></h3>
<p>素晴しい!! <a href="https://github.com/kametoku/orgmine">kametoku/orgmine: Emacs minor mode for org-mode with redmine integration</a></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">orgmine</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="nv">my:d:password-store</span>
           <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:org</span><span class="p">))</span>
  <span class="nv">:diminish</span> <span class="p">(</span><span class="nf">orgmine-mode</span><span class="p">)</span>
  <span class="nv">:commands</span> <span class="p">(</span><span class="nf">orgmine-mode</span><span class="p">)</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">package-installed-p</span> <span class="ss">&#39;orgmine</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">package-install</span> <span class="ss">&#39;elmine</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">orgmine</span>
              <span class="nv">:fetcher</span> <span class="nv">github</span>
              <span class="nv">:repo</span> <span class="s">&quot;kametoku/orgmine&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;safe-local-variable-values</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="nv">orgmine-note-block-begin</span> <span class="o">.</span> <span class="s">&quot;#+BEGIN_SRC textile&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-mode-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">assoc </span><span class="s">&quot;om_server&quot;</span> <span class="nv">org-file-properties</span><span class="p">)</span> <span class="p">(</span><span class="nf">orgmine-mode</span><span class="p">))))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">orgmine-note-block-begin</span> <span class="s">&quot;#+BEGIN_SRC gfm&quot;</span>   <span class="c1">;; 要調整</span>
        <span class="nv">orgmine-note-block-end</span>   <span class="s">&quot;#+END_SRC\n&quot;</span>
        <span class="nv">orgmine-default-todo-keyword</span> <span class="s">&quot;新規&quot;</span><span class="p">)</span>
  <span class="c1">;; サーバ設定</span>
  <span class="p">(</span><span class="nb">load </span><span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:password-store</span> <span class="s">&quot;/orgmine.gpg&quot;</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="Org-Export"><span class='anchor'>_</span></a>Org-Export</h3>
<h4><a id="一般設定"><span class='anchor'>_</span></a>一般設定</h4>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ox</span>
  <span class="nv">:init</span>
  <span class="c1">;; 空行の削除</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:remove-org-newlines-at-cjk-text</span> <span class="p">(</span><span class="nf">&amp;optional</span> <span class="nv">_mode</span><span class="p">)</span>
    <span class="s">&quot;先頭が &#39;*&#39;, &#39;#&#39;, &#39;|&#39; でなく、改行の前後が日本の文字の場合はその改行を除去&quot;</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;^\\([^|#*\n].+\\)\\(.\\)\n *\\(.\\)&quot;</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">string-to-char</span> <span class="p">(</span><span class="nf">match-string</span> <span class="mi">2</span><span class="p">))</span> <span class="o">#</span><span class="nv">x2000</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">string-to-char</span> <span class="p">(</span><span class="nf">match-string</span> <span class="mi">3</span><span class="p">))</span> <span class="o">#</span><span class="nv">x2000</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">replace-match</span> <span class="s">&quot;\\1\\2\\3&quot;</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-at-bol</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">with-eval-after-load</span> <span class="s">&quot;ox&quot;</span>
    <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-export-before-processing-hook</span>
              <span class="ss">&#39;my:remove-org-newlines-at-cjk-text</span><span class="p">))</span>
  <span class="nv">:config</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-export-with-toc</span> <span class="nv">nil</span>
          <span class="nv">org-export-with-section-numbers</span> <span class="nv">nil</span>
          <span class="nv">org-latex-with-hyperref</span> <span class="nv">nil</span><span class="p">)</span>
    <span class="c1">;; for Beamer</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-options-alist</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="nv">:shortdate</span>    <span class="s">&quot;SHORTDATE&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-options-alist</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="nv">:shorttitle</span>   <span class="s">&quot;SHORTTITLE&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
    <span class="c1">;; for Jekyll</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-options-alist</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="nv">:layout</span>    <span class="s">&quot;LAYOUT&quot;</span> <span class="nv">nil</span> <span class="s">&quot;default&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-options-alist</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="nv">:ref</span>       <span class="s">&quot;REF&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-options-alist</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="nv">:permalink</span> <span class="s">&quot;PERMALINK&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-options-alist</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="nv">:redirect_from</span> <span class="s">&quot;redirect_from&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-options-alist</span>
                 <span class="o">&#39;</span><span class="p">(</span><span class="nv">:redirect_to</span> <span class="s">&quot;redirect_to&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span><span class="p">))</span>
    <span class="p">)</span>
</pre></div>
<h4><a id="LaTeX export"><span class='anchor'>_</span></a>LaTeX export</h4>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ox-latex</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-latex-pdf-process</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;latexmk %f&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;my:platex&quot;</span>
                 <span class="s">&quot;\\documentclass[a4j]&#123;jsarticle}</span>
<span class="s">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]&quot;</span>
                 <span class="p">(</span><span class="s">&quot;\\section\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\section*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsection*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsubsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsubsection*\&#123;%s\}&quot;</span><span class="p">))</span>
               <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;my:bxjsartible&quot;</span>
                 <span class="s">&quot;\\documentclass[a4j,ja=standard]&#123;bxjsarticle}</span>
<span class="s">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]&quot;</span>
                 <span class="p">(</span><span class="s">&quot;\\section\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\section*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsection*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsubsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsubsection*\&#123;%s\}&quot;</span><span class="p">))</span>
               <span class="p">)</span>
  <span class="c1">;; &quot;verbatim&quot; → &quot;Verbatim&quot; 置換</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:org-latex-filter-fancyvrb</span> <span class="p">(</span><span class="nf">text</span> <span class="nv">backend</span> <span class="nv">_info</span><span class="p">)</span>
    <span class="s">&quot;Convert begin/end&#123;verbatim} to begin/end&#123;Verbatim}.</span>
<span class="s">  Allows use of the fancyvrb latex package.&quot;</span>
    <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;beamer</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">org-export-derived-backend-p</span> <span class="nv">backend</span> <span class="ss">&#39;latex</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">replace-regexp-in-string</span>
       <span class="s">&quot;\\\\\\(begin\\|end\\)&#123;verbatim}&quot;</span>
       <span class="s">&quot;\\\\\\1&#123;Verbatim}&quot;</span> <span class="nv">text</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-export-filter-final-output-functions</span>
               <span class="ss">&#39;my:org-latex-filter-fancyvrb</span><span class="p">)</span>
  <span class="c1">;; &quot;tabular&quot; →  &quot;Tabular&quot;  置換</span>
  <span class="c1">;; (defun my:org-latex-filter-bigtabular (text backend _info)</span>
  <span class="c1">;;   &quot;Convert begin/end&#123;tabular} to begin/end&#123;Tabular}.&quot;</span>
  <span class="c1">;;   (when (or (org-export-derived-backend-p backend &#39;beamer)</span>
  <span class="c1">;;             (org-export-derived-backend-p backend &#39;latex))</span>
  <span class="c1">;;     (replace-regexp-in-string</span>
  <span class="c1">;;      &quot;\\\\\\(begin\\|end\\)&#123;tabular}&quot;</span>
  <span class="c1">;;      &quot;\\\\\\1&#123;Tabular}&quot; text)))</span>
  <span class="c1">;; (add-to-list &#39;org-export-filter-final-output-functions</span>
  <span class="c1">;;              &#39;my:org-latex-filter-bigtabular)</span>
  <span class="p">)</span>
</pre></div>
<h4><a id="Beamer export"><span class='anchor'>_</span></a>Beamer export</h4>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ox-beamer</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;my:beamer&quot;</span>
                 <span class="s">&quot;\\documentclass[dvipdfmx,presentation]&#123;beamer}</span>
<span class="s">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]&quot;</span>
                 <span class="p">(</span><span class="s">&quot;\\section\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\section*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsection*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsubsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsubsection*\&#123;%s\}&quot;</span><span class="p">))</span>
               <span class="p">)</span>
  <span class="c1">;;</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;my:beamer-uplatex&quot;</span>
                 <span class="s">&quot;\\documentclass[dvipdfmx,presentation]&#123;beamer}</span>
<span class="s">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]&quot;</span>
                 <span class="p">(</span><span class="s">&quot;\\section\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\section*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsection*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsubsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsubsection*\&#123;%s\}&quot;</span><span class="p">))</span>
               <span class="p">)</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;my:beamer-pdflatex&quot;</span>
                 <span class="s">&quot;\\documentclass[unicode,presentation]&#123;beamer}</span>
<span class="s">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]&quot;</span>
                 <span class="p">(</span><span class="s">&quot;\\section\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\section*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsection*\&#123;%s\}&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&quot;\\subsubsection\&#123;%s\}&quot;</span> <span class="o">.</span> <span class="s">&quot;\\subsubsection*\&#123;%s\}&quot;</span><span class="p">))</span>
               <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<p>LATEX_CLASS に <code>my:beamer</code> を指定すると，上記設定で export される．</p>
<h4><a id="HTML export"><span class='anchor'>_</span></a>HTML export</h4>
<p>後述の Jekyll 用の設定も参照のこと．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ox-html</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-html-use-infojs</span> <span class="nv">nil</span>
        <span class="nv">org-html-html5-fancy</span> <span class="nv">t</span>
        <span class="nv">org-export-htmlize-output-type</span> <span class="ss">&#39;inline-css</span>
        <span class="nv">org-html-doctype</span> <span class="s">&quot;html5&quot;</span>
        <span class="nv">org-html-text-markup-alist</span>
        <span class="o">&#39;</span><span class="p">((</span><span class="nf">bold</span>           <span class="o">.</span> <span class="s">&quot;&lt;strong&gt;%s&lt;/strong&gt;&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">code</span>           <span class="o">.</span> <span class="s">&quot;&lt;code&gt;%s&lt;/code&gt;&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">italic</span>         <span class="o">.</span> <span class="s">&quot;&lt;i&gt;%s&lt;/i&gt;&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">strike-through</span> <span class="o">.</span> <span class="s">&quot;&lt;del&gt;%s&lt;/del&gt;&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">underline</span>      <span class="o">.</span> <span class="s">&quot;&lt;span class=\&quot;underline\&quot;&gt;%s&lt;/span&gt;&quot;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">verbatim</span>       <span class="o">.</span> <span class="s">&quot;&lt;code&gt;%s&lt;/code&gt;&quot;</span><span class="p">)))</span>
  <span class="p">)</span>
</pre></div>
<h4><a id="Jekyll 用の Backend の定義"><span class='anchor'>_</span></a>Jekyll 用の Backend の定義</h4>
<p>Web サイトは Jekyll で作成しています．
  <a href="https://github.com/yoshinari-nomura/org-octopress">yoshinari-nomura/org-octopress: org-mode in octopress</a> の
  <code>ox-jekyll</code> を参考に <del>改造して</del> ，
  html export の際に必要な yaml front matter を出力できるようにしてます．
  あと，src-block が liquid に解釈されない様に escape してます．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">org-export-define-derived-backend</span> <span class="ss">&#39;jekyll</span> <span class="ss">&#39;html</span>
  <span class="nv">:menu-entry</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="nv">?j</span> <span class="s">&quot;Jekyl: export to html with YAML front matter.&quot;</span>
       <span class="p">((</span><span class="nf">?H</span> <span class="s">&quot;To temporary buffer&quot;</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">a</span> <span class="nv">s</span> <span class="nv">v</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">org-jekyll-export-as-html</span> <span class="nv">a</span> <span class="nv">s</span> <span class="nv">v</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">?h</span> <span class="s">&quot;To file&quot;</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">a</span> <span class="nv">s</span> <span class="nv">v</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">org-jekyll-export-to-html</span> <span class="nv">a</span> <span class="nv">s</span> <span class="nv">v</span><span class="p">)))))</span>
  <span class="nv">:translate-alist</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nf">template</span>  <span class="o">.</span> <span class="nv">org-jekyll-template</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="nv">:filters-alist</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nf">:filter-final-output</span> <span class="o">.</span> <span class="nv">org-jekyll-finalized</span><span class="p">))</span>
  <span class="p">)</span>
<span class="c1">;; template</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">org-jekyll-template</span> <span class="p">(</span><span class="nf">contents</span> <span class="nv">info</span><span class="p">)</span>
  <span class="s">&quot;Return complete document string after HTML conversion.&quot;</span>
  <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">org-jekyll--yaml-front-matter</span> <span class="nv">info</span><span class="p">)</span> <span class="nv">contents</span><span class="p">))</span>
<span class="c1">;;; 幾つかの文字列を置換する</span>
<span class="c1">;;  - liquid templateに誤認される `&#123;%&#39;, `%}&#39;</span>
<span class="c1">;;  - `:&#39; の escape</span>
<span class="c1">;;  - table-of-contents の処理</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">org-jekyll-finalized</span> <span class="p">(</span><span class="nf">contents</span> <span class="nv">_backend</span> <span class="nv">info</span><span class="p">)</span>
  <span class="s">&quot;Publish src-block to html, Escape liquid tags, e.g. &#123;%, %}&quot;</span>
  <span class="p">(</span><span class="nf">with-temp-buffer</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">contents</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">perform-replace</span> <span class="s">&quot;&amp;$58;&quot;</span> <span class="s">&quot;&amp;#58;&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">perform-replace</span> <span class="s">&quot;&#123;%&quot;</span> <span class="s">&quot;&amp;#123;%&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">perform-replace</span> <span class="s">&quot;%}&quot;</span> <span class="s">&quot;%&amp;#125;&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">perform-replace</span> <span class="s">&quot;&lt;nav id=\&quot;table-of-contents&quot;</span> <span class="s">&quot;&lt;div id=\&quot;toc-wrapper\&quot;&gt;</span>
<span class="s">&lt;nav id=\&quot;table-of-contents&quot;</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">perform-replace</span> <span class="s">&quot;&lt;/nav&gt;&quot;</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;&lt;/nav&gt;</span>
<span class="s">&lt;/div&gt;</span>
<span class="s">&lt;a href=\&quot;#toc-toggle\&quot; class=\&quot;btn toc-btn\&quot; id=\&quot;toc-toggle\&quot;&gt;%s&lt;/a&gt;&quot;</span>
                                      <span class="p">(</span><span class="nf">org-html--translate</span> <span class="s">&quot;Table of Contents&quot;</span> <span class="nv">info</span><span class="p">))</span>
                     <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="nv">nil</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">set-auto-mode</span> <span class="nv">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))))</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">org-jekyll--get-option</span> <span class="p">(</span><span class="nf">info</span> <span class="nv">property-name</span> <span class="nv">&amp;optional</span> <span class="nv">default</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">property</span> <span class="p">(</span><span class="nf">org-export-data</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nv">property-name</span><span class="p">)</span> <span class="nv">info</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s&quot;</span> <span class="p">(</span><span class="k">or </span><span class="nv">property</span> <span class="nv">default</span> <span class="s">&quot;&quot;</span><span class="p">))))</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nf">defun</span> <span class="nv">org-jekyll--yaml-front-matter</span> <span class="p">(</span><span class="nf">info</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">title</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:title</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">date</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:date</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">language</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:language</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">layout</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:layout</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">jekyll-ref</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:ref</span> <span class="p">))</span>
        <span class="p">(</span><span class="nf">jekyll-permalink</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:permalink</span> <span class="p">))</span>
        <span class="p">(</span><span class="nf">jekyll-redirect-from</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:redirect_from</span> <span class="p">))</span>
        <span class="p">(</span><span class="nf">jekyll-redirect-to</span>
         <span class="p">(</span><span class="nf">org-jekyll--get-option</span> <span class="nv">info</span> <span class="nv">:redirect_to</span> <span class="p">))</span>
        <span class="p">(</span><span class="nf">convert-to-yaml-list</span>
         <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">arg</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">mapconcat</span> <span class="o">#&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">text</span><span class="p">)(</span><span class="nf">concat</span> <span class="s">&quot;\n- &quot;</span> <span class="nv">text</span><span class="p">))</span> <span class="p">(</span><span class="nf">split-string</span> <span class="nv">arg</span><span class="p">)</span> <span class="s">&quot; &quot;</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">concat</span>
     <span class="s">&quot;---&quot;</span>
     <span class="s">&quot;\ntitle: &quot;</span>      <span class="p">(</span><span class="nf">s-replace</span> <span class="s">&quot;:&quot;</span> <span class="s">&quot;&amp;$58;&quot;</span> <span class="nv">title</span><span class="p">)</span>
     <span class="s">&quot;\ndate: &quot;</span>       <span class="nv">date</span>
     <span class="s">&quot;\nlayout: &quot;</span>     <span class="nv">layout</span>
     <span class="s">&quot;\nlang: &quot;</span>       <span class="nv">language</span>
     <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">string-equal</span> <span class="nv">jekyll-ref</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;\nref: &quot;</span> <span class="nv">jekyll-ref</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">string-equal</span> <span class="nv">jekyll-permalink</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;\npermalink: &quot;</span> <span class="nv">jekyll-permalink</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">string-equal</span> <span class="nv">jekyll-redirect-from</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;\nredirect_from: &quot;</span> <span class="nv">jekyll-redirect-from</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">string-equal</span> <span class="nv">jekyll-redirect-to</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;\nredirect_to: &quot;</span> <span class="nv">jekyll-redirect-to</span><span class="p">))</span>
     <span class="s">&quot;\n---\n&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">defun</span> <span class="nv">org-jekyll-export-as-html</span>
    <span class="p">(</span><span class="nf">&amp;optional</span> <span class="nv">async</span> <span class="nv">subtreep</span> <span class="nv">visible-only</span> <span class="nv">body-only</span> <span class="nv">ext-plist</span><span class="p">)</span>
  <span class="s">&quot;Export current buffer to a HTML buffer adding some YAML front matter.&quot;</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">org-export-to-buffer</span> <span class="ss">&#39;jekyll</span> <span class="s">&quot;*Org Jekyll HTML Export*&quot;</span>
    <span class="nv">async</span> <span class="nv">subtreep</span> <span class="nv">visible-only</span> <span class="nv">body-only</span> <span class="nv">ext-plist</span> <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">html-mode</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">defun</span> <span class="nv">org-jekyll-export-to-html</span>
    <span class="p">(</span><span class="nf">&amp;optional</span> <span class="nv">async</span> <span class="nv">subtreep</span> <span class="nv">visible-only</span> <span class="nv">body-only</span> <span class="nv">ext-plist</span><span class="p">)</span>
  <span class="s">&quot;Export current buffer to a HTML file adding some YAML front matter.&quot;</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">outfile</span> <span class="p">(</span><span class="nf">org-export-output-file-name</span> <span class="s">&quot;.html&quot;</span> <span class="nv">subtreep</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">org-export-to-file</span> <span class="ss">&#39;jekyll</span> <span class="nv">outfile</span> <span class="nv">async</span> <span class="nv">subtreep</span> <span class="nv">visible-only</span> <span class="nv">body-only</span> <span class="nv">ext-plist</span><span class="p">)))</span>
</pre></div>
<h3><a id="Org-Wiki"><span class='anchor'>_</span></a>Org-Wiki</h3>
<p>計算機関連のメモは <a href="https://github.com/uwabami/org-wiki">uwabami/org-wiki</a> で書いています．元々は
  <a href="https://github.com/caiorss/org-wiki">caiorss/org-wiki</a> を使っていたのですが helm 依存の部分を ido に書き換
  えてます.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">package-installed-p</span> <span class="ss">&#39;org-wiki</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-wiki</span>
            <span class="nv">:fetcher</span> <span class="nv">github</span>
            <span class="nv">:repo</span> <span class="s">&quot;uwabami/org-wiki&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">org-wiki</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="s">&quot;~/Public/cc-env&quot;</span><span class="p">)</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x M&quot;</span> <span class="o">.</span> <span class="nv">org-wiki</span> <span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">org-wiki-location</span> <span class="s">&quot;~/Public/cc-env&quot;</span>
        <span class="nv">org-wikitemplate</span> <span class="s">&quot;#+TITLE:</span>
<span class="s">#+DATE: 20</span>
<span class="s">#+LANGUAGE: ja</span>
<span class="s">#+REF: cc-env/%n</span>
<span class="s">#+LAYOUT: cc-env</span>
<span class="s">#+PERMALINK: /cc-env/%n.html</span>
<span class="s">Related [[wiki:index][Index]]</span>
<span class="s">&quot;</span><span class="p">))</span>
</pre></div>
<h2><a id="Howm"><span class='anchor'>_</span></a>Howm</h2>
<p>Org を使う前は Howm を使っていました.
  過去のメモを検索するためだけに未だに Howm を使っています.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">howm</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">my:dpkg-status</span> <span class="s">&quot;howm&quot;</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;ag&quot;</span><span class="p">))</span>
  <span class="nv">:diminish</span> <span class="nv">howm-mode</span>
  <span class="nv">:bind</span> <span class="p">(</span><span class="nf">:map</span> <span class="nv">howm-mode-map</span>
              <span class="p">(</span><span class="s">&quot;C-c , ,&quot;</span>     <span class="o">.</span> <span class="nv">howm-menu</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&quot;C-c C-c&quot;</span>     <span class="o">.</span> <span class="nv">nil</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&quot;C-x C-z C-c&quot;</span> <span class="o">.</span> <span class="nv">howm-save-and-kill-buffer/screen</span><span class="p">))</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;howm-menu-hook</span> <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
                              <span class="p">(</span><span class="nf">setq</span> <span class="nv">truncate-lines</span> <span class="nv">t</span><span class="p">)))</span>
  <span class="nv">:config</span>
  <span class="c1">;;; ディレクトリの設定</span>
  <span class="c1">;; メモの内容は Nextcloud で同期することに</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-directory</span> <span class="s">&quot;~/Nextcloud/org&quot;</span><span class="p">)</span>
  <span class="c1">;; メニューと履歴を検索対象から除外するために別ディレクトリへ</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-keyword-file</span> <span class="s">&quot;~/Nextcloud/howm/keys&quot;</span>
        <span class="nv">howm-history-file</span> <span class="s">&quot;~/Nextcloud/howm/history&quot;</span>
        <span class="nv">howm-menu-file</span> <span class="s">&quot;~/Nextcloud/howm/menu&quot;</span><span class="p">)</span>
  <span class="c1">;; メモファイルは日付時刻毎に分離</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-file-name-format</span> <span class="s">&quot;%Y%m%d-%H%M%S.howm&quot;</span><span class="p">)</span>
  <span class="c1">;;;  メモはorgで書く</span>
  <span class="c1">;; - org-mode の hook として howm-mode を登録</span>
  <span class="c1">;; - C-c が org に取られるので, howm の prefix は C-xC-z に</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;org-mode-hook</span> <span class="ss">&#39;howm-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">global-unset-key</span> <span class="p">(</span><span class="nf">kbd</span> <span class="s">&quot;C-x C-z&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-prefix</span> <span class="p">(</span><span class="nf">kbd</span> <span class="s">&quot;C-x C-z&quot;</span><span class="p">))</span>
  <span class="c1">;; title header は &quot;*&quot;</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-view-title-header</span> <span class="s">&quot;*&quot;</span><span class="p">)</span>
  <span class="c1">;; :config</span>
  <span class="p">(</span><span class="nf">use-package</span> <span class="s">&quot;elscreen-howm&quot;</span><span class="p">)</span>
  <span class="c1">;; 色付けは org-mode 任せ: howm の font-lock を無効化</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-use-color</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="c1">;;; 以下，決まり文句</span>
  <span class="c1">;; 検索で大文字小文字を区別しない</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-keyword-case-fold-search</span> <span class="nv">t</span><span class="p">)</span>
  <span class="c1">;; grep の 代わりに ag を使う</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-view-use-grep</span> <span class="nv">t</span>
        <span class="nv">howm-view-grep-command</span> <span class="s">&quot;ag&quot;</span>
        <span class="nv">howm-view-grep-option</span> <span class="s">&quot;--nocolor --nogroup&quot;</span>
        <span class="nv">howm-view-grep-extended-option</span> <span class="nv">nil</span>
        <span class="nv">howm-view-grep-fixed-option</span> <span class="s">&quot;-F&quot;</span>
        <span class="nv">howm-view-grep-expr-option</span> <span class="nv">nil</span>
        <span class="nv">howm-view-grep-file-stdin-option</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:howm:add-dev-null</span> <span class="p">(</span><span class="nf">args</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">str</span>   <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">))</span>               <span class="c1">;; 検索文字列</span>
          <span class="p">(</span><span class="nf">files</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">args</span><span class="p">)))</span>            <span class="c1">;; ファイルリスト</span>
      <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nb">= </span><span class="mi">1</span> <span class="p">(</span><span class="nb">length </span><span class="nv">files</span><span class="p">))</span>           <span class="c1">;; 単一ファイル？</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">file-regular-p</span> <span class="p">(</span><span class="nb">car </span><span class="nv">files</span><span class="p">))</span>   <span class="c1">;; 通常ファイル？</span>
            <span class="c1">;; 単一の通常ファイルが指定された場合に /dev/null を追加</span>
            <span class="p">(</span><span class="nf">setq</span> <span class="nv">files</span> <span class="p">(</span><span class="nb">append </span><span class="nv">files</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;/dev/null&quot;</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nb">list </span><span class="nv">str</span> <span class="nv">files</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">advice-add</span> <span class="ss">&#39;howm-real-grep-single</span> <span class="nv">:filter-args</span> <span class="o">#</span><span class="ss">&#39;my:howm:add-dev-null</span><span class="p">)</span>
  <span class="c1">;; 検索対象のディレクトリの追加...とりあえず追加しないことに．</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-search-other-dir</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="c1">;; 検索対象外のファイル: ad hoc にどんどん増えていくなぁ...</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-excluded-file-regexp</span>
        <span class="s">&quot;/\\.#\\|[~#]$\\|\\.bak$\\|/CVS/\\|\\.doc\\|\\.pdf\\|\\.txt$\\|\\.html$\\|\\.tex$\\|\\.dvi$\\|\\.fdb_latexmk$\\|\\.ppt$\\|\\.xls$\\|\\.howm-menu$\\|.howm-keys$\\|\\.png$\\|\\.gif$\\|\\.tif$\\|\\.tiff$\\|\\.jpg$\\|\\.jpeg$\\|\\.el$\\|\\.aux$\\|\\.log$\\|Makefile\\|\\.txt$\\|EUC-UCS2\\|\\.fdb_latexmk$\\|latexmkrc\\|\\.gpg$\\|\\.org$&quot;</span><span class="p">)</span>
  <span class="c1">;; org-mode の日付検索用</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-reminder-regexp-grep-format</span>
        <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;&lt;&quot;</span> <span class="nv">howm-date-regexp-grep</span> <span class="s">&quot;[ :0-9]*&gt;%s&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-reminder-regexp-format</span>
        <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;\\(&lt;&quot;</span> <span class="nv">howm-date-regexp</span> <span class="s">&quot;[ :0-9]*&gt;\\)\\(\\(%s\\)\\([0-9]*\\)\\)&quot;</span><span class="p">))</span>
  <span class="c1">;;; 表示設定</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-menu-top</span> <span class="nv">nil</span>
        <span class="nv">howm-menu-lang</span> <span class="ss">&#39;ja</span><span class="p">)</span>
  <span class="c1">;; 一覧にタイトル表示しない</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-list-title</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="c1">;; save 時にメニューを更新しない</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-menu-refresh-after-save</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-refresh-after-save</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="c1">;; 新規メモを上に</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-prepend</span> <span class="nv">t</span><span class="p">)</span>
  <span class="c1">;; 全メモ一覧時にタイトル表示</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-list-all-title</span> <span class="nv">t</span><span class="p">)</span>
  <span class="c1">;; 「最近のメモ」一覧時にタイトル表示</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-list-recent-title</span> <span class="nv">t</span><span class="p">)</span>
  <span class="c1">;; 「最近のメモ」の表示件数</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-menu-recent-num</span> <span class="mi">20</span><span class="p">)</span>
  <span class="c1">;; メニューを 2 時間キャッシュ</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-menu-expiry-hours</span> <span class="mi">2</span><span class="p">)</span>
  <span class="c1">;; RET でファイルを開く際, 一覧バッファを消す. C-u RET なら残る</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-view-summary-persistent</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="c1">;;; メニュー表示用の関数定義</span>
  <span class="c1">;; 正規表現で検索, 逆順,  表示件数は =howm-menu-recent-num=, という ad hoc な関数</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:howm-menu-search</span> <span class="p">(</span><span class="nf">key</span> <span class="nv">&amp;optional</span> <span class="nv">formatter</span> <span class="nv">regexp-p</span><span class="p">)</span>
    <span class="s">&quot;Embed search result of KEY into menu, reverse-order, howm-menu-recent-num&quot;</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">fixed-p</span> <span class="p">(</span><span class="nb">not </span><span class="nv">regexp-p</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">howm-menu-general</span> <span class="s">&quot;menu-search&quot;</span>
                         <span class="nv">formatter</span>
                         <span class="p">(</span><span class="nf">howm-first-n</span>
                          <span class="p">(</span><span class="nf">howm-sort-items-by-reverse-date</span>
                           <span class="p">(</span><span class="nf">howm-view-search-folder-items</span> <span class="nv">key</span> <span class="p">(</span><span class="nf">howm-folder</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">fixed-p</span><span class="p">)</span>
                           <span class="p">)</span> <span class="nv">howm-menu-recent-num</span><span class="p">)</span>
                         <span class="p">)))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-menu-allow</span>
        <span class="p">(</span><span class="nb">append </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">my:howm-menu-search</span><span class="p">)</span> <span class="nv">howm-menu-allow</span><span class="p">))</span>
  <span class="c1">;; 編集テンプレートの</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">howm-dtime-format</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;&lt;&quot;</span> <span class="nv">howm-dtime-body-format</span> <span class="s">&quot;&gt;&quot;</span><span class="p">)</span>
        <span class="nv">howm-insert-date-format</span> <span class="s">&quot;&lt;%s&gt;&quot;</span>
        <span class="nv">howm-template-date-format</span> <span class="s">&quot;&lt;%Y-%m-%d %a %H:%M:%S&gt;&quot;</span>
        <span class="nv">howm-template-file-format</span> <span class="s">&quot;==&gt;%s&quot;</span>
        <span class="nv">howm-template</span> <span class="s">&quot;* MEMO %date %cursor\n%file\n&quot;</span>
        <span class="nv">howm-reminder-today-format</span> <span class="p">(</span><span class="nf">format</span> <span class="nv">howm-insert-date-format</span> <span class="nv">howm-date-format</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="日記: =tDiary="><span class='anchor'>_</span></a>日記: <code>tDiary</code></h2>
<p>tdiary-mode をちまちまと弄っている所</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">locate-library</span> <span class="s">&quot;tdiary-mode&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">tdiary-mode</span>
            <span class="nv">:fetcher</span> <span class="nv">github</span>
            <span class="nv">:repo</span> <span class="s">&quot;uwabami/tdiary-mode&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">tdiary-mode</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="s">&quot;~/Nextcloud/tdiary&quot;</span><span class="p">)</span>
  <span class="nv">:commands</span> <span class="p">(</span><span class="nf">tdiary-mode</span> <span class="nv">tdiary-new</span> <span class="nv">tdiary-new-directory</span> <span class="nv">tdiary-replace</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nb">load </span><span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:password-store</span> <span class="s">&quot;/tdiary-mode.gpg&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">tdiary-browser-function</span> <span class="ss">&#39;browser-url</span>
        <span class="nv">tdiary-coding-system</span> <span class="ss">&#39;utf-8-dos</span>
        <span class="nv">tdiary-style-mode</span> <span class="ss">&#39;rd-mode</span>
        <span class="nv">tdiary-hour-offset</span> <span class="mi">2</span>
        <span class="nv">tdiary-text-save-p</span> <span class="nv">t</span>
        <span class="nv">tdiary-text-suffix</span> <span class="s">&quot;.rd&quot;</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="MoinMoin: =moinmoin-mode=, =moomin.el="><span class='anchor'>_</span></a>MoinMoin: <code>moinmoin-mode</code>, <code>moomin.el</code></h2>
<p>Debian Wiki や職場の Wiki を編集するための
  MoinMoin の設定.</p>
<h3><a id="=moinmoin-mode="><span class='anchor'>_</span></a><code>moinmoin-mode</code></h3>
<p>MoinMoin 本体の moinmoin-mode 自体は古くて
  screen-lines に依存していたりするので folk して更新中.
  <a href="https://github.com/uwabami/moinmoin-mode">uwabami/moinmoin-mode: Fork from EmacsForMoinMoin, for Emacs &gt;= 25</a></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">locate-library</span> <span class="s">&quot;moinmoin-mode&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-mode</span>
            <span class="nv">:fetcher</span> <span class="nv">github</span>
            <span class="nv">:repo</span> <span class="s">&quot;uwabami/moinmoin-mode&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">moinmoin-mode</span><span class="p">)</span>
</pre></div>
<p>そのうち気になる所を弄る，ということで．</p>
<h3><a id="=moomin="><span class='anchor'>_</span></a><code>moomin</code></h3>
<p>元々は <code>moomin = emacs-request + helm + moinmoin-mode</code>
  という奴. folk して ido-vertical-mode を support する様に
  多少弄った版を使う。
  <a href="https://github.com/uwabami/moomin-el">uwabami/moomin-el: Edit MoinMoin with Emacs</a></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">locate-library</span> <span class="s">&quot;moomin&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">moomin</span>
            <span class="nv">:fetcher</span> <span class="nv">github</span>
            <span class="nv">:repo</span> <span class="s">&quot;uwabami/moomin-el&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">moomin</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">my:d:password-store</span><span class="p">)</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x w&quot;</span> <span class="o">.</span> <span class="nv">ido-moomin</span><span class="p">)</span>
         <span class="nv">:map</span> <span class="nv">moinmoin-mode-map</span>
         <span class="p">(</span><span class="s">&quot;C-c C-c&quot;</span> <span class="o">.</span> <span class="nv">moomin-save-current-buffer</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-c C-s&quot;</span> <span class="o">.</span> <span class="nv">moomin-save-current-buffer</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-c C-o&quot;</span> <span class="o">.</span> <span class="nv">moomin-browse-current-page</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&quot;C-c C-r&quot;</span> <span class="o">.</span> <span class="nv">moomin-reload-current-page</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">moomin-history-file</span>
        <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;.moomin_history&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">load </span><span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:password-store</span> <span class="s">&quot;/moomin.gpg&quot;</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="プログラム環境"><span class='anchor'>_</span></a>プログラム環境</h2>
<h3><a id="文法チェック: =flycheck="><span class='anchor'>_</span></a>文法チェック: <code>flycheck</code></h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">flycheck</span>
  <span class="nv">:disabled</span> <span class="nv">t</span>
  <span class="nv">:defer</span> <span class="nv">t</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="o">#</span><span class="ss">&#39;global-flycheck-mode</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">flycheck-disabled-checkers</span>
        <span class="o">&#39;</span><span class="p">(</span><span class="nv">emacs-lisp-checkdoc</span><span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="VCS: =magit="><span class='anchor'>_</span></a>VCS: <code>magit</code></h3>
<p>magit は Emacs の Git Frontend.
  結局の所 CUI でコマンド叩く事も多いけれど，これはこれで重宝している．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">magit</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x g&quot;</span> <span class="o">.</span> <span class="nv">magit-status</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="c1">;; (setq magit-completing-read-function &#39;magit-ido-completing-read)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="VCS: =ido-ghq="><span class='anchor'>_</span></a>VCS: <code>ido-ghq</code></h3>
<p>ghq list を ido で選んで dired で開く</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">locate-library</span> <span class="s">&quot;ido-ghq&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">quelpa</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ido-ghq</span>
            <span class="nv">:fetcher</span> <span class="nv">github</span>
            <span class="nv">:repo</span> <span class="s">&quot;uwabami/ido-ghq&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">use-package</span> <span class="nv">ido-ghq</span>
  <span class="nv">:bind</span> <span class="p">((</span><span class="s">&quot;C-x f&quot;</span> <span class="o">.</span> <span class="nv">ido-ghq-open</span><span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ido-ghq-short-list</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="対応する括弧を見易く: =rainbow-delimiters="><span class='anchor'>_</span></a>対応する括弧を見易く: <code>rainbow-delimiters</code></h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">rainbow-delimiters</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;emacs-lisp-mode-hook</span> <span class="o">#</span><span class="ss">&#39;rainbow-delimiters-mode</span><span class="p">))</span>
</pre></div>
<h3><a id="設定ファイル: =generic-x="><span class='anchor'>_</span></a>設定ファイル: <code>generic-x</code></h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">generic-x</span><span class="p">)</span>
</pre></div>
<h3><a id="Textile"><span class='anchor'>_</span></a>Textile</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">textile-mode</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
<span class="c1">;  :diminish textile-mode</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="Markdown"><span class='anchor'>_</span></a>Markdown</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">markdown-mode</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;pandoc&quot;</span><span class="p">)</span>
  <span class="nv">:mode</span> <span class="p">(</span><span class="s">&quot;\\.\\(md\\|markdown\\)\\&#39;&quot;</span> <span class="o">.</span> <span class="nv">gfm-mode</span><span class="p">)</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;markdown-mode-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="nf">electric-indent-local-mode</span> <span class="mi">-1</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">orgtbl-mode</span><span class="p">)</span>
              <span class="p">))</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;gfm-mode-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="nf">electric-indent-local-mode</span> <span class="mi">-1</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">orgtbl-mode</span><span class="p">)</span>
              <span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">markdown-command</span>
        <span class="s">&quot;pandoc --from markdown_github -t html5 --mathjax --highlight-style pygments&quot;</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="SCSS"><span class='anchor'>_</span></a>SCSS</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">scss-mode</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;sass&quot;</span><span class="p">)</span>
  <span class="nv">:mode</span> <span class="s">&quot;\\.scss\\&#39;&quot;</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">scss-sass-command</span> <span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;sass&quot;</span><span class="p">)))</span>
</pre></div>
<h3><a id="rainbow-mode"><span class='anchor'>_</span></a>rainbow-mode</h3>
<p><code>#RRGGBB</code> のカラーコードに勝手に色が付く．CSS の編集中なんかで地味に便利．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">rainbow-mode</span>
  <span class="nv">:diminish</span> <span class="nv">rainbow-mode</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="YAML"><span class='anchor'>_</span></a>YAML</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">yaml-mode</span>
  <span class="nv">:mode</span> <span class="s">&quot;\\(\.yml\\|\.yaml\\)&quot;</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="Ruby"><span class='anchor'>_</span></a>Ruby</h3>
<p>素の <code>ruby-mode</code>. <code>Gemfile</code> も ruby-mode で扱う</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ruby-mode</span>
  <span class="nv">:mode</span> <span class="s">&quot;\\.rb\\&#39;&quot;</span>
  <span class="nv">:interpreter</span> <span class="s">&quot;ruby&quot;</span>
  <span class="nv">:init</span>
  <span class="c1">;; マジックコメントは自分で入れる</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ruby-insert-encoding-magic-comment</span> <span class="nv">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;auto-mode-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Gemfile$&quot;</span> <span class="o">.</span> <span class="nv">ruby-mode</span><span class="p">)))</span>
</pre></div>
<p><code>ruby-electric</code>: 括弧や <code>do ... end</code> の補完</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">ruby-electric</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;ruby-mode-hook</span> <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">ruby-electric-mode</span> <span class="nv">t</span><span class="p">)))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ruby-electric-expand-delimiters-list</span> <span class="nv">nil</span><span class="p">))</span>
</pre></div>
<p><code>ruby-block</code>: <code>do...end</code> の対応をハイライト</p>
<div class="highlight"><pre><span></span><span class="c1">;; (use-package ruby-block</span>
<span class="c1">;;  :diminish ruby-block-mode</span>
<span class="c1">;;  :config</span>
<span class="c1">;;  (ruby-block-mode t)</span>
<span class="c1">;;  (setq ruby-block-highlight-toggle &#39;overlay)</span>
<span class="c1">;;  )</span>
</pre></div>
<p><code>rspec-mode</code>:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">rspec-mode</span>
  <span class="nv">:ensure</span> <span class="nv">t</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">rspec-use-rake-flag</span> <span class="nv">nil</span><span class="p">))</span>
</pre></div>
<p><code>rabbit-mode</code>: <a href="http://rabbit-shocker.org/ja/">Rabbit</a> 編集用</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">rabbit-mode</span><span class="p">)</span>
</pre></div>
<p><code>rdoc-mode</code>: 本体の方はどうも動かないなぁ&#8230;</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defface</span> <span class="nv">rdoc-header-1</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-1</span><span class="p">)))</span>
  <span class="s">&quot;rdoc mode header level 1&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defface</span> <span class="nv">rdoc-header-2</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-2</span><span class="p">)))</span>
  <span class="s">&quot;rdoc mode header level 2&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defface</span> <span class="nv">rdoc-header-3</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-3</span><span class="p">)))</span>
  <span class="s">&quot;rdoc mode header level 3&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defface</span> <span class="nv">rdoc-header-4</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-4</span><span class="p">)))</span>
  <span class="s">&quot;rdoc mode header level 4&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">define-generic-mode</span> <span class="ss">&#39;rdoc-mode</span>
  <span class="p">()</span>					<span class="c1">;comment-list</span>
  <span class="o">&#39;</span><span class="p">()</span>					<span class="c1">;keyword-list</span>
  <span class="o">&#39;</span><span class="p">(</span>					<span class="c1">;font-lock-list</span>
    <span class="p">(</span><span class="s">&quot;^=[^=].*&quot;</span>                                             <span class="o">.</span> <span class="ss">&#39;rdoc-header-1</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;^==[^=].*&quot;</span>                                            <span class="o">.</span> <span class="ss">&#39;rdoc-header-2</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;^===[^=].*&quot;</span>                                           <span class="o">.</span> <span class="ss">&#39;rdoc-header-3</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;^====[^=].*&quot;</span>                                          <span class="o">.</span> <span class="ss">&#39;rdoc-header-4</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;^[\\*#]\\&#123;1,9\\} &quot;</span>                                    <span class="o">.</span> <span class="ss">&#39;bold</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;\\(?:[^a-zA-Z0-9]\\)?\\*[^*]+\\*\\(?:[^a-zA-Z0-9]\\)&quot;</span> <span class="o">.</span> <span class="ss">&#39;bold</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;\\(?:[^a-zA-Z0-9]\\)?\\_[^_]+\\_\\(?:[^a-zA-Z0-9]\\)&quot;</span> <span class="o">.</span> <span class="ss">&#39;italic</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;README_FOR_APP&quot;</span> <span class="s">&quot;\\.rdoc$&quot;</span><span class="p">)</span>	<span class="c1">;auto-mode-list</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">auto-fill-mode</span> <span class="nv">t</span><span class="p">)))</span>	<span class="c1">;function-list</span>
  <span class="s">&quot;Major mode for editing RDOC files.&quot;</span><span class="p">)</span>
</pre></div>
<p><code>rd-mode</code></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">rd-mode</span>
  <span class="nv">:mode</span> <span class="s">&quot;\\.rd$&quot;</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;rd-mode-hook</span>
            <span class="ss">&#39;rd-show-other-block-all</span><span class="p">))</span>
</pre></div>
<h3><a id="C"><span class='anchor'>_</span></a>C</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">cc-mode</span>
  <span class="nv">:init</span>
  <span class="p">(</span><span class="nf">c-add-style</span> <span class="s">&quot;my:bsd-like&quot;</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;bsd&quot;</span>
                 <span class="p">(</span><span class="nf">c-basic-offset</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)</span>
                 <span class="p">(</span><span class="nf">c-hanging-braces-alist</span> <span class="o">.</span> <span class="p">((</span><span class="nf">inline-open</span>       <span class="nv">before</span> <span class="nv">after</span><span class="p">)</span>
                                            <span class="p">(</span><span class="nf">block-open</span>        <span class="nv">before</span> <span class="nv">after</span><span class="p">)</span>
                                            <span class="p">(</span><span class="nf">substatement-open</span> <span class="nv">before</span> <span class="nv">after</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nf">c-offsets-alist</span> <span class="o">.</span> <span class="p">((</span><span class="nf">brace-list-entry</span> <span class="o">.</span> <span class="nv">+</span><span class="p">)))</span>
                 <span class="p">))</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq-default</span> <span class="nv">c-default-style</span> <span class="s">&quot;my:bsd-like&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;c-mode-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="nf">c-set-style</span> <span class="s">&quot;my:bsd-like&quot;</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">electric-indent-local-mode</span> <span class="mi">-1</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">set</span> <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;eldoc-idle-delay</span><span class="p">)</span> <span class="mf">0.20</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">c-turn-on-eldoc-mode</span><span class="p">)</span>
              <span class="p">))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="AUCTeX"><span class='anchor'>_</span></a>AUCTeX</h3>
<p>Debian パッケージ版を使う．やっている事は</p>
<ul>
  <li><code>japanese-latex-mode</code> において, 幾つかのコマンドが追加/上書きされているが，
    あまり使うことの無いコマンドが表示されるのが嫌なのでそれらを削除．</li>
  <li>コンパイルには <code>latexmk</code> を使う，です．
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">tex-jp</span>
  <span class="nv">:if</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">executable-find</span> <span class="s">&quot;uplatex&quot;</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">my:dpkg-status</span> <span class="s">&quot;auctex&quot;</span><span class="p">))</span>
  <span class="nv">:init</span> <span class="p">(</span><span class="nf">progn</span>
          <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;LaTeX-mode-hook</span> <span class="o">#</span><span class="ss">&#39;TeX-source-correlate-mode</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;LaTeX-mode-hook</span> <span class="o">#</span><span class="ss">&#39;TeX-PDF-mode</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;LaTeX-mode-hook</span> <span class="o">#</span><span class="ss">&#39;turn-on-reftex</span><span class="p">))</span>

  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;LaTeX-mode-hook</span>
            <span class="p">(</span><span class="nf">function</span>
             <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
               <span class="p">(</span><span class="nf">dolist</span> <span class="p">(</span><span class="nf">command</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;pTeX&quot;</span> <span class="s">&quot;LaTeX&quot;</span> <span class="s">&quot;pLaTeX&quot;</span> <span class="s">&quot;pBibTeX&quot;</span> <span class="s">&quot;jTeX&quot;</span> <span class="s">&quot;jLaTeX&quot;</span> <span class="s">&quot;jBibTeX&quot;</span><span class="p">))</span>
                 <span class="p">(</span><span class="nf">delq</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">command</span> <span class="nv">TeX-command-list</span><span class="p">)</span> <span class="nv">TeX-command-list</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">setq</span> <span class="nv">TeX-command-default</span> <span class="s">&quot;LaTeX&quot;</span>
                     <span class="nv">japanese-LaTeX-command-default</span> <span class="s">&quot;LaTeX&quot;</span>
                     <span class="nv">TeX-PDF-mode</span> <span class="nv">t</span>
                     <span class="nv">TeX-command-output-list</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;LaTeX&quot;</span> <span class="p">(</span><span class="s">&quot;pdf&quot;</span><span class="p">)))</span>
                     <span class="p">)</span>
               <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;TeX-expand-list</span>
                            <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;%(LATEXENC)&quot;</span>
                              <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
                                <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">str</span> <span class="p">(</span><span class="nf">japanese-TeX-get-encoding-string</span><span class="p">)))</span>
                                  <span class="p">(</span><span class="k">if </span><span class="nv">str</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s&quot;</span> <span class="nv">str</span><span class="p">)</span> <span class="s">&quot;&quot;</span><span class="p">)))))</span>
               <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;TeX-command-list</span>
                            <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;LaTeX&quot;</span>
                              <span class="s">&quot;LATEXENC=%(LATEXENC) latexmk -gg %t&quot;</span>
                              <span class="nv">TeX-run-TeX</span> <span class="nv">nil</span> <span class="p">(</span><span class="nf">latex-mode</span><span class="p">)</span> <span class="nv">:help</span> <span class="s">&quot;Run Latexmk&quot;</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">TeX-source-correlate-method</span> <span class="ss">&#39;synctex</span>
        <span class="nv">TeX-source-correlate-start-server</span> <span class="nv">t</span>
        <span class="nv">TeX-source-correlate-mode</span> <span class="nv">t</span>
        <span class="nv">TeX-view-program-selection</span> <span class="o">&#39;</span><span class="p">((</span><span class="nf">output-dvi</span> <span class="s">&quot;xdvi&quot;</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nf">output-pdf</span> <span class="s">&quot;Evince&quot;</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nf">output-html</span> <span class="s">&quot;xdg-open&quot;</span><span class="p">))</span>
        <span class="nv">TeX-auto-save</span> <span class="nv">t</span>
        <span class="nv">TeX-auto-local</span>  <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;auctex/auto&quot;</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">TeX-style-local</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&quot;auctex/style&quot;</span> <span class="nv">my:d:tmp</span><span class="p">)</span>
        <span class="nv">TeX-parse-self</span> <span class="nv">t</span>
        <span class="nv">TeX-auto-untabify</span> <span class="nv">t</span>
        <span class="nv">font-latex-fontify-script</span> <span class="nv">nil</span>
        <span class="nv">font-latex-fontify-sectioning</span> <span class="mf">1.0</span>
        <span class="nv">font-latex-script-display</span> <span class="nv">nil</span>
        <span class="nv">reftex-plug-into-AUCTeX</span> <span class="nv">t</span>
        <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
  </li>
</ul>
<p><code>~/.latexmkrc</code> の設定は以下の通り．</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env perl</span>
<span class="nv">$kanji</span>  <span class="o">=</span> <span class="nb">defined</span> <span class="nv">$ENV</span><span class="p">&#123;</span><span class="s">&quot;LATEXENC&quot;</span><span class="p">}</span> <span class="p">?</span> <span class="s">&quot;-kanji=$ENV&#123;\&quot;LATEXENC\&quot;}&quot;</span> <span class="p">:</span> <span class="s">&quot;-kanjii=utf8&quot;</span> <span class="p">;</span>
<span class="nv">$latex</span>  <span class="o">=</span> <span class="s">&quot;platex -interaction=nonstopmode -src-specials -shell-escape --synctex=1 $kanji&quot;</span><span class="p">;</span>
<span class="nv">$latex_silent</span> <span class="o">=</span> <span class="s">&quot;platex -interaction=batchmode -src-specials -shell-escape --synctex=1 $kanji&quot;</span><span class="p">;</span>
<span class="nv">$bibtex</span> <span class="o">=</span> <span class="s">&quot;pbibtex $kanji&quot;</span><span class="p">;</span>
<span class="nv">$makeindex</span> <span class="o">=</span> <span class="s">&quot;touch -m %D&quot;</span><span class="p">;</span>
<span class="nv">$dvipdf</span> <span class="o">=</span> <span class="s">&quot;dvipdfmx %O -o %D %S&quot;</span><span class="p">;</span>
<span class="nv">$dvips</span> <span class="o">=</span> <span class="s">&#39;dvips %O -z -f %S | convbkmk -u &gt; %D&#39;</span><span class="p">;</span>
<span class="nv">$ps2pdf</span> <span class="o">=</span> <span class="s">&#39;ps2pdfwr %O %S %D&#39;</span><span class="p">;</span>
<span class="nv">$pdf_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$pdf_previewer</span> <span class="o">=</span> <span class="s">&#39;start xdg-open&#39;</span><span class="p">;</span>
<span class="nv">$pdf_update_method</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$clean_ext</span> <span class="o">=</span> <span class="s">&quot;snm nav vrb synctex.gz&quot;</span><span class="p">;</span>
</pre></div>
<h3><a id="Fortran"><span class='anchor'>_</span></a>Fortran</h3>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">f90</span>
  <span class="nv">:mode</span> <span class="p">(</span><span class="s">&quot;\\.\\(f|F\\)\\(90|95|03|08\\)$&quot;</span> <span class="o">.</span> <span class="nv">f90-mode</span><span class="p">)</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;f90-mode-hook</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
              <span class="p">(</span><span class="nf">setq</span> <span class="nv">f90-do-indent</span> <span class="mi">2</span>
                    <span class="nv">f90-if-indent</span> <span class="mi">2</span>
                    <span class="nv">f90-type-indent</span> <span class="mi">2</span>
                    <span class="nv">f90-program-indent</span> <span class="mi">2</span>
                    <span class="nv">f90-continuation-indent</span> <span class="mi">2</span>
                    <span class="nv">f90-directive-comment-re</span> <span class="s">&quot;!omp\\$&quot;</span>
                    <span class="nv">f90-indented-comment-re</span> <span class="s">&quot;!&quot;</span>
                    <span class="nv">f90-break-delimiters</span> <span class="s">&quot;[-+\\*/&gt;&lt;=,% \t]&quot;</span>
                    <span class="nv">f90-break-before-delimiters</span> <span class="nv">t</span>
                    <span class="nv">f90-beginning-ampersand</span> <span class="nv">nil</span>
                    <span class="nv">f90-smart-end</span> <span class="ss">&#39;blink</span>
                    <span class="nv">f90-auto-keyword-case</span> <span class="nv">nil</span>
                    <span class="nv">f90-leave-line-no</span> <span class="nv">nil</span>
                    <span class="nv">f90-comment-region</span> <span class="s">&quot;!! &quot;</span>
                    <span class="nv">f90-indent-comment</span> <span class="s">&quot;! &quot;</span>
                    <span class="nv">indent-tabs-mode</span> <span class="nv">nil</span>
                    <span class="nv">f90-font-lock-keywords</span> <span class="nv">f90-font-lock-keywords-2</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">ggtags-mode</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="p">)</span>
</pre></div>
<h3><a id="補完: =auto-complete="><span class='anchor'>_</span></a>補完: <code>auto-complete</code></h3>
<p>ちょいちょい上手く動かなかったりするんだけれど、どうしたモンかな.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">auto-complete-config</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">ac-flyspell-workaround</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">ac-set-trigger-key</span> <span class="s">&quot;M-TAB&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">ac-config-default</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">&#39;ac-dictionary-directories</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:share</span> <span class="s">&quot;ac-dict&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">ac-comphist-file</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">my:d:tmp</span> <span class="s">&quot;ac-comphist.dat&quot;</span><span class="p">)</span>
        <span class="nv">ac-auto-start</span> <span class="mi">4</span>                          <span class="c1">; 4 文字以上で起動</span>
        <span class="nv">ac-use-menu-map</span> <span class="nv">t</span>                        <span class="c1">; キーバインド</span>
        <span class="nv">ac-auto-show-menu</span> <span class="mi">1</span>                      <span class="c1">; 1秒でメニュー表示</span>
        <span class="nv">ac-use-comphist</span> <span class="nv">t</span>                        <span class="c1">; 補完候補をソート</span>
        <span class="nv">ac-candidate-limit</span> <span class="nv">nil</span>                   <span class="c1">; 補完候補表示を無制限に</span>
        <span class="nv">ac-use-quick-help</span> <span class="nv">nil</span><span class="p">)</span>                   <span class="c1">; tool tip 無し</span>
  <span class="c1">;; (dolist (mode</span>
  <span class="c1">;;          &#39;(</span>
  <span class="c1">;;            ))</span>
  <span class="c1">;;  (add-to-list &#39;ac-modes mode))</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="基本的なキーバインドの設定"><span class='anchor'>_</span></a>基本的なキーバインドの設定</h2>
<p>既に手癖になってしまっているアレコレ．
  特に <code>[home]</code> と <code>[end]</code> は無いと途方に暮れます．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">bind-keys*</span>
 <span class="p">(</span><span class="s">&quot;&lt;f2&gt;&quot;</span>    <span class="o">.</span> <span class="nv">eww</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-h&quot;</span>     <span class="o">.</span> <span class="nv">backward-delete-char</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-c M-a&quot;</span> <span class="o">.</span> <span class="nv">align-regexp</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-c ;&quot;</span>   <span class="o">.</span> <span class="nv">comment-region</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-c M-;&quot;</span> <span class="o">.</span> <span class="nv">uncomment-region</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-/&quot;</span>     <span class="o">.</span> <span class="nv">undo</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-x M-b&quot;</span> <span class="o">.</span> <span class="nv">ibuffer-other-window</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-c M-r&quot;</span> <span class="o">.</span> <span class="nv">replace-regexp</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-c r&quot;</span>   <span class="o">.</span> <span class="nv">replace-string</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;&lt;home&gt;&quot;</span>  <span class="o">.</span> <span class="nv">beginning-of-buffer</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;&lt;end&gt;&quot;</span>   <span class="o">.</span> <span class="nv">end-of-buffer</span><span class="p">)</span>
 <span class="p">(</span><span class="s">&quot;C-c C-j&quot;</span> <span class="o">.</span> <span class="nv">browse-url-at-point</span><span class="p">)</span>
 <span class="p">)</span>
</pre></div>
<h2><a id="=diminish=: モードラインの短縮表示"><span class='anchor'>_</span></a><code>diminish</code>: モードラインの短縮表示</h2>
<p><code>use-package</code> で読み込まれているので，可能な限りそちらで指定するように変更．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">diminish</span> <span class="nv">:ensure</span> <span class="nv">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defmacro</span> <span class="nv">my:diminish</span> <span class="p">(</span><span class="nf">file</span> <span class="nv">mode</span> <span class="nv">&amp;optional</span> <span class="nv">new-name</span><span class="p">)</span>
  <span class="s">&quot;original: https://github.com/larstvei/dot-emacs/blob/master/init.org&quot;</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">with-eval-after-load</span> <span class="o">,</span><span class="nv">file</span>
     <span class="p">(</span><span class="nf">diminish</span> <span class="o">,</span><span class="nv">mode</span> <span class="o">,</span><span class="nv">new-name</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">my:diminish</span> <span class="s">&quot;isearch&quot;</span> <span class="ss">&#39;isearch-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">my:diminish</span> <span class="s">&quot;&quot;</span>        <span class="ss">&#39;develock-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">auto-revert-mode-text</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
<p>メジャーモードは <code>hook</code> で設定.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;emacs-lisp-mode-hook</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">setq</span> <span class="nv">mode-name</span> <span class="s">&quot;&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;lisp-interaction-mode-hook</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">setq</span> <span class="nv">mode-name</span> <span class="s">&quot;&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;wl-folder-mode-hook</span>  <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">setq</span> <span class="nv">mode-name</span> <span class="s">&quot;&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;wl-summary-mode-hook</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">setq</span> <span class="nv">mode-name</span> <span class="s">&quot;&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;wl-draft-mode-hook</span>   <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">setq</span> <span class="nv">mode-name</span> <span class="s">&quot;&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;mime-view-mode-hook</span>  <span class="o">&#39;</span><span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">setq</span> <span class="nv">mode-name</span> <span class="s">&quot;&quot;</span><span class="p">)))</span>
</pre></div>
<h2><a id="フォントと色"><span class='anchor'>_</span></a>フォントと色</h2>
<p>そろそろテーマにした方が良い，とは思ってはいる．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:load-window-config</span> <span class="p">()</span>
  <span class="s">&quot;load window-system specific settings&quot;</span>
  <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">when</span> <span class="nv">window-system</span>
    <span class="p">(</span><span class="nf">progn</span>
      <span class="p">(</span><span class="nf">set-frame-parameter</span> <span class="nv">nil</span> <span class="ss">&#39;alpha</span> <span class="mi">90</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">set-face-attribute</span> <span class="ss">&#39;default</span> <span class="nv">nil</span>
                          <span class="nv">:family</span> <span class="s">&quot;RictyDiscord&quot;</span>
                          <span class="nv">:height</span> <span class="mi">180</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">set-face-attribute</span> <span class="ss">&#39;fixed-pitch</span> <span class="nv">nil</span>
                          <span class="nv">:family</span> <span class="s">&quot;RictyDiscord&quot;</span>
                          <span class="nv">:height</span> <span class="mi">180</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">set-face-attribute</span> <span class="ss">&#39;variable-pitch</span> <span class="nv">nil</span>
                          <span class="nv">:family</span> <span class="s">&quot;RictyDiscord&quot;</span>
                          <span class="nv">:height</span> <span class="mi">180</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">set-background-color</span> <span class="s">&quot;#242424&quot;</span><span class="p">)</span>
      <span class="p">)))</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">frame-background-mode</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="nv">nil</span> <span class="ss">&#39;background-mode</span><span class="p">))</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">default-frame-alist</span>
      <span class="o">&#39;</span><span class="p">(</span>
        <span class="p">(</span><span class="nf">foreground-color</span> <span class="o">.</span> <span class="s">&quot;#F6F3E8&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">scroll-bar-foreground-color</span> <span class="o">.</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">vertical-scroll-bars</span> <span class="o">.</span> <span class="nv">right</span><span class="p">)</span>
        <span class="p">))</span>
<span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nf">window-system</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">my:load-window-config</span><span class="p">))</span>
</pre></div>
<p>現在修正中．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">custom-set-faces</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">default</span>                             <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">cursor</span>                              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4CFF4C&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#4CFF4C&quot;</span> <span class="p">))))</span>
 <span class="c1">;; basic</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-builtin-face</span>              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FBFFF&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-comment-delimiter-face</span>    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#a5a5a6&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-comment-face</span>              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#a5a5a6&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-constant-face</span>             <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FFBF7F&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-doc-face</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FFF7F&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-doc-string-face</span>           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FFF7F&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-function-name-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#BF7FFF&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-keyword-face</span>              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FF7F7F&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-link-face</span>                 <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FFFFF&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-negation-char-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FFFFF&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span>   <span class="nv">:italic</span> <span class="nv">nil</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-preprocessor-face</span>         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FF4C4C&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="nv">:italic</span> <span class="nv">nil</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-regexp-grouping-backslash</span> <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#A5EE4C&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span>   <span class="nv">:italic</span> <span class="nv">nil</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-regexp-grouping-construct</span> <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7F7FFF&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span>   <span class="nv">:italic</span> <span class="nv">nil</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-string-face</span>               <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7FFF7F&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-type-face</span>                 <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FFFF7F&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-variable-name-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7F7FFF&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-warning-face</span>              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FF7FBF&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">mode-line</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#222244&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">mode-line-inactive</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#666666&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#999999&quot;</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">fringe</span>                              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#666666&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#282828&quot;</span> <span class="p">))))</span>
<span class="c1">;; &#39;(hl-line                           ((t (:inherit highlight :underline t ))))</span>
<span class="c1">;; &#39;(highlight                         ((t (:background &quot;#333333&quot; ))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-black</span>                    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#242424&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#242424&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-blue</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#4c4cff&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#4c4cff&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-cyan</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#4cffff&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#4cffff&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-green</span>                    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#4cff4c&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#4cff4c&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-magenta</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#ff4cff&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#ff4cff&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-red</span>                      <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#ff4c4c&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#ff4c4c&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-white</span>                    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#f6f3e8&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#f6f3e8&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">term-color-yellow</span>                   <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#ffff4c&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#ffff4c&quot;</span><span class="p">))))</span>
  <span class="c1">;;</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">minibuffer-prompt</span>                   <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#BF7FFF&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">region</span>                              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#222244&quot;</span> <span class="p">))))</span>
 <span class="c1">;; dired</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">dired-directory</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#7F7FFF&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">dired-flagged</span>                       <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">error</span> <span class="p">))))</span>
 <span class="c1">;; &#39;(dired-header</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">dired-ignored</span>                       <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">shadow</span> <span class="p">))))</span>
 <span class="c1">;; &#39;(dired-mark</span>
 <span class="c1">;; &#39;(dired-marked</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">dired-perm-write</span>                    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#FFFF7F&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">dired-symlink</span>                       <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#7FFFFF&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">dired-warning</span>                       <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-warning-face</span> <span class="p">))))</span>
 <span class="c1">;; helm</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-source-header</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#224488&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-visible-mark</span>                   <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">highlight</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-selection</span>                      <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">highlight</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-selection-line</span>                 <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">highlight</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-ff-directory</span>                   <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">dired-directory</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-bookmark-directory</span>             <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-directory</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-buffer-directory</span>               <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-directory</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-ff-dotted-directory</span>            <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-directory</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-ff-file</span>                        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-bookmark-file</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-file</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-buffer-file</span>                    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-file</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-grep-file</span>                      <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-file</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-etags-file</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-file</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-ff-executable</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-file</span> <span class="nv">:foreground</span> <span class="s">&quot;#7FFF7F&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-ff-symlink</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="nv">:foreground</span> <span class="s">&quot;#7FFFFF&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-ff-dotted-symlink-directory</span>    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">helm-ff-symlink</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">helm-ff-invalid-symlink</span>             <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="nv">:foreground</span> <span class="s">&quot;#FF7F7F&quot;</span> <span class="p">))))</span>
 <span class="c1">;; ido</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">ido-first-match</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:underline</span> <span class="nv">t</span> <span class="nv">:weight</span> <span class="nv">bold</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">ido-only-match</span>                      <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FFFF4C&quot;</span> <span class="nv">:overline</span> <span class="nv">nil</span> <span class="nv">:weight</span> <span class="nv">bold</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">ido-subdir</span>                          <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">dired-directory</span><span class="p">))))</span>
 <span class="c1">;; &#39;(ido-vertical-first-match-face       ((t (:inherit ido-first-match))))</span>
 <span class="c1">;;&#39;(ido-vertical-match-face             ((t (:foreground &quot;#4CFF4C&quot;))))</span>
 <span class="c1">;; &#39;(ido-grid-mode-match ((t (:inherit ido-first-match ))))</span>
 <span class="c1">;; powerline</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">powerline-active1</span>                   <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#000000&quot;</span><span class="nv">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">powerline-active2</span>                   <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#666666&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">powerline-inactive1</span>                 <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">modeline-inactive</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">powerline-inactive2</span>                 <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">modeline-inactive</span><span class="p">))))</span>
 <span class="c1">;; preview-latex</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-sectioning-0-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-latex-sectioning-1-face</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-sectioning-1-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-latex-sectioning-2-face</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-sectioning-2-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-latex-sectioning-3-face</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-sectioning-3-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-latex-sectioning-4-face</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-sectioning-4-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-latex-sectioning-5-face</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-sectioning-5-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-type-face</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-slide-title-face</span>         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-type-face</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-subscript-face</span>           <span class="p">((</span><span class="nf">t</span> <span class="nv">nil</span><span class="p">)))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-superscript-face</span>         <span class="p">((</span><span class="nf">t</span> <span class="nv">nil</span><span class="p">)))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-math-face</span>                <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-constant-face</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-script-char-face</span>         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-preprocessor-face</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-latex-verbatim-face</span>            <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-doc-string-face</span> <span class="p">))))</span>
 <span class="c1">;; elscreen</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">elscreen-tab-control-face</span>           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#222244&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#f6f3e8&quot;</span> <span class="nv">:underline</span> <span class="nv">t</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">elscreen-tab-current-screen-face</span>    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#222244&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#f6f3e8&quot;</span> <span class="nv">:underline</span> <span class="nv">t</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">elscreen-tab-other-screen-face</span>      <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#222244&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#aaaaaa&quot;</span> <span class="nv">:underline</span> <span class="nv">t</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">elscreen-tab-background-face</span>        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:background</span> <span class="s">&quot;#222244&quot;</span> <span class="nv">:foreground</span> <span class="s">&quot;#aaaaaa&quot;</span> <span class="nv">:underline</span> <span class="nv">t</span> <span class="nv">:bold</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="c1">;; git-gutter</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">git-gutter:added</span>                    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#4CFF4C&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#666666&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">git-gutter:deleted</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#FF7FBF&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#666666&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">git-gutter:modified</span>                 <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#FFFF4C&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#666666&quot;</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">git-gutter:unchanged</span>                <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="nv">:background</span> <span class="s">&quot;#666666&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">git-gutter:separator-face</span>           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">default</span> <span class="nv">:foreground</span> <span class="s">&quot;#FF4C4C&quot;</span> <span class="nv">:background</span> <span class="s">&quot;#666666&quot;</span><span class="p">))))</span>
  <span class="c1">;;; howm</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">howm-mode-keyword-face</span>              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#7F7FFF&quot;</span> <span class="nv">:background</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">howm-mode-title-face</span>                <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4CFFFF&quot;</span> <span class="nv">:background</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">howm-reminder-deadline-face</span>         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#FF4C4C&quot;</span> <span class="nv">:background</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">howm-reminder-late-deadline-face</span>    <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:bold</span> <span class="nv">t</span> <span class="nv">:underline</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#FF0000&quot;</span> <span class="nv">:background</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">howm-reminder-today-face</span>            <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#FFBF7F&quot;</span> <span class="nv">:background</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">howm-reminder-tomorrow-face</span>         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:bold</span> <span class="nv">t</span> <span class="nv">:foreground</span> <span class="s">&quot;#FF7FBF&quot;</span> <span class="nv">:background</span> <span class="nv">nil</span> <span class="p">))))</span>
 <span class="c1">;; outline</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-1</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-function-name-face</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-2</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-string-face</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-3</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-keyword-face</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-4</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-type-face</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-5</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-constant-face</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-6</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-variable-name-face</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-7</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-builtin-face</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">outline-8</span>                           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-comment-face</span> <span class="nv">:bold</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="c1">;; org</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-agenda-date-today</span>               <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:underline</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-agenda-date</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FFFFFF&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-agenda-date-weekend</span>             <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#FF7F7F&quot;</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-agenda-calendar-event</span>           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#F6F3E8&quot;</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-hide</span>                            <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:foreground</span> <span class="s">&quot;#4C4C4C&quot;</span> <span class="p">))))</span>
 <span class="c1">;;</span>
 <span class="c1">;; moinmoin</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-h1</span>                         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-1</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-h2</span>                         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-2</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-h3</span>                         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-3</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-h4</span>                         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-4</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-h5</span>                         <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">outline-5</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-url</span>                        <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-link-face</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-url-title</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">moinmoin-url</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-anchor-ref-id</span>              <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">moinmoin-url</span> <span class="nv">:underline</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-anchor-ref-title</span>           <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">moinmoin-url</span> <span class="nv">:bold</span> <span class="nv">t</span><span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-wiki-link</span>                  <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">moinmoin-url</span> <span class="nv">:underline</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-inter-wiki-link</span>            <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">moinmoin-url</span> <span class="nv">:underline</span> <span class="nv">t</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-item</span>                       <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-doc-face</span> <span class="p">))))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">moinmoin-item-2</span>                     <span class="p">((</span><span class="nf">t</span> <span class="p">(</span><span class="nf">:inherit</span> <span class="nv">font-lock-doc-face</span> <span class="p">))))</span>
 <span class="p">)</span>
<span class="c1">;; review</span>
<span class="c1">;; &#39;(review-mode-header1-face  ((t (:inherit outline-1))))</span>
<span class="c1">;; &#39;(review-mode-header2-face  ((t (:inherit outline-2))))</span>
<span class="c1">;; &#39;(review-mode-header3-face  ((t (:inherit outline-3))))</span>
<span class="c1">;; &#39;(review-mode-header4-face  ((t (:inherit outline-4))))</span>
<span class="c1">;; &#39;(review-mode-header5-face  ((t (:inherit outline-5))))</span>
</pre></div>
<h2><a id="=powerline=: モードラインを綺麗に"><span class='anchor'>_</span></a><code>powerline</code>: モードラインを綺麗に</h2>
<h3><a id="ddskk の表示のカスタマイズ"><span class='anchor'>_</span></a>ddskk の表示のカスタマイズ</h3>
<p>SKK の状態がヒョコヒョコ動くのが嫌なので，
  <code>skk-modeline-input-mode</code> に常に現在の状況を表示する様にしておく．</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span> <span class="nv">my:skk-modeline-input-mode</span> <span class="p">()</span>
  <span class="s">&quot;skk が読み込まれていない場合でも skk-modeline-input-mode に文字を入れて返す&quot;</span>
  <span class="p">(</span><span class="nf">unless</span> <span class="p">(</span><span class="nf">boundp</span> <span class="ss">&#39;skk-modeline-inpt-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-modeline-input-mode</span> <span class="s">&quot;--[--]:&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">my:skk-modeline-input-mode</span><span class="p">)</span>
</pre></div>
<p>ddskk そのものに modeline を更新する関数があるので無効化する</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defadvice</span> <span class="nv">skk-setup-modeline</span> <span class="p">(</span><span class="nf">around</span> <span class="nv">my:disable-skk-setup-modeline</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="s">&quot;skk-setup-modeline による modeline の更新を無効化&quot;</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">skk-indicator-alist</span> <span class="p">(</span><span class="nf">skk-make-indicator-alist</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">force-mode-line-update</span> <span class="nv">t</span><span class="p">))</span>
</pre></div>
<h3><a id="powerline 本体の設定．"><span class='anchor'>_</span></a>powerline 本体の設定．</h3>
<p>default-theme をベースに見たい物だけ表示するようにしてみた．
  変更点として,</p>
<ul>
  <li>separater は環境によってズレるので，半角スペースに変更</li>
  <li>vc-mode でのアイコン表示に U+26A1⚡ High Voltage を使う</li>
</ul>
<p>といった事をしている. East Asian ambiguous Width char の扱いは面倒ですね</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">use-package</span> <span class="nv">powerline</span>
  <span class="nv">:config</span>
  <span class="p">(</span><span class="nf">setq</span> <span class="nv">powerline-default-separator</span> <span class="ss">&#39;utf-8</span>
        <span class="c1">;; 半角スペース</span>
        <span class="nv">powerline-utf-8-separator-left</span>  <span class="o">#</span><span class="nv">x20</span>
        <span class="nv">powerline-utf-8-separator-right</span>  <span class="o">#</span><span class="nv">x20</span>
        <span class="c1">;; デフォルトの⇔</span>
        <span class="c1">;; powerline-utf-8-separator-left  #xe0b0</span>
        <span class="c1">;; powerline-utf-8-separator-right #xe0b2</span>
        <span class="c1">;; 上三角, 下三角</span>
        <span class="c1">;; powerline-utf-8-separator-left  #xe0bc</span>
        <span class="c1">;; powerline-utf-8-separator-right #xe0be</span>
        <span class="c1">;; 壊れ枠</span>
        <span class="c1">;; powerline-utf-8-separator-left  #xe0d2</span>
        <span class="c1">;; powerline-utf-8-separator-right #xe0d4</span>
        <span class="p">)</span>
  <span class="p">(</span><span class="nf">defpowerline</span> <span class="nv">my:powerline-vc</span>
    <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span> <span class="nv">vc-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s%s&quot;</span>
              <span class="p">(</span><span class="nf">char-to-string</span> <span class="o">#</span><span class="nv">x26a1</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">format-mode-line</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">vc-mode</span> <span class="nv">vc-mode</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">my:powerline-theme</span> <span class="p">()</span>
    <span class="s">&quot;Setup customize theme.&quot;</span>
    <span class="p">(</span><span class="nf">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">setq-default</span>
     <span class="nv">mode-line-format</span>
     <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;%e&quot;</span>
       <span class="p">(</span><span class="nf">:eval</span>
        <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">active</span> <span class="p">(</span><span class="nf">powerline-selected-window-active</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">mode-line-buffer-id</span> <span class="p">(</span><span class="k">if </span><span class="nv">active</span> <span class="ss">&#39;mode-line-buffer-id</span> <span class="ss">&#39;mode-line-buffer-id-inactive</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">mode-line</span> <span class="p">(</span><span class="k">if </span><span class="nv">active</span> <span class="ss">&#39;mode-line</span> <span class="ss">&#39;mode-line-inactive</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">face1</span> <span class="p">(</span><span class="k">if </span><span class="nv">active</span> <span class="ss">&#39;powerline-active1</span> <span class="ss">&#39;powerline-inactive1</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">face2</span> <span class="p">(</span><span class="k">if </span><span class="nv">active</span> <span class="ss">&#39;powerline-active2</span> <span class="ss">&#39;powerline-inactive2</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">separator-left</span> <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;powerline-%s-%s&quot;</span>
                                               <span class="p">(</span><span class="nf">powerline-current-separator</span><span class="p">)</span>
                                               <span class="p">(</span><span class="nb">car </span><span class="nv">powerline-default-separator-dir</span><span class="p">))))</span>
               <span class="p">(</span><span class="nf">separator-right</span> <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;powerline-%s-%s&quot;</span>
                                                <span class="p">(</span><span class="nf">powerline-current-separator</span><span class="p">)</span>
                                                <span class="p">(</span><span class="nb">cdr </span><span class="nv">powerline-default-separator-dir</span><span class="p">))))</span>
               <span class="p">(</span><span class="nf">lhs</span> <span class="p">(</span><span class="nf">list</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="p">(</span><span class="nb">substring </span><span class="nv">skk-modeline-input-mode</span> <span class="mi">2</span> <span class="mi">-1</span><span class="p">)</span> <span class="nv">nil</span> <span class="ss">&#39;l</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="nv">mode-line-mule-info</span> <span class="nv">mode-line</span> <span class="ss">&#39;l</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="s">&quot;%*&quot;</span> <span class="nv">mode-line</span> <span class="ss">&#39;l</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-buffer-id</span> <span class="nv">mode-line-buffer-id</span> <span class="ss">&#39;l</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">funcall</span> <span class="nv">separator-left</span> <span class="nv">mode-line</span> <span class="nv">face1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-major-mode</span> <span class="nv">face1</span> <span class="ss">&#39;l</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-process</span> <span class="nv">face1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-narrow</span> <span class="nv">face1</span> <span class="ss">&#39;l</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="s">&quot; &quot;</span> <span class="nv">face1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">funcall</span> <span class="nv">separator-left</span> <span class="nv">face1</span> <span class="nv">face2</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">my:powerline-vc</span> <span class="nv">face2</span> <span class="ss">&#39;r</span><span class="p">)</span>
                     <span class="p">))</span>
               <span class="p">(</span><span class="nf">rhs</span> <span class="p">(</span><span class="nf">list</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="nv">global-mode-string</span> <span class="nv">face2</span> <span class="ss">&#39;r</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">funcall</span> <span class="nv">separator-right</span> <span class="nv">face2</span> <span class="nv">face1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="s">&quot; &quot;</span> <span class="nv">face1</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-minor-modes</span> <span class="nv">face1</span> <span class="ss">&#39;r</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">funcall</span> <span class="nv">separator-right</span> <span class="nv">face1</span> <span class="nv">mode-line</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="s">&quot;  &quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">powerline-raw</span> <span class="s">&quot;%6p&quot;</span> <span class="nv">mode-line</span> <span class="ss">&#39;r</span><span class="p">)</span>
                     <span class="p">))</span>
               <span class="p">)</span>
          <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">powerline-render</span> <span class="nv">lhs</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">powerline-fill</span> <span class="nv">face2</span> <span class="p">(</span><span class="nf">powerline-width</span> <span class="nv">rhs</span><span class="p">))</span>
                  <span class="p">(</span><span class="nf">powerline-render</span> <span class="nv">rhs</span><span class="p">)))))))</span>
  <span class="p">(</span><span class="nf">my:powerline-theme</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
<h2><a id="起動時間の計測"><span class='anchor'>_</span></a>起動時間の計測</h2>
<p><a href="http://memo.sugyan.com/entry/20120120/1327037494">起動時間を計測する 改訂版 - すぎゃーんメモ</a></p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-hook</span> <span class="ss">&#39;after-init-hook</span>
          <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
            <span class="p">(</span><span class="nf">message</span> <span class="s">&quot;init time: %.3f sec&quot;</span>
                     <span class="p">(</span><span class="nf">float-time</span> <span class="p">(</span><span class="nf">time-subtract</span> <span class="nv">after-init-time</span> <span class="nv">before-init-time</span><span class="p">)))))</span>
</pre></div>
<h2><a id="LICENSE"><span class='anchor'>_</span></a>LICENSE</h2>
<p>幾つかの関数の元ネタとして Emacs 本体のコードを参照したので，GPL-3 or later です．</p>
<pre class="example">
Copyright (C) 2011--2017 Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;
.
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
.
This package is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.
You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.
</pre>


      </div>
    </main>
    <footer class="flex justify-end bottom-0 left-0 right-0 m0 p1">
  <p class="px4">
    
    &copy; 2006 - 2018
    <a href="mailto:uwabami@gfd-dennou.org"></a>,
    Lastupdate: 2018-10-16 19:46:27
    <br/>
    Powered by
    <a href="http://orgmode.org/" target="_blank" title="Org mode">
      Org mode
    </a>
    +
    <a href="http://jekyllrb.com/" target="_blank" title="Jekyll" >
      Jekyll
    </a>
    +
    <a href="http://basscss.com/" target="_blank" title="Basscss" >
      Basscss
    </a>
  </p>
</footer>
<amp-analytics data-block-on-consent type="googleanalytics" id="amp-analytics">
  <script type="application/json">
  {
      "vars": {
          "account": "UA-90872419-1"
      },
      "triggers": {
          "trackPageview" : {
              "on": "visible",
              "request": "pageview"
          }
      }
  }

  </script>
</amp-analytics>

  </body>
</html>
