---
title: Emacs の設定
date: 2017-01-16 23:35:49
layout: cc-env
lang: ja
ref: cc-env/Emacs
permalink: /cc-env/Emacs.html
---
<p>
Related: <a href='index.html'>Index</a>
</p>
<div id="outline-container-org7339e40" class="outline-2">
<h2 id="org7339e40">はじめに</h2>
<div class="outline-text-2" id="text-org7339e40">
<p>
ここでは，私の Emacs の設定についてまとめています．
</p>

<p>
<object type="image/svg+xml" data="https://travis-ci.org/uwabami/emacs.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<object type="image/svg+xml" data="https://img.shields.io/badge/License-GPLv3-blue.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>

<p>
基本方針は以下の通り:
</p>
</div>
<div id="outline-container-org257bca7" class="outline-3">
<h3 id="org257bca7">Emacs のパッケージ(<code>package.el</code>)と <a href="https://github.com/quelpa/quelpa">quelpa</a>, <a href="https://github.com/jwiegley/use-package">use-package</a> を使う</h3>
<div class="outline-text-3" id="text-org257bca7">
<p>
基本は <code>package.el</code> を使いますが、
VCS からインストールしたいパッケージが幾つかあるので、
それらについては <a href="https://github.com/quelpa/quelpa">quelpa</a> を使います。
</p>
</div>
</div>
<div id="outline-container-orgcda7e00" class="outline-3">
<h3 id="orgcda7e00">Debian パッケージがインストールされているならば，それを優先する</h3>
<div class="outline-text-3" id="text-orgcda7e00">
<p>
はい，個人の我侭ですね．:<a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">Eating your own dog food - Wikipedia</a>
</p>

<p>
Emacsに関連するDebianパッケージを幾つかメンテナンスしているので，
可能な限りDebianパッケージを使うことにしています.
</p>

<p>
自分が root 持っていない環境ではしょうがないですけれど．
</p>
</div>
</div>
<div id="outline-container-org209087f" class="outline-3">
<h3 id="org209087f">設定は <a href="http://orgmode.org/">Org mode</a> で書きたい</h3>
<div class="outline-text-3" id="text-org209087f">
<p>
以前こんなブログ記事を書きました: <a href="http://uwabami.junkhub.org/log/20111213.html#p01">Emacsの設定ファイルをorgで書く</a>
</p>

<p>
というわけで，設定は <a href="http://orgmode.org/worg/org-contrib/babel/intro.html">Org Babel</a> で書いています．
本ファイル(<code>README.org</code>) から，
Makefile 内の以下のスクリプトで <code>~/init.el</code> を生成し，byte-compile します．
</p>
<div class="org-src-container">
<pre class="src src-makefile-gmake"><span style="color: #BF7FFF;">init.el</span>: README.org
    $(<span style="color: #7F7FFF;">EMACS</span>) -q --batch --eval \
         <span style="color: #7FFF7F;">"(progn \</span>
<span style="color: #7FFF7F;">            (require 'ob-tangle) \</span>
<span style="color: #7FFF7F;">            (org-babel-tangle-file \"$</span><span style="color: #FFBF7F;">&lt;</span><span style="color: #7FFF7F;">\" \"</span><span style="color: #7FFF7F;">$</span><span style="color: #FFBF7F;">@</span><span style="color: #7FFF7F;">\" \"emacs-lisp\")))"</span>
<span style="color: #BF7FFF;">%.elc</span>: %.el
    $(<span style="color: #7F7FFF;">EMACS</span>) -l $<span style="color: #FFBF7F;">&lt;</span> -batch -f batch-byte-compile $<span style="color: #FFBF7F;">&lt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb1d8793" class="outline-2">
<h2 id="orgb1d8793">ディレクトリ構成</h2>
<div class="outline-text-2" id="text-orgb1d8793">
<p>
分割した設定ファイル群やパッケージで install したパッケージ
の置き場所は <code>user-emacs-directory</code> 以下にまとめています．
</p>

<p>
試行錯誤の結果，ディレクトリ構成は以下のようにしました:
</p>
<pre class="example">
    ~/.emacs.d/
     |-- Makefile        ←  byte-compile 用の rule
     |-- README.org      ←  本ファイル．`org-babel-tangle' で init.el を生成
     |-- init-foobar.org ←  外部ファイルを使うパッケージの設定ファイル
     |-- init-barbaz.org     (ddskk, gnus, wanderlust, ...)
     :
     |-- packages/       ←  package.el で導入したパッケージが置かれる場所
     |-- quelpa/         ←  quelpa で導入したパッケージが置かれる場所
     |-- share/          ←  (基本的に)参照するだけの資源置き場所
     `-- tmp/            ←  一次ファイルの置き場所
</pre>
<p>
上記ディレクトリ構成を設定ファイルで使用するためにディレクトリ配置を宣言しておきます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">when</span> load-file-name
  (<span style="color: #FF7F7F;">setq</span> user-emacs-directory (file-name-directory load-file-name)))
(<span style="color: #FF7F7F;">defconst</span> <span style="color: #7F7FFF;">my:d:share</span>
  (expand-file-name <span style="color: #7FFF7F;">"share/"</span> user-emacs-directory))
(<span style="color: #FF7F7F;">defconst</span> <span style="color: #7F7FFF;">my:d:tmp</span>
  (expand-file-name <span style="color: #7FFF7F;">"tmp/"</span> user-emacs-directory))
</pre>
</div>
<p>
ついでに，
<code>custom-set-variables</code> は別ファイルに出力，終了時に削除するようにしています．
これは単なる趣味です．
<del>init.elが汚れる気がしてあまり好きではないのですが&#x2026;皆さん気にしてないんですかね</del>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> custom-file (concat my:d:tmp <span style="color: #7FFF7F;">"custom.el"</span>))
(add-hook 'kill-emacs-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (<span style="color: #FF7F7F;">if</span> (file-exists-p custom-file)
                (delete-file custom-file))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf6fb2ef" class="outline-2">
<h2 id="orgf6fb2ef">Package 関連: <code>package.el</code>, <a href="https://github.com/jwiegley/use-package">use-package</a>, <a href="https://github.com/quelpa/quelpa">quelpa</a></h2>
<div class="outline-text-2" id="text-orgf6fb2ef">
<p>
<a href="https://github.com/jwiegley/use-package">use-package</a> のおかけで、
無いと途方に暮れるパッケージ以外のインストールは無視できるようになります。
</p>
</div>
<div id="outline-container-org183f40e" class="outline-3">
<h3 id="org183f40e"><code>package.el</code></h3>
<div class="outline-text-3" id="text-org183f40e">
<p>
パッケージは基本的に <code>pacakge.el</code> で導入するので、先ずはその設定.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (file-directory-p (concat user-emacs-directory <span style="color: #7FFF7F;">"packages"</span>))
  (make-directory (concat user-emacs-directory <span style="color: #7FFF7F;">"packages"</span>)))
(<span style="color: #FF7F7F;">setq</span> url-http-attempt-keepalives nil)
(<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">package</span> nil 'noerror)
(<span style="color: #FF7F7F;">setq</span> package-enable-at-startup t
      package-user-dir (concat user-emacs-directory <span style="color: #7FFF7F;">"packages"</span>))
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"melpa"</span> . <span style="color: #7FFF7F;">"https://melpa.org/packages/"</span>) t)
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"org"</span>   . <span style="color: #7FFF7F;">"http://orgmode.org/elpa/"</span>) t)
(package-initialize)
(<span style="color: #FF7F7F;">eval-when-compile</span> (package-refresh-contents))
(<span style="color: #FF7F7F;">unless</span> (package-installed-p 'package-utils)
  (package-install 'package-utils))
</pre>
</div>
<p>
また，初回起動時に <code>make</code> で org の最新版等を導入するために
batch でインストールできる様に，以下を <code>emacs-batch-install.el</code> として出力します．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">when</span> load-file-name
  (<span style="color: #FF7F7F;">setq</span> user-emacs-directory (file-name-directory load-file-name)))
(<span style="color: #FF7F7F;">unless</span> (file-directory-p (concat user-emacs-directory <span style="color: #7FFF7F;">"packages"</span>))
  (make-directory (concat user-emacs-directory <span style="color: #7FFF7F;">"packages"</span>)))
(<span style="color: #FF7F7F;">setq</span> url-http-attempt-keepalives nil)
(<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">package</span> nil 'noerror)
(<span style="color: #FF7F7F;">setq</span> package-user-dir (concat user-emacs-directory <span style="color: #7FFF7F;">"packages"</span>))
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"melpa"</span> . <span style="color: #7FFF7F;">"https://melpa.org/packages/"</span>) t)
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"org"</span>   . <span style="color: #7FFF7F;">"http://orgmode.org/elpa/"</span>) t)
(package-refresh-contents)
(package-initialize)
(package-install pkg-install)
</pre>
</div>
<p>
batch でのインストールは例えば
</p>
<div class="org-src-container">
<pre class="src src-makefile">    $(<span style="color: #7F7FFF;">EMACS</span>) -q --batch --eval \
      <span style="color: #7FFF7F;">"(deconst pkg-install 'org-plus-contrib)"</span> -l emacs-batch-install.el
</pre>
</div>
<p>
とか．実際は <a href="Makefile">Makefile</a> 参照．
</p>
</div>
</div>
<div id="outline-container-orgfcf8c4b" class="outline-3">
<h3 id="orgfcf8c4b"><a href="https://github.com/jwiegley/use-package">use-package</a></h3>
<div class="outline-text-3" id="text-orgfcf8c4b">
<p>
個々のパッケージの設定には <a href="https://github.com/jwiegley/use-package">use-package</a> を利用します．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">use-package</span> nil t)
  (package-install 'use-package))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge89a176" class="outline-3">
<h3 id="orge89a176"><a href="https://github.com/quelpa/quelpa">quelpa</a></h3>
<div class="outline-text-3" id="text-orge89a176">
<p>
melpa に登録されていないパッケージや自作の elisp 等をインストールできる様に
<a href="https://github.com/quelpa/quelpa">quelpa</a> を入れておきます．とはいえ、これでパッケージを入れる訳ではないので、
melpa の同期はしません。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">quelpa</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> quelpa-upgrade-p nil
        quelpa-checkout-melpa-p nil
        quelpa-update-melpa-p nil
        quelpa-melpa-recipe-stores nil
        )
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd8967ba" class="outline-2">
<h2 id="orgd8967ba">独自関数</h2>
<div class="outline-text-2" id="text-orgd8967ba">
</div><div id="outline-container-org34e2b2b" class="outline-3">
<h3 id="org34e2b2b">カーソルのある位置の face を調べる関数</h3>
<div class="outline-text-3" id="text-org34e2b2b">
<p>
わりと良く使う. 地味に便利
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:describe-face-at-point</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (message <span style="color: #7FFF7F;">"%s"</span> (get-char-property (point) 'face)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org5398ad8" class="outline-3">
<h3 id="org5398ad8">機能を無効化するための関数の定義</h3>
<div class="outline-text-3" id="text-org5398ad8">
<p>
<code>line-number-mode</code> など「有効無効をtoggleする関数」は
慣習的に <code>0</code> 以下の数字を指定すると明示的に無効化できるので，
<code>-1</code> を設定する関数を定義しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:disable-builtin-mode</span> (mode)
  <span style="color: #7FFF7F;">"&#19982;&#12360;&#12425;&#12428;&#12383; mode &#12364;&#23384;&#22312;&#12377;&#12427;&#12398;&#12391;&#12354;&#12428;&#12400; -1 &#12434;&#12475;&#12483;&#12488;&#12375;&#12390;&#28961;&#21177;&#21270;"</span>
  (<span style="color: #FF7F7F;">if</span> (fboundp mode) (funcall mode -1)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf83c6a9" class="outline-3">
<h3 id="orgf83c6a9">dpkg-status</h3>
<div class="outline-text-3" id="text-orgf83c6a9">
<p>
もっと良い方法がありそうなモンですが．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:dpkg-status</span> (package)
  <span style="color: #7FFF7F;">"Return the package status from dpkg --get-selections."</span>
  (string-match <span style="color: #7FFF7F;">"^ii"</span> (shell-command-to-string (format <span style="color: #7FFF7F;">"dpkg -l %s"</span> package))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdf0ec63" class="outline-2">
<h2 id="orgdf0ec63">byte-compile 用の雑多な設定</h2>
<div class="outline-text-2" id="text-orgdf0ec63">
</div><div id="outline-container-org45c59c5" class="outline-3">
<h3 id="org45c59c5">常に <code>cl-lib</code> を読み込む</h3>
<div class="outline-text-3" id="text-org45c59c5">
<p>
以前は(今も?)「 <code>cl.el</code> は名前衝突があるので byte compile 時以外は読み込まない様にしよう」
というお話でした．つまり，
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">eval-when-compile</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">cl</span>))
</pre>
</div>
<p>
としておくこと，という．
</p>

<p>
今は「 <code>cl.el</code> は deprecated なので <code>cl-lib</code> を使いましょう」ということみたいです．
名前衝突の回避のために，関数の接頭詞として <code>cl-</code> が付くようになったのは御愛嬌．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">eval-and-compile</span> (<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">cl-lib</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd7e6c01" class="outline-3">
<h3 id="orgd7e6c01">debug は表示しない: 必要に応じて t に変更する</h3>
<div class="outline-text-3" id="text-orgd7e6c01">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> debug-on-error nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-org56ff198" class="outline-3">
<h3 id="org56ff198"><code>.elc</code> と <code>.el</code> の timestamp を比較し，新しい方を読み込む</h3>
<div class="outline-text-3" id="text-org56ff198">
<p>
<code>load-prefer-newer</code> は Emacs &gt;= 24.4 から．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">when</span> (boundp 'load-prefer-newer)
  (<span style="color: #FF7F7F;">setq</span> load-prefer-newer t))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd48256c" class="outline-3">
<h3 id="orgd48256c">Compile-Log の非表示</h3>
<div class="outline-text-3" id="text-orgd48256c">
<p>
ほとんど見ないし．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">let</span> ((win (get-buffer-window <span style="color: #7FFF7F;">"*Compile-Log*"</span>)))
  (<span style="color: #FF7F7F;">when</span> win (delete-window win)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org03caa8e" class="outline-3">
<h3 id="org03caa8e">Warning の抑制</h3>
<div class="outline-text-3" id="text-org03caa8e">
<p>
これもほとんど見ないし．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> byte-compile-warnings
      '(not
        free-vars
        unresolved
        callargs
        redefine
        obsolete
        noruntime
        cl-functions
        interactive-only
        make-local
        ))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbb4ce54" class="outline-2">
<h2 id="orgbb4ce54">後方互換性: <code>el-x</code></h2>
<div class="outline-text-2" id="text-orgbb4ce54">
<p>
古い <code>flet</code> と同じ挙動をする <code>dflet</code> を使うために <code>el-x</code> を導入しておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">el-x</span>
  <span style="color: #7FBFFF;">:ensure</span> t)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgaf2e4f5" class="outline-2">
<h2 id="orgaf2e4f5">url-retrieve の置き換え: <code>mb-url</code></h2>
<div class="outline-text-2" id="text-orgaf2e4f5">
<p>
標準関数の <code>url-retrieve</code> 等の proxy 環境下での挙動が怪しいので，
<code>mb-url</code> で advice (上書き)することに．
<code>curl</code> のバッファが増殖するのだけれど，これはなんとかならないかなぁ&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">mb-url</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (advice-add 'url-http <span style="color: #7FBFFF;">:override</span> 'mb-url-http-curl))
</pre>
</div>
</div>
</div>
<div id="outline-container-org62d2900" class="outline-2">
<h2 id="org62d2900">環境変数の読み込み: <code>exec-path-from-shell</code></h2>
<div class="outline-text-2" id="text-org62d2900">
<p>
zsh で設定した <code>PATH</code> などの環境変数を Emacs に引き継ぐために
<a href="https://github.com/purcell/exec-path-from-shell">purcell/exec-path-from-shell</a> を使います．
今の所
</p>
<ul class="org-ul">
<li><code>SHELL</code></li>
<li><code>DEBFULLNAME</code></li>
<li><code>DEBEMAIL</code></li>
<li><code>TEXMFHOME</code></li>
<li><code>SKKSERVER</code></li>
<li><code>http_proxy</code></li>
<li><code>GPG_KEY_ID</code></li>
<li><code>GPG_AGENT_INFO</code></li>
<li><code>PASSWORD_STORE_DIR</code></li>
</ul>
<p>
を読み込んでいます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:d:password-store</span> nil)
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">exec-path-from-shell</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">when</span> (memq window-system '(mac ns)) (exec-path-from-shell-initialize))
  (exec-path-from-shell-copy-envs
   '(<span style="color: #7FFF7F;">"SHELL"</span>
     <span style="color: #7FFF7F;">"DEBFULLNAME"</span>
     <span style="color: #7FFF7F;">"DEBEMAIL"</span>
     <span style="color: #7FFF7F;">"SKKSERVER"</span>
     <span style="color: #7FFF7F;">"TEXMFHOME"</span>
     <span style="color: #7FFF7F;">"http_proxy"</span>
     <span style="color: #7FFF7F;">"GPG_KEY_ID"</span>
     <span style="color: #7FFF7F;">"GPG_AGENT_INFO"</span>
     <span style="color: #7FFF7F;">"PASSWORD_STORE_DIR"</span>
     ))
  (<span style="color: #FF7F7F;">setq</span> user-full-name (concat (getenv <span style="color: #7FFF7F;">"DEBFULLNAME"</span>))
        user-mail-address (concat (getenv <span style="color: #7FFF7F;">"DEBEMAIL"</span>))
        my:d:password-store (getenv <span style="color: #7FFF7F;">"PASSWORD_STORE_DIR"</span>))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org76cafc5" class="outline-2">
<h2 id="org76cafc5">言語の設定</h2>
<div class="outline-text-2" id="text-org76cafc5">
<p>
過去にはいろいろ設定していたのですが&#x2026;
</p>
<ul class="org-ul">
<li><a href="http://masutaka.net/chalow/2009-07-09-1.html">Emacs講座 -第7回- 文字コード / マスタカの ChangeLog メモ</a></li>
</ul>
<blockquote>
<p>
いきなり矛盾しますが，最近の Emacs(例:23.3) では文字コードの設定は不要です．
</p>
</blockquote>
<p>
というわけで OS 依存の条件分岐だけを記述しています．
</p>

<p>
ちなみに
<code>prefer-coding-system</code> を設定すると
<code>default-file-name-coding-system</code> が設定されます．
優先順位は以下の通り:
</p>
<ol class="org-ol">
<li><code>file-name-coding-system</code> を見る</li>
<li><code>file-name-coding-system</code> が nil なら <code>default-file-name-coding-system</code> を利用</li>
</ol>
</div>
<div id="outline-container-org5a66173" class="outline-3">
<h3 id="org5a66173">cp5022x.el</h3>
<div class="outline-text-3" id="text-org5a66173">
<p>
Emacs23 から内部が Unicode ベースになっています．
</p>

<p>
しかし文字コードの変換は GNU libc の iconv をベースにしているため，
環境によっては文字の変換がうまく行なえません．
そこで言語設定前に <code>cp5022x.el</code> をインストールすることにしています．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">cp5022x</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orged19ee2" class="outline-3">
<h3 id="orged19ee2">East Asian Ambiguos 対応</h3>
<div class="outline-text-3" id="text-orged19ee2">
<p>
CJK 以外の East Asian Ambiguos，絵文字も2文字幅にするようにしています．
拙作の修正ロケールはこちら: <a href="https://github.com/uwabami/locale-eaw-emoji">https://github.com/uwabami/locale-eaw-emoji</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (package-installed-p 'eaw_and_emoji)
  (quelpa '(eaw_and_emoji
            <span style="color: #7FBFFF;">:fetcher</span> url
            <span style="color: #7FBFFF;">:url</span> <span style="color: #7FFF7F;">"https://raw.githubusercontent.com/uwabami/locale-eaw-emoji/master/eaw_and_emoji.el"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">eaw_and_emoji</span>
  <span style="color: #7FBFFF;">:config</span>
  (eaw-and-emoji-fullwidth))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(setq nobreak-char-display nil)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge66d09c" class="outline-3">
<h3 id="orge66d09c">OSの違いに起因する条件分岐</h3>
<div class="outline-text-3" id="text-orge66d09c">
<p>
Mac と Linux では同じ Unicode でも正規化が異なります
(具体的には Mac のファイルシステムである HFS+ では Unicode の正規化が異なります).
Unicode の正規化と Mac OS X 特有の事情については
</p>
<ul class="org-ul">
<li><a href="http://homepage1.nifty.com/nomenclator/unicode/normalization.htm">Unicode正規化とは</a></li>
<li><a href="http://www.sakito.com/2010/05/mac-os-x-normalization.html">Mac OS X におけるファイル名に関するメモ(NFC, NFD等)</a></li>
</ul>
<p>
等が参考になるでしょう.
</p>

<p>
日本語のファイル名を扱うことは滅多にないものの,
たまに祟りがあるのでそれを回避するための設定をしています.
</p>

<p>
Windows の場合はファイル名などは cp932 にしているものの,
最近 Windows 使っていないので良く知りません(というわけで，設定を捨てました).
<del>さらに，最近は Mac OS でも Emacs 使ってないから，これが正しのか良くわからない&#x2026;</del>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ucs-normalize</span>
  <span style="color: #7FBFFF;">:if</span> (eq system-type 'darwin)
  <span style="color: #7FBFFF;">:config</span>
  (set-file-name-coding-system 'utf-8-hfs)
  (<span style="color: #FF7F7F;">setq</span> locale-coding-system 'utf-8-hfs)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12388;&#12356;&#12391;&#12395;&#12461;&#12540;&#12496;&#12452;&#12531;&#12489;: Ctrl &#12434; Mac &#12363;&#12425;&#22890;&#12356;&#21462;&#12427;</span>
  (<span style="color: #FF7F7F;">setq</span> mac-pass-control-to-system t)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">Cmd &#12392; Option &#12434;&#36870;&#12395;&#12377;&#12427;</span>
  (<span style="color: #FF7F7F;">setq</span> ns-command-modifier 'meta)
  (<span style="color: #FF7F7F;">setq</span> ns-alternate-modifier 'super)
  (global-set-key [ns-drag-file] 'ns-find-file)
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org045a82e" class="outline-2">
<h2 id="org045a82e">主にEmacs本体に同梱されている拡張に関する設定</h2>
<div class="outline-text-2" id="text-org045a82e">
</div><div id="outline-container-orgcfc033f" class="outline-3">
<h3 id="orgcfc033f">基本的なキーバインドの設定</h3>
<div class="outline-text-3" id="text-orgcfc033f">
<p>
既に手癖になってしまっているアレコレ．
特に <code>[home]</code> と <code>[end]</code> は無いと途方に暮れます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">bind-keys*</span>
 (<span style="color: #7FFF7F;">"C-h"</span>     . backward-delete-char)
 (<span style="color: #7FFF7F;">"C-c M-a"</span> . align-regexp)
 (<span style="color: #7FFF7F;">"C-c ;"</span>   . comment-region)
 (<span style="color: #7FFF7F;">"C-c M-;"</span> . uncomment-region)
 (<span style="color: #7FFF7F;">"C-/"</span>     . undo)
 (<span style="color: #7FFF7F;">"C-x M-b"</span> . ibuffer-other-window)
 (<span style="color: #7FFF7F;">"C-c M-r"</span> . replace-regexp)
 (<span style="color: #7FFF7F;">"C-c r"</span>   . replace-string)
 (<span style="color: #7FFF7F;">"&lt;home&gt;"</span>  . beginning-of-buffer)
 (<span style="color: #7FFF7F;">"&lt;end&gt;"</span>   . end-of-buffer))
</pre>
</div>
<p>
<a href="https://github.com/k1LoW/emacs-drill-instructor/wiki">鬼軍曹.el</a> とかで強制した方が良いのかも，とかごく偶に思いますが(思うだけ)．
</p>
</div>
</div>
<div id="outline-container-org6f93440" class="outline-3">
<h3 id="org6f93440">Emacs server</h3>
<div class="outline-text-3" id="text-org6f93440">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">server</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">unless</span> (server-running-p)
    (server-start)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc9092fc" class="outline-3">
<h3 id="orgc9092fc"><code>whitespace</code>: 空白の強調表示</h3>
<div class="outline-text-3" id="text-orgc9092fc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">whitespace</span>
  <span style="color: #7FBFFF;">:diminish</span> global-whitespace-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> whitespace-line-column 72
        whitespace-style
        '(face              <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">face&#12434;&#20351;&#12387;&#12390;&#35222;&#35226;&#21270;&#12377;&#12427;&#65294;</span>
          trailing          <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">&#34892;&#26411;&#12398;&#31354;&#30333;&#12434;&#23550;&#35937;&#12392;&#12377;&#12427;&#65294;</span>
          tabs              <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">tab</span>
          spaces            <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">space</span>
          )
        whitespace-display-mappings
        '((space-mark ?\u3000 [?\u25a1])
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">WARNING: the mapping below has a problem. When a TAB</span>
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">occupies exactly one column, it will display the character</span>
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">?\xBB at that column followed by a TAB which goes to the</span>
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">next TAB column. If this is a problem for you, please,</span>
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">comment the line below.</span>
          (tab-mark ?\t [?\u00BB ?\t] [?\\ ?\t]))
        whitespace-space-regexp <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">\u3000+</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>)
  (global-whitespace-mode 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org602c2fa" class="outline-3">
<h3 id="org602c2fa"><code>uniquify</code>: モードラインのファイル名にディレクトリも表示する</h3>
<div class="outline-text-3" id="text-org602c2fa">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">uniquify</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> uniquify-buffer-name-style 'post-forward-angle-brackets
        uniquify-min-dir-content 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org5c6fc8c" class="outline-3">
<h3 id="org5c6fc8c"><code>saveplace</code>: 前回の修正位置を記憶する.</h3>
<div class="outline-text-3" id="text-org5c6fc8c">
<p>
記憶の保存先は <code>~/.emacs.d/tmp/emacs-places</code> に変更.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">saveplace</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq-default</span> save-place t)
  (<span style="color: #FF7F7F;">setq</span> save-place-file (concat my:d:tmp <span style="color: #7FFF7F;">"emacs-places"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org527b412" class="outline-3">
<h3 id="org527b412"><code>time-stamp</code>: 保存時に timestamp を自動更新</h3>
<div class="outline-text-3" id="text-org527b412">
<p>
デフォルトではいろいろと衝突したので
更新文字列を変更し， <code>＄Lastupdate: 2</code> (＄は半角) があったら timestamp を更新する様にした．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">time-stamp</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> time-stamp-active t
        time-stamp-line-limit 10
        time-stamp-start <span style="color: #7FFF7F;">"$Lastupdate: 2"</span>
        time-stamp-end <span style="color: #7FFF7F;">"\\$"</span>
        time-stamp-format <span style="color: #7FFF7F;">"%03y-%02m-%02d %02H:%02M:%02S"</span>)
  (add-hook 'before-save-hook 'time-stamp))
</pre>
</div>
<p>
モード独自の設定(例えば Org とか)に関しては別途．
</p>
</div>
</div>
<div id="outline-container-org760c0ef" class="outline-3">
<h3 id="org760c0ef"><code>tramp</code>: 使わないので無効化?</h3>
<div class="outline-text-3" id="text-org760c0ef">
<p>
無効化したいんだけれど，うまくいってない，ような&#x2026;?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> tramp-mode nil
      tramp-persistency-file-name (concat my:d:tmp <span style="color: #7FFF7F;">"tramp"</span>)
      tramp-default-method <span style="color: #7FFF7F;">"scpx"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org98cf454" class="outline-3">
<h3 id="org98cf454"><code>bookmark</code>: bookmark ファイル</h3>
<div class="outline-text-3" id="text-org98cf454">
<p>
イマイチ使いこなせてない. 場所だけ変更しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> bookmark-default-file (concat my:d:share <span style="color: #7FFF7F;">"bookmarks"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org754976f" class="outline-3">
<h3 id="org754976f">browse-url</h3>
<div class="outline-text-3" id="text-org754976f">
<p>
Firefox の呼び出し方が変わったので，そのために関数を追加．
詳細は <a href="http://www.emacswiki.org/emacs/BrowseUrl">http://www.emacswiki.org/emacs/BrowseUrl</a> を参照のこと．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">browse-url</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">browse-url-firefox</span> (url <span style="color: #FFFF7F;">&amp;optional</span> new-window)
    <span style="color: #7FFF7F;">"@see </span><span style="text-decoration: underline;">http://www.emacswiki.org/emacs/BrowseUrl</span><span style="color: #7FFF7F;">"</span>
    (<span style="color: #FF7F7F;">interactive</span> (browse-url-interactive-arg <span style="color: #7FFF7F;">"URL: "</span>))
    (<span style="color: #FF7F7F;">setq</span> url (browse-url-encode-url url))
    (<span style="color: #FF7F7F;">let*</span> ((process-environment (browse-url-process-environment))
           (window-args (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">browse-url-maybe-new-window</span> new-window)
                            (<span style="color: #FF7F7F;">if</span> browse-url-firefox-new-window-is-tab
                                '(<span style="color: #7FFF7F;">"-new-tab"</span>)
                              '(<span style="color: #7FFF7F;">"-new-window"</span>))))
           (ff-args (append browse-url-firefox-arguments window-args (list url)))
           (process-name (concat <span style="color: #7FFF7F;">"firefox "</span> url))
           (process (apply 'start-process process-name nil
                           browse-url-firefox-program ff-args) ))))
  (<span style="color: #FF7F7F;">setq</span> browse-url-browser-function 'browse-url-firefox))
(<span style="color: #FF7F7F;">bind-key</span> <span style="color: #7FFF7F;">"C-c C-j"</span> 'browse-url-at-point)
</pre>
</div>
</div>
</div>
<div id="outline-container-org90d79f2" class="outline-3">
<h3 id="org90d79f2">標準機能の設定</h3>
<div class="outline-text-3" id="text-org90d79f2">
</div><div id="outline-container-orgb782e5d" class="outline-4">
<h4 id="orgb782e5d">表示関連</h4>
<div class="outline-text-4" id="text-orgb782e5d">
</div><ul class="org-ul"><li><a id="org6cb0c89"></a>起動時のスプラッシュ画面を表示しない<br ><div class="outline-text-5" id="text-org6cb0c89">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> inhibit-startup-screen t
      inhibit-startup-message t)
</pre>
</div>
</div></li>
<li><a id="org1885b91"></a>フレーム, ツールバー等を非表示に<br ><div class="outline-text-5" id="text-org1885b91">
<p>
大抵の場合ターミナル内で <code>-nw</code> として起動するし,
メニューは触ったことないので使わない.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(my:disable-builtin-mode 'tool-bar-mode)
(my:disable-builtin-mode 'scroll-bar-mode)
(my:disable-builtin-mode 'menu-bar-mode)
(my:disable-builtin-mode 'blink-cursor-mode)
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12459;&#12540;&#12477;&#12523;&#12398;&#20301;&#32622;&#12364;&#20309;&#25991;&#23383;&#30446;&#12363;&#12434;&#34920;&#31034;&#12377;&#12427;</span>
(my:disable-builtin-mode 'column-number-mode)
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12459;&#12540;&#12477;&#12523;&#12398;&#20301;&#32622;&#12364;&#20309;&#34892;&#30446;&#12363;&#12434;&#34920;&#31034;&#12377;&#12427;</span>
(my:disable-builtin-mode 'line-number-mode)
</pre>
</div>
</div></li>
<li><a id="orgc2a64f5"></a>ベル無効化<br ><div class="outline-text-5" id="text-orgc2a64f5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> ring-bell-function 'ignore)
</pre>
</div>
</div></li>
<li><a id="org5687a43"></a>選択リージョンに色付け<br ><div class="outline-text-5" id="text-org5687a43">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> transient-mark-mode t)
</pre>
</div>
</div></li>
<li><a id="org2b97adb"></a>対応する括弧を強調表示<br ><div class="outline-text-5" id="text-org2b97adb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(show-paren-mode 1)
(<span style="color: #FF7F7F;">setq</span> show-paren-style 'mixed)
</pre>
</div>
</div></li>
<li><a id="org42887ca"></a>linum-mode<br ><div class="outline-text-5" id="text-org42887ca">
<p>
必要に応じて <code>linum-mode</code> を有効にするので,
通常はモードラインに行番号や桁番号を表示しないようする.
ついでに <code>linum-mode</code> を有効にした場合の桁表示を 5 桁に.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> linum-format <span style="color: #7FFF7F;">"%5d "</span>)
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-org4387284" class="outline-4">
<h4 id="org4387284">編集関連</h4>
<div class="outline-text-4" id="text-org4387284">
</div><ul class="org-ul"><li><a id="org2365249"></a>yes or no を y or n に<br ><div class="outline-text-5" id="text-org2365249">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(fset 'yes-or-no-p 'y-or-n-p)
</pre>
</div>
</div></li>
<li><a id="org8692652"></a>ファイル名の大文字小文字を区別しない(zsh風)<br ><div class="outline-text-5" id="text-org8692652">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> read-file-name-completion-ignore-case t)
</pre>
</div>
</div></li>
<li><a id="orgb9b1b75"></a>tab 幅 4, tab でのインデントはしない<br ><div class="outline-text-5" id="text-orgb9b1b75">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq-default</span> tab-width 4)
(<span style="color: #FF7F7F;">setq-default</span> indent-tabs-mode nil)
</pre>
</div>
</div></li>
<li><a id="org043aa60"></a>文字列は 72 文字で折り返し(RFC2822風味)<br ><div class="outline-text-5" id="text-org043aa60">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq-default</span> fill-column 72)
(<span style="color: #FF7F7F;">setq</span> paragraph-start '<span style="color: #7FFF7F;">"^</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">[ &#12288;&#12539;&#9675;&lt;\t\n\f]</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">(?[0-9a-zA-Z]+)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>)
(<span style="color: #FF7F7F;">setq-default</span> auto-fill-mode nil)
</pre>
</div>
</div></li>
<li><a id="org89e52b6"></a>長い行の折り返し<br ><div class="outline-text-5" id="text-org89e52b6">
<p>
デフォルトは折り返し有で <code>\C-c M-l</code> で toggle
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-default 'truncate-lines nil)
(<span style="color: #FF7F7F;">setq</span> truncate-partial-width-windows nil)
(define-key global-map (kbd <span style="color: #7FFF7F;">"C-c M-l"</span>) 'toggle-truncate-lines)
</pre>
</div>
</div></li>
<li><a id="orgaedd379"></a>バッファ終端で newline を入れない<br ><div class="outline-text-5" id="text-orgaedd379">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> next-line-add-newlines nil)
</pre>
</div>
</div></li>
<li><a id="orgbdf6d9d"></a>symlink は常においかける<br ><div class="outline-text-5" id="text-orgbdf6d9d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> vc-follow-symlinks t)
</pre>
</div>
</div></li>
<li><a id="org7d8de44"></a>変更のあったファイルの自動再読み込み<br ><div class="outline-text-5" id="text-org7d8de44">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-auto-revert-mode 1)
</pre>
</div>
</div></li>
<li><a id="orgc214681"></a>バックアップとauto-saveの作成/位置の変更<br ><div class="outline-text-5" id="text-orgc214681">
<p>
backup と auto-save ファイルを集約する
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> auto-save-list-file-prefix (concat my:d:tmp <span style="color: #7FFF7F;">".saves-"</span>))
(<span style="color: #FF7F7F;">setq</span> auto-save-default t)
(<span style="color: #FF7F7F;">setq</span> auto-save-timeout 15)
(<span style="color: #FF7F7F;">setq</span> auto-save-interval 60)
(<span style="color: #FF7F7F;">setq</span> make-backup-files t)
(<span style="color: #FF7F7F;">setq</span> backup-by-copying t) <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">symlink &#12399;&#20351;&#12431;&#12394;&#12356;</span>
(<span style="color: #FF7F7F;">setq</span> backup-directory-alist `((<span style="color: #7FFF7F;">"."</span> . ,my:d:tmp)))
(<span style="color: #FF7F7F;">setq</span> auto-save-file-name-transforms `((<span style="color: #7FFF7F;">".*"</span> ,my:d:tmp t)))
(<span style="color: #FF7F7F;">setq</span> version-control t)
(<span style="color: #FF7F7F;">setq</span> kept-new-versions 5)
(<span style="color: #FF7F7F;">setq</span> kept-old-versions 5)
(<span style="color: #FF7F7F;">setq</span> delete-old-versions t)
(<span style="color: #FF7F7F;">setq</span> delete-auto-save-files t)
</pre>
</div>
</div></li>
<li><a id="org7cb9bac"></a>recentf<br ><div class="outline-text-5" id="text-org7cb9bac">
<p>
最近使ったファイル履歴の保管
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> recentf-max-saved-items 10000)
(<span style="color: #FF7F7F;">setq</span> recentf-save-file
      (expand-file-name (concat my:d:tmp <span style="color: #7FFF7F;">"recentf"</span>)))
(<span style="color: #FF7F7F;">setq</span> recentf-auto-cleanup 'never)
(<span style="color: #FF7F7F;">setq</span> recentf-exclude
      '(<span style="color: #7FFF7F;">".recentf"</span>
        <span style="color: #7FFF7F;">"^/tmp\\.*"</span>
        <span style="color: #7FFF7F;">"^/private\\.*"</span>
        <span style="color: #7FFF7F;">"^/var/folders\\.*"</span>
        <span style="color: #7FFF7F;">"/TAGS$"</span>
        <span style="color: #7FFF7F;">"^/home/uwabami/.mozilla/firefox/jhitnbb2.default/itsalltext\\.*"</span>
        ))
(add-hook 'after-init-hook 'recentf-mode)
</pre>
</div>
</div></li>
<li><a id="orgd0b907e"></a>Undo/Redo<br ><div class="outline-text-5" id="text-orgd0b907e">
<p>
そのうち undohist と undo-tree を試そうと思っているのですが，
今のところ特に弄ってません． <code>undo-limit</code> は無限大にしたいのですが，どうするのかな&#x2026;?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> undo-limit 200000)
(<span style="color: #FF7F7F;">setq</span> undo-strong-limit 260000)
(savehist-mode 1)        <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#12398;&#23653;&#27508;&#12434;&#20445;&#23384;&#12375;&#12522;&#12473;&#12488;&#12450;</span>
(<span style="color: #FF7F7F;">setq</span> savehist-file (concat my:d:tmp <span style="color: #7FFF7F;">"history"</span>))
(<span style="color: #FF7F7F;">setq</span> history-length t)  <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">t &#12391;&#28961;&#21046;&#38480;</span>
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-orgf2d360e" class="outline-4">
<h4 id="orgf2d360e">ファイル，デイレクトリ整理</h4>
<div class="outline-text-4" id="text-orgf2d360e">
<p>
他にもイロイロありそう．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">url</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> url-configuration-directory (concat my:d:tmp <span style="color: #7FFF7F;">"url"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">nsm</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> nsm-settings-file (concat my:d:tmp <span style="color: #7FFF7F;">"network-settings.data"</span>)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge9bc64c" class="outline-3">
<h3 id="orge9bc64c">ガベージコレクションの頻度を下げる</h3>
<div class="outline-text-3" id="text-orge9bc64c">
<p>
とりあえず 128 MB にしておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> gc-cons-threshold (* 128 1024 1024))
</pre>
</div>
</div>
</div>
<div id="outline-container-org0660be6" class="outline-3">
<h3 id="org0660be6">行末の無駄な空白/改行を削除する</h3>
<div class="outline-text-3" id="text-org0660be6">
<p>
元ネタ: <a href="http://d.hatena.ne.jp/tototoshi/20101202/1291289625">無駄な行末の空白を削除する(Emacs Advent Calendar jp:2010)</a>
</p>

<p>
ただし, RD や Markdown だと空白行に意味があったりするので，
必要に応じて拡張子で判断して外している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:delete-trailing-whitespace-exclude-suffix</span>
  (list <span style="color: #7FFF7F;">"\\.rd$"</span> <span style="color: #7FFF7F;">"\\.md$"</span> <span style="color: #7FFF7F;">"\\.rbt$"</span> <span style="color: #7FFF7F;">"\\.rab$"</span>))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:delete-trailing-whitespace</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">cond</span>
   ((equal nil
           (<span style="color: #FF7F7F;">cl-loop</span> for pattern in my:delete-trailing-whitespace-exclude-suffix
                    thereis (string-match pattern buffer-file-name)))
    (delete-trailing-whitespace))))
(add-hook 'before-save-hook 'my:delete-trailing-whitespace)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdafccc3" class="outline-3">
<h3 id="orgdafccc3">scratch を殺さない. 消したら再生成</h3>
<div class="outline-text-3" id="text-orgdafccc3">
<p>
&#x2026;元ネタがどこだったのか忘れてしまった&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:make-scratch</span> (<span style="color: #FFFF7F;">&amp;optional</span> arg)
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">progn</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">"*scratch*" &#12434;&#20316;&#25104;&#12375;&#12390; buffer-list &#12395;&#25918;&#12426;&#36796;&#12416;</span>
    (set-buffer (get-buffer-create <span style="color: #7FFF7F;">"*scratch*"</span>))
    (funcall initial-major-mode)
    (erase-buffer)
    (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">and</span> initial-scratch-message (not inhibit-startup-message))
      (insert initial-scratch-message))
    (<span style="color: #FF7F7F;">or</span> arg
        (<span style="color: #FF7F7F;">progn</span>
          (<span style="color: #FF7F7F;">setq</span> arg 0)
          (switch-to-buffer <span style="color: #7FFF7F;">"*scratch*"</span>)))
    (<span style="color: #FF7F7F;">cond</span> ((= arg 0) (message <span style="color: #7FFF7F;">"*scratch* is cleared up."</span>))
          ((= arg 1) (message <span style="color: #7FFF7F;">"another *scratch* is created"</span>)))))

(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:buffer-name-list</span> ()
  (mapcar (<span style="color: #FF7F7F;">function</span> buffer-name) (buffer-list)))
(add-hook 'kill-buffer-query-functions
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12391; kill-buffer &#12375;&#12383;&#12425;&#20869;&#23481;&#12434;&#28040;&#21435;&#12377;&#12427;&#12384;&#12369;&#12395;&#12377;&#12427;</span>
          (<span style="color: #FF7F7F;">function</span> (<span style="color: #FF7F7F;">lambda</span> ()
                      (<span style="color: #FF7F7F;">if</span> (string= <span style="color: #7FFF7F;">"*scratch*"</span> (buffer-name))
                          (<span style="color: #FF7F7F;">progn</span> (my:make-scratch 0) nil)
                        t))))
(add-hook 'after-save-hook
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12398;&#20869;&#23481;&#12434;&#20445;&#23384;&#12375;&#12383;&#12425;</span>
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12434;&#26032;&#12375;&#12367;&#20316;&#12427;.</span>
          (<span style="color: #FF7F7F;">function</span>
           (<span style="color: #FF7F7F;">lambda</span> ()
             (<span style="color: #FF7F7F;">unless</span> (member <span style="color: #7FFF7F;">"*scratch*"</span> (my:buffer-name-list))
               (my:make-scratch 1)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org20289a3" class="outline-3">
<h3 id="org20289a3">空になったファイルを尋ねずに自動削除</h3>
<div class="outline-text-3" id="text-org20289a3">
<p>
ゴミが残らないし，地味に便利．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:delete-file-if-no-contents</span> ()
  (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">and</span> (buffer-file-name (current-buffer))
             (= (point-min) (point-max)))
    (delete-file
     (buffer-file-name (current-buffer)))))
(<span style="color: #FF7F7F;">if</span> (not (memq 'my:delete-file-if-no-contents after-save-hook))
    (<span style="color: #FF7F7F;">setq</span> after-save-hook
          (cons 'my:delete-file-if-no-contents after-save-hook)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgaae0dad" class="outline-3">
<h3 id="orgaae0dad">略語展開: <code>abbrev</code></h3>
<div class="outline-text-3" id="text-orgaae0dad">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">abbrev</span>
  <span style="color: #7FBFFF;">:diminish</span> abbrev-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> abbrev-file-name (concat my:d:share <span style="color: #7FFF7F;">"abbrev_defs"</span>)
        save-abbrevs t
  )
  (<span style="color: #FF7F7F;">setq-default</span> abbrev-mode t)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf41ece0" class="outline-3">
<h3 id="orgf41ece0">emacs-lisp document: <code>eldoc</code></h3>
<div class="outline-text-3" id="text-orgf41ece0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">eldoc</span>
  <span style="color: #7FBFFF;">:diminish</span> eldoc-mode
  <span style="color: #7FBFFF;">:config</span>
  (add-hook 'emacs-lisp-mode-hook 'turn-on-eldoc-mode)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org0ab00b4" class="outline-3">
<h3 id="org0ab00b4"><code>midnight</code>: 一定期間使用しなかった buffer を自動削除</h3>
<div class="outline-text-3" id="text-org0ab00b4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">midnight</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> clean-buffer-list-delay-general 1))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc0c3ba1" class="outline-2">
<h2 id="orgc0c3ba1">日本語入力: <a href="init-ddskk.html">ddskkの設定</a></h2>
<div class="outline-text-2" id="text-orgc0c3ba1">
<p>
<a href="http://openlab.ring.gr.jp/skk/ddskk-ja.html">Daredevil SKK (DDSKK)</a> をメインで使用中．無いと途方に暮れる．
ちなみにGTKが有効になっていると <code>gtk-immodule</code> なんかと衝突するので
<code>~/.Xresources</code> で xim を無効にしておくと良い．
例えば以下の様に:
</p>
<div class="org-src-container">
<pre class="src src-conf">! disable XIM
Emacs*useXIM: false
</pre>
</div>
</div>
<div id="outline-container-org396dff8" class="outline-3">
<h3 id="org396dff8">Emacs 本体側の設定</h3>
<div class="outline-text-3" id="text-org396dff8">
<p>
実際の設定は別ファイルで行なわれるため
ここでは設定ファイルの位置変更を変更している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">skk</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x j"</span>   . skk-mode)
         (<span style="color: #7FFF7F;">"C-x C-j"</span> . skk-mode)
         (<span style="color: #7FFF7F;">"C-\\"</span>    . skk-mode))
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> skk-user-directory (concat my:d:tmp <span style="color: #7FFF7F;">"skk"</span>)
        skk-init-file (concat user-emacs-directory <span style="color: #7FFF7F;">"init-ddskk"</span>)
        default-input-method <span style="color: #7FFF7F;">"japanese-skk"</span> )
  <span style="color: #7FBFFF;">:config</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org45420e0" class="outline-3">
<h3 id="org45420e0">DDSKK 本体の設定</h3>
<div class="outline-text-3" id="text-org45420e0">
</div><div id="outline-container-orgafb12b7" class="outline-4">
<h4 id="orgafb12b7">sticky-shift</h4>
<div class="outline-text-4" id="text-orgafb12b7">
<p>
sticky shift については   <a href="http://homepage1.nifty.com/blankspace/emacs/sticky.html">sticky shift</a> を参照のこと.
ddskk の 14.2 以降から同梱されるようになった(ありがたい)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-sticky-key <span style="color: #7FFF7F;">";"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgad4ca96" class="outline-4">
<h4 id="orgad4ca96">表示関連</h4>
<div class="outline-text-4" id="text-orgad4ca96">
<p>
変換候補の表示位置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-show-candidates-always-pop-to-buffer t)
</pre>
</div>
<p>
候補表示件数を2列に
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-henkan-show-candidates-rows 2)
</pre>
</div>
<p>
日本語表示しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-japanese-message-and-error nil)
</pre>
</div>
<p>
メニューを日本語にしない -&gt; toolbar 非表示だし.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-show-japanese-menu nil)
</pre>
</div>
<p>
注釈の表示
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-show-annotation nil)
</pre>
</div>
<p>
インジケータの表示のカスタマイズ
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-latin-mode-string <span style="color: #7FFF7F;">"[_A]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-hiragana-mode-string <span style="color: #7FFF7F;">"[&#12354;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-katakana-mode-string <span style="color: #7FFF7F;">"[&#12450;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-jisx0208-latin-mode-string <span style="color: #7FFF7F;">"[&#65313;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-jisx0201-mode-string <span style="color: #7FFF7F;">"[_&#65393;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-abbrev-mode-string <span style="color: #7FFF7F;">"[aA]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-indicator-use-cursor-color nil)
</pre>
</div>
<p>
インジケータを左端に表示
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-status-indicator 'left)
</pre>
</div>
<p>
mode-line が動くのが許せないので，ちょっと修正
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">skk-make-indicator-alist</span>
    (after my:set-skk-default-indicator activate)
  (<span style="color: #FF7F7F;">dolist</span> (elem
           '((abbrev <span style="color: #7FFF7F;">" [aA]"</span> . <span style="color: #7FFF7F;">"--[aA]:"</span>)
             (latin <span style="color: #7FFF7F;">" [_A]"</span> . <span style="color: #7FFF7F;">"--[_A]:"</span>)
             (default <span style="color: #7FFF7F;">" [--]"</span> . <span style="color: #7FFF7F;">"--[--]:"</span>)))
    (<span style="color: #FF7F7F;">setq</span> ad-return-value
          (append (cons elem nil)
                  (delq (assoc (car elem) ad-return-value) ad-return-value)))))
(<span style="color: #FF7F7F;">setq</span> skk-show-inline t)
</pre>
</div>
<p>
カーソルには色をつけない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-use-color-cursor nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc3fc069" class="outline-4">
<h4 id="orgc3fc069">編集関連</h4>
<div class="outline-text-4" id="text-orgc3fc069">
<p>
キーバインド
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key <span style="color: #7FFF7F;">"\C-x\C-j"</span> 'skk-mode)
(global-set-key <span style="color: #7FFF7F;">"\C-xj"</span> 'skk-mode)
(global-set-key <span style="color: #7FFF7F;">"\C-j"</span> 'skk-mode)
(global-set-key <span style="color: #7FFF7F;">"\C-\\"</span> 'skk-mode)
</pre>
</div>
<p>
半角カナを入力
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-use-jisx0201-input-method t)
</pre>
</div>
<p>
Enter で改行しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-egg-like-newline t)
</pre>
</div>
<p>
"「"を入力したら"」"も自動で挿入
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-auto-insert-paren t)
</pre>
</div>
<p>
句読点変換ルール
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-kuten-touten-alist
      '(
        (jp    .    (<span style="color: #7FFF7F;">"&#12290;"</span> . <span style="color: #7FFF7F;">"&#12289;"</span> ))
        (en-jp   .    (<span style="color: #7FFF7F;">"&#65294;"</span> . <span style="color: #7FFF7F;">"&#65292;"</span> ))
        (en    .    (<span style="color: #7FFF7F;">". "</span> . <span style="color: #7FFF7F;">", "</span>))
        ))
(<span style="color: #FF7F7F;">setq-default</span> skk-kutouten-type 'en-jp)
</pre>
</div>
<p>
全角記号の変換: @ での日付入力は使わない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-rom-kana-rule-list
      (append skk-rom-kana-rule-list
              '((<span style="color: #7FFF7F;">"!"</span> nil <span style="color: #7FFF7F;">"!"</span>)
                (<span style="color: #7FFF7F;">":"</span> nil <span style="color: #7FFF7F;">":"</span>)
                (<span style="color: #7FFF7F;">";"</span> nil <span style="color: #7FFF7F;">";"</span>)
                (<span style="color: #7FFF7F;">"?"</span> nil <span style="color: #7FFF7F;">"?"</span>)
                (<span style="color: #7FFF7F;">"z "</span> nil <span style="color: #7FFF7F;">"&#12288;"</span>)
                (<span style="color: #7FFF7F;">"\\"</span> nil <span style="color: #7FFF7F;">"\\"</span>)
                (<span style="color: #7FFF7F;">"@"</span> nil <span style="color: #7FFF7F;">"@"</span>)
                )))
</pre>
</div>
<p>
送り仮名が厳密に正しい候補を優先
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-henkan-strict-okuri-precedence t)
</pre>
</div>
<p>
辞書の共有
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-share-private-jisyo t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org4c7caf5" class="outline-4">
<h4 id="org4c7caf5">インクリメンタルサーチ</h4>
<div class="outline-text-4" id="text-org4c7caf5">
<p>
minibuffer 内では強制的に skk off.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'skk-mode-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (<span style="color: #FF7F7F;">and</span> (skk-in-minibuffer-p)
                 (skk-mode-exit))))
(<span style="color: #FF7F7F;">setq</span> skk-isearch-start-mode 'latin)
</pre>
</div>
<p>
インクリメンタルサーチは migemo に任せることに．
</p>
</div>
</div>
<div id="outline-container-org3b4bac2" class="outline-4">
<h4 id="org3b4bac2">辞書の設定</h4>
<div class="outline-text-4" id="text-org3b4bac2">
<p>
追加している辞書の一覧は
</p>
<ul class="org-ul">
<li><a href="http://www.chibutsu.org/jisho/">地球物理辞書</a></li>
<li><a href="http://www.geocities.jp/living_with_plasma/tanudic.html">天文・天体物理用語の漢字変換用辞書</a></li>
<li>はてなキーワード</li>
<li><a href="http://matsucon.net/material/dic/">2ちゃんねる顔文字辞書 MatsuCon</a></li>
<li><a href="http://matsucon.net/">MatsuCon</a></li>
</ul>
<p>
といった所.
はてなキーワードからの辞書の抽出は <a href="http://d.hatena.ne.jp/znz">id:znz</a>znz さんの
</p>
<ul class="org-ul">
<li><a href="http://rubyist.g.hatena.ne.jp/znz/20060924/p1">「はてなダイアリーキーワードふりがなリスト」を SKK の辞書に変換</a></li>
</ul>
<p>
を参考に.
<a href="http://matsucon.net/">MatsuCon</a> で公開されている顔文字に関しては
顔文字に ; や が含まれている場合に, 適宜quoteする必要があるので
以下のスクリプトで適当に変換.
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #e5e5e6;">#</span><span style="color: #e5e5e6;">!/usr/bin/env ruby</span>
<span style="color: #7FBFFF;">require</span> <span style="color: #7FFF7F;">'nkf'</span>
src = <span style="color: #FFFF7F;">ARGV</span>[0]
<span style="color: #FF7F7F;">if</span> <span style="color: #FFFF7F;">ARGV</span>.size &lt; 1
  <span style="color: #7FBFFF;">puts</span> <span style="color: #7FFF7F;">"usage: ime2skk.rb ime_dictionary"</span>
  <span style="color: #7FBFFF;">exit</span> 0
<span style="color: #FF7F7F;">end</span>
<span style="color: #FFFF7F;">File</span>.open(src, <span style="color: #7FFF7F;">"r"</span>) {|f|
  f.each <span style="color: #FF7F7F;">do</span> |line|
    line_euc = <span style="color: #FFFF7F;">NKF</span>.nkf(<span style="color: #7FFF7F;">"-S -e"</span>,line)
    <span style="color: #FF7F7F;">if</span> line_euc =~ <span style="color: #7FFF7F;">/^([^!]+?)\t(.+?)\t.+$/</span>
      entry = <span style="color: #7FBFFF;">$1</span>
      content = <span style="color: #7FBFFF;">$2</span>
      <span style="color: #FF7F7F;">if</span> content =~<span style="color: #7FFF7F;">/;/</span>
        <span style="color: #7FBFFF;">puts</span> entry + <span style="color: #7FFF7F;">" /(concat \""</span> + content.gsub(<span style="color: #7FFF7F;">';'</span>,<span style="color: #7FFF7F;">'\\\\073'</span>) + <span style="color: #7FFF7F;">"\")/"</span>
      <span style="color: #FF7F7F;">elsif</span> content =~<span style="color: #7FFF7F;">/\//</span>
        <span style="color: #7FBFFF;">puts</span> entry + <span style="color: #7FFF7F;">" /(concat \""</span> + content.gsub(<span style="color: #7FFF7F;">'/'</span>,<span style="color: #7FFF7F;">'\\\\057'</span>) + <span style="color: #7FFF7F;">"\")/"</span>
      <span style="color: #FF7F7F;">else</span>
        <span style="color: #7FBFFF;">puts</span> entry + <span style="color: #7FFF7F;">" /"</span> + content + <span style="color: #7FFF7F;">"/"</span>
      <span style="color: #FF7F7F;">end</span>
    <span style="color: #FF7F7F;">end</span>
  <span style="color: #FF7F7F;">end</span>
}
</pre>
</div>
<p>
他にも quote する必要あるような気もするけれど, それは気がついた時に.
</p>

<p>
辞書サーバの指定は以下.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">cond</span>
 ((getenv <span style="color: #7FFF7F;">"SKKSERVER"</span>)
  (<span style="color: #FF7F7F;">setq</span> skk-server-host <span style="color: #7FFF7F;">"127.0.0.1"</span>)
  (<span style="color: #FF7F7F;">setq</span> skk-server-portnum <span style="color: #7FFF7F;">"1178"</span>)
  (<span style="color: #FF7F7F;">setq</span> skk-large-jisyo nil)
  (add-to-list 'skk-search-prog-list
               '(skk-server-completion-search) t)
  (add-to-list 'skk-search-prog-list
               '(skk-comp-by-server-completion) t))
 (t
  (<span style="color: #FF7F7F;">setq</span> skk-get-jisyo-directory (concat my:d:tmp <span style="color: #7FFF7F;">"skk-jisyo"</span>)
        skk-large-jisyo (concat skk-get-jisyo-directory <span style="color: #7FFF7F;">"/SKK-JISYO.L"</span>)))
 )
</pre>
</div>
<p>
辞書登録の際に送り仮名を削除
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-check-okurigana-on-touroku 'auto)
</pre>
</div>
<p>
漢字登録のミスをチェックする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-check-okurigana-on-touroku t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org8cd0b15" class="outline-4">
<h4 id="org8cd0b15">動的補完</h4>
<div class="outline-text-4" id="text-org8cd0b15">
<p>
まだ設定していない&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">;; &#21205;&#30340;&#35036;&#23436;</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(setq skk-dcomp-activate t)</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(setq skk-dcomp-multiple-activate t)</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(setq skk-dcomp-multiple-rows 5)</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">;; &#21205;&#30340;&#35036;&#23436;&#12398;&#35079;&#25968;&#34920;&#31034;&#32676;&#12398;&#12501;&#12455;&#12452;&#12473;</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-foreground 'skk-dcomp-multiple-face "Black")</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-background 'skk-dcomp-multiple-face "LightGoldenrodYellow")</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-bold-p 'skk-dcomp-multiple-face nil)</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">;; &#21205;&#30340;&#35036;&#23436;&#12398;&#35079;&#25968;&#34920;&#31034;&#37089;&#12398;&#35036;&#23436;&#37096;&#20998;&#12398;&#12501;&#12455;&#12452;&#12473;</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-foreground 'skk-dcomp-multiple-trailing-face "dim gray")</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-bold-p 'skk-dcomp-multiple-trailing-face nil)</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">;; &#21205;&#30340;&#35036;&#23436;&#12398;&#35079;&#25968;&#34920;&#31034;&#37089;&#12398;&#36984;&#25246;&#23550;&#35937;&#12398;&#12501;&#12455;&#12452;&#12473;</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-foreground 'skk-dcomp-multiple-selected-face "White")</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-background 'skk-dcomp-multiple-selected-face "LightGoldenrod4")</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(set-face-bold-p 'skk-dcomp-multiple-selected-face nil)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd39816e" class="outline-4">
<h4 id="orgd39816e">部首変換, 総画数変換</h4>
<div class="outline-text-4" id="text-orgd39816e">
<p>
上手く使いこなせていない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'skk-search-prog-list
             '(skk-tankan-search 'skk-search-jisyo-file
                                 skk-large-jisyo 10000))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org5144b49" class="outline-2">
<h2 id="org5144b49">Copy &amp; Paste: <code>xclip</code></h2>
<div class="outline-text-2" id="text-org5144b49">
<p>
<code>xclip</code> で clipboard とデータをやりとり．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">xclip</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"xclip"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (turn-on-xclip))
</pre>
</div>
<p>
clipboard と PRIMARY の同期には <code>gpaste</code> を使っている．
</p>
</div>
</div>
<div id="outline-container-org7c8c067" class="outline-2">
<h2 id="org7c8c067">Elscreen <code>[/]</code></h2>
<div class="outline-text-2" id="text-org7c8c067">
<p>
modeline の表示そのものは無効化しておく．
</p>
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Debian パッケージ版は古い．更新すべき</li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">elscreen</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> elscreen-tab-display-control nil)
  (<span style="color: #FF7F7F;">setq</span> elscreen-prefix-key (kbd <span style="color: #7FFF7F;">"C-o"</span>))
  (<span style="color: #FF7F7F;">setq</span> elscreen-display-tab 8)
  (<span style="color: #FF7F7F;">setq</span> elscreen-display-screen-number nil)
  <span style="color: #7FBFFF;">:config</span>
  (elscreen-start))
</pre>
</div>
</div>
</div>
<div id="outline-container-org0273573" class="outline-2">
<h2 id="org0273573">認証関連: <code>password-store</code></h2>
<div class="outline-text-2" id="text-org0273573">
</div><div id="outline-container-org3cdab34" class="outline-3">
<h3 id="org3cdab34">id-manager の設定</h3>
<div class="outline-text-3" id="text-org3cdab34">
<p>
ID と Password の簡単な組の管理をするのに非常に重宝している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">id-manager</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (file-exists-p <span style="color: #7FFF7F;">"~/.gnupg/idm-db.gpg"</span>)
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FFF7F;">"M-7"</span> . idm-open-list-command)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> idm-database-file
        (expand-file-name <span style="color: #7FFF7F;">"~/.gnupg/idm-db.gpg"</span>))
  (<span style="color: #FF7F7F;">setq</span> idm-clipboard-expire-time-sec 30))
</pre>
</div>
</div>
</div>
<div id="outline-container-org6a44c10" class="outline-3">
<h3 id="org6a44c10">plstore</h3>
<div class="outline-text-3" id="text-org6a44c10">
<p>
デフォルトは対称鍵暗号化なので， <code>GPG_KEY_ID</code> を設定しておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">plstore</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> plstore-secret-keys 'silent
        plstore-encrypt-to (getenv <span style="color: #7FFF7F;">"GPG_KEY_ID"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org75d3a8e" class="outline-3">
<h3 id="org75d3a8e">oauth2</h3>
<div class="outline-text-3" id="text-org75d3a8e">
<p>
oauth2 の認証情報は <code>plstore</code> で保存される．
ファイルの置き場所と暗号鍵の設定をしておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">oauth2</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> oauth2-token-file (concat my:d:tmp <span style="color: #7FFF7F;">"oauth2.plstore"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org03feeae" class="outline-3">
<h3 id="org03feeae">password-store</h3>
<div class="outline-text-3" id="text-org03feeae">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">password-store</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> my:d:password-store
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org67f8009" class="outline-2">
<h2 id="org67f8009">MUA の設定: <code>wanderlust</code></h2>
<div class="outline-text-2" id="text-org67f8009">
<p>
MUA として Wanderlust を使っている
</p>
</div>
<div id="outline-container-orgbff5d5e" class="outline-3">
<h3 id="orgbff5d5e">Emacs 本体側の設定</h3>
<div class="outline-text-3" id="text-orgbff5d5e">
<p>
Emacs 本体での設定は以下の通り. Wanderlust 自体の設定は別ファイルで行なわれる．
ここでは <code>wl-init-file</code> を指定することで，設定ファイルを明示している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">wl</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (<span style="color: #FF7F7F;">or</span> (my:dpkg-status <span style="color: #7FFF7F;">"wl"</span>)
               (my:dpkg-status <span style="color: #7FFF7F;">"wl-beta"</span>))
           (my:dpkg-status <span style="color: #7FFF7F;">"rail"</span>))
  <span style="color: #7FBFFF;">:commands</span> (wl wl-other-frame wl-draft wl-user-agent wl-user-agent-compose wl-draft-send wl-draft-kill)
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">unless</span> (package-installed-p 'gcontacts-get-wl)
    (quelpa '(gcontacts-get-wl
              <span style="color: #7FBFFF;">:fetcher</span> url
              <span style="color: #7FBFFF;">:url</span> <span style="color: #7FFF7F;">"https://raw.githubusercontent.com/uwabami/gcontacts-get-wl/master/gcontacts-get-wl.el"</span>)))
  (define-mail-user-agent
    'wl-user-agent
    'wl-user-agent-compose
    'wl-draft-send
    'wl-draft-kill
    'mail-send-hook)
  (<span style="color: #FF7F7F;">setq</span> elmo-msgdb-directory <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        elmo-maildir-folder-path <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        elmo-cache-directory <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        wl-score-files-directory <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        wl-init-file (concat user-emacs-directory <span style="color: #7FFF7F;">"init-wl"</span>)
        mail-user-agent 'wl-user-agent
        read-mail-command 'wl)
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p elmo-msgdb-directory)
    (make-directory elmo-msgdb-directory))
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local"</span>))
    (make-directory (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local"</span>)))
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local/Trash"</span>))
    (make-directory (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local/Trash"</span>)))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org4fac20b" class="outline-3">
<h3 id="org4fac20b">Wanderlust 本体の設定</h3>
<div class="outline-text-3" id="text-org4fac20b">
<p>
実際の設定は以下の通り
</p>
</div>
<div id="outline-container-org4d0633e" class="outline-4">
<h4 id="org4d0633e">依存/追加ライブラリのインストールと読み込み</h4>
<div class="outline-text-4" id="text-org4d0633e">
</div><ul class="org-ul"><li><a id="org9d2287e"></a>rail<br ><div class="outline-text-5" id="text-org9d2287e">
<p>
SEMI や FLIM などの UA の表示に <a href="http://uwabami.github.com/rail/">rail</a> を使っている.
ちなみに rail を有効にすると, 以下の様に User-Agent が表示される
</p>

<figure>
<p><img src="http://uwabami.github.io/rail/images/wanderlust_with_or_without_rail.png" alt="wanderlust_with_or_without_rail.png">
</p>
</figure>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">eval-when-compile</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">mime-def</span>))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rail</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> rail-emulate-genjis t))
</pre>
</div>
</div></li>
<li><a id="orgbd7ad2a"></a>cp5022x を使う<br ><div class="outline-text-5" id="text-orgbd7ad2a">
<p>
ISO-2022-JP を CP50220 として扱う.
<a href="http://d.hatena.ne.jp/kiwanami/20091103/1257243524">Wanderlustと文字コード</a> も参照のこと.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'mime-charset-coding-system-alist '(iso-2022-jp . cp50220))
(<span style="color: #FF7F7F;">setq</span> wl-mime-charset 'utf-8)
</pre>
</div>
</div></li>
<li><a id="orgc13c76d"></a>gcontacts-get-wl<br ><div class="outline-text-5" id="text-orgc13c76d">
<p>
<a href="https://github.com/uwabami/gcontacts-get-wl">gcontacts-get-wl</a> は
Google Contacts の連絡先を Wanderlust の <code>.Address</code> に出力するだけのパッケージ．
<a href="https://github.com/jd/google-contacts.el">google-contacs.el</a> の方が便利そうではあるものの「ふりがな」の扱いと，
オフラインでの処理を考えて，結局安直な方法を選んでしまった．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">gcontacts-get-wl</span>
  <span style="color: #7FBFFF;">:if</span> (my:dpkg-status <span style="color: #7FFF7F;">"wl-beta"</span>)
  <span style="color: #7FBFFF;">:commands</span> (gcontacts-update-wl-address)
  <span style="color: #7FBFFF;">:config</span>
  (load (expand-file-name <span style="color: #7FFF7F;">"emacs/gcontacts-get.gpg"</span> my:d:password-store)))
</pre>
</div>
<p>
oauth token は <code>pass</code> で管理している．中身は以下の通り
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> gcontacts-get-oauth-client-ID <span style="color: #7FFF7F;">"XXXXXXXXXXXXXXXX.apps.googleusercontent.com"</span>
      gcontacts-get-oauth-client-secret <span style="color: #7FFF7F;">"YYYYYYYYYYYYYYYYYYYYYYYYY"</span>
      gcontacts-get-ask nil)
</pre>
</div>
</div></li>
<li><a id="orgcf9b6b8"></a>elscreen-wl<br ><div class="outline-text-5" id="text-orgcf9b6b8">
<p>
メール作成時に <code>elscreen</code> と連携してくれる．便利
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">elscreen-wl</span>)
</pre>
</div>
</div></li>
<li><a id="org866f837"></a>SEMI の追加設定<br ><div class="outline-text-5" id="text-org866f837">
<p>
HTML メールを表示するための設定: eww を使うことに．
mime-setup がロードされる前に記述する必要あり.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-view-text/html-previewer 'shr)
(<span style="color: #FF7F7F;">setq</span> mime-setup-enable-inline-html 'shr)
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">mime-setup</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">shr-colorize-region</span> (start end fg <span style="color: #FFFF7F;">&amp;optional</span> bg) nil))
</pre>
</div>
<p>
どのアプリケーションで開くか → <code>xdg-open</code> に丸投げ．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-view-mailcap-files '(<span style="color: #7FFF7F;">"~/.mailcap"</span>))
</pre>
</div>
<p>
<code>~/.mailcap</code> 自体は以下
</p>
<div class="org-src-container">
<pre class="src src-conf">applications/*; xdg-open %s;
image/*; xdg-open %s;
video/*; xdg-open %s;
</pre>
</div>
<p>
MIME の例の保存先の変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-situation-examples-file
      (concat my:d:tmp <span style="color: #7FFF7F;">"mime-example"</span>))
</pre>
</div>
<p>
text/plain を html より優先
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-alist 'mime-view-type-subtype-score-alist '(text . html) 0)
</pre>
</div>
<p>
音を鳴らすアレやコレの無効化
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-play-find-every-situations nil
      mime-play-delete-file-immediately nil
      process-connection-type nil)
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-org4bb7921" class="outline-4">
<h4 id="org4bb7921">個人情報の設定</h4>
<div class="outline-text-4" id="text-org4bb7921">
<p>
具体的な設定内容は以下のファイルに置いている
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">     (load (concat my:d:password-store <span style="color: #7FFF7F;">"/emacs/wl-info.gpg"</span>))
</pre>
</div>
<p>
設定している内容は以下の通り
</p>
</div>
<ul class="org-ul"><li><a id="org749e4ed"></a>自身のメールアドレスと購読メーリングリストの設定<br ><div class="outline-text-5" id="text-org749e4ed">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">From: &#12398;&#35373;&#23450;</span>
(<span style="color: #FF7F7F;">setq</span> wl-from (concat user-full-name <span style="color: #7FFF7F;">" &lt;"</span> user-mail-address <span style="color: #7FFF7F;">"&gt;"</span>))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(system-name) &#12364; FQDN &#12434;&#36820;&#12373;&#12394;&#12356;&#22580;&#21512;&#12289;</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">`</span><span style="color: #FFBF7F;">wl-local-domain</span><span style="color: #e5e5e6;">' &#12395;&#12507;&#12473;&#12488;&#21517;&#12434;&#38500;&#12356;&#12383;&#12489;&#12513;&#12452;&#12531;&#21517;&#12434;&#35373;&#23450;</span>
(<span style="color: #FF7F7F;">setq</span> wl-local-domain <span style="color: #7FFF7F;">"example.com"</span>)
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#33258;&#20998;&#12398;&#12513;&#12540;&#12523;&#12450;&#12489;&#12524;&#12473;&#12398;&#12522;&#12473;&#12488;</span>
(<span style="color: #FF7F7F;">setq</span> wl-user-mail-address-list
      (list (wl-address-header-extract-address wl-from)
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">"e-mail2@example.com"</span>
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">"e-mail3@example.net" ...</span>
            ))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#33258;&#20998;&#12398;&#21442;&#21152;&#12375;&#12390;&#12356;&#12427;&#12513;&#12540;&#12522;&#12531;&#12464;&#12522;&#12473;&#12488;&#12398;&#12522;&#12473;&#12488;</span>
(<span style="color: #FF7F7F;">setq</span> wl-subscribed-mailing-list
      '(<span style="color: #7FFF7F;">"wl@lists.airs.net"</span>
        <span style="color: #7FFF7F;">"apel-ja@m17n.org"</span>
        <span style="color: #7FFF7F;">"emacs-mime-ja@m17n.org"</span>
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">"ml@example.com" ...</span>
        ))
</pre>
</div>
</div></li>
<li><a id="orge8f8bf2"></a>送受信用サーバの設定<br ><div class="outline-text-5" id="text-orge8f8bf2">
<p>
受信(IMAP)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-imap4-default-server <span style="color: #7FFF7F;">"your imap server"</span>)
(<span style="color: #FF7F7F;">setq</span> elmo-imap4-default-port '993)
(<span style="color: #FF7F7F;">setq</span> elmo-imap4-default-stream-type 'ssl)
</pre>
</div>
<p>
送信(SMTP)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-smtp-posting-server <span style="color: #7FFF7F;">"your smtp server"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-posting-user <span style="color: #7FFF7F;">"your account"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-posting-port 587)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-connection-type 'starttls)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-authenticate-type <span style="color: #7FFF7F;">"login"</span>)
</pre>
</div>
</div></li>
<li><a id="org693a05f"></a>From に応じて送信サーバをきりかえる.<br ><div class="outline-text-5" id="text-org693a05f">
<p>
本来はメール作成時/返信時の template の切り替えなのだれど,
送信時の SMTP の設定を from に合わせてきりかえるようにする.
default に二重に指定しているのは，
一度別のアカウントに切り替えた後に再びトグルして戻って来た際に元に戻す(上書き)するため.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-template-alist
      '((<span style="color: #7FFF7F;">"default"</span>
         (<span style="color: #7FFF7F;">"From"</span> . wl-from)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"your smtp server"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your account"</span>)
         (wl-smtp-posting-port . 587)
         (wl-smtp-connection-type . 'starttls)
         (wl-smtp-authenticate-type . <span style="color: #7FFF7F;">"login"</span>)
         )
        (<span style="color: #7FFF7F;">"example1"</span>
         (<span style="color: #7FFF7F;">"From"</span> . <span style="color: #7FFF7F;">"Your Name &lt;<a href="mailto:account&#64;example1.com">account&#64;example1.com</a>&gt;"</span>)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"smtp.example1.com"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your account"</span>)
         (wl-smtp-posting-port . 587)
         (wl-smtp-connection-type . 'starttls)
         (wl-smtp-authenticate-type . <span style="color: #7FFF7F;">"login"</span>)
         )
        (<span style="color: #7FFF7F;">"example2"</span>
         (<span style="color: #7FFF7F;">"From"</span> . <span style="color: #7FFF7F;">"Your Name &lt;<a href="mailto:account&#64;example2.com">account&#64;example2.com</a>&gt;"</span>)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"smtp.example2.com"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your account"</span>)
         (wl-smtp-posting-port . 587)
         (wl-smtp-connection-type . 'starttls)
         (wl-smtp-authenticate-type . <span style="color: #7FFF7F;">"plain"</span>)
         )
        (<span style="color: #7FFF7F;">"ssh:smtp"</span>
         <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">need ssh tunnel</span>
         <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ssh -f -N -L 20025:localhost:25 smtp.server.com</span>
         (<span style="color: #7FFF7F;">"From"</span> . <span style="color: #7FFF7F;">"Your Name &lt;<a href="mailto:account&#64;example3.com">account&#64;example3.com</a>&gt;"</span>)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"localhost"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your ssh account"</span>)
         (wl-smtp-posting-port . 20025)
         (wl-smtp-connection-type . 'nil)
         (wl-smtp-authenticate-type . 'nil)
         )
        ))
</pre>
</div>
<p>
ssh tunnel を自動的にやる事はできないモンだろうか
(送信時に open して, 送信後に close する, みたいなの).
</p>

<p>
ついでに template の切り替えに関して幾つか設定.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">template &#20999;&#12426;&#26367;&#12360;&#26178;&#12395; &#20869;&#23481;&#12434;&#34920;&#31034;</span>
(<span style="color: #FF7F7F;">setq</span> wl-template-visible-select t)
</pre>
</div>
<p>
<code>draft-mode</code> で <code>C-c C-n</code> をするとテンプレートを切り替え
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c\C-n"</span> 'wl-template-select)
</pre>
</div>
<p>
from に応じて wl-from, wl-envelope-from,
送信 smtp サーバを変更する送信時に変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'wl-draft-send-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (set (make-local-variable 'wl-from)
                 (std11-fetch-field <span style="color: #7FFF7F;">"From"</span>))))
</pre>
</div>
<p>
送信時に自動的に wl-draft-config-alist を適用&#x2026;しない?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(remove-hook 'wl-draft-send-hook 'wl-draft-config-exec)
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-orgeb3135d" class="outline-4">
<h4 id="orgeb3135d">基本設定</h4>
<div class="outline-text-4" id="text-orgeb3135d">
</div><ul class="org-ul"><li><a id="org65e911b"></a>imap 関連<br ><div class="outline-text-5" id="text-org65e911b">
<p>
デフォルトの認証設定
フォルダ名は UTF-7 でエンコードされているので,
表示する際にこれをデコードする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-imap4-use-modified-utf7 t)
</pre>
</div>
</div></li>
<li><a id="org754c985"></a>非同期チェック<br ><div class="outline-text-5" id="text-org754c985">
<p>
なんか挙動が変な，ような&#x2026;．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-folder-check-async nil)
</pre>
</div>
</div></li>
<li><a id="orgae14b01"></a>フォルダの位置の default からの変更<br ><div class="outline-text-5" id="text-orgae14b01">
<p>
<code>~/.cache/wanderlust/</code> に集約している
local の Mail folder の位置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-maildir-folder-path <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
      elmo-localdir-folder-path <span style="color: #7FFF7F;">"~/.cache/wanderlust/local"</span>)
</pre>
</div>
<p>
local フォルダの設定:
<code>.lost+found</code> は <code>elmo-maildir-folder-path</code> からの相対パスになっていることに注意
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-lost+found-folder <span style="color: #7FFF7F;">".lost+found"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-queue-folder <span style="color: #7FFF7F;">"+queue"</span>)
</pre>
</div>
<p>
folders の位置の変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-folders-file (concat my:d:password-store <span style="color: #7FFF7F;">"/emacs/wl-folders.gpg"</span>))
</pre>
</div>
<p>
Drafts, Trash の置き場所
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-folder <span style="color: #7FFF7F;">"+Drafts"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-trash-folder <span style="color: #7FFF7F;">"+Trash"</span>)
(<span style="color: #FF7F7F;">setq</span> elmo-lost+found-folder <span style="color: #7FFF7F;">"+lost+found"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-temporary-file-directory <span style="color: #7FFF7F;">"~/Downloads/"</span>)
</pre>
</div>
<p>
アドレス帳 -&gt; gcontacts-get-wlを使う.
GNOME を使っているのであれば <a href="https://tracker.debian.org/pkg/eweouz">eweouz</a> もおもしろそう．とりあえず読み込んでおく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-use-petname t)
(<span style="color: #FF7F7F;">setq</span> wl-address-file  <span style="color: #7FFF7F;">"~/.mua/Address.wl"</span>)
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">eweouz</span>
  <span style="color: #7FBFFF;">:config</span>
  (add-hook 'wl-hook 'eweouz-insinuate-wl))
</pre>
</div>
<p>
LDAP サーバからアドレスを引くことも可能.
以前は GCALDaemon を使って local に ldap サーバを上げていたのだけれども,
Google Contacts の API が変わったらしく
GCALDaemon で LDAP サーバは使えなくなったのでコメントアウト.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-use-ldap t)
(<span style="color: #FF7F7F;">setq</span> wl-ldap-server <span style="color: #7FFF7F;">"localhost"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-ldap-port <span style="color: #7FFF7F;">"389"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-ldap-base <span style="color: #7FFF7F;">"dc=math,dc=kyoto-u,dc=ac,dc=jp"</span>)
</pre>
</div>
<p>
パスワードの保存先
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-passwd-alist-file-name (concat my:d:password-store <span style="color: #7FFF7F;">"/emacs/wl-passwd.gpg"</span>))
</pre>
</div>
</div></li>
<li><a id="org065fbe1"></a>フォルダ編集時に backup を作成しない.<br ><div class="outline-text-5" id="text-org065fbe1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-fldmgr-make-backup nil)
</pre>
</div>
</div></li>
<li><a id="orge3942d0"></a>FCC, BCC の設定<br ><div class="outline-text-5" id="text-orge3942d0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-fcc nil)
     <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(setq wl-fcc "%Sent")</span>
</pre>
</div>
<p>
fcc を既読にする場合は以下．=wl-fcc= が nil の場合には意味は無い
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-fcc-force-as-read t)
</pre>
</div>
<p>
bcc は常に自身に.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-bcc (concat user-mail-address))
</pre>
</div>
</div></li>
<li><a id="org5154882"></a>起動時に <code>%INBOX</code> のみをチェック<br ><div class="outline-text-5" id="text-org5154882">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-auto-check-folder-name <span style="color: #7FFF7F;">"%INBOX"</span>)
</pre>
</div>
</div></li>
<li><a id="orgb0ab447"></a>フォルダ選択時の初期設定<br ><div class="outline-text-5" id="text-orgb0ab447">
<p>
imap の namespace を毎度入力するのが面倒なので，これを追加しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-default-spec <span style="color: #7FFF7F;">"%"</span>)
</pre>
</div>
</div></li>
<li><a id="org6a45231"></a>confirm 関連の設定<br ><div class="outline-text-5" id="text-org6a45231">
<p>
スキャン時の問い合わせの無効化.
ちなみに confirm を nil にしても 問い合わせが無いだけで
threshold は効くので, 明示的に nil に.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-folder-update-confirm nil)
(<span style="color: #FF7F7F;">setq</span> elmo-folder-update-threshold nil)
(<span style="color: #FF7F7F;">setq</span> elmo-message-fetch-confirm nil)
(<span style="color: #FF7F7F;">setq</span> elmo-message-fetch-threshold nil)
(<span style="color: #FF7F7F;">setq</span> wl-prefetch-confirm nil)
(<span style="color: #FF7F7F;">setq</span> wl-prefetch-threshold nil)
</pre>
</div>
<p>
終了時に確認しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-interactive-exit nil)
</pre>
</div>
<p>
送信時は確認する   :tangle init-wl.el
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-interactive-send t)
</pre>
</div>
</div></li>
<li><a id="org81f171f"></a>misc.<br ><div class="outline-text-5" id="text-org81f171f">
<p>
大きいメッセージを送信時に分割しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-edit-split-message nil)
</pre>
</div>
<p>
スレッドは常に閉じる
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-thread-insert-opened nil)
</pre>
</div>
<p>
3 pain 表示 -&gt; 使わない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-stay-folder-window nil)
</pre>
</div>
<p>
未読を優先的に読む
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-move-order 'unread)
</pre>
</div>
<p>
改ページ無視
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-break-pages nil)
</pre>
</div>
<p>
icon を使わない → GUI でもメニュー表示してないし, 体感的には遅くなる
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-highlight-folder-with-icon nil)
</pre>
</div>
</div></li>
<li><a id="orgac6557d"></a>dispose, delete の設定<br ><div class="outline-text-5" id="text-orgac6557d">
<p>
Gmail用に%INBOXでは削除を <code>wl-trash-folder</code> への移動ではなく，「delete」に．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'wl-dispose-folder-alist
             '(<span style="color: #7FFF7F;">"^%INBOX"</span> . remove))
</pre>
</div>
<p>
迷惑メール関連も
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'wl-dispose-folder-alist
             '(<span style="color: #7FFF7F;">".*Junk$"</span> . remove))
</pre>
</div>
</div></li>
<li><a id="org2aedfed"></a>折り返しの設定<br ><div class="outline-text-5" id="text-org2aedfed">
<p>
message は折り返す.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-truncate-lines nil)
</pre>
</div>
<p>
draft も折り返す
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-truncate-lines nil)
</pre>
</div>
</div></li>
<li><a id="org213b058"></a>mode-line の設定<br ><div class="outline-text-5" id="text-org213b058">
<p>
長いと嫌なのでイロイロ削る
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-mode-line-format <span style="color: #7FFF7F;">""</span>) <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">"%f &#123;%t}(%n/%u/%a)"</span>
(<span style="color: #FF7F7F;">setq</span> wl-message-mode-line-format <span style="color: #7FFF7F;">""</span>) <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">"&lt;&lt; %f:%F&gt;&gt; [%m]"</span>
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-orgcdd8e2a" class="outline-4">
<h4 id="orgcdd8e2a">キーバインド関連</h4>
<div class="outline-text-4" id="text-orgcdd8e2a">
<p>
<code>use-package</code> で設定しておいた方が良いかなぁ&#x2026;
</p>

<p>
<code>&lt;f2&gt;</code> で Addrbook の更新
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key [f2] 'gcontacts-update-wl-address)
</pre>
</div>
<p>
<code>C-c C-j</code> を browse-url に明け渡す
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c\C-j"</span> 'browse-url-at-point)
</pre>
</div>
<p>
<code>M-u</code> で unread にする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\M-u"</span> 'wl-summary-mark-as-unread)
</pre>
</div>
<p>
<code>i</code> で sync &lt;- Mew 風
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"i"</span> 'wl-summary-sync-update)
</pre>
</div>
<p>
<code>C-o</code> は elscreen で使う
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\C-o"</span> nil )
</pre>
</div>
<p>
<code>M-o</code> で <code>auto-refile</code>  (Mew 風)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\M-o"</span> 'wl-summary-auto-refile)
</pre>
</div>
</div>
</div>
<div id="outline-container-org447b2a7" class="outline-4">
<h4 id="org447b2a7">flag とフォルダを行き来する関数の追加</h4>
<div class="outline-text-4" id="text-org447b2a7">
<p>
"=" でフラグ付きフォルダと
実際にメッセージのあるフォルダを行き来する.
Gmail の「スター付き」フォルダでも有効
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">elmo</span> nil 'noerror)
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:wl-summary-jump-to-referer-message</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">when</span> (wl-summary-message-number)
    (<span style="color: #FF7F7F;">if</span> (eq (elmo-folder-type-internal wl-summary-buffer-elmo-folder) 'flag)
        (<span style="color: #FF7F7F;">progn</span>
          (<span style="color: #FF7F7F;">let*</span> ((referer (elmo-flag-folder-referrer
                           wl-summary-buffer-elmo-folder
                           (wl-summary-message-number)))
                 (folder (<span style="color: #FF7F7F;">if</span> (&gt; (length referer) 1)
                             (completing-read
                              (format <span style="color: #7FFF7F;">"Jump to (%s): "</span> (car (car referer)))
                              referer
                              nil t nil nil (car (car referer)))
                           (car (car referer)))))
            (wl-summary-goto-folder-subr folder 'no-sync nil nil t)
            (wl-summary-jump-to-msg (cdr (assoc folder referer)))))
      (<span style="color: #FF7F7F;">when</span> (eq (elmo-folder-type wl-summary-last-visited-folder) 'internal)
        (wl-summary-goto-last-visited-folder)))))
(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"="</span> 'my:wl-summary-jump-to-referer-message)
</pre>
</div>
</div>
</div>
<div id="outline-container-orga6ba174" class="outline-4">
<h4 id="orga6ba174">summary-mode の表示のカスタマイズ</h4>
<div class="outline-text-4" id="text-orga6ba174">
</div><ul class="org-ul"><li><a id="org01489a6"></a>自分が差出人である mail は To:某 と表示<br ><div class="outline-text-5" id="text-org01489a6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-showto-folder-regexp <span style="color: #7FFF7F;">".*"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-summary-from-function 'wl-summary-default-from)
</pre>
</div>
</div></li>
<li><a id="org2d15afe"></a>サマリ行の表示関連<br ><div class="outline-text-5" id="text-org2d15afe">
<p>
サマリ行のフォーマット指定
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-line-format
      <span style="color: #7FFF7F;">"%T%P%1@%1&gt;%Y/%M/%D %21(%t%[%19(%c %f%)%]%) %#%~%s"</span>)
</pre>
</div>
<p>
サマリ表示は切り詰めない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-subject-length-limit t)
</pre>
</div>
<p>
スレッドの幅の指定
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-thread-indent-level 2)
(<span style="color: #FF7F7F;">setq</span> wl-thread-have-younger-brother-str <span style="color: #7FFF7F;">"+"</span>
      wl-thread-youngest-child-str <span style="color: #7FFF7F;">"+"</span>
      wl-thread-vertical-str <span style="color: #7FFF7F;">"|"</span>
      wl-thread-horizontal-str <span style="color: #7FFF7F;">"-"</span>
      wl-thread-space-str <span style="color: #7FFF7F;">" "</span>)
</pre>
</div>

<p>
以下の二つの設定を有効にするには
<code>elmo-msgdb-extra-fields</code> を設定する必要がある.
この変数は振り分け判定にも使用するのでそこで設定している
</p>
</div></li>
<li><a id="orgc6e112f"></a>Gmail 風に, 自分宛のメールに "&gt;" をつけて表示する<br ><div class="outline-text-5" id="text-orgc6e112f">
<p>
元ネタ <a href="http://d.hatena.ne.jp/khiker/20080206/wanderlust">http://d.hatena.ne.jp/khiker/20080206/wanderlust</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-user-mail-address-regexp <span style="color: #7FFF7F;">"^uwabami.*</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">^sasakyh.*"</span>)
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#19968;&#35239;&#34920;&#31034;&#12391;&#12398;&#32622;&#12365;&#25563;&#12360;&#35215;&#21063;&#12395;&#36861;&#21152;</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:wl-summary-line-for-me</span> ()
  (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">catch</span> '<span style="color: #FFBF7F;">found</span>
        (<span style="color: #FF7F7F;">let</span> ((to (elmo-message-entity-field wl-message-entity 'to))
              (cc (elmo-message-entity-field wl-message-entity 'cc)))
          (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">or</span> (stringp to) cc)
            (<span style="color: #FF7F7F;">setq</span> to
                  (append (<span style="color: #FF7F7F;">if</span> (stringp to) (list to) to)
                          (<span style="color: #FF7F7F;">when</span> cc
                            (<span style="color: #FF7F7F;">if</span> (stringp cc) (list cc) cc)))))
          (<span style="color: #FF7F7F;">dolist</span> (i to)
            (<span style="color: #FF7F7F;">when</span> (wl-address-user-mail-address-p (eword-decode-string i))
              (<span style="color: #FF7F7F;">throw</span> '<span style="color: #FFBF7F;">found</span> t)))))
      <span style="color: #7FFF7F;">"&gt;"</span>
    <span style="color: #7FFF7F;">""</span>))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&gt; &#12434; summary-line-format &#12395;&#36861;&#21152;</span>
(<span style="color: #FF7F7F;">setq</span> wl-summary-line-format-spec-alist
      (append wl-summary-line-format-spec-alist
              '((?&gt; (my:wl-summary-line-for-me)))))
</pre>
</div>
</div></li>
<li><a id="orgf660a7a"></a>添付ファイルがあったら, サマリ行に "@" を付ける<br ><div class="outline-text-5" id="text-orgf660a7a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-line-format-spec-alist
      (append wl-summary-line-format-spec-alist
              '((?@ (wl-summary-line-attached)))))
</pre>
</div>
</div></li>
<li><a id="orgae012a6"></a>クォートされた文字列もデコードする<br ><div class="outline-text-5" id="text-orgae012a6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-header-lexical-analyzer
      '(
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">eword-analyze-quoted-string</span>
        eword-analyze-domain-literal
        eword-analyze-comment
        eword-analyze-spaces
        eword-analyze-special
        eword-analyze-encoded-word
        eword-analyze-atom))
</pre>
</div>
</div></li>
<li><a id="org87667d6"></a>Subject が変わってもスレッドを切らない<br ><div class="outline-text-5" id="text-org87667d6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-divide-thread-when-subject-changed nil)
</pre>
</div>
</div></li>
<li><a id="org606b3ac"></a>Subject での Tab や複数スペースを無視<br ><div class="outline-text-5" id="text-org606b3ac">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">std11-unfold-string</span> (after simply activate)
  (<span style="color: #FF7F7F;">setq</span> ad-return-value
        (elmo-replace-in-string ad-return-value <span style="color: #7FFF7F;">"[ \t]+"</span> <span style="color: #7FFF7F;">" "</span>)))
</pre>
</div>
</div></li>
<li><a id="orgd125c78"></a>重複メッセージを非表示に<br ><div class="outline-text-5" id="text-orgd125c78">
<p>
フォルダ内の Message-ID が同じメールを非表示にする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-folder-process-duplicates-alist
      '(
        (<span style="color: #7FFF7F;">".*"</span> . hide)
        ))
</pre>
</div>
</div></li>
<li><a id="orge7152a3"></a>sort 順: 返信が来た順<br ><div class="outline-text-5" id="text-orge7152a3">
<p>
<code>flet</code> を書き換えるのが面倒で <code>el-x</code> にある <code>dflet</code> を使うように変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">wl-summary-overview-entity-compare-by-reply-date</span> (a b)
  <span style="color: #7FFF7F;">"Compare message A and B by latest date of replies including thread."</span>
  (<span style="color: #FF7F7F;">dflet</span> ((string-max2 (x y)
                       (<span style="color: #FF7F7F;">cond</span> ((string&lt; x y) y)
                             ('t x)))
          (thread-number-get-date (x)
                                  (timezone-make-date-sortable (elmo-msgdb-overview-entity-get-date
                                                                (elmo-message-entity
                                                                 wl-summary-buffer-elmo-folder x))))
          (thread-get-family (x)
                             (cons x (wl-thread-entity-get-descendant (wl-thread-get-entity x))))
          (max-reply-date (x)
                          (<span style="color: #FF7F7F;">cond</span> ((eq 'nil x)
                                 'nil)
                                ((eq 'nil (cdr x))
                                 (thread-number-get-date (car x)))
                                ('t
                                 (string-max2 (thread-number-get-date (car x))
                                              (max-reply-date (cdr x)))))))
    (string&lt;
     (max-reply-date (thread-get-family (elmo-message-entity-number a)))
     (max-reply-date (thread-get-family (elmo-message-entity-number b))))))
(add-to-list 'wl-summary-sort-specs 'reply-date)
(<span style="color: #FF7F7F;">setq</span> wl-summary-default-sort-spec 'reply-date)
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-org54592fe" class="outline-4">
<h4 id="org54592fe">振り分け設定</h4>
<div class="outline-text-4" id="text-org54592fe">
<p>
<code>$</code> 以外を振り分け対象に
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-auto-refile-skip-marks '(<span style="color: #7FFF7F;">"$"</span>))
</pre>
</div>
</div>
<ul class="org-ul"><li><a id="orgfe43d07"></a>振り分け判定に使用するヘッダ<br ><div class="outline-text-5" id="text-orgfe43d07">
<p>
添付の有無の表示にも使うので <code>Content-Type</code> も登録.
あと <code>Delivered-To</code> はメールの検索の時に結構重宝している.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-msgdb-extra-fields
      '(
        <span style="color: #7FFF7F;">"List-Post"</span>
        <span style="color: #7FFF7F;">"List-Id"</span>
        <span style="color: #7FFF7F;">"List-ID"</span>                  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12383;&#12414;&#12395; List-ID &#12391;&#26469;&#12427;&#12513;&#12540;&#12523;&#12354;&#12427;&#12424;&#12397;?</span>
        <span style="color: #7FFF7F;">"Resent-CC"</span>
        <span style="color: #7FFF7F;">"Mailing-List"</span>
        <span style="color: #7FFF7F;">"X-Mailing-List"</span>
        <span style="color: #7FFF7F;">"X-ML-Address"</span>
        <span style="color: #7FFF7F;">"X-ML-Name"</span>
        <span style="color: #7FFF7F;">"X-ML-To"</span>
        <span style="color: #7FFF7F;">"Delivered-To"</span>
        <span style="color: #7FFF7F;">"Content-Type"</span>              <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#28155;&#20184;&#12398;&#26377;&#28961;&#12398;&#34920;&#31034;&#12398;&#28858;&#12395;&#36861;&#21152;</span>
        <span style="color: #7FFF7F;">"X-Google-Appengine-App-Id"</span> <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">GAE&#12398;&#36865;&#20449;&#12377;&#12427;&#12513;&#12540;&#12523;&#12398;&#25391;&#12426;&#20998;&#12369;&#29992;</span>
        <span style="color: #7FFF7F;">"To"</span>
        <span style="color: #7FFF7F;">"Cc"</span>
        <span style="color: #7FFF7F;">"From"</span>
        <span style="color: #7FFF7F;">"Subject"</span>
        <span style="color: #7FFF7F;">"Reply-To"</span>
        <span style="color: #7FFF7F;">"Auto-Submitted"</span>            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">Git commit/Cron notify</span>
        ))
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-orgd4262db" class="outline-4">
<h4 id="orgd4262db">日本語添付ファイル名のデコード</h4>
<div class="outline-text-4" id="text-orgd4262db">
<p>
日本語の添付ファイルに関しては, いまだにうまくいかない時がある.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my-mime-filename-coding-system-for-decode</span>
  '(iso-2022-jp japanese-shift-jis japanese-iso-8bit))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my-mime-decode-filename</span> (filename)
  (<span style="color: #FF7F7F;">let</span> ((filename (<span style="color: #FF7F7F;">if</span> (string-match <span style="color: #7FFF7F;">"\n\t*"</span> filename)
                      (replace-match <span style="color: #7FFF7F;">""</span> nil nil filename)
                    filename))
        (rest (eword-decode-string filename)))
    (<span style="color: #FF7F7F;">or</span> (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">and</span> my-mime-filename-coding-system-for-decode
                   (string= rest filename))
          (<span style="color: #FF7F7F;">let</span> ((dcs (mapcar (<span style="color: #FF7F7F;">function</span> coding-system-base)
                             (detect-coding-string filename))))
            (<span style="color: #FF7F7F;">unless</span> (memq 'emacs-mule dcs)
              (<span style="color: #FF7F7F;">let</span> ((pcs my-mime-filename-coding-system-for-decode))
                (<span style="color: #FF7F7F;">while</span> pcs
                  (<span style="color: #FF7F7F;">if</span> (memq (coding-system-base (car pcs)) dcs)
                      (<span style="color: #FF7F7F;">setq</span> rest (decode-coding-string filename (car pcs))
                            pcs nil)
                    (<span style="color: #FF7F7F;">setq</span> pcs (cdr pcs))))))))
        rest)))
(eval-after-load <span style="color: #7FFF7F;">"mime"</span>
  '(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">mime-entity-filename</span>
       (after eword-decode-for-broken-MUA activate)
     <span style="color: #7FFF7F;">"Decode encoded file name for BROKEN MUA."</span>
     (<span style="color: #FF7F7F;">when</span> (stringp ad-return-value)
       (<span style="color: #FF7F7F;">setq</span> ad-return-value (my-mime-decode-filename ad-return-value)))))
(<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">std11</span> nil 'noerror)
(eval-after-load <span style="color: #7FFF7F;">"std11"</span>
  '(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">std11-wrap-as-quoted-string</span>
       (before encode-string activate)
     <span style="color: #7FFF7F;">"Encode a string."</span>
     (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">eword-encode</span>)
     (ad-set-arg 0 (eword-encode-string (ad-get-arg 0)))))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#20108;&#37325;&#12456;&#12473;&#12465;&#12540;&#12503;&#12434;&#22238;&#36991;</span>
    (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">shell-quote-argument</span> (file) file)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf096b96" class="outline-4">
<h4 id="orgf096b96">メッセージ表示</h4>
<div class="outline-text-4" id="text-orgf096b96">
</div><ul class="org-ul"><li><a id="orga37bebb"></a>いったん全て非表示に<br ><div class="outline-text-5" id="text-orga37bebb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-ignored-field-list '(<span style="color: #7FFF7F;">"^.*:"</span>))
</pre>
</div>
</div></li>
<li><a id="orge8fe7ce"></a>見たいヘッダだけ表示<br ><div class="outline-text-5" id="text-orge8fe7ce">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-visible-field-list
      '(<span style="color: #7FFF7F;">"^Subject:"</span>
        <span style="color: #7FFF7F;">"^From:"</span>
        <span style="color: #7FFF7F;">"^To:"</span>
        <span style="color: #7FFF7F;">"^Cc:"</span>
        <span style="color: #7FFF7F;">"^Date:"</span>
        <span style="color: #7FFF7F;">"^Message-ID:"</span>
        ))
</pre>
</div>
</div></li>
<li><a id="org9080ed9"></a>表示順の変更<br ><div class="outline-text-5" id="text-org9080ed9">
<p>
Mew 風&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-sort-field-list
      '(<span style="color: #7FFF7F;">"^Subject:"</span>
        <span style="color: #7FFF7F;">"^From:"</span>
        <span style="color: #7FFF7F;">"^To:"</span>
        <span style="color: #7FFF7F;">"^Cc:"</span>
        <span style="color: #7FFF7F;">"^Date:"</span>
        <span style="color: #7FFF7F;">"^Message-ID:"</span>
        ))
</pre>
</div>
</div></li>
<li><a id="org56a2d46"></a>mime の画像表示の切り替え<br ><div class="outline-text-5" id="text-org56a2d46">
<p>
<code>M-T</code> でトグル
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">wl-summary-w3m-safe-toggle-inline-images</span> (<span style="color: #FFFF7F;">&amp;optional</span> arg)
  <span style="color: #7FFF7F;">"Toggle displaying of all images in the message buffer.</span>
<span style="color: #7FFF7F;">     If the prefix arg is given, all images are considered to be safe."</span>
  (<span style="color: #FF7F7F;">interactive</span> <span style="color: #7FFF7F;">"P"</span>)
  (<span style="color: #FF7F7F;">with-current-buffer</span> wl-message-buffer
    (w3m-toggle-inline-images arg)))
(eval-after-load <span style="color: #7FFF7F;">"wl-summary"</span>
  '(define-key wl-summary-mode-map
     <span style="color: #7FFF7F;">"\M-T"</span> 'wl-summary-w3m-safe-toggle-inline-images))
</pre>
</div>
</div></li>
<li><a id="orgdf40805"></a>From, To を省略表示しない<br ><div class="outline-text-5" id="text-orgdf40805">
<p>
To や From にアドレスが沢山指定されていると省略されるので，これを無効化
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-use-header-narrowing nil)
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-org429550d" class="outline-4">
<h4 id="org429550d">作成/返信設定</h4>
<div class="outline-text-4" id="text-org429550d">
<p>
自分宛のメールに返信する場合は <code>To:</code>, <code>Cc:</code> から自分のアドレスを削除
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-always-delete-myself t)
</pre>
</div>
<p>
"a" (without-argument)では <code>Reply-To:</code> や <code>From:</code> などで
指定された唯一人または唯一つの投稿先に返信.
また, <code>X-ML-Name:</code> と <code>Reply-To:</code> がついているなら <code>Reply-To:</code> 宛に返信
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-reply-without-argument-list
      '(((<span style="color: #7FFF7F;">"X-ML-Name"</span> <span style="color: #7FFF7F;">"Reply-To"</span>) . ((<span style="color: #7FFF7F;">"Reply-To"</span>) nil nil))
        (<span style="color: #7FFF7F;">"X-ML-Name"</span> . ((<span style="color: #7FFF7F;">"To"</span> <span style="color: #7FFF7F;">"Cc"</span>) nil nil))
        (<span style="color: #7FFF7F;">"Followup-To"</span> . (nil nil (<span style="color: #7FFF7F;">"Followup-To"</span>)))
        (<span style="color: #7FFF7F;">"Newsgroups"</span> . (nil nil (<span style="color: #7FFF7F;">"Newsgroups"</span>)))
        (<span style="color: #7FFF7F;">"Reply-To"</span> . ((<span style="color: #7FFF7F;">"Reply-To"</span>) nil nil))
        (<span style="color: #7FFF7F;">"Mail-Reply-To"</span> . ((<span style="color: #7FFF7F;">"Mail-Reply-To"</span>) nil nil))
        (<span style="color: #7FFF7F;">"From"</span> . ((<span style="color: #7FFF7F;">"From"</span>) nil nil))))
</pre>
</div>
<p>
<code>C-u a</code> (with-argument)であれば関係する全ての人・投稿先に返信
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-reply-with-argument-list
      '((<span style="color: #7FFF7F;">"Followup-To"</span> . ((<span style="color: #7FFF7F;">"From"</span>) nil (<span style="color: #7FFF7F;">"Followup-To"</span>)))
        (<span style="color: #7FFF7F;">"Newsgroups"</span> . ((<span style="color: #7FFF7F;">"From"</span>) nil (<span style="color: #7FFF7F;">"Newsgroups"</span>)))
        (<span style="color: #7FFF7F;">"Mail-Followup-To"</span> . ((<span style="color: #7FFF7F;">"Mail-Followup-To"</span>) nil (<span style="color: #7FFF7F;">"Newsgroups"</span>)))
        (<span style="color: #7FFF7F;">"From"</span> . ((<span style="color: #7FFF7F;">"From"</span>) (<span style="color: #7FFF7F;">"To"</span> <span style="color: #7FFF7F;">"Cc"</span>) (<span style="color: #7FFF7F;">"Newsgroups"</span>)))))
</pre>
</div>
<p>
サマリ表示には petname を使うが, 引用には使わない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-default-draft-cite-decorate-author nil)
</pre>
</div>
</div>
<ul class="org-ul"><li><a id="orga196e26"></a>draft mode で orgtbl を有効に<br ><div class="outline-text-5" id="text-orga196e26">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'wl-draft-mode-hook 'turn-on-orgtbl)
</pre>
</div>
</div></li>
<li><a id="orgcdecb34"></a>c-sig<br ><div class="outline-text-5" id="text-orgcdecb34">
<p>
署名の選択に c-sig を使用している.
設定は以下の通り. Mew 風に <code>C-c &lt;tab&gt;</code> で signature を挿入するようにしている
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">c-sig</span>
  <span style="color: #7FBFFF;">:init</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">eval-when-compile</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">wl</span>))
  (<span style="color: #FF7F7F;">setq</span> sig-insert-end t
        sig-save-to-sig-name-alist nil
        message-signature-file nil)
  (define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c\t"</span> 'insert-signature-eref)
  (add-hook 'wl-draft-mode-hook
            '(lambda ()
               (define-key (current-local-map) <span style="color: #7FFF7F;">"\C-c\C-w"</span>
                 'insert-signature-eref)))
  )
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-org5f32c67" class="outline-4">
<h4 id="org5f32c67">Face の設定</h4>
<div class="outline-text-4" id="text-org5f32c67">
<p>
デフォルトより細かく指定するために幾つかの face 定義を追加.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-highlight-message-header-alist
      '((<span style="color: #7FFF7F;">"Subject[ \t]*:"</span>
         . wl-highlight-message-subject-header-contents)
        (<span style="color: #7FFF7F;">"From[ \t]*:"</span>
         . wl-highlight-message-from-header-contents)
        (<span style="color: #7FFF7F;">"Date[ \t]*:"</span>
         . wl-highlight-message-date-header-contents)
        (<span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">.*To</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">Cc</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">Newsgroups</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">[ \t]*:"</span>
         . wl-highlight-message-important-header-contents)
        (<span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">User-Agent</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">X-Mailer</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">X-Newsreader</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">[ \t]*:"</span> .
         wl-highlight-message-unimportant-header-contents)
        ))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:wl-set-face</span> (face spec)
  (make-face face)
  (<span style="color: #FF7F7F;">cond</span> ((fboundp 'face-spec-set)
         (face-spec-set face spec))
        (t
         (wl-declare-face face spec))))
(my:wl-set-face 'wl-highlight-folder-closed-face                  '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4cff4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
(my:wl-set-face 'wl-highlight-folder-few-face                     '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-folder-killed-face                  '((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-folder-many-face                    '((t (:foreground ,my:h:magenta :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-folder-opened-face                  '((t (:foreground "#4cffff" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-folder-path-face                    '((t (:underline t :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-folder-unknown-face                 '((t (:foreground "#4cffff" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-folder-unread-face                  '((t (:foreground ,my:n:blue :bold nil :italic nil :weight normal ))))</span>
(my:wl-set-face 'wl-highlight-folder-zero-face                    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-header-separator-face               '((t (:inherit highlight :bold t ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-message-citation-header             '((t (:foreground ,my:h:green :bold nil :italic nil ))))</span>
(my:wl-set-face 'wl-highlight-message-cited-text-1                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7fff7f"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-2                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ffff7f"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-3                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7f7fff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-4                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7fffff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-5                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff7fff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-6                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff7f7f"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-7                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4cff4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-8                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ffff4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-9                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4c4cff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-10               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4cffff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-11               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff4cff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-12               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff4c4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-date-header-contents        '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-header-contents             '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-headers                     '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFFFF"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-important-header-contents2  '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-signature                   '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-important-header-contents   '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4CFF"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-subject-header-contents     '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-from-header-contents        '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-unimportant-header-contents '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-summary-answered-face               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-copied-face                 '((t (:foreground "#4CFFFF" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-deleted-face                '((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-displaying-face             '((t (:underline t :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-disposed-face               '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-flagged-face                '((t (:foreground ,my:h:yellow :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-forwarded-face              '((t (:foreground ,my:h:blue :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-high-read-face              '((t (:foreground ,my:h:green :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-high-unread-face            '((t (:foreground ,my:h:orange :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-important-face              '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-important-flag-face         '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-killed-face                 '((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-l:read-face                 '((t (:foreground "#4CFF4C" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-l:unread-face               '((t (:foreground ,my:h:lightb :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-new-face                    '((t (:foreground "#ff4c4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-normal-face                 '((t (:foreground "#f6f3e8" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-prefetch-face               '((t (:foreground ,my:n:blue :bold nil :italic nil :weight normal ))))</span>
(my:wl-set-face 'wl-highlight-summary-refiled-face                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-resend-face                 '((t (:foreground ,my:h:orange :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-target-face                 '((t (:foreground "#4CFFFF" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-temp-face                   '((t (:foreground ,my:n:violet :bold nil :italic nil :weight normal ))))</span>
(my:wl-set-face 'wl-highlight-summary-thread-top-face             '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-summary-unread-face                 '((t (:foreground "#ff4c4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(my:wl-set-face 'wl-highlight-thread-indent-face                  '((t (:underline t :bold nil :italic nil :weight normal ))))</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5e00b33" class="outline-4">
<h4 id="org5e00b33">GPG 署名</h4>
<div class="outline-text-4" id="text-org5e00b33">
<p>
以前は mailcrypt を使っていたけれど,
epa があるので主にキーバインドの設定のみ.
<code>draft-mode</code> の文字コードをあらかじめ指定しておかないと,
送信時に文字コードが変換されるので不正な署名となってしまう.
</p>

<p>
もっとうまい方法/正攻法がありそうな気がするけれど,
使えてるから, まあ良いかな, とか.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-pgp-verify-when-preview nil)
(add-hook 'wl-draft-mode-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (set-buffer-file-coding-system 'iso-2022-jp)
            ))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:epa-wl-decrypt-message</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">save-window-excursion</span>
    (wl-summary-jump-to-current-message)
    (wl-message-decrypt-pgp-nonmime)))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:epa-wl-verify-message</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">save-selected-window</span>
    (wl-summary-jump-to-current-message)
    (wl-message-verify-pgp-nonmime)))
(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\C-c : d"</span> 'my:epa-wl-decrypt-message)
(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\C-c : v"</span> 'my:epa-wl-verify-message)
(define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c : s"</span> 'epa-mail-sign)
(define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c : e"</span> 'epa-mail-encrypt)
</pre>
</div>
</div>
</div>
<div id="outline-container-org67ccc89" class="outline-4">
<h4 id="org67ccc89">検索</h4>
<div class="outline-text-4" id="text-org67ccc89">
<p>
imap の検索か mu(maildir-utils) の検索.
mu の検索が偶にセグフォるので悩み所
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">elmo-search</span>
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FBFFF;">:map</span> wl-summary-mode-map
              (<span style="color: #7FFF7F;">"v"</span> . wl-quicksearch-goto-search-folder-wrapper)
              <span style="color: #7FBFFF;">:map</span> wl-folder-mode-map
              (<span style="color: #7FFF7F;">"v"</span> . wl-quicksearch-goto-search-folder-wrapper))
  <span style="color: #7FBFFF;">:config</span>
  (elmo-search-register-engine
   'mu 'local-file
   <span style="color: #7FBFFF;">:prog</span> <span style="color: #7FFF7F;">"mu"</span>
   <span style="color: #7FBFFF;">:args</span> '(<span style="color: #7FFF7F;">"find"</span> <span style="color: #7FFF7F;">"-u"</span> elmo-search-split-pattern-list <span style="color: #7FFF7F;">"--fields"</span> <span style="color: #7FFF7F;">"l"</span> <span style="color: #7FFF7F;">"--sortfield"</span> <span style="color: #7FFF7F;">"date"</span> <span style="color: #7FFF7F;">"-r"</span>)
   <span style="color: #7FBFFF;">:charset</span> 'utf-8)
  (<span style="color: #FF7F7F;">setq</span> elmo-search-default-engine 'mu)
  (<span style="color: #FF7F7F;">setq</span> wl-quicksearch-folder <span style="color: #7FFF7F;">"[]"</span>))
</pre>
</div>
<p>
検索時にメールが多すぎると怒られるので. 数字は適当.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-multi-divide-number 10000000)
(<span style="color: #FF7F7F;">setq</span> elmo-multi-number 10000000)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org79a7e5d" class="outline-3">
<h3 id="org79a7e5d">Linux Desktop で <code>mailto:</code> リンクを扱うために</h3>
<div class="outline-text-3" id="text-org79a7e5d">
<p>
ついでに <code>mailto</code> のリンクを emacsclient で扱うために，以下の関数を定義しておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:mailto-compose-mail</span> (mailto-url)
  (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">and</span> (stringp mailto-url)
           (string-match <span style="color: #7FFF7F;">"\\`mailto:"</span> mailto-url))
      (<span style="color: #FF7F7F;">progn</span>
        (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">rfc2368</span>)
        (<span style="color: #FF7F7F;">let*</span> ((headers (mapcar (<span style="color: #FF7F7F;">lambda</span> (h) (cons (intern (car h)) (cdr h)))
                                (rfc2368-parse-mailto-url mailto-url)))
               (good-headers (remove-if (<span style="color: #FF7F7F;">lambda</span> (h) (member (car h) '(Body))) headers))
               (body (cdr (assoc 'Body headers))))
          (wl-draft good-headers nil nil body)))))
</pre>
</div>
<p>
Desktop の設定では
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e5e5e6;">#</span><span style="color: #e5e5e6;">!/bin/</span><span style="color: #FF7F7F;">sh</span>
<span style="color: #e5e5e6;"># </span><span style="color: #e5e5e6;">emacs-mailto-handler</span>

<span style="color: #7F7FFF;">mailto</span>=$<span style="color: #7F7FFF;">1</span>
<span style="color: #7F7FFF;">mailto</span>=<span style="color: #7FFF7F;">"mailto:${mailto#mailto:}"</span>
<span style="color: #7F7FFF;">mailto</span>=$(printf <span style="color: #7FFF7F;">'%s\n'</span> <span style="color: #7FFF7F;">"$mailto"</span> | sed -e <span style="color: #7FFF7F;">'s/[\"]/\\&amp;/g'</span>)
<span style="color: #7F7FFF;">elisp_expr</span>=<span style="color: #7FFF7F;">"(my:mailto-compose-mail \"$mailto\")"</span>

emacsclient -a <span style="color: #7FFF7F;">""</span> -n --eval <span style="color: #7FFF7F;">"$elisp_expr"</span> <span style="color: #7FFF7F;">\</span>
    <span style="color: #7FFF7F;">'(set-window-dedicated-p (selected-window) t)'</span>
</pre>
</div>
<p>
をメーラとして指定すれば良い．
GNOME は <code>.desktop</code> ファイルが無いと「お気に入り」登録ができないので
以下のファイルを適当な名前で <code>~/.local/share/applications/</code> 以下に放り込んでおくと良いだろう
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #FFFF7F;">Desktop Entry</span>]
<span style="color: #7F7FFF;">Name</span>=Emacs Mail Handler
<span style="color: #7F7FFF;">GenericName</span>=Mail User Agent
<span style="color: #7F7FFF;">X-GNOME-FullName</span>=Emacs Mail Handler
<span style="color: #7F7FFF;">Comment</span>=Use emacsclient as MUA, handling mailto link
<span style="color: #7F7FFF;">Keywords</span>=email
<span style="color: #7F7FFF;">Exec</span>=/home/uwabami/bin/emacs-mailto-handler %U
<span style="color: #7F7FFF;">Icon</span>=emacs25
<span style="color: #7F7FFF;">Terminal</span>=false
<span style="color: #7F7FFF;">Type</span>=Application
<span style="color: #7F7FFF;">Categories</span>=GNOME;GTK;Office;Email;
<span style="color: #7F7FFF;">StartupNotify</span>=false
<span style="color: #7F7FFF;">MimeType</span>=application/mbox;message/rfc822;x-scheme-handler/mailto;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgec000a7" class="outline-2">
<h2 id="orgec000a7">補完: <code>helm</code></h2>
<div class="outline-text-2" id="text-orgec000a7">
<p>
以前はデフォルトの挙動が嫌で割とイロイロと設定していたのだけれど，
最近はそんなに邪魔しない感じ&#x2026;なのかな? とりあえず現状は以下の通り．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">    (<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">helm</span>
      <span style="color: #7FBFFF;">:ensure</span> t
      <span style="color: #7FBFFF;">:defines</span> helm-map
      <span style="color: #7FBFFF;">:diminish</span> (helm-migemo-mode)
      <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"M-x"</span>     . helm-M-x)
             (<span style="color: #7FFF7F;">"C-x f"</span>   . helm-find-files)
             (<span style="color: #7FFF7F;">"C-x C-f"</span> . helm-find-files)
             (<span style="color: #7FFF7F;">"C-x b"</span>   . helm-buffers-list)
             (<span style="color: #7FFF7F;">"C-x C-b"</span> . helm-buffers-list)
             (<span style="color: #7FFF7F;">"C-x C-r"</span> . helm-recentf)
             )
      <span style="color: #7FBFFF;">:config</span>
      (define-key helm-map (kbd <span style="color: #7FFF7F;">"TAB"</span>) 'helm-execute-persistent-action)
      (define-key helm-map (kbd <span style="color: #7FFF7F;">"C-i"</span>) 'helm-execute-persistent-action)
      (global-unset-key (kbd <span style="color: #7FFF7F;">"C-z"</span>))
      (define-key helm-map (kbd <span style="color: #7FFF7F;">"C-z"</span>) 'helm-select-action)
      (my:disable-builtin-mode 'helm-mode)   <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">helm-mode &#12399;&#22522;&#26412;&#20351;&#12431;&#12394;&#12356;</span>
      (<span style="color: #FF7F7F;">setq</span> helm-command-prefix-key <span style="color: #7FFF7F;">"C-z"</span>    <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">helm-command-prefix-key</span>
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">dired &#12391;&#12398; skk &#12392;&#12398;&#31478;&#21512;(C-x C-j &#12398;&#22890;&#12356;&#21512;&#12356;)&#12434;&#36991;&#12369;&#12427;</span>
            dired-bind-jump nil
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">mode line &#12395;&#12399;&#20309;&#12418;&#34920;&#31034;&#12375;&#12394;&#12356;</span>
            helm-completion-mode-string <span style="color: #7FFF7F;">""</span>
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">minibuffer &#12395; input method &#12398;&#29366;&#24907;&#12434;&#24341;&#12365;&#32153;&#12364;&#12394;&#12356;</span>
            helm-inherit-input-method nil
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#20313;&#35336;&#12394;&#12501;&#12449;&#12452;&#12523;&#12399;&#34920;&#31034;&#12375;&#12394;&#12356;</span>
            helm-ff-skip-boring-files t
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">helm-adaptive &#12398;&#20445;&#23384;&#20808;&#12398;&#22793;&#26356;</span>
            helm-adaptive-history-file (concat my:d:tmp <span style="color: #7FFF7F;">"helm-adaptive-history"</span>)
            <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">mode line &#12395;&#12399;&#20309;&#12418;&#34920;&#31034;&#12375;&#12394;&#12356;</span>
            helm-completion-mode-string <span style="color: #7FFF7F;">""</span>
            )
      <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#19968;&#12388;&#19978;&#12398;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;(../)&#12434;&#20505;&#35036;&#12363;&#12425;&#22806;&#12377;</span>
      (advice-add 'helm-ff-filter-candidate-one-by-one
                  <span style="color: #7FBFFF;">:around</span> (<span style="color: #FF7F7F;">lambda</span> (orig-func file)
                            (<span style="color: #FF7F7F;">unless</span> (string-match <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(?:</span><span style="color: #7FFF7F;">/</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\`</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">\\.\\{2\\}\\'"</span> file)
                              (funcall orig-func file))))
      <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#23384;&#22312;&#12375;&#12394;&#12356;&#12501;&#12449;&#12452;&#12523;&#12395;&#12399;&#20309;&#12418;&#12375;&#12394;&#12356;(default &#12399;&#26032;&#35215; buffer &#12364;&#12391;&#12365;&#12427;)</span>
      (advice-add 'helm-ff-kill-or-find-buffer-fname
                  <span style="color: #7FBFFF;">:around</span> (<span style="color: #FF7F7F;">lambda</span> (orig-func candidate)
                            (<span style="color: #FF7F7F;">when</span> (file-exists-p candidate)
                              (funcall orig-func candidate))))
      (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">and</span> (locate-library <span style="color: #7FFF7F;">"migemo"</span>)     <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">&#12354;&#12428;&#12400; migemo &#12434;&#26377;&#21177;&#21270;</span>
               (executable-find <span style="color: #7FFF7F;">"cmigemo"</span>))
          (<span style="color: #FF7F7F;">setq</span> helm-migemo-mode t)
        (<span style="color: #FF7F7F;">setq</span> helm-migemo-mode nil))
      (helm-autoresize-mode)
      (<span style="color: #FF7F7F;">setq</span> helm-autoresize-min-height 30 <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">fixed 30%</span>
            helm-autoresize-max-height 30)
      )
</pre>
</div>
</div>
<div id="outline-container-org89c0bc4" class="outline-3">
<h3 id="org89c0bc4">helm-flx</h3>
<div class="outline-text-3" id="text-org89c0bc4">
<p>
曖昧検索は flx に任せる．かなり良い．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">helm-flx</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (helm-flx-mode +1)
  (<span style="color: #FF7F7F;">setq</span> helm-flx-for-helm-find-files t <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">t by default</span>
        helm-flx-for-helm-locate t) <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">nil by default</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org6303e9d" class="outline-3">
<h3 id="org6303e9d">helm-locate</h3>
<div class="outline-text-3" id="text-org6303e9d">
<p>
default の <code>mlocate</code> の option を修正しておく．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">helm-locate</span>
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"mlocate"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> helm-locate-command <span style="color: #7FFF7F;">"mlocate %s -e -A --regex %s"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb068981" class="outline-3">
<h3 id="orgb068981">helm-descbinds</h3>
<div class="outline-text-3" id="text-orgb068981">
<p>
<code>helm-M-x</code> の際にキーバインドが表示されるようになる
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">helm-descbinds</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (helm-descbinds-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org5522201" class="outline-3">
<h3 id="org5522201">helm-ag</h3>
<div class="outline-text-3" id="text-org5522201">
<p>
ripgrep があればそっちを使うようにしてみた．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">helm-ag</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">or</span> (executable-find <span style="color: #7FFF7F;">"ag"</span>)
          (executable-find <span style="color: #7FFF7F;">"rg"</span>))
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"M-g ."</span> . helm-ag)
         (<span style="color: #7FFF7F;">"M-g ,"</span> . helm-ag-pop-stack)
         (<span style="color: #7FFF7F;">"C-M-s"</span> . helm-ag-this-file))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">cond</span>
   ((executable-find <span style="color: #7FFF7F;">"rg"</span>)
    (<span style="color: #FF7F7F;">setq</span> helm-ag-base-command <span style="color: #7FFF7F;">"rg --vimgrep --no-heading"</span>))
   (t
    (<span style="color: #FF7F7F;">setq</span> helm-ag-base-command <span style="color: #7FFF7F;">"ag --nocolor --nogroup --ignore-case"</span>
          helm-ag-command-option <span style="color: #7FFF7F;">"--all-text"</span>)))
  (<span style="color: #FF7F7F;">setq</span> helm-ag-insert-at-point 'symbol)
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3360837" class="outline-2">
<h2 id="org3360837">補完: <code>yasnippet</code>, <code>auto-complete</code> <code>[/]</code></h2>
<div class="outline-text-2" id="text-org3360837">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> 上手く設定できていないので保留</li>
</ul>
</div>
<div id="outline-container-org09fe55d" class="outline-3">
<h3 id="org09fe55d">yasnippet</h3>
<div class="outline-text-3" id="text-org09fe55d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">yasnippet</span>
  <span style="color: #7FBFFF;">:disabled</span> t
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FBFFF;">:map</span> yas-minor-mode-map
              (<span style="color: #7FFF7F;">"C-x y i"</span> . yas-insert-snippet)
              (<span style="color: #7FFF7F;">"C-x y n"</span> . yas-new-snippet)
              (<span style="color: #7FFF7F;">"C-x y v"</span> . yas-visit-snippet-file)
              (<span style="color: #7FFF7F;">"&lt;tab&gt;"</span>   . nil)
              (<span style="color: #7FFF7F;">"TAB"</span>     . nil)
              (<span style="color: #7FFF7F;">"C-&lt;tab&gt;"</span> . yas-expand))
  <span style="color: #7FBFFF;">:diminish</span> yas-minor-mode
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">defconst</span> <span style="color: #7F7FFF;">my:d:yasnippet</span>
    (expand-file-name <span style="color: #7FFF7F;">"yasnippet"</span> my:d:share))
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p my:d:yasnippet)
    (make-directory my:d:yasnippet))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> yas-snippet-dirs
        (list my:d:yasnippet yas-installed-snippets-dir))
  (yas-global-mode 1)
  (<span style="color: #FF7F7F;">setq</span> yas-verbosity 2))
</pre>
</div>
</div>
</div>
<div id="outline-container-org13b6088" class="outline-3">
<h3 id="org13b6088">auto-complete</h3>
<div class="outline-text-3" id="text-org13b6088">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">auto-complete-config</span>
  <span style="color: #7FBFFF;">:disabled</span> t
  <span style="color: #7FBFFF;">:diminish</span> auto-complete-mode
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FBFFF;">:map</span> ac-menu-map
              (<span style="color: #7FFF7F;">"C-n"</span>   . ac-next)
              (<span style="color: #7FFF7F;">"C-p"</span>   . ac-previous)
              <span style="color: #7FBFFF;">:map</span> ac-completing-map
              (<span style="color: #7FFF7F;">"&lt;tab&gt;"</span> . ac-complete)
              (<span style="color: #7FFF7F;">"RET"</span>   .  nil)
              (<span style="color: #7FFF7F;">"M-/"</span>   . ac-stop))
  <span style="color: #7FBFFF;">:config</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12362;&#12414;&#12376;&#12394;&#12356;</span>
  (ac-flyspell-workaround)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#36766;&#26360;&#36861;&#21152;</span>
  (add-to-list 'ac-dictionary-directories (concat my:d:share <span style="color: #7FFF7F;">"ac-dict"</span>))
  (<span style="color: #FF7F7F;">setq</span> ac-comphist-file (concat my:d:tmp <span style="color: #7FFF7F;">"ac-comphist.dat"</span>))
  (<span style="color: #FF7F7F;">setq</span> ac-auto-start 4)                         <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">4 &#25991;&#23383;&#20197;&#19978;&#12391;&#36215;&#21205;</span>
  (<span style="color: #FF7F7F;">setq</span> ac-auto-show-menu 1)                     <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">1&#31186;&#12391;&#12513;&#12491;&#12517;&#12540;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> ac-use-comphist t)                       <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">&#35036;&#23436;&#20505;&#35036;&#12434;&#12477;&#12540;&#12488;</span>
  (<span style="color: #FF7F7F;">setq</span> ac-candidate-limit nil)                  <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">&#35036;&#23436;&#20505;&#35036;&#34920;&#31034;&#12434;&#28961;&#21046;&#38480;&#12395;</span>
  (<span style="color: #FF7F7F;">setq</span> ac-use-quick-help nil)                   <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">tool tip &#28961;&#12375;</span>
  (<span style="color: #FF7F7F;">setq</span> ac-use-menu-map t)                       <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">&#12461;&#12540;&#12496;&#12452;&#12531;&#12489;</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">yasnippet &#23550;&#24540;</span>
  (<span style="color: #FF7F7F;">setf</span> (symbol-function 'yas-active-keys)
        (<span style="color: #FF7F7F;">lambda</span> ()
          (remove-duplicates
           (mapcan #'yas--table-all-keys (yas--get-snippet-tables)))))
  (ac-config-default)
  (global-auto-complete-mode t)
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org38e931c" class="outline-2">
<h2 id="org38e931c">校正，辞書等</h2>
<div class="outline-text-2" id="text-org38e931c">
</div><div id="outline-container-orgd5b21f3" class="outline-3">
<h3 id="orgd5b21f3">spell checker</h3>
<div class="outline-text-3" id="text-orgd5b21f3">
<p>
ispell はコマンドとして <code>aspell</code> を利用する．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ispell</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq-default</span> ispell-program-name <span style="color: #7FFF7F;">"aspell"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (add-to-list 'ispell-skip-region-alist '(<span style="color: #7FFF7F;">"[</span><span style="color: #7FFFFF; font-weight: bold;">^</span><span style="color: #7FFF7F;">\000-\377]+"</span>)))
</pre>
</div>
<p>
flyspell-mode は別途有効化しておいた方が良いのかもしれない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">flyspell</span>
  <span style="color: #7FBFFF;">:diminish</span> flyspell-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:flyspell-popup-choose</span> (orig event poss word)
    (<span style="color: #FF7F7F;">if</span> (window-system)
        (funcall orig event poss word)
      (flyspell-emacs-popup-textual event poss word)))
  (advice-add 'flyspell-emacs-popup <span style="color: #7FBFFF;">:around</span> #'my:flyspell-popup-choose)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org8b8853c" class="outline-3">
<h3 id="org8b8853c">辞書</h3>
<div class="outline-text-3" id="text-org8b8853c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">lookup</span>
  <span style="color: #7FBFFF;">:commands</span> (lookup lookup-region lookup-pattern)
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (my:dpkg-status <span style="color: #7FFF7F;">"lookup-el"</span>)
           (file-exists-p <span style="color: #7FFF7F;">"/usr/local/share/dict/lookup-enabled"</span>))
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-c w"</span> . lookup-pattern)
         (<span style="color: #7FFF7F;">"C-c W"</span> . lookup-word))
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> lookup-search-agents
        '(
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/eijiro"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#33521;&#36766;&#37070;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/waeijiro"</span>  <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#21644;&#33521;&#36766;&#37070;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/rikagaku5"</span> <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#29702;&#21270;&#23398;&#36766;&#20856; &#31532;5&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/koujien4"</span>  <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#24195;&#36766;&#33489; &#31532;4&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/wadai5"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#30740;&#31350;&#31038; &#21644;&#33521;&#22823;&#36766;&#20856; &#31532;5&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/eidai6"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#30740;&#31350;&#31038; &#33521;&#21644;&#22823;&#36766;&#20856; &#31532;6&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/colloc"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#30740;&#31350;&#31038; &#33521;&#21644;&#27963;&#29992;&#22823;&#36766;&#20856; "</span>)
          )))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org31d81c4" class="outline-2">
<h2 id="org31d81c4">カレンダー: <code>japanese-holidays</code></h2>
<div class="outline-text-2" id="text-org31d81c4">
<p>
日本の祝日を表示するために <code>japanese-holidays</code> をインストール
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">japanese-holidays</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'calendar-today-visible-hook   'japanese-holiday-mark-weekend)
  (add-hook 'calendar-today-invisible-hook 'japanese-holiday-mark-weekend)
  (add-hook 'calendar-today-visible-hook   'calendar-mark-today)
  <span style="color: #7FBFFF;">:config</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12392;&#12426;&#12354;&#12360;&#12378;&#26085;&#26412;&#12398;&#12415;&#12434;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-holidays
        (append japanese-holidays holiday-local-holidays))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#31069;&#26085;&#12434;&#12459;&#12524;&#12531;&#12480;&#12540;&#12395;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> mark-holidays-in-calendar t)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26376;&#12392;&#26332;&#26085;&#12398;&#34920;&#31034;&#35519;&#25972;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-month-name-array
        [<span style="color: #7FFF7F;">"01"</span> <span style="color: #7FFF7F;">"02"</span> <span style="color: #7FFF7F;">"03"</span> <span style="color: #7FFF7F;">"04"</span> <span style="color: #7FFF7F;">"05"</span> <span style="color: #7FFF7F;">"06"</span> <span style="color: #7FFF7F;">"07"</span> <span style="color: #7FFF7F;">"08"</span> <span style="color: #7FFF7F;">"09"</span> <span style="color: #7FFF7F;">"10"</span> <span style="color: #7FFF7F;">"11"</span> <span style="color: #7FFF7F;">"12"</span> ])
  (<span style="color: #FF7F7F;">setq</span> calendar-day-name-array
        [<span style="color: #7FFF7F;">"&#26085;"</span> <span style="color: #7FFF7F;">"&#26376;"</span> <span style="color: #7FFF7F;">"&#28779;"</span> <span style="color: #7FFF7F;">"&#27700;"</span> <span style="color: #7FFF7F;">"&#26408;"</span> <span style="color: #7FFF7F;">"&#37329;"</span> <span style="color: #7FFF7F;">"&#22303;"</span>])
  (<span style="color: #FF7F7F;">setq</span> calendar-day-header-array
        [<span style="color: #7FFF7F;">"&#26085;"</span> <span style="color: #7FFF7F;">"&#26376;"</span> <span style="color: #7FFF7F;">"&#28779;"</span> <span style="color: #7FFF7F;">"&#27700;"</span> <span style="color: #7FFF7F;">"&#26408;"</span> <span style="color: #7FFF7F;">"&#37329;"</span> <span style="color: #7FFF7F;">"&#22303;"</span>])
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ISO format (YYYY/MM/DD) &#12395;&#22793;&#26356;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-date-style 'iso)
  (calendar-set-date-style 'iso)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#22303;&#26332;&#26085;&#12539;&#26085;&#26332;&#26085;&#12434;&#31069;&#26085;&#12392;&#12375;&#12390;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> japanese-holiday-weekend '(0 6)
        japanese-holiday-weekend-marker
        '(holiday nil nil nil nil nil japanese-holiday-saturday))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26085;&#26332;&#38283;&#22987;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-week-start-day 0))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge3a1b07" class="outline-2">
<h2 id="orge3a1b07">Org</h2>
<div class="outline-text-2" id="text-orge3a1b07">
<p>
<code>org-mode</code> が無いと生きていけない体になりました
</p>
</div>
<div id="outline-container-org47d8bf2" class="outline-3">
<h3 id="org47d8bf2">基本設定: <code>org</code></h3>
<div class="outline-text-3" id="text-org47d8bf2">
<p>
目新しい設定はしていない，と思う．強いて言えば
以前のメモの整理のために <a href="http://howm.osdn.jp/index-j.html">howm: Hitori Otegaru Wiki Modoki</a> も使っているので,
howm も有効にしている，ぐらい．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:d:org</span> (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/Dropbox/org/"</span>))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x n s"</span> . org-narrow-to-subtree)
         (<span style="color: #7FFF7F;">"C-x n w"</span> . widen))
  <span style="color: #7FBFFF;">:init</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-directory my:d:org                 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">Dropbox &#12395;&#20445;&#23384;&#12377;&#12427;</span>
        org-return-follows-link t              <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">return &#12391;&#12522;&#12531;&#12463;&#12434;&#36799;&#12427;</span>
        org-startup-folded t                   <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#35211;&#20986;&#12375;&#12434;&#30067;&#12435;&#12391;&#34920;&#31034;</span>
        org-startup-truncated t                <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#25240;&#12426;&#36820;&#12375;&#28961;&#12375;</span>
        org-emphasis-alist                     <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#22522;&#26412; "-nw" &#12394;&#12398;&#12391;&#33394;&#22793;&#26356;</span>
        (cons '(<span style="color: #7FFF7F;">"+"</span> '(<span style="color: #7FBFFF;">:strike-through</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#999999"</span>))
              (cl-delete <span style="color: #7FFF7F;">"+"</span> org-emphasis-alist <span style="color: #7FBFFF;">:key</span> 'car <span style="color: #7FBFFF;">:test</span> 'equal))
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">GTD: &#29366;&#24907;&#12398;&#36861;&#21152;</span>
        org-todo-keywords '((sequence <span style="color: #7FFF7F;">"TODO(t)"</span> <span style="color: #7FFF7F;">"WAIT(w)"</span> <span style="color: #7FFF7F;">"|"</span> <span style="color: #7FFF7F;">"DONE(d)"</span> <span style="color: #7FFF7F;">"CANCEL(c)"</span> <span style="color: #7FFF7F;">"SOMEDAY(s)"</span>)
                            (type <span style="color: #7FFF7F;">"ARTICLE(a)"</span>)
                            (type <span style="color: #7FFF7F;">"MEMO(m)"</span>))
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">GTD: &#12479;&#12464;&#12398;&#36861;&#21152;</span>
        org-tag-alist '((<span style="color: #7FFF7F;">"OFFICE"</span>     . ?o)
                        (<span style="color: #7FFF7F;">"HOME"</span>       . ?h)
                        (<span style="color: #7FFF7F;">"MAIL"</span>       . ?m)
                        (<span style="color: #7FFF7F;">"WORK"</span>       . ?w)
                        (<span style="color: #7FFF7F;">"Debian"</span>     . ?d)
                        (<span style="color: #7FFF7F;">"Computer"</span>   . ?c)
                        (<span style="color: #7FFF7F;">"Book"</span>       . ?b)
                        (<span style="color: #7FFF7F;">"Emacs"</span>      . ?e)
                        (<span style="color: #7FFF7F;">"TeX"</span>        . ?t)
                        (<span style="color: #7FFF7F;">"Ruby"</span>       . ?r)
                        )
        )
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">GTD: TODO&#8594;...&#8594;DONE &#12392;&#12375;&#12383;&#12456;&#12531;&#12488;&#12522;&#12434; =Arhive.org= &#12395;&#31227;&#21205;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-archive-done-tasks</span> ()
    (<span style="color: #FF7F7F;">interactive</span>)
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ARCHIVE &#12479;&#12464;&#12434;&#20184;&#12369;&#12427;&#12384;&#12369;&#12394;&#12425;&#20197;&#19979;</span>
    <span style="color: #e5e5e6;">;;   </span><span style="color: #e5e5e6;">(org-map-entries 'org-archive-set-tag "/DONE" 'file))</span>
    <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">org-archive-location &#12395; refile &#12375;&#12383;&#12356;&#12394;&#12425;&#20197;&#19979;</span>
    (org-map-entries 'org-archive-subtree <span style="color: #7FFF7F;">"/DONE"</span> 'file))
  (<span style="color: #FF7F7F;">setq</span> org-archive-location <span style="color: #7FFF7F;">"Archive.org::"</span>)
  (add-hook 'org-todo-statistics-hook 'my:org-archive-done-tasks)
  (add-hook 'org-todo-after-statistics-hook 'my:org-archive-done-tasks)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#25991;&#23383;&#12467;&#12540;&#12489;&#24375;&#21046; ... &#20170;&#26178;&#12356;&#12425;&#12394;&#12356;&#12363;&#12418;&#65294;</span>
  (modify-coding-system-alist 'file <span style="color: #7FFF7F;">"\\.org\\'"</span> 'utf-8)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">howm &#12501;&#12449;&#12452;&#12523;&#12418; org-mode &#12391;&#65294;</span>
  (add-to-list 'auto-mode-alist '(<span style="color: #7FFF7F;">"\\.org$"</span> . org-mode))
  (add-to-list 'auto-mode-alist '(<span style="color: #7FFF7F;">"\\.howm$"</span> . org-mode))
  <span style="color: #e5e5e6;">;;; </span><span style="color: #e5e5e6;">timestamp &#26356;&#26032;&#25991;&#23383;&#21015;&#12398;&#22793;&#26356;</span>
  <span style="color: #e5e5e6;">;;  </span><span style="color: #e5e5e6;">org-mode &#12391;&#12399; &#65283;+DATE: &#12434;&#12402;&#12387;&#12363;&#12369;&#12427;&#29992;&#12395;(&#65283;&#12399;&#23567;&#25991;&#23383;)&#65294;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-timestamp-hook</span> ()
    <span style="color: #7FFF7F;">"Change `</span><span style="color: #FFBF7F;">time-stamp-start</span><span style="color: #7FFF7F;">' in org-mode"</span>
    (set (make-local-variable 'time-stamp-start) <span style="color: #7FFF7F;">"#\\+DATE: 2"</span>)
    (set (make-local-variable 'time-stamp-end)   <span style="color: #7FFF7F;">"\$"</span>)
    )
  (add-hook 'org-mode-hook 'my:org-timestamp-hook)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org113af80" class="outline-3">
<h3 id="org113af80">Orglink</h3>
<div class="outline-text-3" id="text-org113af80">
<p>
org 形式の link を他のモードでも使えるようにする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">orglink</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (global-orglink-mode +1)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd251acc" class="outline-3">
<h3 id="orgd251acc">Capture: メモ取り</h3>
<div class="outline-text-3" id="text-orgd251acc">
<p>
キーバインドは以前 changelog memo をやっていた時の癖で <code>C-x m</code> をメモにしている.
他には wanderlust のメールを扱えるように <code>org-wl</code> を読み込んで template を追加したぐらい．
mu のインデックスの方が良いかもしれない，と最近思っている．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-wl</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (my:dpkg-status <span style="color: #7FFF7F;">"wl-beta"</span>)
           (file-directory-p org-directory)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-capture</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x m"</span> . org-capture))
  <span style="color: #7FBFFF;">:if</span> (file-directory-p org-directory)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-default-notes-file (concat org-directory <span style="color: #7FFF7F;">"Memo.org"</span>)
        org-capture-templates
        `(
          (<span style="color: #7FFF7F;">"t"</span> <span style="color: #7FFF7F;">"TODO"</span> plain
           (file (concat org-directory <span style="color: #7FFF7F;">"Memo.org"</span>))
           <span style="color: #7FFF7F;">"* TODO %^{title} %^g\n  %?\n  %a"</span>
           <span style="color: #7FBFFF;">:prepend</span> nil
           <span style="color: #7FBFFF;">:unnarrowed</span> t
           <span style="color: #7FBFFF;">:kill-buffer</span> t
           )
          <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">"* TODO &lt;%&lt;%Y-%m-%d&gt;&gt; %:subject %^g\n  %?\n  %a\n  #+BEGIN_QUOTE\n%i\n  #+END_QUOTE"</span>
          (<span style="color: #7FFF7F;">"e"</span> <span style="color: #7FFF7F;">"Email TODO"</span> plain
           (file (concat org-directory <span style="color: #7FFF7F;">"Memo.org"</span>))
           <span style="color: #7FFF7F;">"* TODO [[wl:\%5Bmsgid:%:message-id-no-brackets\%5D][%(replace-regexp-in-string \"\\\\[</span><span style="color: #FFBF7F;">.*\\\\</span><span style="color: #7FFF7F;">] \" \"\" \"%:subject\")]]\n  :PROPERTIES:\n  :CREATED: %u\n  :END:%?\n"</span>
           <span style="color: #7FBFFF;">:prepend</span> nil
           <span style="color: #7FBFFF;">:unnarrowed</span> nil
           <span style="color: #7FBFFF;">:kill-buffer</span> t
           )
          (<span style="color: #7FFF7F;">"m"</span> <span style="color: #7FFF7F;">"Memo"</span> plain
           (file (concat org-directory <span style="color: #7FFF7F;">"Memo.org"</span>))
           <span style="color: #7FFF7F;">"* MEMO %t %^{titlle}\n  %?\n  %a"</span>
           <span style="color: #7FBFFF;">:prepend</span> nil
           <span style="color: #7FBFFF;">:unnarrowed</span> t
           <span style="color: #7FBFFF;">:kill-buffer</span> t
           )
          ))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org6aea546" class="outline-3">
<h3 id="org6aea546">Agenda: スケジュール，TODO 表示</h3>
<div class="outline-text-3" id="text-org6aea546">
<p>
GTD 用の設定．後述の <code>org-gcal</code> と <code>orgmine</code> で取得したデータも表示している．
ついでに
</p>
<ul class="org-ul">
<li>土曜日をの face を追加.</li>
<li>祝日, 休日を日曜と同じfaceにする.</li>
</ul>
<p>
なんて事もやっている．元ネタは <a href="https://julien.danjou.info/blog/2010/org-mode-and-holidays">Org-mode and holidays</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-agenda</span>
  <span style="color: #7FBFFF;">:if</span> (file-directory-p my:d:org)
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-c a"</span> . org-agenda))
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-date-saturday</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FBFFF"</span> <span style="color: #7FBFFF;">:bold</span> t )))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;&#12398;&#22303;&#26332;&#26085;&#29992;&#12398;face"</span>)
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-date-today-saturday</span>
    '((t (<span style="color: #7FBFFF;">:inherit</span> my:org-agenda-date-saturday <span style="color: #7FBFFF;">:underline</span> t)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;&#12398;&#20170;&#26085;&#12363;&#12388;&#22303;&#26332;&#26085;&#29992;&#12398;face"</span>)
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-date-today-weekend</span>
    '((t (<span style="color: #7FBFFF;">:inherit</span> org-agenda-date-weekend <span style="color: #7FBFFF;">:underline</span> t)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;&#12398;&#20170;&#26085;&#12363;&#12388;&#26085;&#12539;&#31069;&#26085;&#29992;&#12398;face"</span>)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12371;&#12387;&#12363;&#12425;&#12399; org-gcal &#12391;&#21516;&#26399;&#12375;&#12383;&#12459;&#12524;&#12531;&#12480;&#12540;&#12398;&#33394;</span>
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-KUSM</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, KUSM.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-Schedule</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, Schedule.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-GFD</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF7F"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, GFD.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-DebianJP</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#BF7FFF"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, DebianJP.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-twitter</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#CCCCCC"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, Twiiter log &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26356;&#26032;&#29992;&#12398;&#38306;&#25968; - &#12392;&#12426;&#12354;&#12360;&#12378;&#21205;&#12356;&#12390;&#12356;&#12427;&#12398;&#12391;&#33391;&#12375;&#12392;&#12377;&#12427;&#12364;&#65292;&#12522;&#12501;&#12449;&#12463;&#12479;&#12522;&#12531;&#12464;&#12375;&#12383;&#12356;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-agenda-day-face-function</span> (date)
    <span style="color: #7FFF7F;">"Compute DATE face for saturday, holidays."</span>
    (<span style="color: #FF7F7F;">cl-dolist</span> (file (org-agenda-files nil 'ifmode))
      (<span style="color: #FF7F7F;">cond</span>
       ((member (calendar-day-of-week date) '(7))
        (<span style="color: #FF7F7F;">if</span> (org-agenda-todayp date)
            (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-today-weekend))
        (<span style="color: #FF7F7F;">cl-return</span> 'org-agenda-date-weekend))
       ((member (calendar-day-of-week date) '(6))
        (<span style="color: #FF7F7F;">if</span> (org-agenda-todayp date)
            (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-today-saturday))
        (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-saturday)))
      (<span style="color: #FF7F7F;">let</span> ((face
             (<span style="color: #FF7F7F;">cl-dolist</span> (entry (org-agenda-get-day-entries file date))
               (<span style="color: #FF7F7F;">let</span> ((category (<span style="color: #FF7F7F;">with-temp-buffer</span>
                                 (insert entry)
                                 (org-get-category (point-min)))))
                 (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">or</span> (string= <span style="color: #7FFF7F;">"&#31069;&#26085;"</span> category)
                           (string= <span style="color: #7FFF7F;">"&#20241;&#26085;"</span> category))
                   (<span style="color: #FF7F7F;">if</span> (org-agenda-todayp date)
                       (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-today-weekend)
                     (<span style="color: #FF7F7F;">cl-return</span> 'org-agenda-date-weekend)))))))
        (<span style="color: #FF7F7F;">when</span> face (<span style="color: #FF7F7F;">cl-return</span> face)))))
  <span style="color: #7FBFFF;">:config</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#20351;&#29992;&#12377;&#12427;&#12501;&#12449;&#12452;&#12523;</span>
  (<span style="color: #FF7F7F;">setq</span> org-agenda-files nil)
  (<span style="color: #FF7F7F;">dolist</span> (file
           '(<span style="color: #7FFF7F;">"Archive.org"</span>
             <span style="color: #7FFF7F;">"Diary.org"</span>
             <span style="color: #7FFF7F;">"Memo.org"</span>
             <span style="color: #7FFF7F;">"Schedule.org"</span>
             <span style="color: #7FFF7F;">"GFD.org"</span>
             <span style="color: #7FFF7F;">"KUSM.org"</span>
             <span style="color: #7FFF7F;">"DebianJP.org"</span>
             <span style="color: #7FFF7F;">"twitter.org"</span>
             <span style="color: #7FFF7F;">"journal.org"</span>
             <span style="color: #7FFF7F;">"redmine_GFD.org"</span>
             <span style="color: #7FFF7F;">"redmine_FluidSoc.org"</span>
             <span style="color: #7FFF7F;">"redmine_KUSM.org"</span>
             ))
    (add-to-list 'org-agenda-files (concat org-directory file)))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#34920;&#31034;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span>
  (<span style="color: #FF7F7F;">setq</span> org-agenda-span 'day                   <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">day or week</span>
        org-agenda-format-date <span style="color: #7FFF7F;">"%Y/%m/%d (%a)"</span> <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">YY/MM/DD (&#26332;)</span>
        org-agenda-weekend-days '(0)           <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26085;&#26332;&#22987;&#12414;&#12426;</span>
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#34920;&#31034;&#38306;&#25968;</span>
        org-agenda-day-face-function 'my:org-agenda-day-face-function
        org-agenda-custom-commands             <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">GTD &#29992;&#12398;&#35373;&#23450;</span>
        '(
          (<span style="color: #7FFF7F;">"n"</span> <span style="color: #7FFF7F;">"agenda and all TODO list"</span>
           (
            (agenda <span style="color: #7FFF7F;">""</span>
                    ((org-agenda-ndays 1)
                     (org-agenda-entry-types '(<span style="color: #7FBFFF;">:timestamp</span> <span style="color: #7FBFFF;">:sexp</span>))))
            (todo <span style="color: #7FFF7F;">"TODO"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            (todo <span style="color: #7FFF7F;">"&#26032;&#35215;|&#30528;&#25163;|&#36914;&#34892;&#20013;|&#30906;&#35469;"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            (todo <span style="color: #7FFF7F;">"WAIT"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            (todo <span style="color: #7FFF7F;">"SOMEDAY"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            ))
          (<span style="color: #7FFF7F;">"N"</span> <span style="color: #7FFF7F;">"All memo entry"</span>
           (<span style="color: #e5e5e6;">;;</span>
            (todo <span style="color: #7FFF7F;">"MEMO"</span>)
            ))
           )
        )
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#33394;&#20184;&#12369;</span>
  (add-hook 'org-finalize-agenda-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (<span style="color: #FF7F7F;">save-excursion</span>
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"KUSM:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                     '(face my:org-agenda-calendar-KUSM)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"Schedule:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-Schedule)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"DebianJP:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-DebianJP)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"GFD:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-GFD)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"twitter:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-twitter)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"&#31069;&#26085;:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face org-agenda-date-weekend)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"&#20241;&#26085;:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face org-agenda-date-weekend)))
                )))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org6ce5e9e" class="outline-3">
<h3 id="org6ce5e9e"><code>org-journal</code>: 日記</h3>
<div class="outline-text-3" id="text-org6ce5e9e">
<p>
エントリ作成時に日付を入れるために <code>org-jounnal-new-entry</code> を <code>defadvice</code> している
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-journal</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (file-directory-p my:d:org)
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-c C-j"</span> . browse-url-at-point))
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'org-journal-mode-hook
            (<span style="color: #FF7F7F;">setq</span> truncate-lines t))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">unbind-key</span> <span style="color: #7FFF7F;">"C-c C-j"</span> org-journal-mode-map)
  (<span style="color: #FF7F7F;">bind-key</span> <span style="color: #7FFF7F;">"C-c C-j"</span> 'browse-url-at-point)
  (<span style="color: #FF7F7F;">setq</span> org-journal-dir org-directory
        org-journal-file-format <span style="color: #7FFF7F;">"journal.org"</span>
        org-journal-date-format <span style="color: #7FFF7F;">"%x (%a)"</span>
        org-journal-date-prefix <span style="color: #7FFF7F;">"* "</span>
        org-journal-time-format <span style="color: #7FFF7F;">"&lt;%Y-%m-%d %R&gt; "</span>
        org-journal-time-prefix <span style="color: #7FFF7F;">"** "</span>)
  (<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">org-journal-new-entry</span> (before my:org-journal-add-date-entry)
    <span style="color: #7FFF7F;">"Insert date entry"</span>
    (find-file-other-window (concat org-journal-dir org-journal-file-format))
    (org-journal-decrypt)
    (<span style="color: #FF7F7F;">unless</span>
        (string-match (format-time-string org-journal-date-format)
                      (buffer-substring-no-properties (point-min) (point-max)))
      (<span style="color: #FF7F7F;">progn</span>
        (goto-char (point-max))
        (insert (concat <span style="color: #7FFF7F;">"\n"</span> org-journal-date-prefix
                        (format-time-string org-journal-date-format)))
        ))
    )
  (ad-activate 'org-journal-new-entry))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">Key bindings -- &#20351;&#12360;&#12390;&#12394;&#12356;...</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key org-journal-mode-map (kbd "C-c C-f") 'org-journal-open-next-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key org-journal-mode-map (kbd "C-c C-b") 'org-journal-open-previous-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key org-journal-mode-map (kbd "C-c C-j") 'org-journal-new-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map "j" 'org-journal-read-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map (kbd "C-j") 'org-journal-display-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map "]" 'org-journal-next-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map "[" 'org-journal-previous-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map (kbd "i j") 'org-journal-new-date-entry)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map (kbd "f f") 'org-journal-search-forever)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map (kbd "f w") 'org-journal-search-calendar-week)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map (kbd "f m") 'org-journal-search-calendar-month)</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(define-key calendar-mode-map (kbd "f y") 'org-journal-search-calendar-year)))</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7fbce2f" class="outline-3">
<h3 id="org7fbce2f">Babel</h3>
<div class="outline-text-3" id="text-org7fbce2f">
</div><div id="outline-container-org5a78024" class="outline-4">
<h4 id="org5a78024">org-src</h4>
<div class="outline-text-4" id="text-org5a78024">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-src</span>
  <span style="color: #7FBFFF;">:diminish</span> org-src-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-src-fontify-natively t       <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">font-lock</span>
        org-src-tab-acts-natively t      <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">indent</span>
        org-edit-src-content-indentation 0
        org-src-preserve-indentation t
        )
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org2e5f023" class="outline-4">
<h4 id="org2e5f023">org-ditaa</h4>
<div class="outline-text-4" id="text-org2e5f023">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ob-ditaa</span>
  <span style="color: #7FBFFF;">:if</span> (file-exists-p (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/bin/jditaa.jar"</span>))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-ditaa-jar-path (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/bin/jditaa.jar"</span>))
  (org-babel-do-load-languages 'org-babel-load-languages
                               '((ditaa . t)))
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org049f0ba" class="outline-3">
<h3 id="org049f0ba">Org-gcal</h3>
<div class="outline-text-3" id="text-org049f0ba">
<p>
Google カレンダーと org の予定を同期
</p>
</div>
<div id="outline-container-orgdc3fc41" class="outline-4">
<h4 id="orgdc3fc41">token 等の置き場所の変更</h4>
<div class="outline-text-4" id="text-orgdc3fc41">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">request</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> request-storage-directory (concat my:d:tmp <span style="color: #7FFF7F;">"request"</span>))
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p request-storage-directory)
    (make-directory request-storage-directory)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org09be5ff" class="outline-4">
<h4 id="org09be5ff">org-gcal 本体の設定</h4>
<div class="outline-text-4" id="text-org09be5ff">
<p>
実際の情報等は <code>password-store</code> を使って設定しておく.
ついでに agenda 表示の際の色付けを設定．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-gcal</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> my:d:password-store
           (file-directory-p my:d:org))
  <span style="color: #7FBFFF;">:commands</span> (org-gcal-fetch)
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> org-gcal-dir (concat my:d:tmp <span style="color: #7FFF7F;">"org-gcal"</span>))
  (<span style="color: #FF7F7F;">unless</span> org-gcal-dir
    (make-directory org-gcal-dir))
  (<span style="color: #FF7F7F;">setq</span> org-gcal-token-file (expand-file-name <span style="color: #7FFF7F;">".org-gcal-token"</span> org-gcal-dir))
  (<span style="color: #FF7F7F;">setq</span> alert-log-messages t)
  (<span style="color: #FF7F7F;">setq</span> alert-default-style 'log)
  (<span style="color: #FF7F7F;">setq</span> org-gcal-down-days   90) <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#36942;&#21435; 3 month</span>
  (<span style="color: #FF7F7F;">setq</span> org-gcal-up-days    180) <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26410;&#26469; 6 month</span>
  (<span style="color: #FF7F7F;">setq</span> org-gcal-auto-archive nil)
  <span style="color: #7FBFFF;">:config</span>
  (load (expand-file-name <span style="color: #7FFF7F;">"emacs/org-gcal.gpg"</span> my:d:password-store)))
</pre>
</div>
<p>
password-store には multiline で設定を書く．例えば以下:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> org-gcal-client-id <span style="color: #7FFF7F;">"XXXXXXXXXXX"</span>
      org-gcal-client-secret <span style="color: #7FFF7F;">"XXXXXXXXXXX"</span>
      org-gcal-file-alist
      '((<span style="color: #7FFF7F;">"XXXXX@gmail.com"</span> . <span style="color: #7FFF7F;">"~/org/Schedule.org"</span>)
        (<span style="color: #7FFF7F;">"YYYYY@group.calendar.google.com"</span> . <span style="color: #7FFF7F;">"~/org/Project1.org"</span>)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc71a475" class="outline-3">
<h3 id="orgc71a475">OrgとRedmine の連携: <code>orgmine</code></h3>
<div class="outline-text-3" id="text-orgc71a475">
<p>
素晴しい!! <a href="https://github.com/kametoku/orgmine">kametoku/orgmine: Emacs minor mode for org-mode with redmine integration</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">orgmine</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> my:d:password-store
           (file-directory-p org-directory))
  <span style="color: #7FBFFF;">:commands</span> (orgmine-mode)
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">unless</span> (package-installed-p 'orgmine)
    (package-install 'elmine)
    (quelpa '(orgmine
              <span style="color: #7FBFFF;">:fetcher</span> github
              <span style="color: #7FBFFF;">:repo</span> <span style="color: #7FFF7F;">"kametoku/orgmine"</span>)))
  (add-to-list 'safe-local-variable-values
               '(orgmine-note-block-begin . <span style="color: #7FFF7F;">"#+BEGIN_SRC textile"</span>))
  (add-hook 'org-mode-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (<span style="color: #FF7F7F;">if</span> (assoc <span style="color: #7FFF7F;">"om_project"</span> org-file-properties) (orgmine-mode))))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> orgmine-note-block-begin <span style="color: #7FFF7F;">"#+BEGIN_SRC gfm"</span>   <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#35201;&#35519;&#25972;</span>
        orgmine-note-block-end   <span style="color: #7FFF7F;">"#+END_SRC\n"</span>
        orgmine-default-todo-keyword <span style="color: #7FFF7F;">"&#26032;&#35215;"</span>)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12469;&#12540;&#12496;&#35373;&#23450;</span>
  (load (expand-file-name <span style="color: #7FFF7F;">"emacs/orgmine.gpg"</span> my:d:password-store)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org8102b70" class="outline-3">
<h3 id="org8102b70">Org-Wiki</h3>
<div class="outline-text-3" id="text-org8102b70">
<p>
計算機関連のメモは <a href="https://github.com/caiorss/org-wiki">org-wiki</a> で書いています．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (package-installed-p 'org-wiki)
  (quelpa '(org-wiki
            <span style="color: #7FBFFF;">:fetcher</span> github
            <span style="color: #7FBFFF;">:repo</span> <span style="color: #7FFF7F;">"caiorss/org-wiki"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-wiki</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-wiki-location (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/Public/cc-env/"</span>))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-wiki-header</span> ()
    <span style="color: #7FFF7F;">"Insert a header at the top of the file, customize for personal use"</span>
    (<span style="color: #FF7F7F;">interactive</span>)
    (<span style="color: #FF7F7F;">save-excursion</span>
      (goto-char (point-min))
      (insert (format
               (string-trim <span style="color: #7FFF7F;">"</span>
<span style="color: #7FFF7F;">#+TITLE:</span>
<span style="color: #7FFF7F;">#+DATE: 20</span>
<span style="color: #7FFF7F;">#+LANGUAGE: ja</span>
<span style="color: #7FFF7F;">#+REF: cc-env/%s</span>
<span style="color: #7FFF7F;">#+LAYOUT: default</span>
<span style="color: #7FFF7F;">#+SETUPFILE: ~/Public/_setup.org</span>
<span style="color: #7FFF7F;">#+PERMALINK: /cc-env/%s.html</span>
<span style="color: #7FFF7F;">"</span>)
               (file-name-base (buffer-file-name))
               (file-name-base (buffer-file-name))))))
  (advice-add 'org-wiki-header <span style="color: #7FBFFF;">:override</span> 'my:org-wiki-header)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org5b0e13a" class="outline-3">
<h3 id="org5b0e13a">Export</h3>
<div class="outline-text-3" id="text-org5b0e13a">
</div><div id="outline-container-orgdac00c8" class="outline-4">
<h4 id="orgdac00c8">一般設定</h4>
<div class="outline-text-4" id="text-orgdac00c8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox</span>
    <span style="color: #7FBFFF;">:config</span>
    (<span style="color: #FF7F7F;">setq</span> org-export-with-toc nil
          org-export-with-section-numbers nil)
    )
</pre>
</div>
</div>
</div>
<div id="outline-container-org1a5b7cd" class="outline-4">
<h4 id="org1a5b7cd">Beamer export</h4>
<div class="outline-text-4" id="text-org1a5b7cd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox-beamer</span>
  <span style="color: #7FBFFF;">:config</span>
  (add-to-list 'org-latex-classes
               '(<span style="color: #7FFF7F;">"my:beamer"</span>
                 <span style="color: #7FFF7F;">"\\documentclass[dvipdfmx,presentation]{beamer}</span>
<span style="color: #7FFF7F;">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
                 (<span style="color: #7FFF7F;">"\\section\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\section*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsection*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsubsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsubsection*\&#123;%s\}"</span>))))
</pre>
</div>
<p>
LATEX<sub>CLASS</sub> に <code>my:beamer</code> を指定すると，上記設定で export される．
</p>
</div>
</div>
<div id="outline-container-org25026ef" class="outline-4">
<h4 id="org25026ef">HTML 出力: <code>ox-html</code></h4>
<div class="outline-text-4" id="text-org25026ef">
<p>
後述の Jekyll 用の設定も参照のこと．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox-html</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-html-use-infojs nil
        org-html-html5-fancy t
        org-export-htmlize-output-type 'inline-css
        org-html-doctype <span style="color: #7FFF7F;">"html5"</span>
        org-html-text-markup-alist
        '((bold           . <span style="color: #7FFF7F;">"&lt;strong&gt;%s&lt;/strong&gt;"</span>)
          (code           . <span style="color: #7FFF7F;">"&lt;code&gt;%s&lt;/code&gt;"</span>)
          (italic         . <span style="color: #7FFF7F;">"&lt;i&gt;%s&lt;/i&gt;"</span>)
          (strike-through . <span style="color: #7FFF7F;">"&lt;del&gt;%s&lt;/del&gt;"</span>)
          (underline      . <span style="color: #7FFF7F;">"&lt;span class=\"underline\"&gt;%s&lt;/span&gt;"</span>)
          (verbatim       . <span style="color: #7FFF7F;">"&lt;code&gt;%s&lt;/code&gt;"</span>)))
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org4abb501" class="outline-3">
<h3 id="org4abb501">Jekyll 用の設定</h3>
<div class="outline-text-3" id="text-org4abb501">
<p>
Web サイトは Jekyll で作成しています．
<a href="https://github.com/yoshinari-nomura/org-octopress">yoshinari-nomura/org-octopress: org-mode in octopress</a> の
<code>ox-jekyll</code> を参考に <del>改造して</del> ，
html export の際に必要な yaml front matter を出力できるようにしてます．
あと，src-block が liquid に解釈されない様に escape してます．
</p>
</div>
<div id="outline-container-org4b19cc5" class="outline-4">
<h4 id="org4b19cc5">Jekyll 用の Backend の定義</h4>
<div class="outline-text-4" id="text-org4b19cc5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-export-define-derived-backend 'jekyll 'html
  <span style="color: #7FBFFF;">:menu-entry</span>
  '(?j <span style="color: #7FFF7F;">"Jekyl: export to html with YAML front matter."</span>
       ((?H <span style="color: #7FFF7F;">"To temporary buffer"</span>
            (<span style="color: #FF7F7F;">lambda</span> (a s v b) (org-jekyll-export-as-html a s v)))
        (?h <span style="color: #7FFF7F;">"To file"</span> (<span style="color: #FF7F7F;">lambda</span> (a s v b) (org-jekyll-export-to-html a s v)))))
  <span style="color: #7FBFFF;">:translate-alist</span>
  '((template  . org-jekyll-template)
    )
  <span style="color: #7FBFFF;">:options-alist</span>
  '((<span style="color: #7FBFFF;">:layout</span>    <span style="color: #7FFF7F;">"LAYOUT"</span> nil <span style="color: #7FFF7F;">"default"</span>)
    (<span style="color: #7FBFFF;">:ref</span>       <span style="color: #7FFF7F;">"REF"</span> nil nil)
    (<span style="color: #7FBFFF;">:permalink</span> <span style="color: #7FFF7F;">"PERMALINK"</span> nil nil)
    )
  <span style="color: #7FBFFF;">:filters-alist</span>
  '((<span style="color: #7FBFFF;">:filter-final-output</span> . org-jekyll-finalized))
  )
<span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">template</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-template</span> (contents info)
  <span style="color: #7FFF7F;">"Return complete document string after HTML conversion."</span>
  (concat (org-jekyll--yaml-front-matter info) contents))
<span style="color: #e5e5e6;">;;; </span><span style="color: #e5e5e6;">&#24190;&#12388;&#12363;&#12398;&#25991;&#23383;&#21015;&#12434;&#32622;&#25563;&#12377;&#12427;</span>
<span style="color: #e5e5e6;">;;  </span><span style="color: #e5e5e6;">- liquid template&#12395;&#35492;&#35469;&#12373;&#12428;&#12427; `</span><span style="color: #FFBF7F;">&#123;%</span><span style="color: #e5e5e6;">', `</span><span style="color: #FFBF7F;">%&#125;</span><span style="color: #e5e5e6;">'</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-finalized</span> (contents _backend info)
  <span style="color: #7FFF7F;">"Publish src-block to html, Escape liquid tags, e.g. &#123;%, %&#125;"</span>
  (<span style="color: #FF7F7F;">with-temp-buffer</span>
    (insert (s-replace <span style="color: #7FFF7F;">"&#123;%"</span> <span style="color: #7FFF7F;">"&amp;#123;%"</span>
                       (s-replace <span style="color: #7FFF7F;">"%&#125;"</span> <span style="color: #7FFF7F;">"%&amp;#125;"</span>
                                             contents)))
    (set-auto-mode t)
    (buffer-substring-no-properties (point-min) (point-max))))
<span style="color: #e5e5e6;">;;</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll--get-option</span> (info property-name <span style="color: #FFFF7F;">&amp;optional</span> default)
  (<span style="color: #FF7F7F;">let</span> ((property (org-export-data (plist-get info property-name) info)))
    (format <span style="color: #7FFF7F;">"%s"</span> (<span style="color: #FF7F7F;">or</span> property default <span style="color: #7FFF7F;">""</span>))))
<span style="color: #e5e5e6;">;;</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll--yaml-front-matter</span> (info)
  (<span style="color: #FF7F7F;">let</span> ((title
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:title</span>))
        (date
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:date</span>))
        (language
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:language</span>))
        (layout
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:layout</span>))
        (jekyll-ref
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:ref</span> ))
        (jekyll-permalink
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:permalink</span> ))
        (convert-to-yaml-list
         (<span style="color: #FF7F7F;">lambda</span> (arg)
           (mapconcat #'(lambda (text)(concat <span style="color: #7FFF7F;">"\n- "</span> text)) (split-string arg) <span style="color: #7FFF7F;">" "</span>))))
    (concat
     <span style="color: #7FFF7F;">"---"</span>
     <span style="color: #7FFF7F;">"\ntitle: "</span>      (s-replace <span style="color: #7FFF7F;">":"</span> <span style="color: #7FFF7F;">"&amp;$58;"</span> title)
     <span style="color: #7FFF7F;">"\ndate: "</span>       date
     <span style="color: #7FFF7F;">"\nlayout: "</span>     layout
     <span style="color: #7FFF7F;">"\nlang: "</span>       language
     (<span style="color: #FF7F7F;">unless</span> (string-equal jekyll-ref <span style="color: #7FFF7F;">""</span>)
       (concat <span style="color: #7FFF7F;">"\nref: "</span> jekyll-ref))
     (<span style="color: #FF7F7F;">unless</span> (string-equal jekyll-permalink <span style="color: #7FFF7F;">""</span>)
       (concat <span style="color: #7FFF7F;">"\npermalink: "</span> jekyll-permalink))
     <span style="color: #7FFF7F;">"\n---\n"</span>)))

(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-export-as-html</span>
    (<span style="color: #FFFF7F;">&amp;optional</span> async subtreep visible-only body-only ext-plist)
  <span style="color: #7FFF7F;">"Export current buffer to a HTML buffer adding some YAML front matter."</span>
  (<span style="color: #FF7F7F;">interactive</span>)
  (org-export-to-buffer 'jekyll <span style="color: #7FFF7F;">"*Org Jekyll HTML Export*"</span>
    async subtreep visible-only body-only ext-plist (<span style="color: #FF7F7F;">lambda</span> () (html-mode))))

(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-export-to-html</span>
    (<span style="color: #FFFF7F;">&amp;optional</span> async subtreep visible-only body-only ext-plist)
  <span style="color: #7FFF7F;">"Export current buffer to a HTML file adding some YAML front matter."</span>
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">let</span> ((outfile (org-export-output-file-name <span style="color: #7FFF7F;">".html"</span> subtreep)))
    (org-export-to-file 'jekyll outfile async subtreep visible-only body-only ext-plist)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfd9d1a4" class="outline-4">
<h4 id="orgfd9d1a4">Project の定義</h4>
<div class="outline-text-4" id="text-orgfd9d1a4">
<p>
<code>org-publish-all</code> 等で batch で一括出力できるようにしておきます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox-publish</span>
  <span style="color: #7FBFFF;">:if</span> (file-directory-p <span style="color: #7FFF7F;">"~/Public/.git"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-publish-to-jekyll</span> (plist filename pub-dir)
    <span style="color: #7FFF7F;">"publishing org to html with Jekyll YAML front matter."</span>
    (org-publish-org-to 'jekyll filename <span style="color: #7FFF7F;">".html"</span> plist pub-dir))
  (<span style="color: #FF7F7F;">setq</span> org-publish-use-timestamps-flag t
        org-publish-timestamp-directory <span style="color: #7FFF7F;">"~/Public/.org-timestamps/"</span>
        org-publish-project-alist
        '((<span style="color: #7FFF7F;">"web"</span>
           <span style="color: #7FBFFF;">:base-directory</span> <span style="color: #7FFF7F;">"~/Public/"</span>
           <span style="color: #7FBFFF;">:base-extension</span> <span style="color: #7FFF7F;">"org"</span>
           <span style="color: #7FBFFF;">:exclude</span> <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">_.*</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>
           <span style="color: #7FBFFF;">:publishing-directory</span> <span style="color: #7FFF7F;">"~/Public/"</span>
           <span style="color: #7FBFFF;">:publishing-function</span> org-publish-to-jekyll
           <span style="color: #7FBFFF;">:recursive</span> t
           <span style="color: #7FBFFF;">:headline-level</span> 2
           )
          ))
  )
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org1119e55" class="outline-2">
<h2 id="org1119e55">Howm</h2>
<div class="outline-text-2" id="text-org1119e55">
<p>
Org を使う前は Howm を使っていました.
過去のメモを検索するためだけに未だに Howm を使っています.
</p>

<p>
Rust で書かれた <a href="https://github.com/BurntSushi/ripgrep">ripgrep</a> がとても速いらしいので， <code>howm</code> と <code>ripgrep</code> がある時だけ
読み込むようにしています．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">howm</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (my:dpkg-status <span style="color: #7FFF7F;">"howm"</span>)
           (executable-find <span style="color: #7FFF7F;">"rg"</span>))
  <span style="color: #7FBFFF;">:diminish</span> howm-mode
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FBFFF;">:map</span> howm-mode-map
              (<span style="color: #7FFF7F;">"C-c C-c"</span>     . nil)
              (<span style="color: #7FFF7F;">"C-x C-z C-c"</span> . howm-save-and-kill-buffer/screen))
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'howm-menu-hook (<span style="color: #FF7F7F;">lambda</span> ()
                              (<span style="color: #FF7F7F;">setq</span> truncate-lines t)))
  <span style="color: #7FBFFF;">:config</span>
  <span style="color: #e5e5e6;">;;; </span><span style="color: #e5e5e6;">&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#35373;&#23450;</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12513;&#12514;&#12398;&#20869;&#23481;&#12399; Dropbox &#12391;&#21516;&#26399;&#12377;&#12427;&#12371;&#12392;&#12395;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-directory <span style="color: #7FFF7F;">"~/Dropbox/org"</span>)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12513;&#12491;&#12517;&#12540;&#12392;&#23653;&#27508;&#12434;&#26908;&#32034;&#23550;&#35937;&#12363;&#12425;&#38500;&#22806;&#12377;&#12427;&#12383;&#12417;&#12395;&#21029;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12408;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-keyword-file <span style="color: #7FFF7F;">"~/Dropbox/.howm/keys"</span>
        howm-history-file <span style="color: #7FFF7F;">"~/Dropbox/.howm/history"</span>
        howm-menu-file <span style="color: #7FFF7F;">"~/Dropbox/.howm/menu"</span>)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12513;&#12514;&#12501;&#12449;&#12452;&#12523;&#12399;&#26085;&#20184;&#26178;&#21051;&#27598;&#12395;&#20998;&#38626;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-file-name-format <span style="color: #7FFF7F;">"%Y%m%d-%H%M%S.howm"</span>)
  <span style="color: #e5e5e6;">;;;  </span><span style="color: #e5e5e6;">&#12513;&#12514;&#12399;org&#12391;&#26360;&#12367;</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">- org-mode &#12398; hook &#12392;&#12375;&#12390; howm-mode &#12434;&#30331;&#37682;</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">- C-c &#12364; org &#12395;&#21462;&#12425;&#12428;&#12427;&#12398;&#12391;, howm &#12398; prefix &#12399; C-xC-z &#12395;</span>
  (add-hook 'org-mode-hook 'howm-mode)
  (global-unset-key (kbd <span style="color: #7FFF7F;">"C-x C-z"</span>))
  (<span style="color: #FF7F7F;">setq</span> howm-prefix (kbd <span style="color: #7FFF7F;">"C-x C-z"</span>))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">title header &#12399; "*"</span>
  (<span style="color: #FF7F7F;">setq</span> howm-view-title-header <span style="color: #7FFF7F;">"*"</span>)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">:config</span>
  (<span style="color: #FF7F7F;">when</span> (locate-library <span style="color: #7FFF7F;">"elscreen-howm"</span>)
    (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">elscreen-howm</span> nil 'noerror))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#33394;&#20184;&#12369;&#12399; org-mode &#20219;&#12379;: howm &#12398; font-lock &#12434;&#28961;&#21177;&#21270;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-use-color nil)
  <span style="color: #e5e5e6;">;;; </span><span style="color: #e5e5e6;">&#20197;&#19979;&#65292;&#27770;&#12414;&#12426;&#25991;&#21477;</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26908;&#32034;&#12391;&#22823;&#25991;&#23383;&#23567;&#25991;&#23383;&#12434;&#21306;&#21029;&#12375;&#12394;&#12356;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-keyword-case-fold-search t)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">grep &#12398; &#20195;&#12431;&#12426;&#12395; rg (ripgrep) &#12434;&#20351;&#12358;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-view-use-grep t
        howm-view-grep-command <span style="color: #7FFF7F;">"rg"</span>
        howm-view-grep-option <span style="color: #7FFF7F;">"-nH --no-heading --color never"</span>
        howm-view-grep-extended-option nil
        howm-view-grep-fixed-option <span style="color: #7FFF7F;">"-F"</span>
        howm-view-grep-expr-option nil
        howm-view-grep-file-stdin-option nil)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26908;&#32034;&#23550;&#35937;&#12398;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#36861;&#21152;...&#12392;&#12426;&#12354;&#12360;&#12378;&#36861;&#21152;&#12375;&#12394;&#12356;&#12371;&#12392;&#12395;&#65294;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-search-other-dir nil)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26908;&#32034;&#23550;&#35937;&#22806;&#12398;&#12501;&#12449;&#12452;&#12523;: ad hoc &#12395;&#12393;&#12435;&#12393;&#12435;&#22679;&#12360;&#12390;&#12356;&#12367;&#12394;&#12353;...</span>
  (<span style="color: #FF7F7F;">setq</span> howm-excluded-file-regexp
        <span style="color: #7FFF7F;">"/\\.#</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">[~#]$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.bak$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">/CVS/</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.doc</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.pdf</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.txt$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.html$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.tex$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.dvi$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.fdb_latexmk$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.ppt$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.xls$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.howm-menu$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">.howm-keys$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.png$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.gif$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.tif$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.tiff$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.jpg$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.jpeg$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.el$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.aux$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.log$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">Makefile</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.txt$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">EUC-UCS2</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.fdb_latexmk$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">latexmkrc</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.gpg$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.org$"</span>)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">org-mode &#12398;&#26085;&#20184;&#26908;&#32034;&#29992;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-reminder-regexp-grep-format
        (concat <span style="color: #7FFF7F;">"&lt;"</span> howm-date-regexp-grep <span style="color: #7FFF7F;">"[ :0-9]*&gt;%s"</span>))
  (<span style="color: #FF7F7F;">setq</span> howm-reminder-regexp-format
        (concat <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">&lt;"</span> howm-date-regexp <span style="color: #7FFF7F;">"[ :0-9]*&gt;</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">%s</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">[0-9]*</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>))
  <span style="color: #e5e5e6;">;;; </span><span style="color: #e5e5e6;">&#34920;&#31034;&#35373;&#23450;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-top nil
        howm-menu-lang 'ja)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#19968;&#35239;&#12395;&#12479;&#12452;&#12488;&#12523;&#34920;&#31034;&#12375;&#12394;&#12356;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-list-title nil)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">save &#26178;&#12395;&#12513;&#12491;&#12517;&#12540;&#12434;&#26356;&#26032;&#12375;&#12394;&#12356;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-refresh-after-save nil)
  (<span style="color: #FF7F7F;">setq</span> howm-refresh-after-save nil)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#26032;&#35215;&#12513;&#12514;&#12434;&#19978;&#12395;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-prepend t)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#20840;&#12513;&#12514;&#19968;&#35239;&#26178;&#12395;&#12479;&#12452;&#12488;&#12523;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-list-all-title t)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12300;&#26368;&#36817;&#12398;&#12513;&#12514;&#12301;&#19968;&#35239;&#26178;&#12395;&#12479;&#12452;&#12488;&#12523;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-list-recent-title t)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12300;&#26368;&#36817;&#12398;&#12513;&#12514;&#12301;&#12398;&#34920;&#31034;&#20214;&#25968;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-recent-num 20)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#12513;&#12491;&#12517;&#12540;&#12434; 2 &#26178;&#38291;&#12461;&#12515;&#12483;&#12471;&#12517;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-expiry-hours 2)
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">RET &#12391;&#12501;&#12449;&#12452;&#12523;&#12434;&#38283;&#12367;&#38555;, &#19968;&#35239;&#12496;&#12483;&#12501;&#12449;&#12434;&#28040;&#12377;. C-u RET &#12394;&#12425;&#27531;&#12427;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-view-summary-persistent nil)
  <span style="color: #e5e5e6;">;;; </span><span style="color: #e5e5e6;">&#12513;&#12491;&#12517;&#12540;&#34920;&#31034;&#29992;&#12398;&#38306;&#25968;&#23450;&#32681;</span>
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#27491;&#35215;&#34920;&#29694;&#12391;&#26908;&#32034;, &#36870;&#38918;,  &#34920;&#31034;&#20214;&#25968;&#12399; =howm-menu-recent-num=, &#12392;&#12356;&#12358; ad hoc &#12394;&#38306;&#25968;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:howm-menu-search</span> (key <span style="color: #FFFF7F;">&amp;optional</span> formatter regexp-p)
    <span style="color: #7FFF7F;">"Embed search result of KEY into menu, reverse-order, howm-menu-recent-num"</span>
    (<span style="color: #FF7F7F;">let</span> ((fixed-p (not regexp-p)))
      (howm-menu-general <span style="color: #7FFF7F;">"menu-search"</span>
                         formatter
                         (howm-first-n
                          (howm-sort-items-by-reverse-date
                           (howm-view-search-folder-items key (howm-folder) nil fixed-p)
                           ) <span style="color: #FF7FBF; font-weight: bold;">howm-menu-recent-num)</span>
                         )))
  (<span style="color: #FF7F7F;">setq</span> howm-menu-allow
        (append '(my:howm-menu-search) howm-menu-allow))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#32232;&#38598;&#12486;&#12531;&#12503;&#12524;&#12540;&#12488;&#12398;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-dtime-format (concat <span style="color: #7FFF7F;">"&lt;"</span> howm-dtime-body-format <span style="color: #7FFF7F;">"&gt;"</span>)
        howm-insert-date-format <span style="color: #7FFF7F;">"&lt;%s&gt;"</span>
        howm-template-date-format <span style="color: #7FFF7F;">"&lt;%Y-%m-%d %a %H:%M:%S&gt;"</span>
        howm-template-file-format <span style="color: #7FFF7F;">"==&gt;%s"</span>
        howm-template <span style="color: #7FFF7F;">"* MEMO %date %cursor\n%file\n"</span>
        howm-reminder-today-format (format howm-insert-date-format howm-date-format))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb708304" class="outline-2">
<h2 id="orgb708304">プログラム環境</h2>
<div class="outline-text-2" id="text-orgb708304">
</div><div id="outline-container-orgfed21fb" class="outline-3">
<h3 id="orgfed21fb">コードのタグ付け: <code>ggtags</code>, <code>helm-gtags</code></h3>
<div class="outline-text-3" id="text-orgfed21fb">
<p>
無いと途方に暮れる．
<del>Debian 版の GNU Global がすったもんだの挙句ようやく更新された!</del>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">helm-gtags</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"gtags"</span>)
  <span style="color: #7FBFFF;">:diminish</span> helm-gtags-mode
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'helm-gtags-mode-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (local-set-key (kbd <span style="color: #7FFF7F;">"M-t"</span>) 'helm-gtags-find-tag)
              (local-set-key (kbd <span style="color: #7FFF7F;">"M-r"</span>) 'helm-gtags-find-rtag)
              (local-set-key (kbd <span style="color: #7FFF7F;">"M-s"</span>) 'helm-gtags-find-symbol)
              (local-set-key (kbd <span style="color: #7FFF7F;">"C-t"</span>) 'helm-gtags-pop-stack)))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> helm-gtags-path-style 'root
        helm-gtags-ignore-case t)
  (add-hook 'c-mode-hook    'helm-gtags-mode)
  (add-hook 'cc-mode-hook   'helm-gtags-mode)
  (add-hook 'f90-mode-hook  'helm-gtags-mode)
  (add-hook 'ruby-mode-hook 'helm-gtags-mode)
  (add-hook 'emacs-lisp-mode-hook 'helm-gtags-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgefbcaa4" class="outline-3">
<h3 id="orgefbcaa4">プロジェクト管理: <a href="https://github.com/bbatsov/projectile">bbatsov/projectile</a></h3>
<div class="outline-text-3" id="text-orgefbcaa4">
<p>
これも無いと途方に暮れる．<a href="https://github.com/bbatsov/helm-projectile">bbatsov/helm-projectile</a> と一緒に使っている.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">projectile</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> projectile-keymap-prefix (kbd <span style="color: #7FFF7F;">"C-c p"</span>)  <span style="color: #e5e5e6;">; </span><span style="color: #e5e5e6;">default</span>
        projectile-enable-caching t
        projectile-cache-file (concat my:d:tmp <span style="color: #7FFF7F;">"projectile.cache"</span>)
        projectile-completion-system 'helm
        projectile-tags-backend 'ggtags
        projectile-mode-line '(<span style="color: #7FBFFF;">:eval</span>
                               (<span style="color: #FF7F7F;">if</span>
                                   (file-remote-p default-directory)
                                   <span style="color: #7FFF7F;">""</span>
                                 (format <span style="color: #7FFF7F;">" [%s]"</span>
                                         (projectile-project-name))))
        projectile-known-projects-file (concat my:d:tmp <span style="color: #7FFF7F;">"projectile-bookmarks.eld"</span>)
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">projectile-globally-ignored-files</span>
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">projectile-globally-ignored-directories</span>
        )
  (projectile-global-mode)
  (helm-projectile-on)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org28430bc" class="outline-3">
<h3 id="org28430bc">VCS: <code>magit</code>, <code>git-gutter</code></h3>
<div class="outline-text-3" id="text-org28430bc">
<p>
magit は Emacs の Git Frontend.
結局の所 CUI でコマンド叩く事も多いけれど，これはこれで重宝している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">magit</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x g"</span> . magit-status))
  )
</pre>
</div>
<p>
git-gutter で差分を視覚的に表示してくれる．
@see <a href="http://qiita.com/syohex/items/a669b35fbbfcdda0cbf2">git-gutter.elの紹介 - Qiita</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">git-gutter</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (locate-library <span style="color: #7FFF7F;">"magit"</span>)
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x p"</span> . git-gutter:previous-hunk)
         (<span style="color: #7FFF7F;">"C-x n"</span> . git-gutter:previous-hunk)
         (<span style="color: #7FFF7F;">"C-x ="</span> . git-gutter:popup-hunk))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> git-gutter:window-width 2
        git-gutter:added-sign <span style="color: #7FFF7F;">"+ "</span>
        git-gutter:deleted-sign-sign <span style="color: #7FFF7F;">"- "</span>
        git-gutter:modified-sign <span style="color: #7FFF7F;">"::"</span>
        git-gutter:unchanged-sign <span style="color: #7FFF7F;">"  "</span>     <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">&#31354;&#30333; 2&#12388;</span>
        git-gutter:always-show-separator nil
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">git-gutter:modified-sign "&#8660;"</span>
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">git-gutter:added-sign "&#8658;"</span>
        <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">git-gutter:deleted-sign "&#8656;"</span>
        git-gutter:lighter <span style="color: #7FFF7F;">""</span>
        )
  (global-git-gutter-mode +1)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbd96de6" class="outline-3">
<h3 id="orgbd96de6">flycheck</h3>
<div class="outline-text-3" id="text-orgbd96de6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">flycheck</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:diminish</span> flycheck-mode
  <span style="color: #7FBFFF;">:init</span>
  <span style="color: #7FBFFF;">:config</span>
  (global-flycheck-mode)
  (<span style="color: #FF7F7F;">setq-default</span> flycheck-disabled-checkers
                '(
                  emacs-lisp-checkdoc
                  ))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">gcc</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:setup-flycheck-gcc-project-path</span> ()
    <span style="color: #7FFF7F;">"gcc: Add projectile root for include path"</span>
    (<span style="color: #FF7F7F;">let</span> ((root (<span style="color: #FF7F7F;">ignore-errors</span> (projectile-project-root))))
      (<span style="color: #FF7F7F;">when</span> root
        (add-to-list
         (make-variable-buffer-local 'flycheck-gcc-include-path)
         root))))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">gfortran</span>
  (add-hook 'c-mode-hook 'my:setup-flycheck-gcc-project-path)
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:setup-flycheck-gfortran-project-path</span> ()
    <span style="color: #7FFF7F;">"gfortran: Add projectile root for include path"</span>
    (<span style="color: #FF7F7F;">let</span> ((root (<span style="color: #FF7F7F;">ignore-errors</span> (projectile-project-root))))
      (<span style="color: #FF7F7F;">when</span> root
        (add-to-list
         (make-variable-buffer-local 'flycheck-gfortran-include-path)
         root))))
  (add-hook 'c-mode-hook 'my:setup-flycheck-gfortran-project-path)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org4bfc6dd" class="outline-3">
<h3 id="org4bfc6dd">rainbow-mode</h3>
<div class="outline-text-3" id="text-org4bfc6dd">
<p>
<code>#RRGGBB</code> のカラーコードに勝手に色が付く．CSS の編集中なんかで地味に便利．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rainbow-mode</span>
  <span style="color: #7FBFFF;">:diminish</span> rainbow-mode
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org81fc99d" class="outline-3">
<h3 id="org81fc99d">Textile</h3>
<div class="outline-text-3" id="text-org81fc99d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">textile-mode</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org73b4fcd" class="outline-3">
<h3 id="org73b4fcd">Markdown</h3>
<div class="outline-text-3" id="text-org73b4fcd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">markdown-mode</span>
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"pandoc"</span>)
  <span style="color: #7FBFFF;">:mode</span> (<span style="color: #7FFF7F;">"\\.</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">md</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">markdown</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">\\'"</span> . gfm-mode)
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'markdown-mode-hook
            '(lambda ()
               (electric-indent-local-mode -1)))
  (add-hook 'gfm-mode-hook
            '(lambda ()
               (electric-indent-local-mode -1)))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> markdown-command
        <span style="color: #7FFF7F;">"pandoc --from markdown_github -t html5 --mathjax --highlight-style pygments"</span>)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org7869f07" class="outline-3">
<h3 id="org7869f07">SCSS</h3>
<div class="outline-text-3" id="text-org7869f07">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">scss-mode</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"sass"</span>)
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"\\.scss\\'"</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> scss-sass-command (executable-find <span style="color: #7FFF7F;">"sass"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org6b5028b" class="outline-3">
<h3 id="org6b5028b">YAML</h3>
<div class="outline-text-3" id="text-org6b5028b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">yaml-mode</span>
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">\.yml</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\.yaml</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org869ad30" class="outline-3">
<h3 id="org869ad30">設定ファイル: <code>generic-x</code></h3>
<div class="outline-text-3" id="text-org869ad30">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">generic-x</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf78ca70" class="outline-3">
<h3 id="orgf78ca70">Ruby</h3>
<div class="outline-text-3" id="text-orgf78ca70">
<p>
素の <code>ruby-mode</code>. <code>Gemfile</code> も ruby-mode で扱う
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ruby-mode</span>
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"\\.rb\\'"</span>
  <span style="color: #7FBFFF;">:interpreter</span> <span style="color: #7FFF7F;">"ruby"</span>
  <span style="color: #7FBFFF;">:init</span>
  (add-to-list 'auto-mode-alist '(<span style="color: #7FFF7F;">"Gemfile$"</span> . ruby-mode)))
</pre>
</div>
<p>
<code>ruby-electric</code>: 括弧や <code>do ... end</code> の補完
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ruby-electric</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'ruby-mode-hook (<span style="color: #FF7F7F;">lambda</span> () (ruby-electric-mode t)))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> ruby-electric-expand-delimiters-list nil))
</pre>
</div>
<p>
<code>ruby-block</code>: <code>do...end</code> の対応をハイライト
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ruby-block</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:diminish</span> ruby-block-mode
  <span style="color: #7FBFFF;">:config</span>
  (ruby-block-mode t)
  (<span style="color: #FF7F7F;">setq</span> ruby-block-highlight-toggle 'overlay)
  )
</pre>
</div>
<p>
<code>rspec-mode</code>:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rspec-mode</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> rspec-use-rake-flag nil))
</pre>
</div>
<p>
<code>rabbit-mode</code>: <a href="http://rabbit-shocker.org/ja/">Rabbit</a> 編集用
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rabbit-mode</span>
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"\\.rab$"</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org36fe2e4" class="outline-3">
<h3 id="org36fe2e4">C</h3>
<div class="outline-text-3" id="text-org36fe2e4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">cc-mode</span>
  <span style="color: #7FBFFF;">:init</span>
  (c-add-style <span style="color: #7FFF7F;">"my:bsd-like"</span>
               '(<span style="color: #7FFF7F;">"bsd"</span>
                 (c-basic-offset . 2)
                 (c-hanging-braces-alist . ((inline-open       before after)
                                            (block-open        before after)
                                            (substatement-open before after)))
                 (c-offsets-alist . ((brace-list-entry . +)))
                 ))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq-default</span> c-default-style <span style="color: #7FFF7F;">"my:bsd-like"</span>)
  (add-hook 'c-mode-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (c-set-style <span style="color: #7FFF7F;">"my:bsd-like"</span>)
              (electric-indent-local-mode -1)
              (set (make-local-variable 'eldoc-idle-delay) 0.20)
              (c-turn-on-eldoc-mode)
              ))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbaf5813" class="outline-3">
<h3 id="orgbaf5813">Fortran</h3>
<div class="outline-text-3" id="text-orgbaf5813">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">f90</span>
  <span style="color: #7FBFFF;">:mode</span> (<span style="color: #7FFF7F;">"\\.</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">f|F</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">90|95|03|08</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">$"</span> . f90-mode)
  <span style="color: #7FBFFF;">:config</span>
  (add-hook 'f90-mode-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (<span style="color: #FF7F7F;">setq</span> f90-do-indent 2
                    f90-if-indent 2
                    f90-type-indent 2
                    f90-program-indent 2
                    f90-continuation-indent 2
                    f90-directive-comment-re <span style="color: #7FFF7F;">"!omp\\$"</span>
                    f90-indented-comment-re <span style="color: #7FFF7F;">"!"</span>
                    f90-break-delimiters <span style="color: #7FFF7F;">"[-+\\*/&gt;&lt;=,% \t]"</span>
                    f90-break-before-delimiters t
                    f90-beginning-ampersand nil
                    f90-smart-end 'blink
                    f90-auto-keyword-case nil
                    f90-leave-line-no nil
                    f90-comment-region <span style="color: #7FFF7F;">"!! "</span>
                    f90-indent-comment <span style="color: #7FFF7F;">"! "</span>
                    indent-tabs-mode nil
                    f90-font-lock-keywords f90-font-lock-keywords-2)
              (ggtags-mode 1)))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org8df82b0" class="outline-3">
<h3 id="org8df82b0">AUCTeX</h3>
<div class="outline-text-3" id="text-org8df82b0">
<p>
Debian パッケージ版を使う．やっている事は
</p>
<ul class="org-ul">
<li><code>japanese-latex-mode</code> において, 幾つかのコマンドが追加/上書きされているが，
あまり使うことの無いコマンドが表示されるのが嫌なのでそれらを削除．</li>
<li><p>
<a href="https://github.com/tom-tan/auctex-latexmk/">auctex-latexmk</a> を参考に
file encoding を取得する関数と latexmk の実行用関数をカスタマイズ
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">tex-jp</span>
  <span style="color: #7FBFFF;">:if</span> (my:dpkg-status <span style="color: #7FFF7F;">"auctex"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">dolist</span> (command '(<span style="color: #7FFF7F;">"pTeX"</span> <span style="color: #7FFF7F;">"pLaTeX"</span> <span style="color: #7FFF7F;">"pBibTeX"</span> <span style="color: #7FFF7F;">"jTeX"</span> <span style="color: #7FFF7F;">"jLaTeX"</span> <span style="color: #7FFF7F;">"jBibTeX"</span>))
    (delq (assoc command TeX-command-list) TeX-command-list))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">@see </span><span style="text-decoration: underline;">https://github.com/tom-tan/auctex-latexmk/auctex-latexmk.el</span>
  (<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:auctex-latexmk-encoding-alist</span>
    '((japanese-iso-8bit      . <span style="color: #7FFF7F;">"euc"</span>)
      (japanese-iso-8bit-unix . <span style="color: #7FFF7F;">"euc"</span>)
      (euc-jp                 . <span style="color: #7FFF7F;">"euc"</span>)
      (euc-jp-unix            . <span style="color: #7FFF7F;">"euc"</span>)
      (utf-8                  . <span style="color: #7FFF7F;">"utf8"</span>)
      (utf-8-unix             . <span style="color: #7FFF7F;">"utf8"</span>)
      (japanese-shift-jis     . <span style="color: #7FFF7F;">"sjis"</span>)
      (japanese-shift-jis-dos . <span style="color: #7FFF7F;">"sjis"</span>))
    <span style="color: #7FFF7F;">"Encoding mapping for platex."</span>)
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:TeX-run-latexmk</span> ()
    <span style="color: #7FFF7F;">"Guess TeX file encoding and Excecute latexmk"</span>
    (<span style="color: #FF7F7F;">let</span> ((TeX-sentinel-default-function 'Latexmk-sentinel)
          (pair (assq buffer-file-coding-system my:auctex-latexmk-encoding-alist)))
      (<span style="color: #FF7F7F;">unless</span> (null pair)
        (setenv <span style="color: #7FFF7F;">"LATEXENC"</span> (cdr pair)))
      (TeX-run-TeX name command file)
      (setenv <span style="color: #7FFF7F;">"LATEXENC"</span> nil)))
  <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">customize latexmk command</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:latexmk-setup</span> ()
    <span style="color: #7FFF7F;">"Add LatexMk command to TeX-command-list."</span>
    (delq (assoc <span style="color: #7FFF7F;">"LaTeX"</span> TeX-command-list) TeX-command-list)
    (add-to-list 'TeX-command-list
                 '(<span style="color: #7FFF7F;">"LaTeX"</span> <span style="color: #7FFF7F;">"latexmk -gg -pdfdvi %t"</span> my:TeX-run-latexmk nil
                   (plain-tex-mode latex-mode doctex-mode)
                   <span style="color: #7FBFFF;">:help</span> <span style="color: #7FFF7F;">"Run LatexMk, with epLaTeX, dvipdfmx"</span>))
    (add-to-list 'TeX-command-list
                 '(<span style="color: #7FFF7F;">"LaTeXMk"</span> <span style="color: #7FFF7F;">"latexmk %t"</span> my:TeX-run-latexmk nil
                   (plain-tex-mode latex-mode doctex-mode)
                   <span style="color: #7FBFFF;">:help</span> <span style="color: #7FFF7F;">"Run LatexMk without any options"</span>))
    (add-to-list 'TeX-command-list
                 '(<span style="color: #7FFF7F;">"LaTeXMk(ps2pdfwr)"</span> <span style="color: #7FFF7F;">"latexmk -gg -pdfps %t"</span> my:TeX-run-latexmk nil
                   (plain-tex-mode latex-mode doctex-mode)
                   <span style="color: #7FBFFF;">:help</span> <span style="color: #7FFF7F;">"Run LatexMk, with (e)pLaTeX, dvips, ps2pdfwr"</span>))
    (<span style="color: #FF7F7F;">setq</span> LaTeX-clean-intermediate-suffixes
          (append
           '(<span style="color: #7FFF7F;">"\\.nav"</span> <span style="color: #7FFF7F;">"\\.snm"</span> <span style="color: #7FFF7F;">"\\.fdb_latexmk"</span> <span style="color: #7FFF7F;">"\\.aux.bak"</span> <span style="color: #7FFF7F;">"\\.synctex.gz"</span>)
           LaTeX-clean-intermediate-suffixes))
    (<span style="color: #FF7F7F;">setq</span> TeX-command-output-list
          '((<span style="color: #7FFF7F;">"latexmk"</span> (<span style="color: #7FFF7F;">"pdf"</span>)))))
  (add-hook 'LaTeX-mode-hook 'my:latexmk-setup)
  )
</pre>
</div></li>
</ul>
<p>
<code>~/.latexmkrc</code> の設定は以下の通り．
</p>
<div class="org-src-container">
<pre class="src src-perl">      <span style="color: #e5e5e6;">#!/usr/bin/env perl</span>
      $<span style="color: #7F7FFF;">kanji</span>  = defined $<span style="color: #7F7FFF;">ENV</span>{<span style="color: #7FFF7F;">"LATEXENC"</span>} ? <span style="color: #7FFF7F;">"-kanji=$ENV{\"LATEXENC\"}"</span> : <span style="color: #7FFF7F;">"-kanjii=utf8"</span> ;
      $<span style="color: #7F7FFF;">latex</span>  = <span style="color: #7FFF7F;">"platex -interaction=nonstopmode -src-specials -shell-escape --synctex=1 $kanji"</span>;
      $<span style="color: #7F7FFF;">latex_silent</span> = <span style="color: #7FFF7F;">"platex -interaction=batchmode -src-specials -shell-escape --synctex=1 $kanji"</span>;
      $<span style="color: #7F7FFF;">bibtex</span> = <span style="color: #7FFF7F;">"pbibtex $kanji"</span>;
      $<span style="color: #7F7FFF;">makeindex</span> = <span style="color: #7FFF7F;">"touch -m %D"</span>;
      $<span style="color: #7F7FFF;">dvipdf</span> = <span style="color: #7FFF7F;">"dvipdfmx %O -o %D %S"</span>;
      $<span style="color: #7F7FFF;">dvips</span> = <span style="color: #7FFF7F;">'dvips %O -z -f %S | convbkmk -u &gt; %D'</span>;
      $<span style="color: #7F7FFF;">ps2pdf</span> = <span style="color: #7FFF7F;">'ps2pdfwr %O %S %D'</span>;
      $<span style="color: #7F7FFF;">pdf_mode</span> = 3;
      $<span style="color: #7F7FFF;">pdf_previewer</span> = <span style="color: #7FFF7F;">'start xdg-open'</span>;
      $<span style="color: #7F7FFF;">pdf_update_method</span> = 0;
      $<span style="color: #7F7FFF;">clean_ext</span> = <span style="color: #7FFF7F;">"snm nav vrb synctex.gz"</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org7162da7" class="outline-3">
<h3 id="org7162da7">AUCTeX と Zotero との連携</h3>
<div class="outline-text-3" id="text-org7162da7">
<p>
イマイチ使いこなせてないけれど．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">zotelo</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (my:dpkg-status <span style="color: #7FFF7F;">"zotelo"</span>)
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'LaTeX-mode-hook 'zotelo-minor-mode)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> zotelo-translator-charsets '((BibTeX . <span style="color: #7FFF7F;">"Unicode"</span>)
                                     (Default . <span style="color: #7FFF7F;">"Unicode"</span>)))
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org81cfc7d" class="outline-2">
<h2 id="org81cfc7d">フォントと色</h2>
<div class="outline-text-2" id="text-org81cfc7d">
<p>
そろそろテーマにした方が良い，とは思ってはいる．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:load-window-config</span> ()
  <span style="color: #7FFF7F;">"load window-system specific settings"</span>
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">when</span> window-system
    (<span style="color: #FF7F7F;">progn</span>
      (add-to-list 'default-frame-alist '(font . <span style="color: #7FFF7F;">"Monospace-12"</span>))
      (set-background-color <span style="color: #7FFF7F;">"#242424"</span>)
      (set-face-attribute 'default t <span style="color: #7FBFFF;">:font</span> <span style="color: #7FFF7F;">"Monospace"</span> <span style="color: #7FBFFF;">:height</span> 135)
      (set-frame-font <span style="color: #7FFF7F;">"Monospace-13.5"</span> nil t)
      )))
(<span style="color: #FF7F7F;">setq</span> frame-background-mode (frame-parameter nil 'background-mode))
(<span style="color: #FF7F7F;">setq</span> default-frame-alist
      '(
        (foreground-color . <span style="color: #7FFF7F;">"#F6F3E8"</span>)
        (scroll-bar-foreground-color . <span style="color: #7FFF7F;">"red"</span>)
        (vertical-scroll-bars . right)
        ))
(<span style="color: #FF7F7F;">when</span> (window-system)
  (my:load-window-config))
</pre>
</div>
<p>
現在修正中．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(custom-set-faces
 '(default                             ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> ))))
 <span style="color: #e5e5e6;">;;</span>
 '(cursor                              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> ))))
 '(font-lock-builtin-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FBFFF"</span> ))))
 '(font-lock-comment-delimiter-face    ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#e5e5e6"</span> ))))
 '(font-lock-comment-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#e5e5e6"</span> ))))
 '(font-lock-constant-face             ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFBF7F"</span> ))))
 '(font-lock-doc-face                  ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span> ))))
 '(font-lock-doc-string-face           ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span> ))))
 '(font-lock-function-name-face        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#BF7FFF"</span>))))
 '(font-lock-keyword-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7F7F"</span>))))
 '(font-lock-link-face                 ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span> ))))
 '(font-lock-negation-char-face        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span> <span style="color: #7FBFFF;">:bold</span> t   <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-preprocessor-face         ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-regexp-grouping-backslash ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#A5EE4C"</span> <span style="color: #7FBFFF;">:bold</span> t   <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-regexp-grouping-construct ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> <span style="color: #7FBFFF;">:bold</span> t   <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-string-face               ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span> ))))
 '(font-lock-type-face                 ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF7F"</span> ))))
 '(font-lock-variable-name-face        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> ))))
 '(font-lock-warning-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7FBF"</span> <span style="color: #7FBFFF;">:bold</span> t ))))
 '(fringe                              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#666666"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#282828"</span> ))))
 '(hl-line                             ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#4C4C4C"</span> ))))
 '(highlight                           ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#4C4C4C"</span> ))))
 '(minibuffer-prompt                   ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#BF7FFF"</span> ))))
 '(mode-line                           ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> ))))
 '(mode-line-inactive                  ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#666666"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#999999"</span> <span style="color: #7FBFFF;">:bold</span> nil ))))
 '(region                              ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">custom-set-faces was added by Custom.</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">If you edit it by hand, you could mess it up, so be careful.</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">Your init file should contain only one such instance.</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">If there is more than one, they won't work right.</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(fixed-pitch ((t (:family "Ricty" ))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(variable-pitch ((t (:family "Ricty" ))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(fixed-pitch ((t (:family "Monospace" :height 135 ))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(variable-pitch ((t (:family "Monospace" :height 135 ))))</span>
 <span style="color: #e5e5e6;">;;</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">elscreen</span>
 '(elscreen-tab-control-face        ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#f6f3e8"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> t ))))
 '(elscreen-tab-current-screen-face ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#f6f3e8"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> t ))))
 '(elscreen-tab-other-screen-face   ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> nil ))))
 '(elscreen-tab-background-face     ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> nil ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">dired</span>
 '(dired-directory                  ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(dired-flagged</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(dired-header</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(dired-ignored</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(dired-mark</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(dired-marked</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(dired-perm-write</span>
 '(dired-symlink                    ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span> ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(dired-warning</span>
 '(flx-highlight-face               ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:undeline</span> t))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">git-gutter</span>
 '(git-gutter:added                  ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span>))))
 '(git-gutter:deleted                ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7FBF"</span>))))
 '(git-gutter:modified               ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF4C"</span>))))
 '(git-gutter:unchanged              ((t (<span style="color: #7FBFFF;">:inherit</span> default ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">helm: header-line</span>
 '(helm-source-header               ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#224488"</span> <span style="color: #7FBFFF;">:bold</span> t))))
 '(helm-visible-mark                ((t (<span style="color: #7FBFFF;">:inherit</span> highlight ))))
 '(helm-selection                   ((t (<span style="color: #7FBFFF;">:inherit</span> highlight ))))
 '(helm-selection-line              ((t (<span style="color: #7FBFFF;">:inherit</span> highlight ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">helm: directory</span>
 '(helm-ff-directory                ((t (<span style="color: #7FBFFF;">:inherit</span> dired-directory ))))
 '(helm-bookmark-directory          ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-directory ))))
 '(helm-buffer-directory            ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-directory ))))
 '(helm-ff-dotted-directory         ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-directory ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">helm: file</span>
 '(helm-ff-file                     ((t (<span style="color: #7FBFFF;">:inherit</span> default ))))
 '(helm-bookmark-file               ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-file ))))
 '(helm-buffer-file                 ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-file ))))
 '(helm-grep-file                   ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-file ))))
 '(helm-etags-file                  ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-file ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">helm: file + executable</span>
 '(helm-ff-executable               ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-file <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span> <span style="color: #7FBFFF;">:bold</span> t))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">helm: symlink</span>
 '(helm-ff-symlink                  ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span> <span style="color: #7FBFFF;">:bold</span> t))))
 '(helm-ff-dotted-symlink-directory ((t (<span style="color: #7FBFFF;">:inherit</span> helm-ff-symlink ))))
 '(helm-ff-invalid-symlink          ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7F7F"</span> ))))
 <span style="color: #e5e5e6;">;;; </span><span style="color: #e5e5e6;">howm</span>
 '(howm-mode-keyword-face            ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-mode-title-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFFFF"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-deadline-face       ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-late-deadline-face  ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF0000"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-today-face          ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFBF7F"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-tomorrow-face       ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7FBF"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ido</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(ido-first-match     ((t (:inherit default ))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(ido-only-match      ((t (:foreground "#FFFF4C" ))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(ido-subdir          ((t (:foreground "#7F7FFF" :bold t))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(ido-grid-mode-match ((t (:inherit ido-first-match ))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ido-grid-mode-common-match</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ido-grid-mode-jump-face</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ido-incomplete-regexp</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ido-indicator</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">ido-virtual</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">outline</span>
 '(outline-1 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-function-name-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-2 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-string-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-3 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-keyword-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-4 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-type-face <span style="color: #7FBFFF;">:bold</span> t ))))
 '(outline-5 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-constant-face <span style="color: #7FBFFF;">:bold</span> t ))))
 '(outline-6 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-variable-name-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-7 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-builtin-face <span style="color: #7FBFFF;">:bold</span> t ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(outline-8 ((t (:inherit font-lock-comment-face :bold t ))))</span>
 <span style="color: #e5e5e6;">;;</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">org</span>
 '(org-agenda-date-today           ((t (<span style="color: #7FBFFF;">:underline</span> t ))))
 '(org-agenda-date                 ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFFFF"</span> ))))
 '(org-agenda-date-weekend         ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7F7F"</span> <span style="color: #7FBFFF;">:bold</span> t))))
 '(org-agenda-calendar-event       ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> ))))
 '(org-hide                        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4C4C4C"</span> ))))
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">review</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(review-mode-header1-face  ((t (:inherit outline-1))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(review-mode-header2-face  ((t (:inherit outline-2))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(review-mode-header3-face  ((t (:inherit outline-3))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(review-mode-header4-face  ((t (:inherit outline-4))))</span>
 <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">'(review-mode-header5-face  ((t (:inherit outline-5))))</span>
 )
</pre>
</div>
</div>
</div>
<div id="outline-container-orged7a158" class="outline-2">
<h2 id="orged7a158"><code>diminish</code>: モードラインの短縮表示</h2>
<div class="outline-text-2" id="text-orged7a158">
<p>
<code>use-package</code> で読み込まれているので，可能な限りそちらで指定するように変更．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defmacro</span> <span style="color: #BF7FFF;">my:diminish</span> (file mode <span style="color: #FFFF7F;">&amp;optional</span> new-name)
  <span style="color: #7FFF7F;">"original: </span><span style="text-decoration: underline;">https://github.com/larstvei/dot-emacs/blob/master/init.org</span><span style="color: #7FFF7F;">"</span>
  `(<span style="color: #FF7F7F;">with-eval-after-load</span> ,file
     (diminish ,mode ,new-name)))
(<span style="color: #FF7F7F;">my:diminish</span> <span style="color: #7FFF7F;">"isearch"</span>          'isearch-mode)
(<span style="color: #FF7F7F;">setq</span> auto-revert-mode-text <span style="color: #7FFF7F;">""</span>)
</pre>
</div>
<p>
メジャーモードは <code>hook</code> で設定.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-lisp-mode-hook '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">"El"</span>)))
(add-hook 'lisp-interaction-mode-hook '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">"Li"</span>)))
(add-hook 'wl-folder-mode-hook  '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
(add-hook 'wl-summary-mode-hook '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
(add-hook 'wl-draft-mode-hook   '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
(add-hook 'mime-view-mode-hook  '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3a38ed3" class="outline-2">
<h2 id="org3a38ed3"><code>powerline</code>: モードラインを綺麗に</h2>
<div class="outline-text-2" id="text-org3a38ed3">
<p>
<a href="https://github.com/milkypostman/powerline">milkypostman/powerline: emacs powerline</a> で modeline を良い感じに表示する．
</p>

<p>
SKK の状態がヒョコヒョコ動くのが嫌なので，
<code>skk-modeline-input-mode</code> に常に現在の状況を表示する様にしておく．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:skk-modeline-input-mode</span> ()
  <span style="color: #7FFF7F;">"skk &#12364;&#35501;&#12415;&#36796;&#12414;&#12428;&#12390;&#12356;&#12394;&#12356;&#22580;&#21512;&#12391;&#12418; skk-modeline-input-mode &#12395;&#25991;&#23383;&#12434;&#20837;&#12428;&#12390;&#36820;&#12377;"</span>
  (<span style="color: #FF7F7F;">unless</span> (boundp 'skk-modeline-inpt-mode)
    (<span style="color: #FF7F7F;">setq</span> skk-modeline-input-mode <span style="color: #7FFF7F;">"--[--]:"</span>)))
(my:skk-modeline-input-mode)
</pre>
</div>
<p>
ddskk そのものに modeline を更新する関数があるので無効化する
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">skk-setup-modeline</span> (around my:disable-skk-setup-modeline activate)
  <span style="color: #7FFF7F;">"skk-setup-modeline &#12395;&#12424;&#12427; modeline &#12398;&#26356;&#26032;&#12434;&#28961;&#21177;&#21270;"</span>
  (<span style="color: #FF7F7F;">setq</span> skk-indicator-alist (skk-make-indicator-alist))
  (force-mode-line-update t))
</pre>
</div>
<p>
powerline 本体の設定．default-theme をベースに見たい物だけ表示するようにしてみた．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">powerline</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">when</span> (eq system-type 'darwin)
    (<span style="color: #FF7F7F;">setq</span> powerline-default-separator 'utf-8
          powerline-utf-8-separator-left  #x20
          powerline-utf-8-separator-right #x20))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:powerline-theme</span> ()
    <span style="color: #7FFF7F;">"Setup customize theme."</span>
    (<span style="color: #FF7F7F;">interactive</span>)
    (my:skk-modeline-input-mode)
    (<span style="color: #FF7F7F;">setq-default</span>
     mode-line-format
     '(<span style="color: #7FFF7F;">"%e"</span>
       (<span style="color: #7FBFFF;">:eval</span>
        (<span style="color: #FF7F7F;">let*</span> ((active (powerline-selected-window-active))
               (mode-line-buffer-id (<span style="color: #FF7F7F;">if</span> active 'mode-line-buffer-id 'mode-line-buffer-id-inactive))
               (mode-line (<span style="color: #FF7F7F;">if</span> active 'mode-line 'mode-line-inactive))
               (face1 (<span style="color: #FF7F7F;">if</span> active 'powerline-active1 'powerline-inactive1))
               (face2 (<span style="color: #FF7F7F;">if</span> active 'powerline-active2 'powerline-inactive2))
               (separator-left (intern (format <span style="color: #7FFF7F;">"powerline-%s-%s"</span>
                                               (powerline-current-separator)
                                               (car powerline-default-separator-dir))))
               (separator-right (intern (format <span style="color: #7FFF7F;">"powerline-%s-%s"</span>
                                                (powerline-current-separator)
                                                (cdr powerline-default-separator-dir))))
               (lhs (list
                     (powerline-raw (substring skk-modeline-input-mode 2 -1) nil 'l)
                     (powerline-raw <span style="color: #7FFF7F;">"%*"</span> mode-line 'l)
                     (powerline-raw mode-line-mule-info mode-line 'l)
                     (powerline-buffer-id mode-line-buffer-id 'l)
                     <span style="color: #e5e5e6;">;; </span><span style="color: #e5e5e6;">(when (and (boundp 'which-func-mode) which-func-mode)</span>
                     <span style="color: #e5e5e6;">;;   </span><span style="color: #e5e5e6;">(powerline-raw which-func-format nil 'l))</span>
                     (powerline-raw <span style="color: #7FFF7F;">" "</span>)
                     (funcall separator-left mode-line face1)
                     (powerline-major-mode face1 'l)
                     (powerline-process face1)
                     (powerline-narrow face1 'l)
                     (powerline-raw <span style="color: #7FFF7F;">" "</span> face1)
                     (funcall separator-left face1 face2)
                     (powerline-vc face2 'r)
                     ))
               (rhs (list
                     (powerline-raw global-mode-string face2 'r)
                     (funcall separator-right face2 face1)
                     (powerline-raw <span style="color: #7FFF7F;">" "</span> face1)
                     (powerline-minor-modes face1 'r)
                     (funcall separator-right face1 mode-line)
                     (powerline-raw <span style="color: #7FFF7F;">" "</span>)
                     (powerline-raw <span style="color: #7FFF7F;">"%6p"</span> mode-line 'r)
                     ))
               )
          (concat (powerline-render lhs)
                  (powerline-fill face2 (powerline-width rhs))
                  (powerline-render rhs)))))))
  (my:powerline-theme)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org5a2f839" class="outline-2">
<h2 id="org5a2f839">起動時間の計測</h2>
<div class="outline-text-2" id="text-org5a2f839">
<p>
<a href="http://memo.sugyan.com/entry/20120120/1327037494">起動時間を計測する 改訂版 - すぎゃーんメモ</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'after-init-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (message <span style="color: #7FFF7F;">"init time: %.3f sec"</span>
                     (float-time (time-subtract after-init-time before-init-time)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org7abbc70" class="outline-2">
<h2 id="org7abbc70">LICENSE</h2>
<div class="outline-text-2" id="text-org7abbc70">
<p>
幾つかの関数の元ネタとして Emacs 本体のコードを参照したので，GPL-3 or later です．
</p>
<pre class="example">
Copyright (C) 2011--2017 Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;
.
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
.
This package is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.
You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.
</pre>
</div>
</div>
