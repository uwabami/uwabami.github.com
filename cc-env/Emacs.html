---
title: Emacs の設定
date: 2017-07-20 02:27:43
layout: cc-env
lang: ja
ref: cc-env/Emacs
permalink: /cc-env/Emacs.html
---
<div id="toc-wrapper">
<nav id="table-of-contents">
<h2>&#30446;&#27425;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb974032">はじめに</a>
<ul>
<li><a href="#org37133a6">Emacs のパッケージ(<code>package.el</code>)と quelpa, use-package を使う</a></li>
<li><a href="#orgefbaeb2">Debian パッケージがインストールされているならば，それを優先する</a></li>
<li><a href="#org4cebe45">設定は Org mode で書きたい</a></li>
</ul>
</li>
<li><a href="#orgceb440f">ディレクトリ構成</a></li>
<li><a href="#org30f311a">Package 関連: <code>package.el</code>, use-package, quelpa</a>
<ul>
<li><a href="#orgc17de8e"><code>package.el</code></a></li>
<li><a href="#orgb3153c9">use-package</a></li>
<li><a href="#org9121293">quelpa</a></li>
</ul>
</li>
<li><a href="#orgb08f4b8">独自関数</a>
<ul>
<li><a href="#orgc580dc1">カーソルのある位置の face を調べる関数</a></li>
<li><a href="#org967348d">機能を無効化するための関数の定義</a></li>
<li><a href="#org0e9e81d">dpkg-status</a></li>
</ul>
</li>
<li><a href="#org9400654">常に <code>cl-lib</code> を読み込む</a></li>
<li><a href="#orga1cffc7">後方互換性: <code>el-x</code></a></li>
<li><a href="#org22fa324">url-retrieve の置換: <code>mb-url</code></a></li>
<li><a href="#org8ee2cab">環境変数の読み込み: <code>exec-path-from-shell</code></a></li>
<li><a href="#orgbca86c9">言語の設定</a>
<ul>
<li><a href="#org65f7f9b">cp5022x.el</a></li>
<li><a href="#orgcc07fb8">East Asian Ambiguos 対応</a></li>
<li><a href="#orgc007c34">OSの違いに起因する条件分岐</a></li>
</ul>
</li>
<li><a href="#org43697ff">主にEmacs本体に同梱されている拡張に関する設定</a>
<ul>
<li><a href="#orgae3d8c8">標準機能の設定</a>
<ul>
<li><a href="#org1b6b59a">表示関連</a></li>
<li><a href="#orgeaa9f99">編集関連</a></li>
<li><a href="#org7eda492">ファイル，デイレクトリ整理</a></li>
</ul>
</li>
<li><a href="#org4642e32"><code>.elc</code> と <code>.el</code> の timestamp を比較し，新しい方を読み込む</a></li>
<li><a href="#org493fd75">ガベージコレクションの頻度を下げる</a></li>
<li><a href="#org65a8528">scratch を殺さない. 消したら再生成</a></li>
<li><a href="#orgf32ac0d">空になったファイルを尋ねずに自動削除</a></li>
<li><a href="#org83033dd"><code>abbrev</code>: 略語展開</a></li>
<li><a href="#org5ffdaa9"><code>eldoc</code>: emacs-lisp document</a></li>
<li><a href="#orgc7bb37c"><code>midnight</code>: 一定期間使用しなかった buffer を自動削除</a></li>
<li><a href="#org71c9c07"><code>uniquify</code>: モードラインのファイル名にディレクトリも表示する</a></li>
<li><a href="#org47b60d9"><code>whitespace</code>: 空白の強調表示</a></li>
<li><a href="#orgc074ac4"><code>saveplace</code>: 前回の修正位置を記憶する.</a></li>
<li><a href="#orgd885246"><code>time-stamp</code>: 保存時に timestamp を自動更新</a></li>
<li><a href="#org07a421d"><code>tramp</code>: ssh 越しにファイルを編集</a></li>
<li><a href="#orgf73514f"><code>bookmark</code>: bookmark ファイル</a></li>
<li><a href="#org4ddc61b"><code>eww</code>: 内蔵ブラウザ <code>[0/1]</code></a></li>
<li><a href="#org10aa1c4"><code>browse-url</code></a></li>
<li><a href="#org0c00ceb"><code>server</code>: Emacs server</a></li>
</ul>
</li>
<li><a href="#org3bd8022">日本語入力: <code>ddskk</code></a>
<ul>
<li><a href="#org75e1d99">Emacs 本体側の設定</a></li>
<li><a href="#orge62a055">DDSKK 本体の設定</a>
<ul>
<li><a href="#org1eba988">編集関連</a></li>
<li><a href="#org67f5019">インクリメンタルサーチ</a></li>
<li><a href="#org6d86eb6">辞書の設定</a></li>
<li><a href="#org199b263">動的補完</a></li>
<li><a href="#org8d9034a">部首変換, 総画数変換</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb61010b">Copy &amp; Paste: <code>xclip</code></a></li>
<li><a href="#org4d685e8">Elscreen <code>[/]</code></a></li>
<li><a href="#org4f17dc6">認証関連: <code>password-store</code></a>
<ul>
<li><a href="#orgccb2a7d">id-manager の設定</a></li>
<li><a href="#org1093679">plstore</a></li>
<li><a href="#org7177536">oauth2</a></li>
<li><a href="#org60f38ee">password-store</a></li>
</ul>
</li>
<li><a href="#org4ea74a5">MUA の設定: <code>wanderlust</code></a>
<ul>
<li><a href="#org4d49572">Emacs 本体側の設定</a></li>
<li><a href="#org711a3af">Wanderlust 本体の設定</a>
<ul>
<li><a href="#orgda20e29">依存/追加ライブラリのインストールと読み込み</a>
<ul>
<li><a href="#org0441655">rail</a></li>
<li><a href="#orgbd36a3c">cp5022x を使う</a></li>
<li><a href="#org388d928">gcontacts-get-wl</a></li>
<li><a href="#org9e105e7">elscreen-wl</a></li>
<li><a href="#org90753bd">SEMI の追加設定</a></li>
</ul>
</li>
<li><a href="#orgab249b4">個人情報の設定</a>
<ul>
<li><a href="#orgf57a738">自身のメールアドレスと購読メーリングリストの設定</a></li>
<li><a href="#orgef751cd">送受信用サーバの設定</a></li>
<li><a href="#org51a6de2">From に応じて送信サーバをきりかえる.</a></li>
</ul>
</li>
<li><a href="#orge28f739">基本設定</a>
<ul>
<li><a href="#org3228f00">imap 関連</a></li>
<li><a href="#org123ba63">非同期チェック</a></li>
<li><a href="#org078d130">フォルダの位置の default からの変更</a></li>
<li><a href="#orgcee53ef">フォルダ編集時に backup を作成しない.</a></li>
<li><a href="#org7b7a37a">FCC, BCC の設定</a></li>
<li><a href="#orga22a6fd">起動時に <code>%INBOX</code> のみをチェック</a></li>
<li><a href="#org28e3e62">フォルダ選択時の初期設定</a></li>
<li><a href="#orgcfc2fce">confirm 関連の設定</a></li>
<li><a href="#orga7145b3">misc.</a></li>
<li><a href="#org5163fd5">dispose, delete の設定</a></li>
<li><a href="#orgb212748">折り返しの設定</a></li>
<li><a href="#org37c68b3">mode-line の設定</a></li>
</ul>
</li>
<li><a href="#org94d465c">キーバインド関連</a></li>
<li><a href="#org7765fba">flag とフォルダを行き来する関数の追加</a></li>
<li><a href="#org484fdc9">summary-mode の表示のカスタマイズ</a>
<ul>
<li><a href="#org35e24c6">自分が差出人である mail は To:某 と表示</a></li>
<li><a href="#orgfd131ab">サマリ行の表示関連</a></li>
<li><a href="#org7027834">Gmail 風に, 自分宛のメールに "&gt;" をつけて表示する</a></li>
<li><a href="#org821d424">添付ファイルがあったら, サマリ行に "@" を付ける</a></li>
<li><a href="#org2ec85f6">クォートされた文字列もデコードする</a></li>
<li><a href="#orgbff765a">Subject が変わってもスレッドを切らない</a></li>
<li><a href="#orgb06f7ba">Subject での Tab や複数スペースを無視</a></li>
<li><a href="#orgd7f6133">重複メッセージを非表示に</a></li>
<li><a href="#orgdc713a3">sort 順: 返信が来た順</a></li>
</ul>
</li>
<li><a href="#org039be84">振り分け設定</a>
<ul>
<li><a href="#orgafb5225">振り分け判定に使用するヘッダ</a></li>
</ul>
</li>
<li><a href="#org9d69599">メッセージ表示</a>
<ul>
<li><a href="#org44538b3">いったん全て非表示に</a></li>
<li><a href="#org058953d">見たいヘッダだけ表示</a></li>
<li><a href="#org1e1c6b9">表示順の変更</a></li>
<li><a href="#orgc013465">mime の画像表示の切り替え</a></li>
<li><a href="#orgf640153">From, To を省略表示しない</a></li>
</ul>
</li>
<li><a href="#org1af52e3">作成/返信設定</a>
<ul>
<li><a href="#org1beff99">メール本文の文字コード</a></li>
<li><a href="#org85b54dc">draft mode で orgtbl を有効に</a></li>
<li><a href="#orge2676d7">c-sig</a></li>
</ul>
</li>
<li><a href="#org29def32">Face の設定</a></li>
<li><a href="#orga0248d5">GPG 署名</a></li>
<li><a href="#orga001041">検索</a></li>
</ul>
</li>
<li><a href="#org915f645">Linux Desktop で <code>mailto:</code> リンクを扱うために</a></li>
</ul>
</li>
<li><a href="#orgee41b1b">Emacs-w3m</a></li>
<li><a href="#org4792ff8">補完: <code>ido</code>, <code>flx-ido</code>, <code>smex</code></a>
<ul>
<li><a href="#org6b0690a"><code>ido</code> の設定</a></li>
<li><a href="#orgd65025b"><code>flx-ido</code>: flex match の強化</a></li>
<li><a href="#orga8e37ba"><code>ido-grid</code>: 補完候補の grid 表示</a></li>
<li><a href="#orgbb975a1"><code>ido-recentf</code>: recentf を ido で</a></li>
<li><a href="#orgac67847"><code>ido-describe-bindings</code>: key binding を表示?</a></li>
<li><a href="#org312180a"><code>smex</code></a></li>
</ul>
</li>
<li><a href="#orgab311d4">補完: <code>helm</code></a></li>
<li><a href="#org292f8bd">校正，辞書等</a>
<ul>
<li><a href="#orgebdf4fa">spell checker</a></li>
<li><a href="#orga771be7">辞書</a></li>
</ul>
</li>
<li><a href="#org8e696ff">カレンダー: <code>japanese-holidays</code></a></li>
<li><a href="#orgd9f246a">Org</a>
<ul>
<li><a href="#org8c800ce">基本設定: <code>org</code></a></li>
<li><a href="#orgf7a0481">Org-Id, Orglink</a></li>
<li><a href="#org3fd5e73">Org-capture: 日記</a></li>
<li><a href="#org49e6603">Capture: メモ取り</a></li>
<li><a href="#org70b1d79">Agenda: スケジュール，TODO 表示</a></li>
<li><a href="#orgb85b0f6">Babel</a>
<ul>
<li><a href="#org77ec1ed">org-src</a></li>
<li><a href="#org3e25d6d">org-ditaa</a></li>
</ul>
</li>
<li><a href="#org87df5bd">OrgとGoogle カレンダーの連携: <code>org-gcal</code></a>
<ul>
<li><a href="#orgc96ae13">token 等の置き場所の変更</a></li>
<li><a href="#org4833a48">org-gcal 本体の設定</a></li>
</ul>
</li>
<li><a href="#orgbc5264a">OrgとRedmine の連携: <code>orgmine</code></a></li>
<li><a href="#org24423f9">Org-Export</a>
<ul>
<li><a href="#org23717b7">一般設定</a></li>
<li><a href="#org7219086">Beamer export</a></li>
<li><a href="#orgce70b34">HTML export</a></li>
<li><a href="#org69419ea">Jekyll 用の Backend の定義</a></li>
</ul>
</li>
<li><a href="#org00e03ba">Org-Project</a></li>
<li><a href="#org30efae7">Org-Wiki</a></li>
</ul>
</li>
<li><a href="#org1a9456e">Howm</a></li>
<li><a href="#orgf23518a">フォントと色</a></li>
<li><a href="#orgc4a9493">日記: <code>tDiary</code></a></li>
<li><a href="#org155c83d">プログラム環境</a>
<ul>
<li><a href="#orgc3455b7">VCS: <code>magit</code></a></li>
<li><a href="#orgc435948">rainbow-mode</a></li>
<li><a href="#org35095d6">Textile</a></li>
<li><a href="#org32a2966">Markdown</a></li>
<li><a href="#orgc4bc4d1">SCSS</a></li>
<li><a href="#org8d3ecba">YAML</a></li>
<li><a href="#org8512260">設定ファイル: <code>generic-x</code></a></li>
<li><a href="#org6c5fc81">Ruby</a></li>
<li><a href="#org8712e7f">C</a></li>
<li><a href="#org3d4000d">Fortran</a></li>
<li><a href="#org6d6deb2">AUCTeX</a></li>
<li><a href="#org4d21671">AUCTeX と Zotero との連携</a></li>
</ul>
</li>
<li><a href="#org24a422e">基本的なキーバインドの設定 <code>[/]</code></a></li>
<li><a href="#org16ee167"><code>diminish</code>: モードラインの短縮表示</a></li>
<li><a href="#org3fe91e6"><code>powerline</code>: モードラインを綺麗に</a></li>
<li><a href="#org599bdcc">起動時間の計測</a></li>
<li><a href="#org0f369f0">LICENSE</a></li>
</ul>
</div>
</nav>
</div>
<a href="#toc-toggle" class="btn toc-btn" id="toc-toggle">&#30446;&#27425;</a>
<p>
Related: <a href='index.html'>Index</a>
</p>
<div id="outline-container-orgb974032" class="outline-2">
<h2 id="orgb974032">はじめに</h2>
<div class="outline-text-2" id="text-orgb974032">
<p>
ここでは，私の Emacs の設定についてまとめています．
</p>

<p>
<img src="https://travis-ci.org/uwabami/emacs.svg?branch=master" class="travis_badge">
<object type="image/svg+xml" data="https://img.shields.io/badge/License-GPLv3-blue.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
<style>#forkongithub a{background:#000;color:#fff;text-decoration:none;font-family:arial,sans-serif;text-align:center;font-weight:bold;padding:5px 40px;font-size:1rem;line-height:2rem;position:relative;transition:0.5s;}#forkongithub a:hover{background:#c11;color:#fff;}#forkongithub a::before,#forkongithub a::after{content:"";width:100%;display:block;position:absolute;top:1px;left:0;height:1px;background:#fff;}#forkongithub a::after{bottom:1px;top:auto;}@media screen and (min-width:800px){#forkongithub{position:fixed;display:block;top:0;right:0;width:200px;overflow:hidden;height:200px;z-index:9999;}#forkongithub a{width:200px;position:absolute;top:120px;right:15px;transform:rotate(45deg);-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);box-shadow:4px 4px 10px rgba(0,0,0,0.8);}}</style><span id="forkongithub"><a href="https://github.com/uwabami/emacs">Fork me on GitHub</a></span>
</p>

<p>
基本方針は以下の通り:
</p>
</div>
<div id="outline-container-org37133a6" class="outline-3">
<h3 id="org37133a6">Emacs のパッケージ(<code>package.el</code>)と <a href="https://github.com/quelpa/quelpa">quelpa</a>, <a href="https://github.com/jwiegley/use-package">use-package</a> を使う</h3>
<div class="outline-text-3" id="text-org37133a6">
<p>
基本は <code>package.el</code> を使いますが、
VCS からインストールしたいパッケージが幾つかあるので、
それらについては <a href="https://github.com/quelpa/quelpa">quelpa</a> を使います。
</p>
</div>
</div>
<div id="outline-container-orgefbaeb2" class="outline-3">
<h3 id="orgefbaeb2">Debian パッケージがインストールされているならば，それを優先する</h3>
<div class="outline-text-3" id="text-orgefbaeb2">
<p>
:<a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">Eating your own dog food - Wikipedia</a>
</p>

<p>
Emacsに関連するDebianパッケージを幾つかメンテナンスしているので，
可能な限りDebianパッケージを使うことにしています.
</p>
</div>
</div>
<div id="outline-container-org4cebe45" class="outline-3">
<h3 id="org4cebe45">設定は <a href="http://orgmode.org/">Org mode</a> で書きたい</h3>
<div class="outline-text-3" id="text-org4cebe45">
<p>
以前こんなブログ記事を書きました: <a href="http://uwabami.junkhub.org/log/20111213.html#p01">Emacsの設定ファイルをorgで書く</a>
</p>

<p>
というわけで，設定は <a href="http://orgmode.org/worg/org-contrib/babel/intro.html">Org Babel</a> で書いています．
本ファイル(<code>README.org</code>) から，
Makefile 内の以下のスクリプトで <code>~/init.el</code> を生成し，byte-compile します．
</p>
<div class="org-src-container">
<pre class="src src-makefile-gmake"><span style="color: #BF7FFF;">init.el</span>: README.org
    $(<span style="color: #7F7FFF;">EMACS</span>) -q --batch --eval \
         <span style="color: #7FFF7F;">"(progn \</span>
<span style="color: #7FFF7F;">            (require 'ob-tangle) \</span>
<span style="color: #7FFF7F;">            (org-babel-tangle-file \"$</span><span style="color: #FFBF7F;">&lt;</span><span style="color: #7FFF7F;">\" \"</span><span style="color: #7FFF7F;">$</span><span style="color: #FFBF7F;">@</span><span style="color: #7FFF7F;">\" \"emacs-lisp\")))"</span>
<span style="color: #BF7FFF;">%.elc</span>: %.el
    $(<span style="color: #7F7FFF;">EMACS</span>) -l $<span style="color: #FFBF7F;">&lt;</span> -batch -f batch-byte-compile $<span style="color: #FFBF7F;">&lt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgceb440f" class="outline-2">
<h2 id="orgceb440f">ディレクトリ構成</h2>
<div class="outline-text-2" id="text-orgceb440f">
<p>
分割した設定ファイル群やパッケージで install したパッケージ
の置き場所は <code>user-emacs-directory</code> 以下にまとめています．
</p>

<p>
試行錯誤の結果，ディレクトリ構成は以下のようにしました:
</p>
<pre class="example">
    ~/.emacs.d/
     |-- Makefile    ←  byte-compile 用の rule
     |-- README.org  ←  本ファイル．`org-babel-tangle' で init.el を生成
     |-- elpa/       ←  package.el で導入したパッケージが置かれる場所
     |-- quelpa/     ←  quelpa で導入したパッケージが置かれる場所
     |-- share/      ←  (基本的に)参照するだけの資源置き場所
     `-- tmp/        ←  一次ファイルの置き場所
</pre>
<p>
上記ディレクトリ構成を設定ファイルで使用するためにディレクトリ配置を宣言しておきます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">when</span> load-file-name
  (<span style="color: #FF7F7F;">setq</span> user-emacs-directory (file-name-directory load-file-name)))
(<span style="color: #FF7F7F;">defconst</span> <span style="color: #7F7FFF;">my:d:share</span>
  (expand-file-name <span style="color: #7FFF7F;">"share/"</span> user-emacs-directory))
(<span style="color: #FF7F7F;">defconst</span> <span style="color: #7F7FFF;">my:d:tmp</span>
  (expand-file-name <span style="color: #7FFF7F;">"tmp/"</span> user-emacs-directory))
</pre>
</div>
<p>
ついでに，
<code>custom-set-variables</code> は別ファイルに出力，終了時に削除するようにしています．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> custom-file (concat my:d:tmp <span style="color: #7FFF7F;">"custom.el"</span>))
(add-hook 'kill-emacs-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (<span style="color: #FF7F7F;">if</span> (file-exists-p custom-file)
                (delete-file custom-file))))
</pre>
</div>
<p>
<del>init.elが汚れる気がしてあまり好きではないのですが&#x2026;皆さん気にしてないんですかね</del>
</p>
</div>
</div>
<div id="outline-container-org30f311a" class="outline-2">
<h2 id="org30f311a">Package 関連: <code>package.el</code>, <a href="https://github.com/jwiegley/use-package">use-package</a>, <a href="https://github.com/quelpa/quelpa">quelpa</a></h2>
<div class="outline-text-2" id="text-org30f311a">
<p>
<a href="https://github.com/jwiegley/use-package">use-package</a> のおかけで、
無いと途方に暮れるパッケージ以外のインストールは無視できるようになります。
</p>
</div>
<div id="outline-container-orgc17de8e" class="outline-3">
<h3 id="orgc17de8e"><code>package.el</code></h3>
<div class="outline-text-3" id="text-orgc17de8e">
<p>
パッケージは基本的に <code>pacakge.el</code> で導入するので、先ずはその設定.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> url-http-attempt-keepalives nil)
(<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">package</span> nil 'noerror)
(<span style="color: #FF7F7F;">setq</span> package-enable-at-startup t)
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"melpa"</span> . <span style="color: #7FFF7F;">"https://melpa.org/packages/"</span>) t)
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"org"</span>   . <span style="color: #7FFF7F;">"http://orgmode.org/elpa/"</span>) t)
(<span style="color: #FF7F7F;">eval-when-compile</span>
  (<span style="color: #FF7F7F;">unless</span> (file-exists-p (concat user-emacs-directory <span style="color: #7FFF7F;">"tmp/bootstrap-stamp"</span>))
    (package-refresh-contents)))
(package-initialize)
(<span style="color: #FF7F7F;">unless</span> (package-installed-p 'package-utils)
  (package-install 'package-utils))
</pre>
</div>
<p>
また，初回起動時に <code>make</code> で org の最新版等を導入するために
batch でインストールできる様に，以下を <code>emacs-batch-install.el</code> として出力します．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> url-http-attempt-keepalives nil)
(<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">package</span> nil 'noerror)
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"melpa"</span> . <span style="color: #7FFF7F;">"https://melpa.org/packages/"</span>) t)
(add-to-list 'package-archives '(<span style="color: #7FFF7F;">"org"</span>   . <span style="color: #7FFF7F;">"http://orgmode.org/elpa/"</span>) t)
(package-refresh-contents)
(package-initialize)
(package-install pkg-install)
</pre>
</div>
<p>
batch でのインストールは例えば
</p>
<div class="org-src-container">
<pre class="src src-makefile">    $(<span style="color: #7F7FFF;">EMACS</span>) -q --batch --eval \
      <span style="color: #7FFF7F;">"(deconst pkg-install 'org-plus-contrib)"</span> -l emacs-batch-install.el
</pre>
</div>
<p>
とすれば良いかと.
</p>
</div>
</div>
<div id="outline-container-orgb3153c9" class="outline-3">
<h3 id="orgb3153c9"><a href="https://github.com/jwiegley/use-package">use-package</a></h3>
<div class="outline-text-3" id="text-orgb3153c9">
<p>
個々のパッケージの設定には <a href="https://github.com/jwiegley/use-package">use-package</a> を利用します．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">use-package</span> nil t)
  (package-install 'use-package))
</pre>
</div>
</div>
</div>
<div id="outline-container-org9121293" class="outline-3">
<h3 id="org9121293"><a href="https://github.com/quelpa/quelpa">quelpa</a></h3>
<div class="outline-text-3" id="text-org9121293">
<p>
melpa に登録されていないパッケージや自作の elisp 等をインストールできる様に
<a href="https://github.com/quelpa/quelpa">quelpa</a> を入れておきます．とはいえ、これでパッケージを入れる訳ではないので、
melpa の同期はしません。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">quelpa</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> quelpa-upgrade-p nil
        quelpa-checkout-melpa-p nil
        quelpa-update-melpa-p nil
        quelpa-melpa-recipe-stores nil)
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb08f4b8" class="outline-2">
<h2 id="orgb08f4b8">独自関数</h2>
<div class="outline-text-2" id="text-orgb08f4b8">
<p>
細かい独自関数，など．
</p>
</div>
<div id="outline-container-orgc580dc1" class="outline-3">
<h3 id="orgc580dc1">カーソルのある位置の face を調べる関数</h3>
<div class="outline-text-3" id="text-orgc580dc1">
<p>
わりと良く使う. 地味に便利
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:describe-face-at-point</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (message <span style="color: #7FFF7F;">"%s"</span> (get-char-property (point) 'face)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org967348d" class="outline-3">
<h3 id="org967348d">機能を無効化するための関数の定義</h3>
<div class="outline-text-3" id="text-org967348d">
<p>
<code>line-number-mode</code> など「有効無効をtoggleする関数」は
慣習的に <code>0</code> 以下の数字を指定すると明示的に無効化できるので，
<code>-1</code> を設定する関数を定義しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:disable-builtin-mode</span> (mode)
  <span style="color: #7FFF7F;">"&#19982;&#12360;&#12425;&#12428;&#12383; mode &#12364;&#23384;&#22312;&#12377;&#12427;&#12398;&#12391;&#12354;&#12428;&#12400; -1 &#12434;&#12475;&#12483;&#12488;&#12375;&#12390;&#28961;&#21177;&#21270;"</span>
  (<span style="color: #FF7F7F;">if</span> (fboundp mode) (funcall mode -1)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org0e9e81d" class="outline-3">
<h3 id="org0e9e81d">dpkg-status</h3>
<div class="outline-text-3" id="text-org0e9e81d">
<p>
もっと良い方法がありそうなモンですが．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:dpkg-status</span> (package)
  <span style="color: #7FFF7F;">"Return the package status from dpkg --get-selections."</span>
  (string-match <span style="color: #7FFF7F;">"^ii"</span> (shell-command-to-string (format <span style="color: #7FFF7F;">"dpkg -l %s"</span> package))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9400654" class="outline-2">
<h2 id="org9400654">常に <code>cl-lib</code> を読み込む</h2>
<div class="outline-text-2" id="text-org9400654">
<p>
以前は(今も?)「 <code>cl.el</code> は名前衝突があるので byte compile 時以外は読み込まない様にしよう」
というお話でした．つまり，
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">eval-when-compile</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">cl</span>))
</pre>
</div>
<p>
としておくこと，という．
</p>

<p>
今は「 <code>cl.el</code> は deprecated なので <code>cl-lib</code> を使いましょう」ということみたいです．
名前衝突の回避のために，関数の接頭詞として <code>cl-</code> が付くようになったのは御愛嬌．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">eval-and-compile</span> (<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">cl-lib</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga1cffc7" class="outline-2">
<h2 id="orga1cffc7">後方互換性: <code>el-x</code></h2>
<div class="outline-text-2" id="text-orga1cffc7">
<p>
古い <code>flet</code> と同じ挙動をする <code>dflet</code> を使うために <code>el-x</code> を導入しておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">el-x</span>
  <span style="color: #7FBFFF;">:ensure</span> t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org22fa324" class="outline-2">
<h2 id="org22fa324">url-retrieve の置換: <code>mb-url</code></h2>
<div class="outline-text-2" id="text-org22fa324">
<p>
標準関数の url-retrieve 等の proxy 環境下での挙動が怪しいので,
<a href="https://github.com/dochang/mb-url">dochang/mb-url: Multiple Backends for Emacs URL package</a>
advice (上書き)する.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">mb-url</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"curl"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (advice-add 'url-http <span style="color: #7FBFFF;">:override</span> 'mb-url-http-curl)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org8ee2cab" class="outline-2">
<h2 id="org8ee2cab">環境変数の読み込み: <code>exec-path-from-shell</code></h2>
<div class="outline-text-2" id="text-org8ee2cab">
<p>
zsh で設定した <code>PATH</code> などの環境変数を Emacs に引き継ぐために
<a href="https://github.com/purcell/exec-path-from-shell">purcell/exec-path-from-shell</a> を使います．
今の所
</p>
<ul class="org-ul">
<li><code>SHELL</code></li>
<li><code>DEBFULLNAME</code></li>
<li><code>DEBEMAIL</code></li>
<li><code>TEXMFHOME</code></li>
<li><code>SKKSERVER</code></li>
<li><code>http_proxy</code></li>
<li><code>GPG_KEY_ID</code></li>
<li><code>GPG_AGENT_INFO</code></li>
<li><code>PASSWORD_STORE_DIR</code></li>
</ul>
<p>
を読み込んでいます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:d:password-store</span> nil)
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">exec-path-from-shell</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">when</span> (memq window-system '(mac ns)) (exec-path-from-shell-initialize))
  (exec-path-from-shell-copy-envs
   '(<span style="color: #7FFF7F;">"SHELL"</span>
     <span style="color: #7FFF7F;">"DEBFULLNAME"</span>
     <span style="color: #7FFF7F;">"DEBEMAIL"</span>
     <span style="color: #7FFF7F;">"SKKSERVER"</span>
     <span style="color: #7FFF7F;">"TEXMFHOME"</span>
     <span style="color: #7FFF7F;">"http_proxy"</span>
     <span style="color: #7FFF7F;">"GPG_KEY_ID"</span>
     <span style="color: #7FFF7F;">"GPG_AGENT_INFO"</span>
     <span style="color: #7FFF7F;">"PASSWORD_STORE_DIR"</span>
     ))
  (<span style="color: #FF7F7F;">setq</span> user-full-name (concat (getenv <span style="color: #7FFF7F;">"DEBFULLNAME"</span>))
        user-mail-address (concat (getenv <span style="color: #7FFF7F;">"DEBEMAIL"</span>))
        my:d:password-store (getenv <span style="color: #7FFF7F;">"PASSWORD_STORE_DIR"</span>))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbca86c9" class="outline-2">
<h2 id="orgbca86c9">言語の設定</h2>
<div class="outline-text-2" id="text-orgbca86c9">
<p>
日本語, UTF-8 にしています.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-language-environment <span style="color: #7FFF7F;">"Japanese"</span>)
(prefer-coding-system 'utf-8)
(set-file-name-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-default 'buffer-file-coding-system 'utf-8)
</pre>
</div>
<p>
その他, 機種依存文字等についての設定をアレコレ.
</p>
</div>
<div id="outline-container-org65f7f9b" class="outline-3">
<h3 id="org65f7f9b">cp5022x.el</h3>
<div class="outline-text-3" id="text-org65f7f9b">
<p>
Emacs23 から内部が Unicode ベースになっています．
</p>

<p>
しかし文字コードの変換は GNU libc の iconv をベースにしているため，
環境によっては文字の変換がうまく行なえません．
そこで言語設定前に <code>cp5022x.el</code> をインストールすることにしています．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">cp5022x</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (set-charset-priority 'ascii 'japanese-jisx0208 'latin-jisx0201
                        'katakana-jisx0201 'iso-8859-1 'unicode)
  (set-coding-system-priority 'utf-8 'euc-jp 'iso-2022-jp 'cp932)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcc07fb8" class="outline-3">
<h3 id="orgcc07fb8">East Asian Ambiguos 対応</h3>
<div class="outline-text-3" id="text-orgcc07fb8">
<p>
CJK 以外の East Asian Ambiguos，絵文字も2文字幅にするようにしています．
拙作の修正ロケールはこちら: <a href="https://github.com/uwabami/locale-eaw-emoji">https://github.com/uwabami/locale-eaw-emoji</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (package-installed-p 'locale-eaw-emoji)
  (quelpa '(locale-eaw-emoji
            <span style="color: #7FBFFF;">:fetcher</span> url
            <span style="color: #7FBFFF;">:url</span> <span style="color: #7FFF7F;">"https://raw.githubusercontent.com/uwabami/locale-eaw-emoji/master/locale-eaw-emoji.el"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">locale-eaw-emoji</span>
  <span style="color: #7FBFFF;">:config</span>
  (eaw-and-emoji-fullwidth))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc007c34" class="outline-3">
<h3 id="orgc007c34">OSの違いに起因する条件分岐</h3>
<div class="outline-text-3" id="text-orgc007c34">
<p>
Mac と Linux では同じ Unicode でも正規化が異なります
(具体的には Mac のファイルシステムである HFS+ では Unicode の正規化が異なります).
Unicode の正規化と Mac OS X 特有の事情については
</p>
<ul class="org-ul">
<li><a href="http://homepage1.nifty.com/nomenclator/unicode/normalization.htm">Unicode正規化とは</a></li>
<li><a href="http://www.sakito.com/2010/05/mac-os-x-normalization.html">Mac OS X におけるファイル名に関するメモ(NFC, NFD等)</a></li>
</ul>
<p>
等が参考になるでしょう.
</p>

<p>
日本語のファイル名を扱うことは滅多にないものの,
たまに祟りがあるのでそれを回避するための設定をしています.
</p>

<p>
Windows の場合はファイル名などは cp932 にしているものの,
最近 Windows 使っていないので良く知りません(というわけで，設定を捨てました).
<del>さらに，最近は Mac OS でも Emacs 使ってないから，これが正しのか良くわからない&#x2026;</del>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ucs-normalize</span>
  <span style="color: #7FBFFF;">:if</span> (eq system-type 'darwin)
  <span style="color: #7FBFFF;">:config</span>
  (set-file-name-coding-system 'utf-8-hfs)
  (<span style="color: #FF7F7F;">setq</span> locale-coding-system 'utf-8-hfs)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12388;&#12356;&#12391;&#12395;&#12461;&#12540;&#12496;&#12452;&#12531;&#12489;: Ctrl &#12434; Mac &#12363;&#12425;&#22890;&#12356;&#21462;&#12427;</span>
  (<span style="color: #FF7F7F;">setq</span> mac-pass-control-to-system t)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">Cmd &#12392; Option &#12434;&#36870;&#12395;&#12377;&#12427;</span>
  (<span style="color: #FF7F7F;">setq</span> ns-command-modifier 'meta)
  (<span style="color: #FF7F7F;">setq</span> ns-alternate-modifier 'super)
  (global-set-key [ns-drag-file] 'ns-find-file)
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org43697ff" class="outline-2">
<h2 id="org43697ff"><a id="ID-1621568c-82d3-455a-8a12-5b356ba79e89"></a>主にEmacs本体に同梱されている拡張に関する設定</h2>
<div class="outline-text-2" id="text-org43697ff">
</div>
<div id="outline-container-orgae3d8c8" class="outline-3">
<h3 id="orgae3d8c8">標準機能の設定</h3>
<div class="outline-text-3" id="text-orgae3d8c8">
</div><div id="outline-container-org1b6b59a" class="outline-4">
<h4 id="org1b6b59a">表示関連</h4>
<div class="outline-text-4" id="text-org1b6b59a">
<p>
起動時のスプラッシュ画面を表示しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> inhibit-startup-screen t
      inhibit-startup-message t)
</pre>
</div>
<p>
大抵の場合ターミナル内で <code>-nw</code> として起動するし,
メニューは触ったことないので使わないので，
フレーム, ツールバー等を非表示にする．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(my:disable-builtin-mode 'tool-bar-mode)
(my:disable-builtin-mode 'scroll-bar-mode)
(my:disable-builtin-mode 'menu-bar-mode)
(my:disable-builtin-mode 'blink-cursor-mode)
(my:disable-builtin-mode 'column-number-mode)
</pre>
</div>
<p>
ベル無効化
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> ring-bell-function 'ignore)
</pre>
</div>
<p>
現在行のハイライト
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-hl-line-mode t)
</pre>
</div>
<p>
選択リージョンに色付け
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> transient-mark-mode t)
</pre>
</div>
<p>
対応する括弧を強調表示
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(show-paren-mode +1)
(<span style="color: #FF7F7F;">setq</span> show-paren-style 'mixed)
</pre>
</div>
<p>
行番号を表示する <code>linum-mode</code> は基本使わない(必要に応じて有効にする)
ので通常はモードラインに行番号や桁番号を表示しないようする.
ついでに <code>linum-mode</code> を有効にした場合の桁表示を 5 桁に.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(my:disable-builtin-mode 'line-number-mode)
(<span style="color: #FF7F7F;">setq</span> linum-format <span style="color: #7FFF7F;">"%5d "</span>)
</pre>
</div>
<p>
debug は表示しない: 必要に応じて t に変更する
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> debug-on-error nil)
</pre>
</div>
<p>
Compile-Log の非表示:     ほとんど見ないし．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">let</span> ((win (get-buffer-window <span style="color: #7FFF7F;">"*Compile-Log*"</span>)))
  (<span style="color: #FF7F7F;">when</span> win (delete-window win)))
</pre>
</div>
<p>
Warning の抑制: これもほとんど見ないし．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> byte-compile-warnings
      '(not
        free-vars
        unresolved
        callargs
        redefine
        obsolete
        noruntime
        cl-functions
        interactive-only
        make-local
        ))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeaa9f99" class="outline-4">
<h4 id="orgeaa9f99">編集関連</h4>
<div class="outline-text-4" id="text-orgeaa9f99">
<p>
yes or no を y or n に
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(fset 'yes-or-no-p 'y-or-n-p)
</pre>
</div>
<p>
ファイル名の大文字小文字を区別しない(zsh風)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> read-file-name-completion-ignore-case t)
</pre>
</div>
<p>
tab 幅 4, tab でのインデントはしない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq-default</span> tab-width 4)
(<span style="color: #FF7F7F;">setq-default</span> indent-tabs-mode nil)
</pre>
</div>
<p>
文字列は 72 文字で折り返し(RFC2822風味)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq-default</span> fill-column 72)
(<span style="color: #FF7F7F;">setq</span> paragraph-start '<span style="color: #7FFF7F;">"^</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">[ &#12288;&#12539;&#9675;&lt;\t\n\f]</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">(?[0-9a-zA-Z]+)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>)
(<span style="color: #FF7F7F;">setq-default</span> auto-fill-mode nil)
</pre>
</div>
<p>
長い行の折り返し:
デフォルトは折り返し有で <code>\C-c M-l</code> で toggle
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-default 'truncate-lines nil)
(<span style="color: #FF7F7F;">setq</span> truncate-partial-width-windows nil)
(define-key global-map (kbd <span style="color: #7FFF7F;">"C-c M-l"</span>) 'toggle-truncate-lines)
</pre>
</div>
<p>
バッファ終端で newline を入れない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> next-line-add-newlines nil)
</pre>
</div>
<p>
symlink は常においかける
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> vc-follow-symlinks t)
</pre>
</div>
<p>
変更のあったファイルの自動再読み込み
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-auto-revert-mode 1)
</pre>
</div>
<p>
バックアップとauto-saveの作成/位置の変更:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> auto-save-list-file-prefix (concat my:d:tmp <span style="color: #7FFF7F;">".saves-"</span>))
(<span style="color: #FF7F7F;">setq</span> auto-save-default t)
(<span style="color: #FF7F7F;">setq</span> auto-save-timeout 15)
(<span style="color: #FF7F7F;">setq</span> auto-save-interval 60)
(<span style="color: #FF7F7F;">setq</span> make-backup-files t)
(<span style="color: #FF7F7F;">setq</span> backup-by-copying t) <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">symlink &#12399;&#20351;&#12431;&#12394;&#12356;</span>
(<span style="color: #FF7F7F;">setq</span> backup-directory-alist `((<span style="color: #7FFF7F;">"."</span> . ,my:d:tmp)))
(<span style="color: #FF7F7F;">setq</span> auto-save-file-name-transforms `((<span style="color: #7FFF7F;">".*"</span> ,my:d:tmp t)))
(<span style="color: #FF7F7F;">setq</span> version-control t)
(<span style="color: #FF7F7F;">setq</span> kept-new-versions 5)
(<span style="color: #FF7F7F;">setq</span> kept-old-versions 5)
(<span style="color: #FF7F7F;">setq</span> delete-old-versions t)
(<span style="color: #FF7F7F;">setq</span> delete-auto-save-files t)
</pre>
</div>
<p>
<code>recentf</code>: 最近使ったファイル履歴の保管
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> recentf-max-saved-items 10000)
(<span style="color: #FF7F7F;">setq</span> recentf-save-file
      (expand-file-name (concat my:d:tmp <span style="color: #7FFF7F;">"recentf"</span>)))
(<span style="color: #FF7F7F;">setq</span> recentf-auto-cleanup 'never)
(<span style="color: #FF7F7F;">setq</span> recentf-exclude
      '(<span style="color: #7FFF7F;">".recentf"</span>
        <span style="color: #7FFF7F;">"^/tmp\\.*"</span>
        <span style="color: #7FFF7F;">"^/private\\.*"</span>
        <span style="color: #7FFF7F;">"^/var/folders\\.*"</span>
        <span style="color: #7FFF7F;">"/TAGS$"</span>
        <span style="color: #7FFF7F;">"^/home/uwabami/.mozilla/firefox/jhitnbb2.default/itsalltext\\.*"</span>
        ))
(add-hook 'after-init-hook 'recentf-mode)
</pre>
</div>
<p>
Undo/Redo:
そのうち undohist と undo-tree を試そうと思っているのですが，
今のところ特に弄ってません． <code>undo-limit</code> は無限大にしたいのですが，どうするのかな&#x2026;?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> undo-limit 200000)
(<span style="color: #FF7F7F;">setq</span> undo-strong-limit 260000)
(savehist-mode 1)        <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#12398;&#23653;&#27508;&#12434;&#20445;&#23384;&#12375;&#12522;&#12473;&#12488;&#12450;</span>
(<span style="color: #FF7F7F;">setq</span> savehist-file (concat my:d:tmp <span style="color: #7FFF7F;">"history"</span>))
(<span style="color: #FF7F7F;">setq</span> history-length t)  <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">t &#12391;&#28961;&#21046;&#38480;</span>
</pre>
</div>
<p>
行末の無駄な空白/改行を削除する:     <a href="http://d.hatena.ne.jp/tototoshi/20101202/1291289625">無駄な行末の空白を削除する(Emacs Advent Calendar jp:2010)</a>
</p>

<p>
ただし, RD や Markdown だと空白行に意味があったりするので，
必要に応じて拡張子で判断して外している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:delete-trailing-whitespace-exclude-suffix</span>
  (list <span style="color: #7FFF7F;">"\\.rd$"</span> <span style="color: #7FFF7F;">"\\.md$"</span> <span style="color: #7FFF7F;">"\\.rbt$"</span> <span style="color: #7FFF7F;">"\\.rab$"</span>))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:delete-trailing-whitespace</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">cond</span>
   ((equal nil
           (<span style="color: #FF7F7F;">cl-loop</span> for pattern in my:delete-trailing-whitespace-exclude-suffix
                    thereis (string-match pattern buffer-file-name)))
    (delete-trailing-whitespace))))
(add-hook 'before-save-hook 'my:delete-trailing-whitespace)
</pre>
</div>
</div>
</div>
<div id="outline-container-org7eda492" class="outline-4">
<h4 id="org7eda492">ファイル，デイレクトリ整理</h4>
<div class="outline-text-4" id="text-org7eda492">
<p>
他にもイロイロありそう．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">url</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> url-configuration-directory (concat my:d:tmp <span style="color: #7FFF7F;">"url"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">nsm</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> nsm-settings-file (concat my:d:tmp <span style="color: #7FFF7F;">"network-settings.data"</span>)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org4642e32" class="outline-3">
<h3 id="org4642e32"><code>.elc</code> と <code>.el</code> の timestamp を比較し，新しい方を読み込む</h3>
<div class="outline-text-3" id="text-org4642e32">
<p>
<code>load-prefer-newer</code> は Emacs &gt;= 24.4 から．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">when</span> (boundp 'load-prefer-newer)
  (<span style="color: #FF7F7F;">setq</span> load-prefer-newer t))
</pre>
</div>
</div>
</div>
<div id="outline-container-org493fd75" class="outline-3">
<h3 id="org493fd75">ガベージコレクションの頻度を下げる</h3>
<div class="outline-text-3" id="text-org493fd75">
<p>
とりあえず 128 MB にしておく. ついでに message に gc が走っていることを表示
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> gc-cons-threshold (* 128 1024 1024)
      garbage-collection-messages t
      )
</pre>
</div>
</div>
</div>
<div id="outline-container-org65a8528" class="outline-3">
<h3 id="org65a8528">scratch を殺さない. 消したら再生成</h3>
<div class="outline-text-3" id="text-org65a8528">
<p>
&#x2026;元ネタがどこだったのか忘れてしまった&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:make-scratch</span> (<span style="color: #FFFF7F;">&amp;optional</span> arg)
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">progn</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">"*scratch*" &#12434;&#20316;&#25104;&#12375;&#12390; buffer-list &#12395;&#25918;&#12426;&#36796;&#12416;</span>
    (set-buffer (get-buffer-create <span style="color: #7FFF7F;">"*scratch*"</span>))
    (funcall initial-major-mode)
    (erase-buffer)
    (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">and</span> initial-scratch-message (not inhibit-startup-message))
      (insert initial-scratch-message))
    (<span style="color: #FF7F7F;">or</span> arg
        (<span style="color: #FF7F7F;">progn</span>
          (<span style="color: #FF7F7F;">setq</span> arg 0)
          (switch-to-buffer <span style="color: #7FFF7F;">"*scratch*"</span>)))
    (<span style="color: #FF7F7F;">cond</span> ((= arg 0) (message <span style="color: #7FFF7F;">"*scratch* is cleared up."</span>))
          ((= arg 1) (message <span style="color: #7FFF7F;">"another *scratch* is created"</span>)))))

(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:buffer-name-list</span> ()
  (mapcar (<span style="color: #FF7F7F;">function</span> buffer-name) (buffer-list)))
(add-hook 'kill-buffer-query-functions
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12391; kill-buffer &#12375;&#12383;&#12425;&#20869;&#23481;&#12434;&#28040;&#21435;&#12377;&#12427;&#12384;&#12369;&#12395;&#12377;&#12427;</span>
          (<span style="color: #FF7F7F;">function</span> (<span style="color: #FF7F7F;">lambda</span> ()
                      (<span style="color: #FF7F7F;">if</span> (string= <span style="color: #7FFF7F;">"*scratch*"</span> (buffer-name))
                          (<span style="color: #FF7F7F;">progn</span> (my:make-scratch 0) nil)
                        t))))
(add-hook 'after-save-hook
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12398;&#20869;&#23481;&#12434;&#20445;&#23384;&#12375;&#12383;&#12425;</span>
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12434;&#26032;&#12375;&#12367;&#20316;&#12427;.</span>
          (<span style="color: #FF7F7F;">function</span>
           (<span style="color: #FF7F7F;">lambda</span> ()
             (<span style="color: #FF7F7F;">unless</span> (member <span style="color: #7FFF7F;">"*scratch*"</span> (my:buffer-name-list))
               (my:make-scratch 1)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf32ac0d" class="outline-3">
<h3 id="orgf32ac0d">空になったファイルを尋ねずに自動削除</h3>
<div class="outline-text-3" id="text-orgf32ac0d">
<p>
ゴミが残らないし，地味に便利．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:delete-file-if-no-contents</span> ()
  (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">and</span> (buffer-file-name (current-buffer))
             (= (point-min) (point-max)))
    (delete-file
     (buffer-file-name (current-buffer)))))
(<span style="color: #FF7F7F;">if</span> (not (memq 'my:delete-file-if-no-contents after-save-hook))
    (<span style="color: #FF7F7F;">setq</span> after-save-hook
          (cons 'my:delete-file-if-no-contents after-save-hook)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org83033dd" class="outline-3">
<h3 id="org83033dd"><code>abbrev</code>: 略語展開</h3>
<div class="outline-text-3" id="text-org83033dd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">abbrev</span>
  <span style="color: #7FBFFF;">:diminish</span> abbrev-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> abbrev-file-name (concat my:d:share <span style="color: #7FFF7F;">"abbrev_defs"</span>)
        save-abbrevs t
  )
  (<span style="color: #FF7F7F;">setq-default</span> abbrev-mode t)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org5ffdaa9" class="outline-3">
<h3 id="org5ffdaa9"><code>eldoc</code>: emacs-lisp document</h3>
<div class="outline-text-3" id="text-org5ffdaa9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">eldoc</span>
  <span style="color: #7FBFFF;">:diminish</span> eldoc-mode
  <span style="color: #7FBFFF;">:config</span>
  (add-hook 'emacs-lisp-mode-hook 'turn-on-eldoc-mode)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc7bb37c" class="outline-3">
<h3 id="orgc7bb37c"><code>midnight</code>: 一定期間使用しなかった buffer を自動削除</h3>
<div class="outline-text-3" id="text-orgc7bb37c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">midnight</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> clean-buffer-list-delay-general 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org71c9c07" class="outline-3">
<h3 id="org71c9c07"><code>uniquify</code>: モードラインのファイル名にディレクトリも表示する</h3>
<div class="outline-text-3" id="text-org71c9c07">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">uniquify</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> uniquify-buffer-name-style 'post-forward-angle-brackets
        uniquify-min-dir-content 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org47b60d9" class="outline-3">
<h3 id="org47b60d9"><code>whitespace</code>: 空白の強調表示</h3>
<div class="outline-text-3" id="text-org47b60d9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">whitespace</span>
  <span style="color: #7FBFFF;">:diminish</span> global-whitespace-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> whitespace-line-column 72
        whitespace-style
        '(face              <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">face&#12434;&#20351;&#12387;&#12390;&#35222;&#35226;&#21270;&#12377;&#12427;&#65294;</span>
          trailing          <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">&#34892;&#26411;&#12398;&#31354;&#30333;&#12434;&#23550;&#35937;&#12392;&#12377;&#12427;&#65294;</span>
          tabs              <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">tab</span>
          spaces            <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">space</span>
          )
        whitespace-display-mappings
        '((space-mark ?\u3000 [?\u25a1])
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">WARNING: the mapping below has a problem. When a TAB</span>
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">occupies exactly one column, it will display the character</span>
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">?\xBB at that column followed by a TAB which goes to the</span>
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">next TAB column. If this is a problem for you, please,</span>
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">comment the line below.</span>
          (tab-mark ?\t [?\u00BB ?\t] [?\\ ?\t]))
        whitespace-space-regexp <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">\u3000+</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>)
  (global-whitespace-mode 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc074ac4" class="outline-3">
<h3 id="orgc074ac4"><code>saveplace</code>: 前回の修正位置を記憶する.</h3>
<div class="outline-text-3" id="text-orgc074ac4">
<p>
記憶の保存先は <code>~/.emacs.d/tmp/emacs-places</code> に変更.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">saveplace</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq-default</span> save-place t)
  (<span style="color: #FF7F7F;">setq</span> save-place-file (concat my:d:tmp <span style="color: #7FFF7F;">"emacs-places"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd885246" class="outline-3">
<h3 id="orgd885246"><code>time-stamp</code>: 保存時に timestamp を自動更新</h3>
<div class="outline-text-3" id="text-orgd885246">
<p>
デフォルトではいろいろと衝突したので
更新文字列を変更し， <code>＄Lastupdate: 2</code> (＄は半角) があったら timestamp を更新する様にした．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">time-stamp</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> time-stamp-active t
        time-stamp-line-limit 10
        time-stamp-start <span style="color: #7FFF7F;">"$Lastupdate: 2"</span>
        time-stamp-end <span style="color: #7FFF7F;">"\\$"</span>
        time-stamp-format <span style="color: #7FFF7F;">"%03y-%02m-%02d %02H:%02M:%02S"</span>)
  (add-hook 'before-save-hook 'time-stamp))
</pre>
</div>
<p>
モード独自の設定(例えば Org とか)に関しては別途．
</p>
</div>
</div>
<div id="outline-container-org07a421d" class="outline-3">
<h3 id="org07a421d"><code>tramp</code>: ssh 越しにファイルを編集</h3>
<div class="outline-text-3" id="text-org07a421d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">tramp</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> tramp-persistency-file-name (concat my:d:tmp <span style="color: #7FFF7F;">"tramp"</span>))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf73514f" class="outline-3">
<h3 id="orgf73514f"><code>bookmark</code>: bookmark ファイル</h3>
<div class="outline-text-3" id="text-orgf73514f">
<p>
イマイチ使いこなせてない. 場所だけ変更しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> bookmark-default-file (concat my:d:share <span style="color: #7FFF7F;">"bookmarks"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ddc61b" class="outline-3">
<h3 id="org4ddc61b"><code>eww</code>: 内蔵ブラウザ <code>[0/1]</code></h3>
<div class="outline-text-3" id="text-org4ddc61b">
<p>
内蔵ブラウザの設定
</p>
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> <code>mb-url</code> で curl を使うようにすると、
<code>google</code> から 403が返るようになる。これ、どうしたら良いのかな?</li>
</ul>
<p>
幅と背景色の指定がメイン
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">eww</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> eww-bookmarks-directory (expand-file-name <span style="color: #7FFF7F;">"eww"</span> my:d:tmp)
        )
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p (expand-file-name <span style="color: #7FFF7F;">"eww"</span> my:d:tmp))
    (make-directory (expand-file-name <span style="color: #7FFF7F;">"eww"</span> my:d:tmp)))
  (<span style="color: #FF7F7F;">setq</span> eww-search-prefix <span style="color: #7FFF7F;">"https://www.bing.com/search?q="</span>)
  (<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:eww-disable-colorize</span> t)
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">shr-colorize-region--disable</span> (orig start end fg <span style="color: #FFFF7F;">&amp;optional</span> bg <span style="color: #FFFF7F;">&amp;rest</span> _)
    (<span style="color: #FF7F7F;">unless</span> my:eww-disable-colorize
      (funcall orig start end fg)))
  (advice-add 'shr-colorize-region <span style="color: #7FBFFF;">:around</span> 'shr-colorize-region--disable)
  (advice-add 'eww-colorize-region <span style="color: #7FBFFF;">:around</span> 'shr-colorize-region--disable)
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">eww-disable-color</span> ()
    <span style="color: #7FFF7F;">"eww &#12391;&#25991;&#23383;&#33394;&#12434;&#21453;&#26144;&#12373;&#12379;&#12394;&#12356;"</span>
    (<span style="color: #FF7F7F;">interactive</span>)
    (<span style="color: #FF7F7F;">setq-local</span> my:eww-disable-colorize t)
    (eww-reload))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">eww-enable-color</span> ()
    <span style="color: #7FFF7F;">"eww &#12391;&#25991;&#23383;&#33394;&#12434;&#21453;&#26144;&#12373;&#12379;&#12427;"</span>
    (<span style="color: #FF7F7F;">interactive</span>)
    (<span style="color: #FF7F7F;">setq-local</span> my:eww-disable-colorize nil)
    (eww-reload))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12486;&#12461;&#12473;&#12488;&#24133;&#12434; 70 &#12395;&#22266;&#23450;</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">- </span><span style="text-decoration: underline;"><a href="http://emacs.rubikitch.com/eww-width/">Emacs&#32068;&#12415;&#36796;&#12415;Web&#12502;&#12521;&#12454;&#12470;EWW&#12391;&#12486;&#12461;&#12473;&#12488;&#12398;&#27178;&#24133;&#12434;&#25351;&#23450;&#12377;&#12427;&#26041;&#27861;</a></span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">shr-insert-document--for-eww</span> (<span style="color: #FFFF7F;">&amp;rest</span> them)
    (<span style="color: #FF7F7F;">let</span> ((shr-width 70)) (apply them)))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">eww-display-html--fill-column</span> (<span style="color: #FFFF7F;">&amp;rest</span> them)
    (advice-add 'shr-insert-document <span style="color: #7FBFFF;">:around</span> 'shr-insert-document--for-eww)
    (<span style="color: #FF7F7F;">unwind-protect</span>
        (apply them)
      (advice-remove 'shr-insert-document 'shr-insert-document--for-eww)))
  (advice-add 'eww-display-html <span style="color: #7FBFFF;">:around</span> 'eww-display-html--fill-column)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org10aa1c4" class="outline-3">
<h3 id="org10aa1c4"><code>browse-url</code></h3>
<div class="outline-text-3" id="text-org10aa1c4">
<p>
Firefox の呼び出し方が変わったので，そのために関数を追加．
詳細は <a href="http://www.emacswiki.org/emacs/BrowseUrl">http://www.emacswiki.org/emacs/BrowseUrl</a> を参照のこと．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">browse-url</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-c C-j"</span> . browse-url-at-point))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">browse-url-firefox</span> (url <span style="color: #FFFF7F;">&amp;optional</span> new-window)
    <span style="color: #7FFF7F;">"@see </span><span style="text-decoration: underline;"><a href="http://www.emacswiki.org/emacs/BrowseUrl">http://www.emacswiki.org/emacs/BrowseUrl</a></span><span style="color: #7FFF7F;">"</span>
    (<span style="color: #FF7F7F;">interactive</span> (browse-url-interactive-arg <span style="color: #7FFF7F;">"URL: "</span>))
    (<span style="color: #FF7F7F;">setq</span> url (browse-url-encode-url url))
    (<span style="color: #FF7F7F;">let*</span> ((process-environment (browse-url-process-environment))
           (window-args (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">browse-url-maybe-new-window</span> new-window)
                            (<span style="color: #FF7F7F;">if</span> browse-url-firefox-new-window-is-tab
                                '(<span style="color: #7FFF7F;">"-new-tab"</span>)
                              '(<span style="color: #7FFF7F;">"-new-window"</span>))))
           (ff-args (append browse-url-firefox-arguments window-args (list url)))
           (process-name (concat <span style="color: #7FFF7F;">"firefox "</span> url))
           (process (apply 'start-process process-name nil
                           browse-url-firefox-program ff-args) ))))
  (<span style="color: #FF7F7F;">setq</span> browse-url-browser-function 'browse-url-firefox)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org0c00ceb" class="outline-3">
<h3 id="org0c00ceb"><code>server</code>: Emacs server</h3>
<div class="outline-text-3" id="text-org0c00ceb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">server</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">unless</span> (server-running-p)
    (server-start)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3bd8022" class="outline-2">
<h2 id="org3bd8022">日本語入力: <code>ddskk</code></h2>
<div class="outline-text-2" id="text-org3bd8022">
<p>
<a href="http://openlab.ring.gr.jp/skk/ddskk-ja.html">Daredevil SKK (DDSKK)</a> をメインで使用中．無いと途方に暮れる．
ちなみにGTKが有効になっていると <code>gtk-immodule</code> なんかと衝突するので
<code>~/.Xresources</code> で xim を無効にしておくと良い．
例えば以下の様に:
</p>
<div class="org-src-container">
<pre class="src src-conf">! disable XIM
Emacs*useXIM: false
</pre>
</div>
</div>
<div id="outline-container-org75e1d99" class="outline-3">
<h3 id="org75e1d99">Emacs 本体側の設定</h3>
<div class="outline-text-3" id="text-org75e1d99">
<p>
実際の設定は別ファイルで行なわれるため
ここでは設定ファイルの位置変更を変更している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">skk</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x j"</span>   . skk-mode)
         (<span style="color: #7FFF7F;">"C-x C-j"</span> . skk-mode)
         (<span style="color: #7FFF7F;">"C-\\"</span>    . skk-mode))
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> skk-user-directory (concat my:d:tmp <span style="color: #7FFF7F;">"skk"</span>)
        skk-init-file (concat user-emacs-directory <span style="color: #7FFF7F;">"init-ddskk"</span>)
        default-input-method <span style="color: #7FFF7F;">"japanese-skk"</span> )
  <span style="color: #7FBFFF;">:config</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orge62a055" class="outline-3">
<h3 id="orge62a055">DDSKK 本体の設定</h3>
<div class="outline-text-3" id="text-orge62a055">
<p>
sticky shift: <a href="http://homepage1.nifty.com/blankspace/emacs/sticky.html">sticky shift</a> を参照のこと.
ddskk の 14.2 以降から同梱されるようになった(ありがたい)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-sticky-key <span style="color: #7FFF7F;">";"</span>)
</pre>
</div>
<p>
変換候補の表示位置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-show-candidates-always-pop-to-buffer t)
</pre>
</div>
<p>
候補表示件数を2列に
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-henkan-show-candidates-rows 2)
</pre>
</div>
<p>
日本語表示しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-japanese-message-and-error nil)
</pre>
</div>
<p>
メニューを日本語にしない -&gt; toolbar 非表示だし.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-show-japanese-menu nil)
</pre>
</div>
<p>
注釈の表示
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-show-annotation nil)
</pre>
</div>
<p>
インジケータの表示のカスタマイズ
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-latin-mode-string <span style="color: #7FFF7F;">"[_A]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-hiragana-mode-string <span style="color: #7FFF7F;">"[&#12354;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-katakana-mode-string <span style="color: #7FFF7F;">"[&#12450;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-jisx0208-latin-mode-string <span style="color: #7FFF7F;">"[&#65313;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-jisx0201-mode-string <span style="color: #7FFF7F;">"[_&#65393;]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-abbrev-mode-string <span style="color: #7FFF7F;">"[aA]"</span>)
(<span style="color: #FF7F7F;">setq</span> skk-indicator-use-cursor-color nil)
</pre>
</div>
<p>
インジケータを左端に表示
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-status-indicator 'left)
</pre>
</div>
<p>
mode-line が動くのが許せないので，ちょっと修正
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">skk-make-indicator-alist</span>
    (after my:set-skk-default-indicator activate)
  (<span style="color: #FF7F7F;">dolist</span> (elem
           '((abbrev <span style="color: #7FFF7F;">" [aA]"</span> . <span style="color: #7FFF7F;">"--[aA]:"</span>)
             (latin <span style="color: #7FFF7F;">" [_A]"</span> . <span style="color: #7FFF7F;">"--[_A]:"</span>)
             (default <span style="color: #7FFF7F;">" [--]"</span> . <span style="color: #7FFF7F;">"--[--]:"</span>)))
    (<span style="color: #FF7F7F;">setq</span> ad-return-value
          (append (cons elem nil)
                  (delq (assoc (car elem) ad-return-value) ad-return-value)))))
(<span style="color: #FF7F7F;">setq</span> skk-show-inline t)
</pre>
</div>
<p>
カーソルには色をつけない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-use-color-cursor nil)
</pre>
</div>
</div>
<div id="outline-container-org1eba988" class="outline-4">
<h4 id="org1eba988">編集関連</h4>
<div class="outline-text-4" id="text-org1eba988">
<p>
キーバインド
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key <span style="color: #7FFF7F;">"\C-x\C-j"</span> 'skk-mode)
(global-set-key <span style="color: #7FFF7F;">"\C-xj"</span> 'skk-mode)
(global-set-key <span style="color: #7FFF7F;">"\C-j"</span> 'skk-mode)
(global-set-key <span style="color: #7FFF7F;">"\C-\\"</span> 'skk-mode)
</pre>
</div>
<p>
半角カナを入力
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-use-jisx0201-input-method t)
</pre>
</div>
<p>
Enter で改行しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-egg-like-newline t)
</pre>
</div>
<p>
"「"を入力したら"」"も自動で挿入
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-auto-insert-paren t)
</pre>
</div>
<p>
句読点変換ルール
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-kuten-touten-alist
      '(
        (jp    . (<span style="color: #7FFF7F;">"&#12290;"</span> . <span style="color: #7FFF7F;">"&#12289;"</span>))
        (en-jp . (<span style="color: #7FFF7F;">"&#65294;"</span> . <span style="color: #7FFF7F;">"&#65292;"</span>))
        (en    . (<span style="color: #7FFF7F;">". "</span> . <span style="color: #7FFF7F;">", "</span>))
        ))
(<span style="color: #FF7F7F;">setq-default</span> skk-kutouten-type 'en)
</pre>
</div>
<p>
全角記号の変換: @ での日付入力は使わない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-rom-kana-rule-list
      (append skk-rom-kana-rule-list
              '((<span style="color: #7FFF7F;">"!"</span> nil <span style="color: #7FFF7F;">"!"</span>)
                (<span style="color: #7FFF7F;">":"</span> nil <span style="color: #7FFF7F;">":"</span>)
                (<span style="color: #7FFF7F;">";"</span> nil <span style="color: #7FFF7F;">";"</span>)
                (<span style="color: #7FFF7F;">"?"</span> nil <span style="color: #7FFF7F;">"?"</span>)
                (<span style="color: #7FFF7F;">"z "</span> nil <span style="color: #7FFF7F;">"&#12288;"</span>)
                (<span style="color: #7FFF7F;">"\\"</span> nil <span style="color: #7FFF7F;">"\\"</span>)
                (<span style="color: #7FFF7F;">"@"</span> nil <span style="color: #7FFF7F;">"@"</span>)
                )))
</pre>
</div>
<p>
送り仮名が厳密に正しい候補を優先
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-henkan-strict-okuri-precedence t)
</pre>
</div>
<p>
辞書の共有
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-share-private-jisyo t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org67f5019" class="outline-4">
<h4 id="org67f5019">インクリメンタルサーチ</h4>
<div class="outline-text-4" id="text-org67f5019">
<p>
minibuffer 内では強制的に skk off.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'skk-mode-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (<span style="color: #FF7F7F;">and</span> (skk-in-minibuffer-p)
                 (skk-mode-exit))))
(<span style="color: #FF7F7F;">setq</span> skk-isearch-start-mode 'latin)
</pre>
</div>
<p>
インクリメンタルサーチは migemo に任せることに．
</p>
</div>
</div>
<div id="outline-container-org6d86eb6" class="outline-4">
<h4 id="org6d86eb6">辞書の設定</h4>
<div class="outline-text-4" id="text-org6d86eb6">
<p>
追加している辞書の一覧は
</p>
<ul class="org-ul">
<li><a href="http://www.chibutsu.org/jisho/">地球物理辞書</a></li>
<li><a href="http://www.geocities.jp/living_with_plasma/tanudic.html">天文・天体物理用語の漢字変換用辞書</a></li>
<li>はてなキーワード</li>
<li><a href="http://matsucon.net/material/dic/">2ちゃんねる顔文字辞書 MatsuCon</a></li>
<li><a href="http://matsucon.net/">MatsuCon</a></li>
</ul>
<p>
といった所.
はてなキーワードからの辞書の抽出は <a href="http://d.hatena.ne.jp/znz">znz</a> さんの
</p>
<ul class="org-ul">
<li><a href="http://rubyist.g.hatena.ne.jp/znz/20060924/p1">「はてなダイアリーキーワードふりがなリスト」を SKK の辞書に変換</a></li>
</ul>
<p>
を参考に.
<a href="http://matsucon.net/">MatsuCon</a> で公開されている顔文字に関しては
顔文字に ; や が含まれている場合に, 適宜quoteする必要があるので
以下のスクリプトで適当に変換.
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #a5a5a6;">#</span><span style="color: #a5a5a6;">!/usr/bin/env ruby</span>
<span style="color: #7FBFFF;">require</span> <span style="color: #7FFF7F;">'nkf'</span>
src = <span style="color: #FFFF7F;">ARGV</span>[0]
<span style="color: #FF7F7F;">if</span> <span style="color: #FFFF7F;">ARGV</span>.size &lt; 1
  <span style="color: #7FBFFF;">puts</span> <span style="color: #7FFF7F;">"usage: ime2skk.rb ime_dictionary"</span>
  <span style="color: #7FBFFF;">exit</span> 0
<span style="color: #FF7F7F;">end</span>
<span style="color: #FFFF7F;">File</span>.open(src, <span style="color: #7FFF7F;">"r"</span>) {|f|
  f.each <span style="color: #FF7F7F;">do</span> |line|
    line_euc = <span style="color: #FFFF7F;">NKF</span>.nkf(<span style="color: #7FFF7F;">"-S -e"</span>,line)
    <span style="color: #FF7F7F;">if</span> line_euc =~ <span style="color: #7FFF7F;">/^([^!]+?)\t(.+?)\t.+$/</span>
      entry = <span style="color: #7FBFFF;">$1</span>
      content = <span style="color: #7FBFFF;">$2</span>
      <span style="color: #FF7F7F;">if</span> content =~<span style="color: #7FFF7F;">/;/</span>
        <span style="color: #7FBFFF;">puts</span> entry + <span style="color: #7FFF7F;">" /(concat \""</span> + content.gsub(<span style="color: #7FFF7F;">';'</span>,<span style="color: #7FFF7F;">'\\\\073'</span>) + <span style="color: #7FFF7F;">"\")/"</span>
      <span style="color: #FF7F7F;">elsif</span> content =~<span style="color: #7FFF7F;">/\//</span>
        <span style="color: #7FBFFF;">puts</span> entry + <span style="color: #7FFF7F;">" /(concat \""</span> + content.gsub(<span style="color: #7FFF7F;">'/'</span>,<span style="color: #7FFF7F;">'\\\\057'</span>) + <span style="color: #7FFF7F;">"\")/"</span>
      <span style="color: #FF7F7F;">else</span>
        <span style="color: #7FBFFF;">puts</span> entry + <span style="color: #7FFF7F;">" /"</span> + content + <span style="color: #7FFF7F;">"/"</span>
      <span style="color: #FF7F7F;">end</span>
    <span style="color: #FF7F7F;">end</span>
  <span style="color: #FF7F7F;">end</span>
}
</pre>
</div>
<p>
他にも quote する必要あるような気もするけれど, それは気がついた時に.
</p>

<p>
辞書サーバの指定は以下.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">cond</span>
 ((getenv <span style="color: #7FFF7F;">"SKKSERVER"</span>)
  (<span style="color: #FF7F7F;">setq</span> skk-server-host <span style="color: #7FFF7F;">"127.0.0.1"</span>
        skk-server-portnum <span style="color: #7FFF7F;">"1178"</span>
        skk-large-jisyo  nil)
  (add-to-list 'skk-search-prog-list
               '(skk-server-completion-search) t)
  (add-to-list 'skk-search-prog-list
               '(skk-comp-by-server-completion) t))
 (t
  (<span style="color: #FF7F7F;">setq</span> skk-get-jisyo-directory (concat my:d:tmp <span style="color: #7FFF7F;">"skk-jisyo"</span>)
        skk-large-jisyo (concat skk-get-jisyo-directory <span style="color: #7FFF7F;">"/SKK-JISYO.L"</span>)))
 )
</pre>
</div>
<p>
辞書登録の際に送り仮名を削除
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-check-okurigana-on-touroku 'auto)
</pre>
</div>
<p>
漢字登録のミスをチェックする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> skk-check-okurigana-on-touroku t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org199b263" class="outline-4">
<h4 id="org199b263">動的補完</h4>
<div class="outline-text-4" id="text-org199b263">
<p>
まだ設定していない&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">;; &#21205;&#30340;&#35036;&#23436;</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(setq skk-dcomp-activate t)</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(setq skk-dcomp-multiple-activate t)</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(setq skk-dcomp-multiple-rows 5)</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">;; &#21205;&#30340;&#35036;&#23436;&#12398;&#35079;&#25968;&#34920;&#31034;&#32676;&#12398;&#12501;&#12455;&#12452;&#12473;</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-foreground 'skk-dcomp-multiple-face "Black")</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-background 'skk-dcomp-multiple-face "LightGoldenrodYellow")</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-bold-p 'skk-dcomp-multiple-face nil)</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">;; &#21205;&#30340;&#35036;&#23436;&#12398;&#35079;&#25968;&#34920;&#31034;&#37089;&#12398;&#35036;&#23436;&#37096;&#20998;&#12398;&#12501;&#12455;&#12452;&#12473;</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-foreground 'skk-dcomp-multiple-trailing-face "dim gray")</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-bold-p 'skk-dcomp-multiple-trailing-face nil)</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">;; &#21205;&#30340;&#35036;&#23436;&#12398;&#35079;&#25968;&#34920;&#31034;&#37089;&#12398;&#36984;&#25246;&#23550;&#35937;&#12398;&#12501;&#12455;&#12452;&#12473;</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-foreground 'skk-dcomp-multiple-selected-face "White")</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-background 'skk-dcomp-multiple-selected-face "LightGoldenrod4")</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-face-bold-p 'skk-dcomp-multiple-selected-face nil)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8d9034a" class="outline-4">
<h4 id="org8d9034a">部首変換, 総画数変換</h4>
<div class="outline-text-4" id="text-org8d9034a">
<p>
上手く使いこなせていない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'skk-search-prog-list
             '(skk-tankan-search 'skk-search-jisyo-file
                                 skk-large-jisyo 10000))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb61010b" class="outline-2">
<h2 id="orgb61010b">Copy &amp; Paste: <code>xclip</code></h2>
<div class="outline-text-2" id="text-orgb61010b">
<p>
<code>xclip</code> で clipboard とデータをやりとり．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">xclip</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"xclip"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (turn-on-xclip))
</pre>
</div>
<p>
clipboard と PRIMARY の同期には <code>gpaste</code> を使っている．
</p>
</div>
</div>
<div id="outline-container-org4d685e8" class="outline-2">
<h2 id="org4d685e8">Elscreen <code>[/]</code></h2>
<div class="outline-text-2" id="text-org4d685e8">
<p>
modeline の表示そのものは無効化しておく．
</p>
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Debian パッケージ版は古い．更新すべき</li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">elscreen</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> elscreen-tab-display-control nil)
  (<span style="color: #FF7F7F;">setq</span> elscreen-prefix-key (kbd <span style="color: #7FFF7F;">"C-o"</span>))
  (<span style="color: #FF7F7F;">setq</span> elscreen-display-tab 8)
  (<span style="color: #FF7F7F;">setq</span> elscreen-display-screen-number nil)
  <span style="color: #7FBFFF;">:config</span>
  (elscreen-start))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4f17dc6" class="outline-2">
<h2 id="org4f17dc6">認証関連: <code>password-store</code></h2>
<div class="outline-text-2" id="text-org4f17dc6">
</div><div id="outline-container-orgccb2a7d" class="outline-3">
<h3 id="orgccb2a7d">id-manager の設定</h3>
<div class="outline-text-3" id="text-orgccb2a7d">
<p>
ID と Password の簡単な組の管理をするのに非常に重宝している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">id-manager</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (file-exists-p <span style="color: #7FFF7F;">"~/.gnupg/idm-db.gpg"</span>)
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FFF7F;">"M-7"</span> . idm-open-list-command)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> idm-database-file
        (expand-file-name <span style="color: #7FFF7F;">"~/.gnupg/idm-db.gpg"</span>))
  (<span style="color: #FF7F7F;">setq</span> idm-clipboard-expire-time-sec 30))
</pre>
</div>
</div>
</div>
<div id="outline-container-org1093679" class="outline-3">
<h3 id="org1093679">plstore</h3>
<div class="outline-text-3" id="text-org1093679">
<p>
デフォルトは対称鍵暗号化なので， <code>GPG_KEY_ID</code> を設定しておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">plstore</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> plstore-secret-keys 'silent
        plstore-encrypt-to (getenv <span style="color: #7FFF7F;">"GPG_KEY_ID"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org7177536" class="outline-3">
<h3 id="org7177536">oauth2</h3>
<div class="outline-text-3" id="text-org7177536">
<p>
oauth2 の認証情報は <code>plstore</code> で保存される．
ファイルの置き場所と暗号鍵の設定をしておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">oauth2</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> oauth2-token-file (concat my:d:tmp <span style="color: #7FFF7F;">"oauth2.plstore"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org60f38ee" class="outline-3">
<h3 id="org60f38ee">password-store</h3>
<div class="outline-text-3" id="text-org60f38ee">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">password-store</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> my:d:password-store
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org4ea74a5" class="outline-2">
<h2 id="org4ea74a5"><a id="ID-544e8091-614a-4784-a889-78651a923d6c"></a>MUA の設定: <code>wanderlust</code></h2>
<div class="outline-text-2" id="text-org4ea74a5">
<p>
MUA として Wanderlust を使っている
</p>
</div>
<div id="outline-container-org4d49572" class="outline-3">
<h3 id="org4d49572">Emacs 本体側の設定</h3>
<div class="outline-text-3" id="text-org4d49572">
<p>
Emacs 本体での設定は以下の通り. Wanderlust 自体の設定は別ファイルで行なわれる．
ここでは <code>wl-init-file</code> を指定することで，設定ファイルを明示している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">wl</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (<span style="color: #FF7F7F;">or</span> (my:dpkg-status <span style="color: #7FFF7F;">"wl"</span>)
               (my:dpkg-status <span style="color: #7FFF7F;">"wl-beta"</span>))
           (my:dpkg-status <span style="color: #7FFF7F;">"rail"</span>))
  <span style="color: #7FBFFF;">:commands</span> (wl wl-other-frame wl-draft wl-user-agent wl-user-agent-compose wl-draft-send wl-draft-kill)
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">unless</span> (package-installed-p 'gcontacts-get-wl)
    (quelpa '(gcontacts-get-wl
              <span style="color: #7FBFFF;">:fetcher</span> url
              <span style="color: #7FBFFF;">:url</span> <span style="color: #7FFF7F;">"https://raw.githubusercontent.com/uwabami/gcontacts-get-wl/master/gcontacts-get-wl.el"</span>)))
  (define-mail-user-agent
    'wl-user-agent
    'wl-user-agent-compose
    'wl-draft-send
    'wl-draft-kill
    'mail-send-hook)
  (<span style="color: #FF7F7F;">setq</span> elmo-msgdb-directory <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        elmo-maildir-folder-path <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        elmo-cache-directory <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        wl-score-files-directory <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
        wl-init-file (concat user-emacs-directory <span style="color: #7FFF7F;">"init-wl"</span>)
        mail-user-agent 'wl-user-agent
        read-mail-command 'wl)
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p elmo-msgdb-directory)
    (make-directory elmo-msgdb-directory))
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local"</span>))
    (make-directory (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local"</span>)))
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local/Trash"</span>))
    (make-directory (concat elmo-msgdb-directory <span style="color: #7FFF7F;">"/local/Trash"</span>)))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org711a3af" class="outline-3">
<h3 id="org711a3af">Wanderlust 本体の設定</h3>
<div class="outline-text-3" id="text-org711a3af">
<p>
実際の設定は以下の通り
</p>
</div>
<div id="outline-container-orgda20e29" class="outline-4">
<h4 id="orgda20e29">依存/追加ライブラリのインストールと読み込み</h4>
<div class="outline-text-4" id="text-orgda20e29">
</div><div id="outline-container-org0441655" class="outline-5">
<h5 id="org0441655">rail</h5>
<div class="outline-text-5" id="text-org0441655">
<p>
SEMI や FLIM などの UA の表示に <a href="http://uwabami.github.com/rail/">rail</a> を使っている.
ちなみに rail を有効にすると, 以下の様に User-Agent が表示される
</p>

<figure>
<img src="https://uwabami.github.io/software/rail/images/wanderlust_with_or_without_rail.png" alt="wanderlust_with_or_without_rail.png">

</figure>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">eval-when-compile</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">mime-def</span>))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rail</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> rail-emulate-genjis t))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbd36a3c" class="outline-5">
<h5 id="orgbd36a3c">cp5022x を使う</h5>
<div class="outline-text-5" id="text-orgbd36a3c">
<p>
ISO-2022-JP を CP50220 として扱う.
<a href="http://d.hatena.ne.jp/kiwanami/20091103/1257243524">Wanderlustと文字コード</a> も参照のこと.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'mime-charset-coding-system-alist '(iso-2022-jp . cp50220))
(<span style="color: #FF7F7F;">setq</span> wl-mime-charset 'iso-2022-jp)
</pre>
</div>
</div>
</div>
<div id="outline-container-org388d928" class="outline-5">
<h5 id="org388d928">gcontacts-get-wl</h5>
<div class="outline-text-5" id="text-org388d928">
<p>
<a href="https://github.com/uwabami/gcontacts-get-wl">gcontacts-get-wl</a> は
Google Contacts の連絡先を Wanderlust の <code>.Address</code> に出力するだけのパッケージ．
<a href="https://github.com/jd/google-contacts.el">google-contacs.el</a> の方が便利そうではあるものの「ふりがな」の扱いと，
オフラインでの処理を考えて，結局安直な方法を選んでしまった．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">gcontacts-get-wl</span>
  <span style="color: #7FBFFF;">:if</span> (my:dpkg-status <span style="color: #7FFF7F;">"wl-beta"</span>)
  <span style="color: #7FBFFF;">:commands</span> (gcontacts-update-wl-address)
  <span style="color: #7FBFFF;">:config</span>
  (load (expand-file-name <span style="color: #7FFF7F;">"emacs/gcontacts-get.gpg"</span> my:d:password-store)))
</pre>
</div>
<p>
oauth token は <code>pass</code> で管理している．中身は以下の通り
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> gcontacts-get-oauth-client-ID <span style="color: #7FFF7F;">"XXXXXXXXXXXXXXXX.apps.googleusercontent.com"</span>
      gcontacts-get-oauth-client-secret <span style="color: #7FFF7F;">"YYYYYYYYYYYYYYYYYYYYYYYYY"</span>
      gcontacts-get-ask nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-org9e105e7" class="outline-5">
<h5 id="org9e105e7">elscreen-wl</h5>
<div class="outline-text-5" id="text-org9e105e7">
<p>
メール作成時に <code>elscreen</code> と連携してくれる．便利
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">elscreen-wl</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org90753bd" class="outline-5">
<h5 id="org90753bd">SEMI の追加設定</h5>
<div class="outline-text-5" id="text-org90753bd">
<p>
HTML メールを表示するための設定: eww を使うことに．
mime-setup がロードされる前に記述する必要あり.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-view-text/html-previewer 'shr)
(<span style="color: #FF7F7F;">setq</span> mime-setup-enable-inline-html 'shr)
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(use-package mime-setup</span>
<span style="color: #a5a5a6;">;;   </span><span style="color: #a5a5a6;">:init</span>
<span style="color: #a5a5a6;">;;   </span><span style="color: #a5a5a6;">(defun shr-colorize-region (start end fg &amp;optional bg) nil))</span>
</pre>
</div>
<p>
どのアプリケーションで開くか → <code>xdg-open</code> に丸投げ．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-view-mailcap-files '(<span style="color: #7FFF7F;">"~/.mailcap"</span>))
</pre>
</div>
<p>
<code>~/.mailcap</code> 自体は以下
</p>
<div class="org-src-container">
<pre class="src src-conf">applications/*; xdg-open %s;
image/*; xdg-open %s;
video/*; xdg-open %s;
</pre>
</div>
<p>
MIME の例の保存先の変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-situation-examples-file
      (concat my:d:tmp <span style="color: #7FFF7F;">"mime-example"</span>))
</pre>
</div>
<p>
text/plain を html より優先 → 最近は html を表示している
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-alist 'mime-view-type-subtype-score-alist '(text . html) 0)</span>
</pre>
</div>
<p>
音を鳴らすアレやコレの無効化
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-play-find-every-situations nil
      mime-play-delete-file-immediately nil
      process-connection-type nil)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgab249b4" class="outline-4">
<h4 id="orgab249b4">個人情報の設定</h4>
<div class="outline-text-4" id="text-orgab249b4">
<p>
具体的な設定内容は以下のファイルに置いている
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">     (load (concat my:d:password-store <span style="color: #7FFF7F;">"/emacs/wl-info.gpg"</span>))
</pre>
</div>
<p>
設定している内容は以下の通り
</p>
</div>
<div id="outline-container-orgf57a738" class="outline-5">
<h5 id="orgf57a738">自身のメールアドレスと購読メーリングリストの設定</h5>
<div class="outline-text-5" id="text-orgf57a738">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">From: &#12398;&#35373;&#23450;</span>
(<span style="color: #FF7F7F;">setq</span> wl-from (concat user-full-name <span style="color: #7FFF7F;">" &lt;"</span> user-mail-address <span style="color: #7FFF7F;">"&gt;"</span>))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(system-name) &#12364; FQDN &#12434;&#36820;&#12373;&#12394;&#12356;&#22580;&#21512;&#12289;</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">`</span><span style="color: #FFBF7F;">wl-local-domain</span><span style="color: #a5a5a6;">' &#12395;&#12507;&#12473;&#12488;&#21517;&#12434;&#38500;&#12356;&#12383;&#12489;&#12513;&#12452;&#12531;&#21517;&#12434;&#35373;&#23450;</span>
(<span style="color: #FF7F7F;">setq</span> wl-local-domain <span style="color: #7FFF7F;">"example.com"</span>)
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#33258;&#20998;&#12398;&#12513;&#12540;&#12523;&#12450;&#12489;&#12524;&#12473;&#12398;&#12522;&#12473;&#12488;</span>
(<span style="color: #FF7F7F;">setq</span> wl-user-mail-address-list
      (list (wl-address-header-extract-address wl-from)
            <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">"e-mail2@example.com"</span>
            <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">"e-mail3@example.net" ...</span>
            ))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#33258;&#20998;&#12398;&#21442;&#21152;&#12375;&#12390;&#12356;&#12427;&#12513;&#12540;&#12522;&#12531;&#12464;&#12522;&#12473;&#12488;&#12398;&#12522;&#12473;&#12488;</span>
(<span style="color: #FF7F7F;">setq</span> wl-subscribed-mailing-list
      '(<span style="color: #7FFF7F;">"wl@lists.airs.net"</span>
        <span style="color: #7FFF7F;">"apel-ja@m17n.org"</span>
        <span style="color: #7FFF7F;">"emacs-mime-ja@m17n.org"</span>
        <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">"ml@example.com" ...</span>
        ))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgef751cd" class="outline-5">
<h5 id="orgef751cd">送受信用サーバの設定</h5>
<div class="outline-text-5" id="text-orgef751cd">
<p>
受信(IMAP)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-imap4-default-server <span style="color: #7FFF7F;">"your imap server"</span>)
(<span style="color: #FF7F7F;">setq</span> elmo-imap4-default-port '993)
(<span style="color: #FF7F7F;">setq</span> elmo-imap4-default-stream-type 'ssl)
</pre>
</div>
<p>
送信(SMTP)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-smtp-posting-server <span style="color: #7FFF7F;">"your smtp server"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-posting-user <span style="color: #7FFF7F;">"your account"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-posting-port 587)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-connection-type 'starttls)
(<span style="color: #FF7F7F;">setq</span> wl-smtp-authenticate-type <span style="color: #7FFF7F;">"login"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org51a6de2" class="outline-5">
<h5 id="org51a6de2">From に応じて送信サーバをきりかえる.</h5>
<div class="outline-text-5" id="text-org51a6de2">
<p>
本来はメール作成時/返信時の template の切り替えなのだれど,
送信時の SMTP の設定を from に合わせてきりかえるようにする.
default に二重に指定しているのは，
一度別のアカウントに切り替えた後に再びトグルして戻って来た際に元に戻す(上書き)するため.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-template-alist
      '((<span style="color: #7FFF7F;">"default"</span>
         (<span style="color: #7FFF7F;">"From"</span> . wl-from)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"your smtp server"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your account"</span>)
         (wl-smtp-posting-port . 587)
         (wl-smtp-connection-type . 'starttls)
         (wl-smtp-authenticate-type . <span style="color: #7FFF7F;">"login"</span>)
         )
        (<span style="color: #7FFF7F;">"example1"</span>
         (<span style="color: #7FFF7F;">"From"</span> . <span style="color: #7FFF7F;">"Your Name <a href="mailto:account%40example1.com">&lt;account@example1.com&gt;</a>"</span>)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"smtp.example1.com"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your account"</span>)
         (wl-smtp-posting-port . 587)
         (wl-smtp-connection-type . 'starttls)
         (wl-smtp-authenticate-type . <span style="color: #7FFF7F;">"login"</span>)
         )
        (<span style="color: #7FFF7F;">"example2"</span>
         (<span style="color: #7FFF7F;">"From"</span> . <span style="color: #7FFF7F;">"Your Name <a href="mailto:account%40example2.com">&lt;account@example2.com&gt;</a>"</span>)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"smtp.example2.com"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your account"</span>)
         (wl-smtp-posting-port . 587)
         (wl-smtp-connection-type . 'starttls)
         (wl-smtp-authenticate-type . <span style="color: #7FFF7F;">"plain"</span>)
         )
        (<span style="color: #7FFF7F;">"ssh:smtp"</span>
         <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">need ssh tunnel</span>
         <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">ssh -f -N -L 20025:localhost:25 smtp.server.com</span>
         (<span style="color: #7FFF7F;">"From"</span> . <span style="color: #7FFF7F;">"Your Name <a href="mailto:account%40example3.com">&lt;account@example3.com&gt;</a>"</span>)
         (wl-smtp-posting-server . <span style="color: #7FFF7F;">"localhost"</span>)
         (wl-smtp-posting-user . <span style="color: #7FFF7F;">"your ssh account"</span>)
         (wl-smtp-posting-port . 20025)
         (wl-smtp-connection-type . 'nil)
         (wl-smtp-authenticate-type . 'nil)
         )
        ))
</pre>
</div>
<p>
ssh tunnel を自動的にやる事はできないモンだろうか
(送信時に open して, 送信後に close する, みたいなの).
</p>

<p>
ついでに template の切り替えに関して幾つか設定.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">template &#20999;&#12426;&#26367;&#12360;&#26178;&#12395; &#20869;&#23481;&#12434;&#34920;&#31034;</span>
(<span style="color: #FF7F7F;">setq</span> wl-template-visible-select t)
</pre>
</div>
<p>
<code>draft-mode</code> で <code>C-c C-n</code> をするとテンプレートを切り替え
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c\C-n"</span> 'wl-template-select)
</pre>
</div>
<p>
from に応じて wl-from, wl-envelope-from,
送信 smtp サーバを変更する送信時に変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'wl-draft-send-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (set (make-local-variable 'wl-from)
                 (std11-fetch-field <span style="color: #7FFF7F;">"From"</span>))))
</pre>
</div>
<p>
送信時に自動的に wl-draft-config-alist を適用&#x2026;しない?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(remove-hook 'wl-draft-send-hook 'wl-draft-config-exec)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge28f739" class="outline-4">
<h4 id="orge28f739">基本設定</h4>
<div class="outline-text-4" id="text-orge28f739">
</div><div id="outline-container-org3228f00" class="outline-5">
<h5 id="org3228f00">imap 関連</h5>
<div class="outline-text-5" id="text-org3228f00">
<p>
デフォルトの認証設定
フォルダ名は UTF-7 でエンコードされているので,
表示する際にこれをデコードする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-imap4-use-modified-utf7 t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org123ba63" class="outline-5">
<h5 id="org123ba63">非同期チェック</h5>
<div class="outline-text-5" id="text-org123ba63">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-folder-check-async t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org078d130" class="outline-5">
<h5 id="org078d130">フォルダの位置の default からの変更</h5>
<div class="outline-text-5" id="text-org078d130">
<p>
<code>~/.cache/wanderlust/</code> に集約している
local の Mail folder の位置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-maildir-folder-path <span style="color: #7FFF7F;">"~/.cache/wanderlust"</span>
      elmo-localdir-folder-path <span style="color: #7FFF7F;">"~/.cache/wanderlust/local"</span>)
</pre>
</div>
<p>
local フォルダの設定:
<code>.lost+found</code> は <code>elmo-maildir-folder-path</code> からの相対パスになっていることに注意
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-lost+found-folder <span style="color: #7FFF7F;">".lost+found"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-queue-folder <span style="color: #7FFF7F;">"+queue"</span>)
</pre>
</div>
<p>
folders の位置の変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-folders-file (concat my:d:password-store <span style="color: #7FFF7F;">"/emacs/wl-folders.gpg"</span>))
</pre>
</div>
<p>
Drafts, Trash の置き場所
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-folder <span style="color: #7FFF7F;">"+Drafts"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-trash-folder <span style="color: #7FFF7F;">"+Trash"</span>)
(<span style="color: #FF7F7F;">setq</span> elmo-lost+found-folder <span style="color: #7FFF7F;">"+lost+found"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-temporary-file-directory <span style="color: #7FFF7F;">"~/Downloads/"</span>)
</pre>
</div>
<p>
アドレス帳 -&gt; gcontacts-get-wlを使う.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-use-petname t)
(<span style="color: #FF7F7F;">setq</span> wl-address-file  <span style="color: #7FFF7F;">"~/.mua/Address.wl"</span>)
</pre>
</div>
<p>
LDAP サーバからアドレスを引くことも可能.
以前は GCALDaemon を使って local に ldap サーバを上げていたのだけれども,
Google Contacts の API が変わったらしく
GCALDaemon で LDAP サーバは使えなくなったのでコメントアウト.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-use-ldap t)
(<span style="color: #FF7F7F;">setq</span> wl-ldap-server <span style="color: #7FFF7F;">"localhost"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-ldap-port <span style="color: #7FFF7F;">"389"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-ldap-base <span style="color: #7FFF7F;">"dc=math,dc=kyoto-u,dc=ac,dc=jp"</span>)
</pre>
</div>
<p>
パスワードの保存先
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-passwd-alist-file-name (concat my:d:password-store <span style="color: #7FFF7F;">"/emacs/wl-passwd.gpg"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcee53ef" class="outline-5">
<h5 id="orgcee53ef">フォルダ編集時に backup を作成しない.</h5>
<div class="outline-text-5" id="text-orgcee53ef">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-fldmgr-make-backup nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-org7b7a37a" class="outline-5">
<h5 id="org7b7a37a">FCC, BCC の設定</h5>
<div class="outline-text-5" id="text-org7b7a37a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-fcc nil)
     <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(setq wl-fcc "%Sent")</span>
</pre>
</div>
<p>
fcc を既読にする場合は以下．=wl-fcc= が nil の場合には意味は無い
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-fcc-force-as-read t)
</pre>
</div>
<p>
bcc は常に自身に.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-bcc (concat user-mail-address))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga22a6fd" class="outline-5">
<h5 id="orga22a6fd">起動時に <code>%INBOX</code> のみをチェック</h5>
<div class="outline-text-5" id="text-orga22a6fd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-auto-check-folder-name <span style="color: #7FFF7F;">"%INBOX"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org28e3e62" class="outline-5">
<h5 id="org28e3e62">フォルダ選択時の初期設定</h5>
<div class="outline-text-5" id="text-org28e3e62">
<p>
imap の namespace を毎度入力するのが面倒なので，これを追加しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-default-spec <span style="color: #7FFF7F;">"%"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcfc2fce" class="outline-5">
<h5 id="orgcfc2fce">confirm 関連の設定</h5>
<div class="outline-text-5" id="text-orgcfc2fce">
<p>
スキャン時の問い合わせの無効化.
ちなみに confirm を nil にしても 問い合わせが無いだけで
threshold は効くので, 明示的に nil に.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-folder-update-confirm nil)
(<span style="color: #FF7F7F;">setq</span> elmo-folder-update-threshold nil)
(<span style="color: #FF7F7F;">setq</span> elmo-message-fetch-confirm nil)
(<span style="color: #FF7F7F;">setq</span> elmo-message-fetch-threshold nil)
(<span style="color: #FF7F7F;">setq</span> wl-prefetch-confirm nil)
(<span style="color: #FF7F7F;">setq</span> wl-prefetch-threshold nil)
</pre>
</div>
<p>
終了時に確認しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-interactive-exit nil)
</pre>
</div>
<p>
送信時は確認する   :tangle init-wl.el
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-interactive-send t)
</pre>
</div>
</div>
</div>
<div id="outline-container-orga7145b3" class="outline-5">
<h5 id="orga7145b3">misc.</h5>
<div class="outline-text-5" id="text-orga7145b3">
<p>
大きいメッセージを送信時に分割しない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-edit-split-message nil)
</pre>
</div>
<p>
スレッドは常に閉じる
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-thread-insert-opened nil)
</pre>
</div>
<p>
3 pain 表示 -&gt; 使わない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-stay-folder-window nil)
</pre>
</div>
<p>
未読を優先的に読む
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-move-order 'unread)
</pre>
</div>
<p>
改ページ無視
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-break-pages nil)
</pre>
</div>
<p>
icon を使わない → GUI でもメニュー表示してないし, 体感的には遅くなる
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-highlight-folder-with-icon nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-org5163fd5" class="outline-5">
<h5 id="org5163fd5">dispose, delete の設定</h5>
<div class="outline-text-5" id="text-org5163fd5">
<p>
Gmail用に%INBOXでは削除を <code>wl-trash-folder</code> への移動ではなく，「delete」に．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'wl-dispose-folder-alist
             '(<span style="color: #7FFF7F;">"^%INBOX"</span> . remove))
</pre>
</div>
<p>
迷惑メール関連も
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'wl-dispose-folder-alist
             '(<span style="color: #7FFF7F;">".*Junk$"</span> . remove))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb212748" class="outline-5">
<h5 id="orgb212748">折り返しの設定</h5>
<div class="outline-text-5" id="text-orgb212748">
<p>
message は折り返す.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-truncate-lines nil)
</pre>
</div>
<p>
draft も折り返す
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-truncate-lines nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-org37c68b3" class="outline-5">
<h5 id="org37c68b3">mode-line の設定</h5>
<div class="outline-text-5" id="text-org37c68b3">
<p>
長いと嫌なのでイロイロ削る
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-mode-line-format <span style="color: #7FFF7F;">""</span>) <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">"%f &#123;%t}(%n/%u/%a)"</span>
(<span style="color: #FF7F7F;">setq</span> wl-message-mode-line-format <span style="color: #7FFF7F;">""</span>) <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">"&lt;&lt; %f:%F&gt;&gt; [%m]"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org94d465c" class="outline-4">
<h4 id="org94d465c">キーバインド関連</h4>
<div class="outline-text-4" id="text-org94d465c">
<p>
<code>use-package</code> で設定しておいた方が良いかなぁ&#x2026;
<code>&lt;f2&gt;</code> で Addrbook の更新
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key [f2] 'gcontacts-update-wl-address)
</pre>
</div>
<p>
<code>C-c C-j</code> を browse-url に明け渡す
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c\C-j"</span> 'browse-url-at-point)
</pre>
</div>
<p>
<code>M-u</code> で unread にする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\M-u"</span> 'wl-summary-mark-as-unread)
</pre>
</div>
<p>
<code>i</code> で sync &lt;- Mew 風
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"i"</span> 'wl-summary-sync-update)
</pre>
</div>
<p>
<code>C-o</code> は elscreen で使う
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\C-o"</span> nil )
</pre>
</div>
<p>
<code>M-o</code> で <code>auto-refile</code>  (Mew 風)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"\M-o"</span> 'wl-summary-auto-refile)
</pre>
</div>
</div>
</div>
<div id="outline-container-org7765fba" class="outline-4">
<h4 id="org7765fba">flag とフォルダを行き来する関数の追加</h4>
<div class="outline-text-4" id="text-org7765fba">
<p>
以前は flag 付きフォルダを設定していたので使っていたが,
最近は <code>mu find flag:Flagged</code> の結果を仮想フォルダにしているので
以下の関数は使っていない.
</p>

<p>
"=" でフラグ付きフォルダと
実際にメッセージのあるフォルダを行き来する.
Gmail の「スター付き」フォルダでも有効
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">elmo</span> nil 'noerror)
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:wl-summary-jump-to-referer-message</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">when</span> (wl-summary-message-number)
    (<span style="color: #FF7F7F;">if</span> (eq (elmo-folder-type-internal wl-summary-buffer-elmo-folder) 'flag)
        (<span style="color: #FF7F7F;">progn</span>
          (<span style="color: #FF7F7F;">let*</span> ((referer (elmo-flag-folder-referrer
                           wl-summary-buffer-elmo-folder
                           (wl-summary-message-number)))
                 (folder (<span style="color: #FF7F7F;">if</span> (&gt; (length referer) 1)
                             (completing-read
                              (format <span style="color: #7FFF7F;">"Jump to (%s): "</span> (car (car referer)))
                              referer
                              nil t nil nil (car (car referer)))
                           (car (car referer)))))
            (wl-summary-goto-folder-subr folder 'no-sync nil nil t)
            (wl-summary-jump-to-msg (cdr (assoc folder referer)))))
      (<span style="color: #FF7F7F;">when</span> (eq (elmo-folder-type wl-summary-last-visited-folder) 'internal)
        (wl-summary-goto-last-visited-folder)))))
(define-key wl-summary-mode-map <span style="color: #7FFF7F;">"="</span> 'my:wl-summary-jump-to-referer-message)
</pre>
</div>
</div>
</div>
<div id="outline-container-org484fdc9" class="outline-4">
<h4 id="org484fdc9">summary-mode の表示のカスタマイズ</h4>
<div class="outline-text-4" id="text-org484fdc9">
</div><div id="outline-container-org35e24c6" class="outline-5">
<h5 id="org35e24c6">自分が差出人である mail は To:某 と表示</h5>
<div class="outline-text-5" id="text-org35e24c6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-showto-folder-regexp <span style="color: #7FFF7F;">".*"</span>)
(<span style="color: #FF7F7F;">setq</span> wl-summary-from-function 'wl-summary-default-from)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfd131ab" class="outline-5">
<h5 id="orgfd131ab">サマリ行の表示関連</h5>
<div class="outline-text-5" id="text-orgfd131ab">
<p>
サマリ行のフォーマット指定
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-line-format
      <span style="color: #7FFF7F;">"%T%P%1@%1&gt;%Y/%M/%D %21(%t%[%19(%c %f%)%]%) %#%~%s"</span>)
</pre>
</div>
<p>
サマリ表示は切り詰めない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-subject-length-limit t)
</pre>
</div>
<p>
スレッドの幅の指定
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-thread-indent-level 2)
(<span style="color: #FF7F7F;">setq</span> wl-thread-have-younger-brother-str <span style="color: #7FFF7F;">"+"</span>
      wl-thread-youngest-child-str <span style="color: #7FFF7F;">"+"</span>
      wl-thread-vertical-str <span style="color: #7FFF7F;">"|"</span>
      wl-thread-horizontal-str <span style="color: #7FFF7F;">"-"</span>
      wl-thread-space-str <span style="color: #7FFF7F;">" "</span>)
</pre>
</div>

<p>
以下の二つの設定を有効にするには
<code>elmo-msgdb-extra-fields</code> を設定する必要がある.
この変数は振り分け判定にも使用するのでそこで設定している
</p>
</div>
</div>
<div id="outline-container-org7027834" class="outline-5">
<h5 id="org7027834">Gmail 風に, 自分宛のメールに "&gt;" をつけて表示する</h5>
<div class="outline-text-5" id="text-org7027834">
<p>
元ネタ <a href="http://d.hatena.ne.jp/khiker/20080206/wanderlust">http://d.hatena.ne.jp/khiker/20080206/wanderlust</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-user-mail-address-regexp <span style="color: #7FFF7F;">"^uwabami.*</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">^sasakyh.*"</span>)
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#19968;&#35239;&#34920;&#31034;&#12391;&#12398;&#32622;&#12365;&#25563;&#12360;&#35215;&#21063;&#12395;&#36861;&#21152;</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:wl-summary-line-for-me</span> ()
  (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">catch</span> '<span style="color: #FFBF7F;">found</span>
        (<span style="color: #FF7F7F;">let</span> ((to (elmo-message-entity-field wl-message-entity 'to))
              (cc (elmo-message-entity-field wl-message-entity 'cc)))
          (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">or</span> (stringp to) cc)
            (<span style="color: #FF7F7F;">setq</span> to
                  (append (<span style="color: #FF7F7F;">if</span> (stringp to) (list to) to)
                          (<span style="color: #FF7F7F;">when</span> cc
                            (<span style="color: #FF7F7F;">if</span> (stringp cc) (list cc) cc)))))
          (<span style="color: #FF7F7F;">dolist</span> (i to)
            (<span style="color: #FF7F7F;">when</span> (wl-address-user-mail-address-p (eword-decode-string i))
              (<span style="color: #FF7F7F;">throw</span> '<span style="color: #FFBF7F;">found</span> t)))))
      <span style="color: #7FFF7F;">"&gt;"</span>
    <span style="color: #7FFF7F;">""</span>))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&gt; &#12434; summary-line-format &#12395;&#36861;&#21152;</span>
(<span style="color: #FF7F7F;">setq</span> wl-summary-line-format-spec-alist
      (append wl-summary-line-format-spec-alist
              '((?&gt; (my:wl-summary-line-for-me)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org821d424" class="outline-5">
<h5 id="org821d424">添付ファイルがあったら, サマリ行に "@" を付ける</h5>
<div class="outline-text-5" id="text-org821d424">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-line-format-spec-alist
      (append wl-summary-line-format-spec-alist
              '((?@ (wl-summary-line-attached)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org2ec85f6" class="outline-5">
<h5 id="org2ec85f6">クォートされた文字列もデコードする</h5>
<div class="outline-text-5" id="text-org2ec85f6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-header-lexical-analyzer
      '(
        <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">eword-analyze-quoted-string</span>
        eword-analyze-domain-literal
        eword-analyze-comment
        eword-analyze-spaces
        eword-analyze-special
        eword-analyze-encoded-word
        eword-analyze-atom))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbff765a" class="outline-5">
<h5 id="orgbff765a">Subject が変わってもスレッドを切らない</h5>
<div class="outline-text-5" id="text-orgbff765a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-divide-thread-when-subject-changed nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb06f7ba" class="outline-5">
<h5 id="orgb06f7ba">Subject での Tab や複数スペースを無視</h5>
<div class="outline-text-5" id="text-orgb06f7ba">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">std11-unfold-string</span> (after simply activate)
  (<span style="color: #FF7F7F;">setq</span> ad-return-value
        (elmo-replace-in-string ad-return-value <span style="color: #7FFF7F;">"[ \t]+"</span> <span style="color: #7FFF7F;">" "</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd7f6133" class="outline-5">
<h5 id="orgd7f6133">重複メッセージを非表示に</h5>
<div class="outline-text-5" id="text-orgd7f6133">
<p>
フォルダ内の Message-ID が同じメールを非表示にする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-folder-process-duplicates-alist
      '(
        (<span style="color: #7FFF7F;">".*"</span> . hide)
        ))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdc713a3" class="outline-5">
<h5 id="orgdc713a3">sort 順: 返信が来た順</h5>
<div class="outline-text-5" id="text-orgdc713a3">
<p>
<code>flet</code> を書き換えるのが面倒で <code>el-x</code> にある <code>dflet</code> を使うように変更
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">wl-summary-overview-entity-compare-by-reply-date</span> (a b)
  <span style="color: #7FFF7F;">"Compare message A and B by latest date of replies including thread."</span>
  (<span style="color: #FF7F7F;">dflet</span> ((string-max2 (x y)
                       (<span style="color: #FF7F7F;">cond</span> ((string&lt; x y) y)
                             ('t x)))
          (thread-number-get-date (x)
                                  (timezone-make-date-sortable (elmo-msgdb-overview-entity-get-date
                                                                (elmo-message-entity
                                                                 wl-summary-buffer-elmo-folder x))))
          (thread-get-family (x)
                             (cons x (wl-thread-entity-get-descendant (wl-thread-get-entity x))))
          (max-reply-date (x)
                          (<span style="color: #FF7F7F;">cond</span> ((eq 'nil x)
                                 'nil)
                                ((eq 'nil (cdr x))
                                 (thread-number-get-date (car x)))
                                ('t
                                 (string-max2 (thread-number-get-date (car x))
                                              (max-reply-date (cdr x)))))))
    (string&lt;
     (max-reply-date (thread-get-family (elmo-message-entity-number a)))
     (max-reply-date (thread-get-family (elmo-message-entity-number b))))))
(add-to-list 'wl-summary-sort-specs 'reply-date)
(<span style="color: #FF7F7F;">setq</span> wl-summary-default-sort-spec 'reply-date)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org039be84" class="outline-4">
<h4 id="org039be84">振り分け設定</h4>
<div class="outline-text-4" id="text-org039be84">
<p>
<code>$</code> 以外を振り分け対象に
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-summary-auto-refile-skip-marks '(<span style="color: #7FFF7F;">"$"</span>))
</pre>
</div>
</div>
<div id="outline-container-orgafb5225" class="outline-5">
<h5 id="orgafb5225">振り分け判定に使用するヘッダ</h5>
<div class="outline-text-5" id="text-orgafb5225">
<p>
添付の有無の表示にも使うので <code>Content-Type</code> も登録.
あと <code>Delivered-To</code> はメールの検索の時に結構重宝している.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-msgdb-extra-fields
      '(
        <span style="color: #7FFF7F;">"List-Post"</span>
        <span style="color: #7FFF7F;">"List-Id"</span>
        <span style="color: #7FFF7F;">"List-ID"</span>                  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12383;&#12414;&#12395; List-ID &#12391;&#26469;&#12427;&#12513;&#12540;&#12523;&#12354;&#12427;&#12424;&#12397;?</span>
        <span style="color: #7FFF7F;">"Resent-CC"</span>
        <span style="color: #7FFF7F;">"Mailing-List"</span>
        <span style="color: #7FFF7F;">"X-Mailing-List"</span>
        <span style="color: #7FFF7F;">"X-ML-Address"</span>
        <span style="color: #7FFF7F;">"X-ML-Name"</span>
        <span style="color: #7FFF7F;">"X-ML-To"</span>
        <span style="color: #7FFF7F;">"Delivered-To"</span>
        <span style="color: #7FFF7F;">"Content-Type"</span>              <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#28155;&#20184;&#12398;&#26377;&#28961;&#12398;&#34920;&#31034;&#12398;&#28858;&#12395;&#36861;&#21152;</span>
        <span style="color: #7FFF7F;">"X-Google-Appengine-App-Id"</span> <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">GAE&#12398;&#36865;&#20449;&#12377;&#12427;&#12513;&#12540;&#12523;&#12398;&#25391;&#12426;&#20998;&#12369;&#29992;</span>
        <span style="color: #7FFF7F;">"To"</span>
        <span style="color: #7FFF7F;">"Cc"</span>
        <span style="color: #7FFF7F;">"From"</span>
        <span style="color: #7FFF7F;">"Subject"</span>
        <span style="color: #7FFF7F;">"Reply-To"</span>
        <span style="color: #7FFF7F;">"Auto-Submitted"</span>            <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">Git commit/Cron notify</span>
        ))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9d69599" class="outline-4">
<h4 id="org9d69599">メッセージ表示</h4>
<div class="outline-text-4" id="text-org9d69599">
</div><div id="outline-container-org44538b3" class="outline-5">
<h5 id="org44538b3">いったん全て非表示に</h5>
<div class="outline-text-5" id="text-org44538b3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-ignored-field-list '(<span style="color: #7FFF7F;">"^.*:"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org058953d" class="outline-5">
<h5 id="org058953d">見たいヘッダだけ表示</h5>
<div class="outline-text-5" id="text-org058953d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-visible-field-list
      '(<span style="color: #7FFF7F;">"^Subject:"</span>
        <span style="color: #7FFF7F;">"^From:"</span>
        <span style="color: #7FFF7F;">"^To:"</span>
        <span style="color: #7FFF7F;">"^Cc:"</span>
        <span style="color: #7FFF7F;">"^Date:"</span>
        <span style="color: #7FFF7F;">"^Message-ID:"</span>
        ))
</pre>
</div>
</div>
</div>
<div id="outline-container-org1e1c6b9" class="outline-5">
<h5 id="org1e1c6b9">表示順の変更</h5>
<div class="outline-text-5" id="text-org1e1c6b9">
<p>
Mew 風&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-sort-field-list
      '(<span style="color: #7FFF7F;">"^Subject:"</span>
        <span style="color: #7FFF7F;">"^From:"</span>
        <span style="color: #7FFF7F;">"^To:"</span>
        <span style="color: #7FFF7F;">"^Cc:"</span>
        <span style="color: #7FFF7F;">"^Date:"</span>
        <span style="color: #7FFF7F;">"^Message-ID:"</span>
        ))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc013465" class="outline-5">
<h5 id="orgc013465">mime の画像表示の切り替え</h5>
<div class="outline-text-5" id="text-orgc013465">
<p>
<code>M-T</code> でトグル
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">wl-summary-w3m-safe-toggle-inline-images</span> (<span style="color: #FFFF7F;">&amp;optional</span> arg)
  <span style="color: #7FFF7F;">"Toggle displaying of all images in the message buffer.</span>
<span style="color: #7FFF7F;">     If the prefix arg is given, all images are considered to be safe."</span>
  (<span style="color: #FF7F7F;">interactive</span> <span style="color: #7FFF7F;">"P"</span>)
  (<span style="color: #FF7F7F;">with-current-buffer</span> wl-message-buffer
    (w3m-toggle-inline-images arg)))
(eval-after-load <span style="color: #7FFF7F;">"wl-summary"</span>
  '(define-key wl-summary-mode-map
     <span style="color: #7FFF7F;">"\M-T"</span> 'wl-summary-w3m-safe-toggle-inline-images))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf640153" class="outline-5">
<h5 id="orgf640153">From, To を省略表示しない</h5>
<div class="outline-text-5" id="text-orgf640153">
<p>
To や From にアドレスが沢山指定されていると省略されるので，これを無効化
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-message-use-header-narrowing nil)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1af52e3" class="outline-4">
<h4 id="org1af52e3">作成/返信設定</h4>
<div class="outline-text-4" id="text-org1af52e3">
<p>
自分宛のメールに返信する場合は <code>To:</code>, <code>Cc:</code> から自分のアドレスを削除
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-always-delete-myself t)
</pre>
</div>
<p>
"a" (without-argument)では <code>Reply-To:</code> や <code>From:</code> などで
指定された唯一人または唯一つの投稿先に返信.
また, <code>X-ML-Name:</code> と <code>Reply-To:</code> がついているなら <code>Reply-To:</code> 宛に返信
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-reply-without-argument-list
      '(((<span style="color: #7FFF7F;">"X-ML-Name"</span> <span style="color: #7FFF7F;">"Reply-To"</span>) . ((<span style="color: #7FFF7F;">"Reply-To"</span>) nil nil))
        (<span style="color: #7FFF7F;">"X-ML-Name"</span> . ((<span style="color: #7FFF7F;">"To"</span> <span style="color: #7FFF7F;">"Cc"</span>) nil nil))
        (<span style="color: #7FFF7F;">"Followup-To"</span> . (nil nil (<span style="color: #7FFF7F;">"Followup-To"</span>)))
        (<span style="color: #7FFF7F;">"Newsgroups"</span> . (nil nil (<span style="color: #7FFF7F;">"Newsgroups"</span>)))
        (<span style="color: #7FFF7F;">"Reply-To"</span> . ((<span style="color: #7FFF7F;">"Reply-To"</span>) nil nil))
        (<span style="color: #7FFF7F;">"Mail-Reply-To"</span> . ((<span style="color: #7FFF7F;">"Mail-Reply-To"</span>) nil nil))
        (<span style="color: #7FFF7F;">"From"</span> . ((<span style="color: #7FFF7F;">"From"</span>) nil nil))))
</pre>
</div>
<p>
<code>C-u a</code> (with-argument)であれば関係する全ての人・投稿先に返信
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-draft-reply-with-argument-list
      '((<span style="color: #7FFF7F;">"Followup-To"</span> . ((<span style="color: #7FFF7F;">"From"</span>) nil (<span style="color: #7FFF7F;">"Followup-To"</span>)))
        (<span style="color: #7FFF7F;">"Newsgroups"</span> . ((<span style="color: #7FFF7F;">"From"</span>) nil (<span style="color: #7FFF7F;">"Newsgroups"</span>)))
        (<span style="color: #7FFF7F;">"Mail-Followup-To"</span> . ((<span style="color: #7FFF7F;">"Mail-Followup-To"</span>) nil (<span style="color: #7FFF7F;">"Newsgroups"</span>)))
        (<span style="color: #7FFF7F;">"From"</span> . ((<span style="color: #7FFF7F;">"From"</span>) (<span style="color: #7FFF7F;">"To"</span> <span style="color: #7FFF7F;">"Cc"</span>) (<span style="color: #7FFF7F;">"Newsgroups"</span>)))))
</pre>
</div>
<p>
サマリ表示には petname を使うが, 引用には使わない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-default-draft-cite-decorate-author nil)
</pre>
</div>
</div>
<div id="outline-container-org1beff99" class="outline-5">
<h5 id="org1beff99">メール本文の文字コード</h5>
<div class="outline-text-5" id="text-org1beff99">
<p>
丸囲み数字なんかが入ってしまうと
勝手にエンコーディングが変わってしまって鬱陶しい. どうしたモンだろうかね.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'wl-draft-mode-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (add-to-list 'mime-charset-type-list '(utf-8 8 nil))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org85b54dc" class="outline-5">
<h5 id="org85b54dc">draft mode で orgtbl を有効に</h5>
<div class="outline-text-5" id="text-org85b54dc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'wl-draft-mode-hook 'turn-on-orgtbl)
</pre>
</div>
</div>
</div>
<div id="outline-container-orge2676d7" class="outline-5">
<h5 id="orge2676d7">c-sig</h5>
<div class="outline-text-5" id="text-orge2676d7">
<p>
署名の選択に c-sig を使用している.
設定は以下の通り. Mew 風に <code>C-c &lt;tab&gt;</code> で signature を挿入するようにしている
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">c-sig</span>
  <span style="color: #7FBFFF;">:init</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">eval-when-compile</span> (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">wl</span>))
  (<span style="color: #FF7F7F;">setq</span> sig-insert-end t
        sig-save-to-sig-name-alist nil
        message-signature-file nil)
  (define-key wl-draft-mode-map <span style="color: #7FFF7F;">"\C-c\t"</span> 'insert-signature-eref)
  (add-hook 'wl-draft-mode-hook
            '(lambda ()
               (define-key (current-local-map) <span style="color: #7FFF7F;">"\C-c\C-w"</span>
                 'insert-signature-eref)))
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org29def32" class="outline-4">
<h4 id="org29def32">Face の設定</h4>
<div class="outline-text-4" id="text-org29def32">
<p>
デフォルトより細かく指定するために幾つかの face 定義を追加.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> wl-highlight-message-header-alist
      '((<span style="color: #7FFF7F;">"Subject[ \t]*:"</span>
         . wl-highlight-message-subject-header-contents)
        (<span style="color: #7FFF7F;">"From[ \t]*:"</span>
         . wl-highlight-message-from-header-contents)
        (<span style="color: #7FFF7F;">"Date[ \t]*:"</span>
         . wl-highlight-message-date-header-contents)
        (<span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">.*To</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">Cc</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">Newsgroups</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">[ \t]*:"</span>
         . wl-highlight-message-important-header-contents)
        (<span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">User-Agent</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">X-Mailer</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">X-Newsreader</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">[ \t]*:"</span> .
         wl-highlight-message-unimportant-header-contents)
        ))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:wl-set-face</span> (face spec)
  (make-face face)
  (<span style="color: #FF7F7F;">cond</span> ((fboundp 'face-spec-set)
         (face-spec-set face spec))
        (t
         (wl-declare-face face spec))))
(my:wl-set-face 'wl-highlight-folder-closed-face                  '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4cff4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
(my:wl-set-face 'wl-highlight-folder-few-face                     '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-folder-killed-face                  '((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-folder-many-face                    '((t (:foreground ,my:h:magenta :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-folder-opened-face                  '((t (:foreground "#4cffff" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-folder-path-face                    '((t (:underline t :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-folder-unknown-face                 '((t (:foreground "#4cffff" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-folder-unread-face                  '((t (:foreground ,my:n:blue :bold nil :italic nil :weight normal ))))</span>
(my:wl-set-face 'wl-highlight-folder-zero-face                    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-header-separator-face               '((t (:inherit highlight :bold t ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-message-citation-header             '((t (:foreground ,my:h:green :bold nil :italic nil ))))</span>
(my:wl-set-face 'wl-highlight-message-cited-text-1                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7fff7f"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-2                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ffff7f"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-3                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7f7fff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-4                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7fffff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-5                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff7fff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-6                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff7f7f"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-7                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4cff4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-8                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ffff4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-9                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4c4cff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-10               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4cffff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-11               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff4cff"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-cited-text-12               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#ff4c4c"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-date-header-contents        '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-header-contents             '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-headers                     '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFFFF"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-important-header-contents2  '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-signature                   '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-important-header-contents   '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4CFF"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-subject-header-contents     '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-from-header-contents        '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF4C"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-message-unimportant-header-contents '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil ))))
(my:wl-set-face 'wl-highlight-summary-answered-face               '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-copied-face                 '((t (:foreground "#4CFFFF" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-deleted-face                '((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-displaying-face             '((t (:underline t :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-disposed-face               '((t (:foreground "#aaaaaa" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-flagged-face                '((t (:foreground ,my:h:yellow :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-forwarded-face              '((t (:foreground ,my:h:blue :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-high-read-face              '((t (:foreground ,my:h:green :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-high-unread-face            '((t (:foreground ,my:h:orange :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-important-face              '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-important-flag-face         '((t (:foreground "#ffff4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-killed-face                 '((t (:foreground ,my:h:black :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-l:read-face                 '((t (:foreground "#4CFF4C" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-l:unread-face               '((t (:foreground ,my:h:lightb :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-new-face                    '((t (:foreground "#ff4c4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-normal-face                 '((t (:foreground "#f6f3e8" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-prefetch-face               '((t (:foreground ,my:n:blue :bold nil :italic nil :weight normal ))))</span>
(my:wl-set-face 'wl-highlight-summary-refiled-face                '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-resend-face                 '((t (:foreground ,my:h:orange :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-target-face                 '((t (:foreground "#4CFFFF" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-temp-face                   '((t (:foreground ,my:n:violet :bold nil :italic nil :weight normal ))))</span>
(my:wl-set-face 'wl-highlight-summary-thread-top-face             '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:italic</span> nil <span style="color: #7FBFFF;">:weight</span> normal ))))
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-summary-unread-face                 '((t (:foreground "#ff4c4c" :bold nil :italic nil :weight normal ))))</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(my:wl-set-face 'wl-highlight-thread-indent-face                  '((t (:underline t :bold nil :italic nil :weight normal ))))</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga0248d5" class="outline-4">
<h4 id="orga0248d5">GPG 署名</h4>
<div class="outline-text-4" id="text-orga0248d5">
<p>
以前は mailcrypt を使っていたけれど,
epa があるので主にキーバインドの設定のみ.
<code>draft-mode</code> の文字コードをあらかじめ指定しておかないと,
送信時に文字コードが変換されるので不正な署名となってしまう.
</p>

<p>
もっとうまい方法/正攻法がありそうな気がするけれど,
使えてるから, まあ良いかな, とか.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> mime-pgp-verify-when-preview nil)
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:epa-wl-decrypt-message</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">save-window-excursion</span>
    (wl-summary-jump-to-current-message)
    (wl-message-decrypt-pgp-nonmime)))
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:epa-wl-verify-message</span> ()
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">save-selected-window</span>
    (wl-summary-jump-to-current-message)
    (wl-message-verify-pgp-nonmime)))
(<span style="color: #FF7F7F;">bind-keys</span> <span style="color: #7FBFFF;">:map</span> wl-summary-mode-map
           (<span style="color: #7FFF7F;">"C-c : d"</span> . my:epa-wl-decrypt-message)
           (<span style="color: #7FFF7F;">"C-c : v"</span> . my:epa-wl-verify-message))
(<span style="color: #FF7F7F;">bind-keys</span> <span style="color: #7FBFFF;">:map</span> wl-draft-mode-map
           (<span style="color: #7FFF7F;">"C-c : s"</span> . epa-mail-sign)
           (<span style="color: #7FFF7F;">"C-c : e"</span> . epa-mail-encrypt))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga001041" class="outline-4">
<h4 id="orga001041">検索</h4>
<div class="outline-text-4" id="text-orga001041">
<p>
mu(maildir-utils)を使う. 偶にセグフォるので悩み所
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">elmo-search</span>
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FBFFF;">:map</span> wl-summary-mode-map
              (<span style="color: #7FFF7F;">"v"</span> . wl-quicksearch-goto-search-folder-wrapper)
              (<span style="color: #7FFF7F;">"V"</span> . wl-quicksearch-goto-search-folder-wrapper)
              <span style="color: #7FBFFF;">:map</span> wl-folder-mode-map
              (<span style="color: #7FFF7F;">"v"</span> . wl-quicksearch-goto-search-folder-wrapper)
              (<span style="color: #7FFF7F;">"V"</span> . wl-quicksearch-goto-search-folder-wrapper))
  <span style="color: #7FBFFF;">:config</span>
  (elmo-search-register-engine
   'mu 'local-file
   <span style="color: #7FBFFF;">:prog</span> <span style="color: #7FFF7F;">"mu"</span>
   <span style="color: #7FBFFF;">:args</span> '(<span style="color: #7FFF7F;">"find"</span> <span style="color: #7FFF7F;">"-u"</span> elmo-search-split-pattern-list <span style="color: #7FFF7F;">"--fields"</span> <span style="color: #7FFF7F;">"l"</span> <span style="color: #7FFF7F;">"--sortfield"</span> <span style="color: #7FFF7F;">"date"</span> <span style="color: #7FFF7F;">"-r"</span>)
   <span style="color: #7FBFFF;">:charset</span> 'utf-8)
  (<span style="color: #FF7F7F;">setq</span> elmo-search-default-engine 'mu)
  (<span style="color: #FF7F7F;">setq</span> wl-quicksearch-folder <span style="color: #7FFF7F;">"[]"</span>))
</pre>
</div>
<p>
検索時にメールが多すぎると怒られるので. 数字は適当.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> elmo-multi-divide-number 1000000000)
(<span style="color: #FF7F7F;">setq</span> elmo-multi-number 1000000000)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org915f645" class="outline-3">
<h3 id="org915f645">Linux Desktop で <code>mailto:</code> リンクを扱うために</h3>
<div class="outline-text-3" id="text-org915f645">
<p>
ついでに <code>mailto</code> のリンクを emacsclient で扱うために，以下の関数を定義しておく
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:mailto-compose-mail</span> (mailto-url)
  (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">and</span> (stringp mailto-url)
           (string-match <span style="color: #7FFF7F;">"\\`mailto:"</span> mailto-url))
      (<span style="color: #FF7F7F;">progn</span>
        (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">rfc2368</span>)
        (<span style="color: #FF7F7F;">let*</span> ((headers (mapcar (<span style="color: #FF7F7F;">lambda</span> (h) (cons (intern (car h)) (cdr h)))
                                (rfc2368-parse-mailto-url mailto-url)))
               (good-headers (remove-if (<span style="color: #FF7F7F;">lambda</span> (h) (member (car h) '(Body))) headers))
               (body (cdr (assoc 'Body headers))))
          (wl-draft good-headers nil nil body)))))
</pre>
</div>
<p>
Desktop の設定では
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a5a5a6;">#</span><span style="color: #a5a5a6;">!/bin/</span><span style="color: #FF7F7F;">sh</span>
<span style="color: #a5a5a6;"># </span><span style="color: #a5a5a6;">emacs-mailto-handler</span>

<span style="color: #7F7FFF;">mailto</span>=$<span style="color: #7F7FFF;">1</span>
<span style="color: #7F7FFF;">mailto</span>=<span style="color: #7FFF7F;">"mailto:${mailto#mailto:}"</span>
<span style="color: #7F7FFF;">mailto</span>=$(printf <span style="color: #7FFF7F;">'%s\n'</span> <span style="color: #7FFF7F;">"$mailto"</span> | sed -e <span style="color: #7FFF7F;">'s/[\"]/\\&amp;/g'</span>)
<span style="color: #7F7FFF;">elisp_expr</span>=<span style="color: #7FFF7F;">"(my:mailto-compose-mail \"$mailto\")"</span>

emacsclient -a <span style="color: #7FFF7F;">""</span> -n --eval <span style="color: #7FFF7F;">"$elisp_expr"</span> <span style="color: #7FFF7F;">\</span>
    <span style="color: #7FFF7F;">'(set-window-dedicated-p (selected-window) t)'</span>
</pre>
</div>
<p>
をメーラとして指定すれば良い．
GNOME は <code>.desktop</code> ファイルが無いと「お気に入り」登録ができないので
以下のファイルを適当な名前で <code>~/.local/share/applications/</code> 以下に放り込んでおくと良いだろう
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #FFFF7F;">Desktop Entry</span>]
<span style="color: #7F7FFF;">Name</span>=Emacs Mail Handler
<span style="color: #7F7FFF;">GenericName</span>=Mail User Agent
<span style="color: #7F7FFF;">X-GNOME-FullName</span>=Emacs Mail Handler
<span style="color: #7F7FFF;">Comment</span>=Use emacsclient as MUA, handling mailto link
<span style="color: #7F7FFF;">Keywords</span>=email
<span style="color: #7F7FFF;">Exec</span>=/home/uwabami/bin/emacs-mailto-handler %U
<span style="color: #7F7FFF;">Icon</span>=emacs25
<span style="color: #7F7FFF;">Terminal</span>=false
<span style="color: #7F7FFF;">Type</span>=Application
<span style="color: #7F7FFF;">Categories</span>=GNOME;GTK;Office;Email;
<span style="color: #7F7FFF;">StartupNotify</span>=false
<span style="color: #7F7FFF;">MimeType</span>=application/mbox;message/rfc822;x-scheme-handler/mailto;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgee41b1b" class="outline-2">
<h2 id="orgee41b1b">Emacs-w3m</h2>
<div class="outline-text-2" id="text-orgee41b1b">
<p>
あまり使わないけれど, 一応設定しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">w3m</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> w3m-search-default-engine <span style="color: #7FFF7F;">"google"</span>
        w3m-use-cookies t)
  (<span style="color: #FF7F7F;">with-eval-after-load</span> <span style="color: #7FFF7F;">"w3m-search"</span>
    '(add-to-list 'w3m-search-engine-alist
                  '(<span style="color: #7FFF7F;">"google"</span> <span style="color: #7FFF7F;">"https://encrypted.google.com/search?num=100&amp;ie=utf-8&amp;oe=utf-8&amp;hl=ja&amp;safe=off&amp;filter=0&amp;pws=0&amp;complete=0&amp;gbv=1&amp;q=%s"</span> utf-8)))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org4792ff8" class="outline-2">
<h2 id="org4792ff8">補完: <code>ido</code>, <code>flx-ido</code>, <code>smex</code></h2>
<div class="outline-text-2" id="text-org4792ff8">
<p>
半年ぐらい Helm を使ってみたけど
余計な事しすぎで色々設定してもシンドかったので，
結局使うのを止めました．
</p>

<p>
そんな訳で，当分 <code>ido</code> と <code>smex</code> を使うことに．
</p>
</div>
<div id="outline-container-org6b0690a" class="outline-3">
<h3 id="org6b0690a"><code>ido</code> の設定</h3>
<div class="outline-text-3" id="text-org6b0690a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ido</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x f"</span>   . ido-find-file)
         (<span style="color: #7FFF7F;">"C-x C-f"</span> . ido-find-file)
         (<span style="color: #7FFF7F;">"C-x d"</span>   . ido-dired)
         (<span style="color: #7FFF7F;">"C-x C-d"</span> . ido-dired)
         (<span style="color: #7FFF7F;">"C-x b"</span>   . ido-switch-buffer)
         (<span style="color: #7FFF7F;">"C-x C-b"</span> . ido-switch-buffer)
         (<span style="color: #7FFF7F;">"C-x M-b"</span> . ibuffer))
  <span style="color: #7FBFFF;">:config</span>
  (ido-mode t)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(ido-everywhere t)  &lt;- Wanderlust &#12415;&#12383;&#12356;&#12395;&#65292;&#36942;&#21435;&#12398;&#36984;&#25246;&#12434;&#35226;&#12360;&#12390;&#12356;&#12427;&#22900;&#12392;&#30456;&#24615;&#24746;&#12356;&#12398;&#12391;.</span>
  (<span style="color: #FF7F7F;">setq</span> ido-enable-prefix nil             <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">prefix match &#12434;&#26377;&#21177;&#12395;&#12377;&#12427;&#12392;&#65292;&#20837;&#21147;&#12434;&#20808;&#38957;&#19968;&#33268;&#21487;&#33021;</span>
        ido-confirm-unique-completion t   <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">TAB &#12391;&#21517;&#21069;&#12398;&#19968;&#33268;&#12414;&#12391;&#34892;&#12394;&#12356;&#65292;&#12381;&#12398;&#24460; RET &#12391;&#23455;&#34892;</span>
        ido-enable-flex-matching t        <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">flex matching &#12434;&#35430;&#12377;&#38555;&#12395;&#12399; prefix &#12434;&#28961;&#21177;&#21270;&#12377;&#12427;&#12371;&#12392;</span>
        ido-enable-dot-prefix t           <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">. &#12434; prefix &#12392;&#12375;&#12390;&#25201;&#12358;</span>
        ido-default-file-method   'selected-window
        ido-default-buffer-method 'selected-window
        ido-max-directory-size 100000
        ido-enable-tramp-completion nil
        ido-use-faces nil                 <span style="color: #a5a5a6;">; </span><span style="color: #a5a5a6;">flx-ido &#12398; highlight &#12434;&#20351;&#12358;</span>
        ido-ignore-extensions t
        ido-cannot-complete-command 'ido-next-match
        ido-save-directory-list-file (concat my:d:tmp <span style="color: #7FFF7F;">"ido.last"</span>))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#35036;&#23436;&#12391;&#28961;&#35222;&#12377;&#12427;&#25313;&#24373;&#23376;&#12398;&#36861;&#21152;</span>
  (<span style="color: #FF7F7F;">cl-loop</span> for ext in
           '(<span style="color: #7FFF7F;">".dvi"</span>
             <span style="color: #7FFF7F;">".fdb_latexmk"</span>
             <span style="color: #7FFF7F;">".fls"</span>
             <span style="color: #7FFF7F;">".ilg"</span>
             <span style="color: #7FFF7F;">".jqz"</span>
             <span style="color: #7FFF7F;">".mod"</span>
             <span style="color: #7FFF7F;">".nav"</span>
             <span style="color: #7FFF7F;">".out"</span>
             <span style="color: #7FFF7F;">".snm"</span>
             <span style="color: #7FFF7F;">".synctex.gz"</span>
             <span style="color: #7FFF7F;">".vrb"</span>
             )
           do (add-to-list 'completion-ignored-extensions ext))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">ido-disable-line-trucation</span> ()
    (set (make-local-variable 'truncate-lines) nil))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">ido &#12398; buffer &#12391; skk &#12434;&#28961;&#21177;&#21270;&#12375;&#12390;&#12362;&#12367;.</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26085;&#26412;&#35486;&#12501;&#12449;&#12452;&#12523;&#21517;&#12399;, &#12392;&#12426;&#12354;&#12360;&#12378;&#32771;&#12360;&#12394;&#12356;&#12371;&#12392;&#12395;.</span>
  (add-hook 'ido-minibuffer-setup-hook 'ido-disable-line-trucation)
  (add-hook 'ido-minibuffer-setup-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (<span style="color: #FF7F7F;">when</span> (fboundp 'skk-mode-exit)
                (skk-mode-exit))))
  (add-hook 'ido-setup-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (define-key ido-completion-map (kbd <span style="color: #7FFF7F;">"C-h"</span>)     'ido-delete-backward-updir)
              (define-key ido-completion-map (kbd <span style="color: #7FFF7F;">"C-l"</span>)     'ido-delete-backward-updir)))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">tramp &#12399;&#12461;&#12515;&#12483;&#12471;&#12517;&#12363;&#12425;&#28040;&#12377;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:ido-remove-tramp-from-cache</span> nil
    <span style="color: #7FFF7F;">"Remove any TRAMP entries from `</span><span style="color: #FFBF7F;">ido-dir-file-cache</span><span style="color: #7FFF7F;">'."</span>
    (<span style="color: #FF7F7F;">interactive</span>)
    (<span style="color: #FF7F7F;">setq</span> ido-dir-file-cache
          (cl-remove-if
           (<span style="color: #FF7F7F;">lambda</span> (x)
             (string-match <span style="color: #7FFF7F;">"/</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">rsh</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">ssh</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">telnet</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">su</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">sudo</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">sshx</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">krlogin</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">ksu</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">rcp</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">scp</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">rsync</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">scpx</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">fcp</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">nc</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">ftp</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">smb</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">adb</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">:"</span> (car x)))
           ido-dir-file-cache)))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">ido-kill-emacs-hook</span> ()
    (my:ido-remove-tramp-from-cache)
    (ido-save-history))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd65025b" class="outline-3">
<h3 id="orgd65025b"><code>flx-ido</code>: flex match の強化</h3>
<div class="outline-text-3" id="text-orgd65025b">
<p>
曖昧マッチが非常に直感的になった．地味に便利で手放せない．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">flx-ido</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (flx-ido-mode 1)
  (<span style="color: #FF7F7F;">setq</span> flx-ido-use-faces t
        flx-ido-threshold 10000)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orga8e37ba" class="outline-3">
<h3 id="orga8e37ba"><code>ido-grid</code>: 補完候補の grid 表示</h3>
<div class="outline-text-3" id="text-orga8e37ba">
<p>
パッケージにある <code>ido-grid-mode</code> ではなく,
<a href="https://github.com/larkery/ido-grid.el">larkery/ido-grid.el: reimplementation of ido-grid-mode to be simpler/faster</a>
を使うことに.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (package-installed-p 'ido-grid)
  (quelpa '(ido-grid
            <span style="color: #7FBFFF;">:fetcher</span> github
            <span style="color: #7FBFFF;">:repo</span> <span style="color: #7FFF7F;">"larkery/ido-grid.el"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ido-grid</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> ido-grid-enabled t
        ido-grid-start-small nil
        ido-grid-rows 0.20)
  (ido-grid-enable)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbb975a1" class="outline-3">
<h3 id="orgbb975a1"><code>ido-recentf</code>: recentf を ido で</h3>
<div class="outline-text-3" id="text-orgbb975a1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">ido-recentf-open</span> ()
  <span style="color: #7FFF7F;">"Use `</span><span style="color: #FFBF7F;">ido-completing-read</span><span style="color: #7FFF7F;">' to \\[</span><span style="color: #FFBF7F;">find-file</span><span style="color: #7FFF7F;">] a recent file"</span>
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">if</span> (find-file (ido-completing-read <span style="color: #7FFF7F;">"Find recent file: "</span> recentf-list))
      (message <span style="color: #7FFF7F;">"Opening file..."</span>)
    (message <span style="color: #7FFF7F;">"Aborting"</span>)))
(<span style="color: #FF7F7F;">bind-key</span> <span style="color: #7FFF7F;">"C-x C-r"</span> 'ido-recentf-open)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgac67847" class="outline-3">
<h3 id="orgac67847"><code>ido-describe-bindings</code>: key binding を表示?</h3>
<div class="outline-text-3" id="text-orgac67847">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ido-describe-bindings</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FBFFF;">:map</span> help-map
              (<span style="color: #7FFF7F;">"b"</span> . ido-describe-bindings))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org312180a" class="outline-3">
<h3 id="org312180a"><code>smex</code></h3>
<div class="outline-text-3" id="text-org312180a">
<p>
<code>M-x</code> の強化
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">smex</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"M-x"</span> . smex))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> smex-save-file (concat my:d:tmp <span style="color: #7FFF7F;">"smex-items"</span>))
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgab311d4" class="outline-2">
<h2 id="orgab311d4">補完: <code>helm</code></h2>
<div class="outline-text-2" id="text-orgab311d4">
<p>
幾つかの拡張で <code>helm</code> が呼ばれるので,
インストールするけれども明示的に無効化しておく.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">helm</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (helm-mode -1)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org292f8bd" class="outline-2">
<h2 id="org292f8bd">校正，辞書等</h2>
<div class="outline-text-2" id="text-org292f8bd">
</div><div id="outline-container-orgebdf4fa" class="outline-3">
<h3 id="orgebdf4fa">spell checker</h3>
<div class="outline-text-3" id="text-orgebdf4fa">
<p>
ispell はコマンドとして <code>aspell</code> を利用する．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ispell</span>
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq-default</span> ispell-program-name <span style="color: #7FFF7F;">"aspell"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (add-to-list 'ispell-skip-region-alist '(<span style="color: #7FFF7F;">"[</span><span style="color: #7FFFFF; font-weight: bold;">^</span><span style="color: #7FFF7F;">\000-\377]+"</span>)))
</pre>
</div>
<p>
flyspell-mode は別途有効化しておいた方が良いのかもしれない
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">flyspell</span>
  <span style="color: #7FBFFF;">:diminish</span> flyspell-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:flyspell-popup-choose</span> (orig event poss word)
    (<span style="color: #FF7F7F;">if</span> (window-system)
        (funcall orig event poss word)
      (flyspell-emacs-popup-textual event poss word)))
  (advice-add 'flyspell-emacs-popup <span style="color: #7FBFFF;">:around</span> #'my:flyspell-popup-choose)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orga771be7" class="outline-3">
<h3 id="orga771be7">辞書</h3>
<div class="outline-text-3" id="text-orga771be7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">lookup</span>
  <span style="color: #7FBFFF;">:commands</span> (lookup lookup-region lookup-pattern)
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (my:dpkg-status <span style="color: #7FFF7F;">"lookup-el"</span>)
           (file-exists-p <span style="color: #7FFF7F;">"/usr/local/share/dict/lookup-enabled"</span>))
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-c w"</span> . lookup-pattern)
         (<span style="color: #7FFF7F;">"C-c W"</span> . lookup-word))
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> lookup-search-agents
        '(
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/eijiro"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#33521;&#36766;&#37070;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/waeijiro"</span>  <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#21644;&#33521;&#36766;&#37070;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/rikagaku5"</span> <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#29702;&#21270;&#23398;&#36766;&#20856; &#31532;5&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/koujien4"</span>  <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#24195;&#36766;&#33489; &#31532;4&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/wadai5"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#30740;&#31350;&#31038; &#21644;&#33521;&#22823;&#36766;&#20856; &#31532;5&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/eidai6"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#30740;&#31350;&#31038; &#33521;&#21644;&#22823;&#36766;&#20856; &#31532;6&#29256;"</span>)
          (ndeb <span style="color: #7FFF7F;">"/usr/local/share/dict/colloc"</span>    <span style="color: #7FBFFF;">:alias</span> <span style="color: #7FFF7F;">"&#30740;&#31350;&#31038; &#33521;&#21644;&#27963;&#29992;&#22823;&#36766;&#20856; "</span>)
          )))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8e696ff" class="outline-2">
<h2 id="org8e696ff">カレンダー: <code>japanese-holidays</code></h2>
<div class="outline-text-2" id="text-org8e696ff">
<p>
日本の祝日を表示するために <code>japanese-holidays</code> をインストール
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">japanese-holidays</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'calendar-today-visible-hook   'japanese-holiday-mark-weekend)
  (add-hook 'calendar-today-invisible-hook 'japanese-holiday-mark-weekend)
  (add-hook 'calendar-today-visible-hook   'calendar-mark-today)
  <span style="color: #7FBFFF;">:config</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12392;&#12426;&#12354;&#12360;&#12378;&#26085;&#26412;&#12398;&#12415;&#12434;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-holidays
        (append japanese-holidays holiday-local-holidays))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#31069;&#26085;&#12434;&#12459;&#12524;&#12531;&#12480;&#12540;&#12395;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> mark-holidays-in-calendar t)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26376;&#12392;&#26332;&#26085;&#12398;&#34920;&#31034;&#35519;&#25972;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-month-name-array
        [<span style="color: #7FFF7F;">"01"</span> <span style="color: #7FFF7F;">"02"</span> <span style="color: #7FFF7F;">"03"</span> <span style="color: #7FFF7F;">"04"</span> <span style="color: #7FFF7F;">"05"</span> <span style="color: #7FFF7F;">"06"</span> <span style="color: #7FFF7F;">"07"</span> <span style="color: #7FFF7F;">"08"</span> <span style="color: #7FFF7F;">"09"</span> <span style="color: #7FFF7F;">"10"</span> <span style="color: #7FFF7F;">"11"</span> <span style="color: #7FFF7F;">"12"</span> ])
  (<span style="color: #FF7F7F;">setq</span> calendar-day-name-array
        [<span style="color: #7FFF7F;">"&#26085;"</span> <span style="color: #7FFF7F;">"&#26376;"</span> <span style="color: #7FFF7F;">"&#28779;"</span> <span style="color: #7FFF7F;">"&#27700;"</span> <span style="color: #7FFF7F;">"&#26408;"</span> <span style="color: #7FFF7F;">"&#37329;"</span> <span style="color: #7FFF7F;">"&#22303;"</span>])
  (<span style="color: #FF7F7F;">setq</span> calendar-day-header-array
        [<span style="color: #7FFF7F;">"&#26085;"</span> <span style="color: #7FFF7F;">"&#26376;"</span> <span style="color: #7FFF7F;">"&#28779;"</span> <span style="color: #7FFF7F;">"&#27700;"</span> <span style="color: #7FFF7F;">"&#26408;"</span> <span style="color: #7FFF7F;">"&#37329;"</span> <span style="color: #7FFF7F;">"&#22303;"</span>])
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">ISO format (YYYY/MM/DD) &#12395;&#22793;&#26356;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-date-style 'iso)
  (calendar-set-date-style 'iso)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#22303;&#26332;&#26085;&#12539;&#26085;&#26332;&#26085;&#12434;&#31069;&#26085;&#12392;&#12375;&#12390;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> japanese-holiday-weekend '(0 6)
        japanese-holiday-weekend-marker
        '(holiday nil nil nil nil nil japanese-holiday-saturday))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26085;&#26332;&#38283;&#22987;</span>
  (<span style="color: #FF7F7F;">setq</span> calendar-week-start-day 0))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd9f246a" class="outline-2">
<h2 id="orgd9f246a">Org</h2>
<div class="outline-text-2" id="text-orgd9f246a">
<p>
<code>org-mode</code> が無いと生きていけない体になりました
</p>
</div>
<div id="outline-container-org8c800ce" class="outline-3">
<h3 id="org8c800ce">基本設定: <code>org</code></h3>
<div class="outline-text-3" id="text-org8c800ce">
<p>
目新しい設定はしていない，と思う．強いて言えば
以前のメモの整理のために <a href="http://howm.osdn.jp/index-j.html">howm: Hitori Otegaru Wiki Modoki</a> も使っているので,
howm も有効にしている，ぐらい．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defvar</span> <span style="color: #7F7FFF;">my:d:org</span> (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/Dropbox/org/"</span>))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x n s"</span> . org-narrow-to-subtree)
         (<span style="color: #7FFF7F;">"C-x n w"</span> . widen))
  <span style="color: #7FBFFF;">:init</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-directory my:d:org                 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">Dropbox &#12395;&#20445;&#23384;&#12377;&#12427;</span>
        org-return-follows-link t              <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">return &#12391;&#12522;&#12531;&#12463;&#12434;&#36799;&#12427;</span>
        org-startup-folded t                   <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#35211;&#20986;&#12375;&#12434;&#30067;&#12435;&#12391;&#34920;&#31034;</span>
        org-startup-truncated t                <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#25240;&#12426;&#36820;&#12375;&#28961;&#12375;</span>
        org-emphasis-alist                     <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#22522;&#26412; "-nw" &#12394;&#12398;&#12391;&#33394;&#22793;&#26356;</span>
        (cons '(<span style="color: #7FFF7F;">"+"</span> '(<span style="color: #7FBFFF;">:strike-through</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#999999"</span>))
              (cl-delete <span style="color: #7FFF7F;">"+"</span> org-emphasis-alist <span style="color: #7FBFFF;">:key</span> 'car <span style="color: #7FBFFF;">:test</span> 'equal))
        org-completion-use-ido t
        <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">GTD: &#29366;&#24907;&#12398;&#36861;&#21152;</span>
        org-todo-keywords
        '((sequence <span style="color: #7FFF7F;">"TODO(t)"</span> <span style="color: #7FFF7F;">"WAIT(w)"</span> <span style="color: #7FFF7F;">"|"</span> <span style="color: #7FFF7F;">"DONE(d)"</span> <span style="color: #7FFF7F;">"CANCEL(c)"</span> <span style="color: #7FFF7F;">"SOMEDAY(s)"</span>)
          (type <span style="color: #7FFF7F;">"ARTICLE(a)"</span>)
          (type <span style="color: #7FFF7F;">"MEMO(m)"</span>)
          )
        <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">GTD: &#12479;&#12464;&#12398;&#36861;&#21152;</span>
        org-tag-alist '((<span style="color: #7FFF7F;">"OFFICE"</span>     . ?o)
                        (<span style="color: #7FFF7F;">"HOME"</span>       . ?h)
                        (<span style="color: #7FFF7F;">"MAIL"</span>       . ?m)
                        (<span style="color: #7FFF7F;">"WORK"</span>       . ?w)
                        (<span style="color: #7FFF7F;">"Debian"</span>     . ?d)
                        (<span style="color: #7FFF7F;">"Computer"</span>   . ?c)
                        (<span style="color: #7FFF7F;">"Book"</span>       . ?b)
                        (<span style="color: #7FFF7F;">"Emacs"</span>      . ?e)
                        (<span style="color: #7FFF7F;">"TeX"</span>        . ?t)
                        (<span style="color: #7FFF7F;">"Ruby"</span>       . ?r)
                        )
        )
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">GTD: TODO&#8594;...&#8594;DONE &#12392;&#12375;&#12383;&#12456;&#12531;&#12488;&#12522;&#12434; =Arhive.org= &#12395;&#31227;&#21205;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-archive-done-tasks</span> ()
    (<span style="color: #FF7F7F;">interactive</span>)
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">ARCHIVE &#12479;&#12464;&#12434;&#20184;&#12369;&#12427;&#12384;&#12369;&#12394;&#12425;&#20197;&#19979;</span>
    <span style="color: #a5a5a6;">;;   </span><span style="color: #a5a5a6;">(org-map-entries 'org-archive-set-tag "/DONE" 'file))</span>
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">org-archive-location &#12395; refile &#12375;&#12383;&#12356;&#12394;&#12425;&#20197;&#19979;</span>
    (org-map-entries 'org-archive-subtree <span style="color: #7FFF7F;">"/DONE"</span> 'file))
  (<span style="color: #FF7F7F;">setq</span> org-archive-location <span style="color: #7FFF7F;">"Archive.org::"</span>)
  (add-hook 'org-todo-statistics-hook 'my:org-archive-done-tasks)
  (add-hook 'org-todo-after-statistics-hook 'my:org-archive-done-tasks)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#25991;&#23383;&#12467;&#12540;&#12489;&#24375;&#21046; ... &#20170;&#26178;&#12356;&#12425;&#12394;&#12356;&#12363;&#12418;&#65294;</span>
  (modify-coding-system-alist 'file <span style="color: #7FFF7F;">"\\.org\\'"</span> 'utf-8)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">howm &#12501;&#12449;&#12452;&#12523;&#12418; org-mode &#12391;&#65294;</span>
  (add-to-list 'auto-mode-alist '(<span style="color: #7FFF7F;">"\\.org$"</span> . org-mode))
  (add-to-list 'auto-mode-alist '(<span style="color: #7FFF7F;">"\\.howm$"</span> . org-mode))
  <span style="color: #a5a5a6;">;;; </span><span style="color: #a5a5a6;">timestamp &#26356;&#26032;&#25991;&#23383;&#21015;&#12398;&#22793;&#26356;</span>
  <span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">org-mode &#12391;&#12399; &#65283;+DATE: &#12434;&#12402;&#12387;&#12363;&#12369;&#12427;&#29992;&#12395;(&#65283;&#12399;&#23567;&#25991;&#23383;)&#65294;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-timestamp-hook</span> ()
    <span style="color: #7FFF7F;">"Change `</span><span style="color: #FFBF7F;">time-stamp-start</span><span style="color: #7FFF7F;">' in org-mode"</span>
    (set (make-local-variable 'time-stamp-start) <span style="color: #7FFF7F;">"#\\+DATE: 2"</span>)
    (set (make-local-variable 'time-stamp-end)   <span style="color: #7FFF7F;">"\$"</span>)
    )
  (add-hook 'org-mode-hook 'my:org-timestamp-hook)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf7a0481" class="outline-3">
<h3 id="orgf7a0481">Org-Id, Orglink</h3>
<div class="outline-text-3" id="text-orgf7a0481">
<p>
ファイル間のリンクを uuid で行なう設定
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-id</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-c l"</span>   . org-store-link)
         (<span style="color: #7FFF7F;">"C-c C-l"</span> . org-insert-link))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-id-link-to-org-use-id 'create-if-interactive-and-no-custom-id
        org-id-track-globally t
        )
  (<span style="color: #FF7F7F;">when</span> (file-directory-p <span style="color: #7FFF7F;">"~/Public/cc-env"</span>)
    (<span style="color: #FF7F7F;">setq</span> org-id-extra-files (f-glob <span style="color: #7FFF7F;">"*.org"</span> <span style="color: #7FFF7F;">"~/Public/cc-env"</span>))
    (add-to-list 'org-id-extra-files
                 (concat user-emacs-directory <span style="color: #7FFF7F;">"README.org"</span>)))
  )
</pre>
</div>
<p>
org 形式の link を他のモードのドキュメント，コメント等でも使えるようにする
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">orglink</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:diminish</span> orglink-mode
  <span style="color: #7FBFFF;">:config</span>
  (global-orglink-mode +1)
  )
</pre>
</div>
<p>
まあ，あきたら止めそうだけれど，どうだろうかね．
</p>
</div>
</div>
<div id="outline-container-org3fd5e73" class="outline-3">
<h3 id="org3fd5e73">Org-capture: 日記</h3>
<div class="outline-text-3" id="text-org3fd5e73">
<p>
単一ファイルに記述すること，および
エントリ作成時に日付を入れるために <code>org-jounnal-new-entry</code> を <code>advice</code> している
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-journal</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (file-directory-p my:d:org)
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'org-journal-mode-hook
            (<span style="color: #FF7F7F;">setq</span> truncate-lines t))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">unbind-key</span> <span style="color: #7FFF7F;">"C-c C-j"</span> org-journal-mode-map)
  (<span style="color: #FF7F7F;">bind-key</span>   <span style="color: #7FFF7F;">"C-c C-j"</span> 'browse-url-at-point)
  (<span style="color: #FF7F7F;">setq</span> org-journal-dir my:d:org
        org-journal-file-format <span style="color: #7FFF7F;">"journal.org"</span>
        org-journal-date-format <span style="color: #7FFF7F;">"%x (%a)"</span>
        org-journal-date-prefix <span style="color: #7FFF7F;">"* "</span>
        org-journal-time-format <span style="color: #7FFF7F;">"&lt;%Y-%m-%d %R&gt; "</span>
        org-journal-time-prefix <span style="color: #7FFF7F;">"** MEMO "</span>
        org-journal-find-file 'find-file
        )
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-journal-add-date-entry</span> (prefix <span style="color: #FFFF7F;">&amp;optional</span> time)
    <span style="color: #7FFF7F;">"Insert date entry to `</span><span style="color: #FFBF7F;">org-journal-file</span><span style="color: #7FFF7F;">'"</span>
    (find-file (expand-file-name org-journal-file-format org-journal-dir))
    (org-journal-decrypt)
    (<span style="color: #FF7F7F;">unless</span>
        (string-match (format-time-string org-journal-date-format)
                      (buffer-substring-no-properties (point-min) (point-max)))
      (<span style="color: #FF7F7F;">progn</span>
        (goto-char (point-max))
        (insert (concat <span style="color: #7FFF7F;">"\n"</span> org-journal-date-prefix
                        (format-time-string org-journal-date-format)))
        ))
    )
  (advice-add 'org-journal-new-entry <span style="color: #7FBFFF;">:before</span> 'my:org-journal-add-date-entry)
  )
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">Key bindings -- &#20351;&#12360;&#12390;&#12394;&#12356;...</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key org-journal-mode-map (kbd "C-c C-f") 'org-journal-open-next-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key org-journal-mode-map (kbd "C-c C-b") 'org-journal-open-previous-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key org-journal-mode-map (kbd "C-c C-j") 'org-journal-new-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map "j" 'org-journal-read-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map (kbd "C-j") 'org-journal-display-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map "]" 'org-journal-next-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map "[" 'org-journal-previous-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map (kbd "i j") 'org-journal-new-date-entry)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map (kbd "f f") 'org-journal-search-forever)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map (kbd "f w") 'org-journal-search-calendar-week)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map (kbd "f m") 'org-journal-search-calendar-month)</span>
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(define-key calendar-mode-map (kbd "f y") 'org-journal-search-calendar-year)))</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org49e6603" class="outline-3">
<h3 id="org49e6603">Capture: メモ取り</h3>
<div class="outline-text-3" id="text-org49e6603">
<p>
キーバインドは以前 changelog memo をやっていた時の癖で <code>C-x m</code> をメモにしている.
他には wanderlust のメールを扱えるように <code>org-wl</code> を読み込んで template を追加したぐらい．
mu のインデックスの方が良いかもしれない，と最近思っている．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-capture</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x m"</span> . org-capture))
  <span style="color: #7FBFFF;">:if</span> (file-directory-p org-directory)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">if</span> (<span style="color: #FF7F7F;">and</span> (my:dpkg-status <span style="color: #7FFF7F;">"wl-beta"</span>)
           (file-directory-p org-directory))
      (<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-wl</span>))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-journal-add-date-entry-capture</span> ()
    (my:org-journal-add-date-entry nil)
    (goto-char (point-max))
    )
  (<span style="color: #FF7F7F;">setq</span> org-default-notes-file (concat org-directory <span style="color: #7FFF7F;">"journal.org"</span>)
        org-capture-templates
        `(
          (<span style="color: #7FFF7F;">"t"</span> <span style="color: #7FFF7F;">"TODO"</span> plain
           (<span style="color: #FF7F7F;">function</span> my:org-journal-add-date-entry-capture)
           <span style="color: #7FFF7F;">"** TODO %^{title} %^g\n  %?\n  %a"</span>
           <span style="color: #7FBFFF;">:prepend</span> nil
           <span style="color: #7FBFFF;">:unnarrowed</span> nil
           <span style="color: #7FBFFF;">:kill-buffer</span> t
           )
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">"* TODO &lt;%&lt;%Y-%m-%d&gt;&gt; %:subject %^g\n  %?\n  %a\n  #+BEGIN_QUOTE\n%i\n  #+END_QUOTE"</span>
          (<span style="color: #7FFF7F;">"e"</span> <span style="color: #7FFF7F;">"Email TODO"</span> plain
           (<span style="color: #FF7F7F;">function</span> my:org-journal-add-date-entry-capture)
           <span style="color: #7FFF7F;">"** TODO [[wl:\%5Bmsgid:%:message-id-no-brackets\%5D][%(replace-regexp-in-string \"\\\\[</span><span style="color: #FFBF7F;">.*\\\\</span><span style="color: #7FFF7F;">] \" \"\" \"%:subject\")]]\n  :PROPERTIES:\n  :CREATED: %u\n  :END:%?\n"</span>
           <span style="color: #7FBFFF;">:prepend</span> nil
           <span style="color: #7FBFFF;">:unnarrowed</span> nil
           <span style="color: #7FBFFF;">:kill-buffer</span> t
           )
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">("s" "Email Schedule" plain</span>
          <span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">(file (expand-file-name "Schedule.org" org-directory))</span>
          <span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">"* %:subject\n[[wl:\%5Bmsgid:%:message-id-no-brackets\%5D][%(replace-regexp-in-string \"\\\\[</span><span style="color: #FFBF7F;">.*\\\\</span><span style="color: #a5a5a6;">] \" \"\" \"%:subject\")]]\n %?\n%t\n"</span>
          <span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">:prepend nil</span>
          <span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">:unnarrowed nil</span>
          <span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">:kill-buffer t</span>
          <span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">)</span>
          (<span style="color: #7FFF7F;">"m"</span> <span style="color: #7FFF7F;">"Memo/Journal Entry"</span> plain
           (<span style="color: #FF7F7F;">function</span> my:org-journal-add-date-entry-capture)
           <span style="color: #7FFF7F;">"** MEMO %T %?"</span>
           <span style="color: #7FBFFF;">:prepend</span> nil
           <span style="color: #7FBFFF;">:unnarrowed</span> nil
           <span style="color: #7FBFFF;">:kill-buffer</span> t
           )
          (<span style="color: #7FFF7F;">"a"</span> <span style="color: #7FFF7F;">"Aritcle Entry"</span> plain
           (<span style="color: #FF7F7F;">function</span> my:org-journal-add-date-entry-capture)
           <span style="color: #7FFF7F;">"** ARTICLE %T %? "</span>
           <span style="color: #7FBFFF;">:prepend</span> nil
           <span style="color: #7FBFFF;">:unnarrowed</span> nil
           <span style="color: #7FBFFF;">:kill-buffer</span> t
           )
          ))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org70b1d79" class="outline-3">
<h3 id="org70b1d79">Agenda: スケジュール，TODO 表示</h3>
<div class="outline-text-3" id="text-org70b1d79">
<p>
GTD 用の設定．後述の <code>org-gcal</code> と <code>orgmine</code> で取得したデータも表示している．
ついでに
</p>
<ul class="org-ul">
<li>土曜日をの face を追加.</li>
<li>祝日, 休日を日曜と同じfaceにする.</li>
</ul>
<p>
なんて事もやっている．元ネタは <a href="https://julien.danjou.info/blog/2010/org-mode-and-holidays">Org-mode and holidays</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-agenda</span>
  <span style="color: #7FBFFF;">:diminish</span> org-agenda-mode
  <span style="color: #7FBFFF;">:if</span> (file-directory-p my:d:org)
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-c a"</span> . org-agenda))
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-date-saturday</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FBFFF"</span> <span style="color: #7FBFFF;">:bold</span> t )))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;&#12398;&#22303;&#26332;&#26085;&#29992;&#12398;face"</span>)
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-date-today-saturday</span>
    '((t (<span style="color: #7FBFFF;">:inherit</span> my:org-agenda-date-saturday <span style="color: #7FBFFF;">:underline</span> t)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;&#12398;&#20170;&#26085;&#12363;&#12388;&#22303;&#26332;&#26085;&#29992;&#12398;face"</span>)
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-date-today-weekend</span>
    '((t (<span style="color: #7FBFFF;">:inherit</span> org-agenda-date-weekend <span style="color: #7FBFFF;">:underline</span> t)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;&#12398;&#20170;&#26085;&#12363;&#12388;&#26085;&#12539;&#31069;&#26085;&#29992;&#12398;face"</span>)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12371;&#12387;&#12363;&#12425;&#12399; org-gcal &#12391;&#21516;&#26399;&#12375;&#12383;&#12459;&#12524;&#12531;&#12480;&#12540;&#12398;&#33394;</span>
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-KUSM</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, KUSM.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-Schedule</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, Schedule.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-GFD</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF7F"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, GFD.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-DebianJP</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#BF7FFF"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, DebianJP.org &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  (<span style="color: #FF7F7F;">defface</span> <span style="color: #7F7FFF;">my:org-agenda-calendar-twitter</span>
    '((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#CCCCCC"</span>)))
    <span style="color: #7FFF7F;">"Agenda &#34920;&#31034;&#20013;, Twitter log &#12398;&#34920;&#31034; face"</span>
    <span style="color: #7FBFFF;">:group</span> 'org-agenda )
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26356;&#26032;&#29992;&#12398;&#38306;&#25968; - &#12392;&#12426;&#12354;&#12360;&#12378;&#21205;&#12356;&#12390;&#12356;&#12427;&#12398;&#12391;&#33391;&#12375;&#12392;&#12377;&#12427;&#12364;&#65292;&#12522;&#12501;&#12449;&#12463;&#12479;&#12522;&#12531;&#12464;&#12375;&#12383;&#12356;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-agenda-day-face-function</span> (date)
    <span style="color: #7FFF7F;">"Compute DATE face for saturday, holidays."</span>
    (<span style="color: #FF7F7F;">cl-dolist</span> (file (org-agenda-files nil 'ifmode))
      (<span style="color: #FF7F7F;">cond</span>
       ((member (calendar-day-of-week date) '(7))
        (<span style="color: #FF7F7F;">if</span> (org-agenda-todayp date)
            (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-today-weekend))
        (<span style="color: #FF7F7F;">cl-return</span> 'org-agenda-date-weekend))
       ((member (calendar-day-of-week date) '(6))
        (<span style="color: #FF7F7F;">if</span> (org-agenda-todayp date)
            (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-today-saturday))
        (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-saturday)))
      (<span style="color: #FF7F7F;">let</span> ((face
             (<span style="color: #FF7F7F;">cl-dolist</span> (entry (org-agenda-get-day-entries file date))
               (<span style="color: #FF7F7F;">let</span> ((category (<span style="color: #FF7F7F;">with-temp-buffer</span>
                                 (insert entry)
                                 (org-get-category (point-min)))))
                 (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">or</span> (string= <span style="color: #7FFF7F;">"&#31069;&#26085;"</span> category)
                           (string= <span style="color: #7FFF7F;">"&#20241;&#26085;"</span> category))
                   (<span style="color: #FF7F7F;">if</span> (org-agenda-todayp date)
                       (<span style="color: #FF7F7F;">cl-return</span> 'my:org-agenda-date-today-weekend)
                     (<span style="color: #FF7F7F;">cl-return</span> 'org-agenda-date-weekend)))))))
        (<span style="color: #FF7F7F;">when</span> face (<span style="color: #FF7F7F;">cl-return</span> face)))))
  <span style="color: #7FBFFF;">:config</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#20351;&#29992;&#12377;&#12427;&#12501;&#12449;&#12452;&#12523;</span>
  (<span style="color: #FF7F7F;">dolist</span> (file
           '(<span style="color: #7FFF7F;">"Archive.org"</span>
             <span style="color: #7FFF7F;">"Holidays.org"</span>
             <span style="color: #7FFF7F;">"Memo.org"</span>
             <span style="color: #7FFF7F;">"Schedule.org"</span>
             <span style="color: #7FFF7F;">"GFD.org"</span>
             <span style="color: #7FFF7F;">"KUSM.org"</span>
             <span style="color: #7FFF7F;">"DebianJP.org"</span>
             <span style="color: #7FFF7F;">"twitter.org"</span>
             <span style="color: #7FFF7F;">"journal.org"</span>
             <span style="color: #7FFF7F;">"redmine_GFD.org"</span>
             <span style="color: #7FFF7F;">"redmine_FluidSoc.org"</span>
             <span style="color: #7FFF7F;">"redmine_KUSM.org"</span>
             ))
    (add-to-list 'org-agenda-files (concat org-directory file)))
  (add-to-list 'org-agenda-files (expand-file-name <span style="color: #7FFF7F;">"README.org"</span> user-emacs-directory))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#34920;&#31034;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span>
  (<span style="color: #FF7F7F;">setq</span> org-agenda-span 'day                   <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">day or week</span>
        org-agenda-format-date <span style="color: #7FFF7F;">"%Y/%m/%d (%a)"</span> <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">YY/MM/DD (&#26332;)</span>
        org-agenda-weekend-days '(0)           <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26085;&#26332;&#22987;&#12414;&#12426;</span>
        <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#34920;&#31034;&#38306;&#25968;</span>
        org-agenda-day-face-function 'my:org-agenda-day-face-function
        org-agenda-custom-commands             <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">GTD &#29992;&#12398;&#35373;&#23450;</span>
        '(
          (<span style="color: #7FFF7F;">"n"</span> <span style="color: #7FFF7F;">"agenda and all TODO list"</span>
           (
            (agenda <span style="color: #7FFF7F;">""</span>
                    ((org-agenda-ndays 1)
                     (org-agenda-entry-types '(<span style="color: #7FBFFF;">:timestamp</span> <span style="color: #7FBFFF;">:sexp</span>))))
            (todo <span style="color: #7FFF7F;">"TODO"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            (todo <span style="color: #7FFF7F;">"&#26032;&#35215;|&#30528;&#25163;|&#36914;&#34892;&#20013;|&#30906;&#35469;"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            (todo <span style="color: #7FFF7F;">"WAIT"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            (todo <span style="color: #7FFF7F;">"SOMEDAY"</span>
                  ((org-agenda-prefix-format <span style="color: #7FFF7F;">" %i %-22:c"</span>))
                  )
            ))
          (<span style="color: #7FFF7F;">"N"</span> <span style="color: #7FFF7F;">"All memo entry"</span>
           (<span style="color: #a5a5a6;">;;</span>
            (todo <span style="color: #7FFF7F;">"MEMO"</span>)
            ))
           )
        )
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#33394;&#20184;&#12369;</span>
  (add-hook 'org-finalize-agenda-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (<span style="color: #FF7F7F;">save-excursion</span>
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"KUSM:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                     '(face my:org-agenda-calendar-KUSM)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"Schedule:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-Schedule)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"DebianJP:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-DebianJP)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"GFD:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-GFD)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"twitter:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face my:org-agenda-calendar-twitter)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"&#31069;&#26085;:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face org-agenda-date-weekend)))
                (goto-char (point-min))
                (<span style="color: #FF7F7F;">while</span> (re-search-forward <span style="color: #7FFF7F;">"&#20241;&#26085;:"</span> nil t)
                  (add-text-properties (match-beginning 0) (point-at-eol)
                                       '(face org-agenda-date-weekend)))
                )))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb85b0f6" class="outline-3">
<h3 id="orgb85b0f6">Babel</h3>
<div class="outline-text-3" id="text-orgb85b0f6">
</div><div id="outline-container-org77ec1ed" class="outline-4">
<h4 id="org77ec1ed">org-src</h4>
<div class="outline-text-4" id="text-org77ec1ed">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-src</span>
  <span style="color: #7FBFFF;">:diminish</span> org-src-mode
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-src-fontify-natively t       <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">font-lock</span>
        org-src-tab-acts-natively t      <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">indent</span>
        org-edit-src-content-indentation 0
        org-src-preserve-indentation t
        )
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org3e25d6d" class="outline-4">
<h4 id="org3e25d6d">org-ditaa</h4>
<div class="outline-text-4" id="text-org3e25d6d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ob-ditaa</span>
  <span style="color: #7FBFFF;">:if</span> (file-exists-p (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/bin/jditaa.jar"</span>))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-ditaa-jar-path (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/bin/jditaa.jar"</span>))
  (org-babel-do-load-languages 'org-babel-load-languages
                               '((ditaa . t)))
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org87df5bd" class="outline-3">
<h3 id="org87df5bd">OrgとGoogle カレンダーの連携: <code>org-gcal</code></h3>
<div class="outline-text-3" id="text-org87df5bd">
</div><div id="outline-container-orgc96ae13" class="outline-4">
<h4 id="orgc96ae13">token 等の置き場所の変更</h4>
<div class="outline-text-4" id="text-orgc96ae13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">request</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> request-storage-directory (concat my:d:tmp <span style="color: #7FFF7F;">"request"</span>))
  (<span style="color: #FF7F7F;">unless</span> (file-directory-p request-storage-directory)
    (make-directory request-storage-directory)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4833a48" class="outline-4">
<h4 id="org4833a48">org-gcal 本体の設定</h4>
<div class="outline-text-4" id="text-org4833a48">
<p>
実際の情報等は <code>password-store</code> を使って設定しておく.
ついでに agenda 表示の際の色付けを設定．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-gcal</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> my:d:password-store
           (file-directory-p my:d:org))
  <span style="color: #7FBFFF;">:commands</span> (org-gcal-fetch)
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">setq</span> org-gcal-dir (concat my:d:tmp <span style="color: #7FFF7F;">"org-gcal"</span>))
  (<span style="color: #FF7F7F;">unless</span> org-gcal-dir
    (make-directory org-gcal-dir))
  (<span style="color: #FF7F7F;">setq</span> org-gcal-token-file (expand-file-name <span style="color: #7FFF7F;">".org-gcal-token"</span> org-gcal-dir))
  (<span style="color: #FF7F7F;">setq</span> alert-log-messages t)
  (<span style="color: #FF7F7F;">setq</span> alert-default-style 'log)
  (<span style="color: #FF7F7F;">setq</span> org-gcal-down-days   90) <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#36942;&#21435; 3 month</span>
  (<span style="color: #FF7F7F;">setq</span> org-gcal-up-days    180) <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26410;&#26469; 6 month</span>
  (<span style="color: #FF7F7F;">setq</span> org-gcal-auto-archive nil)
  <span style="color: #7FBFFF;">:config</span>
  (load (expand-file-name <span style="color: #7FFF7F;">"emacs/org-gcal.gpg"</span> my:d:password-store)))
</pre>
</div>
<p>
password-store には multiline で設定を書く．例えば以下:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">setq</span> org-gcal-client-id <span style="color: #7FFF7F;">"XXXXXXXXXXX"</span>
      org-gcal-client-secret <span style="color: #7FFF7F;">"XXXXXXXXXXX"</span>
      org-gcal-file-alist
      '((<span style="color: #7FFF7F;">"XXXXX@gmail.com"</span> . <span style="color: #7FFF7F;">"~/org/Schedule.org"</span>)
        (<span style="color: #7FFF7F;">"YYYYY@group.calendar.google.com"</span> . <span style="color: #7FFF7F;">"~/org/Project1.org"</span>)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbc5264a" class="outline-3">
<h3 id="orgbc5264a">OrgとRedmine の連携: <code>orgmine</code></h3>
<div class="outline-text-3" id="text-orgbc5264a">
<p>
素晴しい!! <a href="https://github.com/kametoku/orgmine">kametoku/orgmine: Emacs minor mode for org-mode with redmine integration</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">orgmine</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> my:d:password-store
           (file-directory-p org-directory))
  <span style="color: #7FBFFF;">:commands</span> (orgmine-mode)
  <span style="color: #7FBFFF;">:init</span>
  (<span style="color: #FF7F7F;">unless</span> (package-installed-p 'orgmine)
    (package-install 'elmine)
    (quelpa '(orgmine
              <span style="color: #7FBFFF;">:fetcher</span> github
              <span style="color: #7FBFFF;">:repo</span> <span style="color: #7FFF7F;">"kametoku/orgmine"</span>)))
  (add-to-list 'safe-local-variable-values
               '(orgmine-note-block-begin . <span style="color: #7FFF7F;">"#+BEGIN_SRC textile"</span>))
  (add-hook 'org-mode-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (<span style="color: #FF7F7F;">if</span> (assoc <span style="color: #7FFF7F;">"om_project"</span> org-file-properties) (orgmine-mode))))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> orgmine-note-block-begin <span style="color: #7FFF7F;">"#+BEGIN_SRC gfm"</span>   <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#35201;&#35519;&#25972;</span>
        orgmine-note-block-end   <span style="color: #7FFF7F;">"#+END_SRC\n"</span>
        orgmine-default-todo-keyword <span style="color: #7FFF7F;">"&#26032;&#35215;"</span>)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12469;&#12540;&#12496;&#35373;&#23450;</span>
  (load (expand-file-name <span style="color: #7FFF7F;">"emacs/orgmine.gpg"</span> my:d:password-store)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org24423f9" class="outline-3">
<h3 id="org24423f9">Org-Export</h3>
<div class="outline-text-3" id="text-org24423f9">
</div><div id="outline-container-org23717b7" class="outline-4">
<h4 id="org23717b7">一般設定</h4>
<div class="outline-text-4" id="text-org23717b7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox</span>
    <span style="color: #7FBFFF;">:config</span>
    (<span style="color: #FF7F7F;">setq</span> org-export-with-toc nil
          org-export-with-section-numbers nil)
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">for Beamer</span>
    (add-to-list 'org-export-options-alist
                 '(<span style="color: #7FBFFF;">:shortdate</span>    <span style="color: #7FFF7F;">"SHORTDATE"</span> nil nil))
    (add-to-list 'org-export-options-alist
                 '(<span style="color: #7FBFFF;">:shorttitle</span>   <span style="color: #7FFF7F;">"SHORTTITLE"</span> nil nil))
    <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">for Jekyll</span>
    (add-to-list 'org-export-options-alist
                 '(<span style="color: #7FBFFF;">:layout</span>    <span style="color: #7FFF7F;">"LAYOUT"</span> nil <span style="color: #7FFF7F;">"default"</span>))
    (add-to-list 'org-export-options-alist
                 '(<span style="color: #7FBFFF;">:ref</span>       <span style="color: #7FFF7F;">"REF"</span> nil nil))
    (add-to-list 'org-export-options-alist
                 '(<span style="color: #7FBFFF;">:permalink</span> <span style="color: #7FFF7F;">"PERMALINK"</span> nil nil))
    (add-to-list 'org-export-options-alist
                 '(<span style="color: #7FBFFF;">:redirect_from</span> <span style="color: #7FFF7F;">"redirect_from"</span> nil nil))
    (add-to-list 'org-export-options-alist
                 '(<span style="color: #7FBFFF;">:redirect_to</span> <span style="color: #7FFF7F;">"redirect_to"</span> nil nil))
    )
</pre>
</div>
</div>
</div>
<div id="outline-container-org7219086" class="outline-4">
<h4 id="org7219086">Beamer export</h4>
<div class="outline-text-4" id="text-org7219086">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox-beamer</span>
  <span style="color: #7FBFFF;">:config</span>
  (add-to-list 'org-latex-classes
               '(<span style="color: #7FFF7F;">"my:beamer"</span>
                 <span style="color: #7FFF7F;">"\\documentclass[dvipdfmx,presentation]{beamer}</span>
<span style="color: #7FFF7F;">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
                 (<span style="color: #7FFF7F;">"\\section\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\section*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsection*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsubsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsubsection*\&#123;%s\}"</span>))
               )
  <span style="color: #a5a5a6;">;;</span>
  (add-to-list 'org-latex-classes
               '(<span style="color: #7FFF7F;">"my:beamer-uplatex"</span>
                 <span style="color: #7FFF7F;">"\\documentclass[dvipdfmx,presentation]{beamer}</span>
<span style="color: #7FFF7F;">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
                 (<span style="color: #7FFF7F;">"\\section\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\section*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsection*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsubsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsubsection*\&#123;%s\}"</span>))
               )
  (add-to-list 'org-latex-classes
               '(<span style="color: #7FFF7F;">"my:beamer-pdflatex"</span>
                 <span style="color: #7FFF7F;">"\\documentclass[unicode,presentation]{beamer}</span>
<span style="color: #7FFF7F;">                     [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
                 (<span style="color: #7FFF7F;">"\\section\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\section*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsection*\&#123;%s\}"</span>)
                 (<span style="color: #7FFF7F;">"\\subsubsection\&#123;%s\}"</span> . <span style="color: #7FFF7F;">"\\subsubsection*\&#123;%s\}"</span>))
               )
  )
</pre>
</div>
<p>
LATEX<sub>CLASS</sub> に <code>my:beamer</code> を指定すると，上記設定で export される．
</p>
</div>
</div>
<div id="outline-container-orgce70b34" class="outline-4">
<h4 id="orgce70b34">HTML export</h4>
<div class="outline-text-4" id="text-orgce70b34">
<p>
後述の Jekyll 用の設定も参照のこと．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox-html</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-html-use-infojs nil
        org-html-html5-fancy t
        org-export-htmlize-output-type 'inline-css
        org-html-doctype <span style="color: #7FFF7F;">"html5"</span>
        org-html-text-markup-alist
        '((bold           . <span style="color: #7FFF7F;">"&lt;strong&gt;%s&lt;/strong&gt;"</span>)
          (code           . <span style="color: #7FFF7F;">"&lt;code&gt;%s&lt;/code&gt;"</span>)
          (italic         . <span style="color: #7FFF7F;">"&lt;i&gt;%s&lt;/i&gt;"</span>)
          (strike-through . <span style="color: #7FFF7F;">"&lt;del&gt;%s&lt;/del&gt;"</span>)
          (underline      . <span style="color: #7FFF7F;">"&lt;span class=\"underline\"&gt;%s&lt;/span&gt;"</span>)
          (verbatim       . <span style="color: #7FFF7F;">"&lt;code&gt;%s&lt;/code&gt;"</span>)))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org69419ea" class="outline-4">
<h4 id="org69419ea">Jekyll 用の Backend の定義</h4>
<div class="outline-text-4" id="text-org69419ea">
<p>
Web サイトは Jekyll で作成しています．
<a href="https://github.com/yoshinari-nomura/org-octopress">yoshinari-nomura/org-octopress: org-mode in octopress</a> の
<code>ox-jekyll</code> を参考に <del>改造して</del> ，
html export の際に必要な yaml front matter を出力できるようにしてます．
あと，src-block が liquid に解釈されない様に escape してます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-export-define-derived-backend 'jekyll 'html
  <span style="color: #7FBFFF;">:menu-entry</span>
  '(?j <span style="color: #7FFF7F;">"Jekyl: export to html with YAML front matter."</span>
       ((?H <span style="color: #7FFF7F;">"To temporary buffer"</span>
            (<span style="color: #FF7F7F;">lambda</span> (a s v b) (org-jekyll-export-as-html a s v)))
        (?h <span style="color: #7FFF7F;">"To file"</span> (<span style="color: #FF7F7F;">lambda</span> (a s v b) (org-jekyll-export-to-html a s v)))))
  <span style="color: #7FBFFF;">:translate-alist</span>
  '((template  . org-jekyll-template)
    )
  <span style="color: #7FBFFF;">:filters-alist</span>
  '((<span style="color: #7FBFFF;">:filter-final-output</span> . org-jekyll-finalized))
  )
<span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">template</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-template</span> (contents info)
  <span style="color: #7FFF7F;">"Return complete document string after HTML conversion."</span>
  (concat (org-jekyll--yaml-front-matter info) contents))
<span style="color: #a5a5a6;">;;; </span><span style="color: #a5a5a6;">&#24190;&#12388;&#12363;&#12398;&#25991;&#23383;&#21015;&#12434;&#32622;&#25563;&#12377;&#12427;</span>
<span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">- liquid template&#12395;&#35492;&#35469;&#12373;&#12428;&#12427; `</span><span style="color: #FFBF7F;">&#123;%</span><span style="color: #a5a5a6;">', `</span><span style="color: #FFBF7F;">%&#125;</span><span style="color: #a5a5a6;">'</span>
<span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">- `:' &#12398; escape</span>
<span style="color: #a5a5a6;">;;  </span><span style="color: #a5a5a6;">- table-of-contents &#12398;&#20966;&#29702;</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-finalized</span> (contents _backend info)
  <span style="color: #7FFF7F;">"Publish src-block to html, Escape liquid tags, e.g. &#123;%, %&#125;"</span>
  (<span style="color: #FF7F7F;">with-temp-buffer</span>
    (insert contents)
    (perform-replace <span style="color: #7FFF7F;">"&amp;$58;"</span> <span style="color: #7FFF7F;">"&amp;#58;"</span> nil nil nil nil nil (point-min) (point-max))
    (perform-replace <span style="color: #7FFF7F;">"&#123;%"</span> <span style="color: #7FFF7F;">"&amp;#123;%"</span> nil nil nil nil nil (point-min) (point-max))
    (perform-replace <span style="color: #7FFF7F;">"%&#125;"</span> <span style="color: #7FFF7F;">"%&amp;#125;"</span> nil nil nil nil nil (point-min) (point-max))
    (perform-replace <span style="color: #7FFF7F;">"&lt;nav id=\"table-of-contents"</span> <span style="color: #7FFF7F;">"&lt;div id=\"toc-wrapper\"&gt;</span>
<span style="color: #7FFF7F;">&lt;nav id=\"table-of-contents"</span> nil nil nil nil nil (point-min) (point-max))
    (perform-replace <span style="color: #7FFF7F;">"&lt;/nav&gt;"</span> (format <span style="color: #7FFF7F;">"&lt;/nav&gt;</span>
<span style="color: #7FFF7F;">&lt;/div&gt;</span>
<span style="color: #7FFF7F;">&lt;a href=\"#toc-toggle\" class=\"btn toc-btn\" id=\"toc-toggle\"&gt;%s&lt;/a&gt;"</span>
                                      (org-html--translate <span style="color: #7FFF7F;">"Table of Contents"</span> info))
                     nil nil nil nil nil (point-min) (point-max))
    (set-auto-mode t)
    (buffer-substring-no-properties (point-min) (point-max))))
<span style="color: #a5a5a6;">;;</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll--get-option</span> (info property-name <span style="color: #FFFF7F;">&amp;optional</span> default)
  (<span style="color: #FF7F7F;">let</span> ((property (org-export-data (plist-get info property-name) info)))
    (format <span style="color: #7FFF7F;">"%s"</span> (<span style="color: #FF7F7F;">or</span> property default <span style="color: #7FFF7F;">""</span>))))
<span style="color: #a5a5a6;">;;</span>
(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll--yaml-front-matter</span> (info)
  (<span style="color: #FF7F7F;">let</span> ((title
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:title</span>))
        (date
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:date</span>))
        (language
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:language</span>))
        (layout
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:layout</span>))
        (jekyll-ref
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:ref</span> ))
        (jekyll-permalink
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:permalink</span> ))
        (jekyll-redirect-from
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:redirect_from</span> ))
        (jekyll-redirect-to
         (org-jekyll--get-option info <span style="color: #7FBFFF;">:redirect_to</span> ))
        (convert-to-yaml-list
         (<span style="color: #FF7F7F;">lambda</span> (arg)
           (mapconcat #'(lambda (text)(concat <span style="color: #7FFF7F;">"\n- "</span> text)) (split-string arg) <span style="color: #7FFF7F;">" "</span>))))
    (concat
     <span style="color: #7FFF7F;">"---"</span>
     <span style="color: #7FFF7F;">"\ntitle: "</span>      (s-replace <span style="color: #7FFF7F;">":"</span> <span style="color: #7FFF7F;">"&amp;$58;"</span> title)
     <span style="color: #7FFF7F;">"\ndate: "</span>       date
     <span style="color: #7FFF7F;">"\nlayout: "</span>     layout
     <span style="color: #7FFF7F;">"\nlang: "</span>       language
     (<span style="color: #FF7F7F;">unless</span> (string-equal jekyll-ref <span style="color: #7FFF7F;">""</span>)
       (concat <span style="color: #7FFF7F;">"\nref: "</span> jekyll-ref))
     (<span style="color: #FF7F7F;">unless</span> (string-equal jekyll-permalink <span style="color: #7FFF7F;">""</span>)
       (concat <span style="color: #7FFF7F;">"\npermalink: "</span> jekyll-permalink))
     (<span style="color: #FF7F7F;">unless</span> (string-equal jekyll-redirect-from <span style="color: #7FFF7F;">""</span>)
       (concat <span style="color: #7FFF7F;">"\nredirect_from: "</span> jekyll-redirect-from))
     (<span style="color: #FF7F7F;">unless</span> (string-equal jekyll-redirect-to <span style="color: #7FFF7F;">""</span>)
       (concat <span style="color: #7FFF7F;">"\nredirect_to: "</span> jekyll-redirect-to))
     <span style="color: #7FFF7F;">"\n---\n"</span>)))

(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-export-as-html</span>
    (<span style="color: #FFFF7F;">&amp;optional</span> async subtreep visible-only body-only ext-plist)
  <span style="color: #7FFF7F;">"Export current buffer to a HTML buffer adding some YAML front matter."</span>
  (<span style="color: #FF7F7F;">interactive</span>)
  (org-export-to-buffer 'jekyll <span style="color: #7FFF7F;">"*Org Jekyll HTML Export*"</span>
    async subtreep visible-only body-only ext-plist (<span style="color: #FF7F7F;">lambda</span> () (html-mode))))

(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-jekyll-export-to-html</span>
    (<span style="color: #FFFF7F;">&amp;optional</span> async subtreep visible-only body-only ext-plist)
  <span style="color: #7FFF7F;">"Export current buffer to a HTML file adding some YAML front matter."</span>
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">let</span> ((outfile (org-export-output-file-name <span style="color: #7FFF7F;">".html"</span> subtreep)))
    (org-export-to-file 'jekyll outfile async subtreep visible-only body-only ext-plist)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org00e03ba" class="outline-3">
<h3 id="org00e03ba">Org-Project</h3>
<div class="outline-text-3" id="text-org00e03ba">
<p>
<code>org-publish-all</code> 等で batch で一括出力できるようにしておきます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">htmlize</span>)
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ox-publish</span>
  <span style="color: #7FBFFF;">:if</span> (file-directory-p <span style="color: #7FFF7F;">"~/Public/.git"</span>)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">org-publish-to-jekyll</span> (plist filename pub-dir)
    <span style="color: #7FFF7F;">"publishing org to html with Jekyll YAML front matter."</span>
    (org-id-update-id-locations)
    (org-publish-org-to 'jekyll filename <span style="color: #7FFF7F;">".html"</span> plist pub-dir))
  (<span style="color: #FF7F7F;">setq</span> org-publish-use-timestamps-flag t
        org-publish-timestamp-directory <span style="color: #7FFF7F;">"~/Public/.org-timestamps/"</span>
        org-publish-project-alist
        '((<span style="color: #7FFF7F;">"org"</span>
           <span style="color: #7FBFFF;">:base-directory</span> <span style="color: #7FFF7F;">"~/Public/"</span>
           <span style="color: #7FBFFF;">:base-extension</span> <span style="color: #7FFF7F;">"org"</span>
           <span style="color: #7FBFFF;">:exclude</span> <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">_.*</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">cc-env</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>
           <span style="color: #7FBFFF;">:publishing-directory</span> <span style="color: #7FFF7F;">"~/Public/"</span>
           <span style="color: #7FBFFF;">:publishing-function</span> org-publish-to-jekyll
           <span style="color: #7FBFFF;">:recursive</span> t
           <span style="color: #7FBFFF;">:with-toc</span> nil
           <span style="color: #7FBFFF;">:headline-levels</span> 5
           )
          (<span style="color: #7FFF7F;">"cc-env"</span>
           <span style="color: #7FBFFF;">:base-directory</span> <span style="color: #7FFF7F;">"~/Public/cc-env/"</span>
           <span style="color: #7FBFFF;">:base-extension</span> <span style="color: #7FFF7F;">"org"</span>
           <span style="color: #7FBFFF;">:publishing-directory</span> <span style="color: #7FFF7F;">"~/Public/cc-env/"</span>
           <span style="color: #7FBFFF;">:publishing-function</span> org-publish-to-jekyll
           <span style="color: #7FBFFF;">:recursive</span> t
           <span style="color: #7FBFFF;">:with-toc</span> t
           <span style="color: #7FBFFF;">:headline-levels</span> 5
           )
          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">("web" :components ("org" "cc-env"))</span>
          )
        )
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org30efae7" class="outline-3">
<h3 id="org30efae7">Org-Wiki</h3>
<div class="outline-text-3" id="text-org30efae7">
<p>
計算機関連のメモは <a href="https://github.com/caiorss/org-wiki">org-wiki</a> で書いています．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (package-installed-p 'org-wiki)
  (quelpa '(org-wiki
            <span style="color: #7FBFFF;">:fetcher</span> github
            <span style="color: #7FBFFF;">:repo</span> <span style="color: #7FFF7F;">"caiorss/org-wiki"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">org-wiki</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> org-wiki-location (concat (getenv <span style="color: #7FFF7F;">"HOME"</span>) <span style="color: #7FFF7F;">"/Public/cc-env/"</span>))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:org-wiki-header</span> ()
    <span style="color: #7FFF7F;">"Insert a header at the top of the file, customize for personal use"</span>
    (<span style="color: #FF7F7F;">interactive</span>)
    (<span style="color: #FF7F7F;">save-excursion</span>
      (goto-char (point-min))
      (insert (format
               (string-trim <span style="color: #7FFF7F;">"</span>
<span style="color: #7FFF7F;">#+TITLE:</span>
<span style="color: #7FFF7F;">#+DATE: 20</span>
<span style="color: #7FFF7F;">#+LANGUAGE: ja</span>
<span style="color: #7FFF7F;">#+REF: cc-env/%s</span>
<span style="color: #7FFF7F;">#+LAYOUT: cc-env</span>
<span style="color: #7FFF7F;">#+SETUPFILE: ~/Public/_setup.org</span>
<span style="color: #7FFF7F;">#+PERMALINK: /cc-env/%s.html</span>
<span style="color: #7FFF7F;">Related [[wiki:index][Index]]</span>
<span style="color: #7FFF7F;">"</span>)
               (file-name-base (buffer-file-name))
               (file-name-base (buffer-file-name))))))
  (advice-add 'org-wiki-header <span style="color: #7FBFFF;">:override</span> 'my:org-wiki-header)
  )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1a9456e" class="outline-2">
<h2 id="org1a9456e">Howm</h2>
<div class="outline-text-2" id="text-org1a9456e">
<p>
Org を使う前は Howm を使っていました.
過去のメモを検索するためだけに未だに Howm を使っています.
</p>

<p>
Rust で書かれた <a href="https://github.com/BurntSushi/ripgrep">ripgrep</a> がとても速いらしいので， <code>howm</code> と <code>ripgrep</code> がある時だけ
読み込むようにしています．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">howm</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (my:dpkg-status <span style="color: #7FFF7F;">"howm"</span>)
           (executable-find <span style="color: #7FFF7F;">"rg"</span>))
  <span style="color: #7FBFFF;">:diminish</span> howm-mode
  <span style="color: #7FBFFF;">:bind</span> (<span style="color: #7FBFFF;">:map</span> howm-mode-map
              (<span style="color: #7FFF7F;">"C-c C-c"</span>     . nil)
              (<span style="color: #7FFF7F;">"C-x C-z C-c"</span> . howm-save-and-kill-buffer/screen))
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'howm-menu-hook (<span style="color: #FF7F7F;">lambda</span> ()
                              (<span style="color: #FF7F7F;">setq</span> truncate-lines t)))
  <span style="color: #7FBFFF;">:config</span>
  <span style="color: #a5a5a6;">;;; </span><span style="color: #a5a5a6;">&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#35373;&#23450;</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12513;&#12514;&#12398;&#20869;&#23481;&#12399; Dropbox &#12391;&#21516;&#26399;&#12377;&#12427;&#12371;&#12392;&#12395;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-directory <span style="color: #7FFF7F;">"~/Dropbox/org"</span>)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12513;&#12491;&#12517;&#12540;&#12392;&#23653;&#27508;&#12434;&#26908;&#32034;&#23550;&#35937;&#12363;&#12425;&#38500;&#22806;&#12377;&#12427;&#12383;&#12417;&#12395;&#21029;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12408;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-keyword-file <span style="color: #7FFF7F;">"~/Dropbox/.howm/keys"</span>
        howm-history-file <span style="color: #7FFF7F;">"~/Dropbox/.howm/history"</span>
        howm-menu-file <span style="color: #7FFF7F;">"~/Dropbox/.howm/menu"</span>)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12513;&#12514;&#12501;&#12449;&#12452;&#12523;&#12399;&#26085;&#20184;&#26178;&#21051;&#27598;&#12395;&#20998;&#38626;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-file-name-format <span style="color: #7FFF7F;">"%Y%m%d-%H%M%S.howm"</span>)
  <span style="color: #a5a5a6;">;;;  </span><span style="color: #a5a5a6;">&#12513;&#12514;&#12399;org&#12391;&#26360;&#12367;</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">- org-mode &#12398; hook &#12392;&#12375;&#12390; howm-mode &#12434;&#30331;&#37682;</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">- C-c &#12364; org &#12395;&#21462;&#12425;&#12428;&#12427;&#12398;&#12391;, howm &#12398; prefix &#12399; C-xC-z &#12395;</span>
  (add-hook 'org-mode-hook 'howm-mode)
  (global-unset-key (kbd <span style="color: #7FFF7F;">"C-x C-z"</span>))
  (<span style="color: #FF7F7F;">setq</span> howm-prefix (kbd <span style="color: #7FFF7F;">"C-x C-z"</span>))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">title header &#12399; "*"</span>
  (<span style="color: #FF7F7F;">setq</span> howm-view-title-header <span style="color: #7FFF7F;">"*"</span>)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">:config</span>
  (<span style="color: #FF7F7F;">when</span> (locate-library <span style="color: #7FFF7F;">"elscreen-howm"</span>)
    (<span style="color: #FF7F7F;">require</span> '<span style="color: #FFBF7F;">elscreen-howm</span> nil 'noerror))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#33394;&#20184;&#12369;&#12399; org-mode &#20219;&#12379;: howm &#12398; font-lock &#12434;&#28961;&#21177;&#21270;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-use-color nil)
  <span style="color: #a5a5a6;">;;; </span><span style="color: #a5a5a6;">&#20197;&#19979;&#65292;&#27770;&#12414;&#12426;&#25991;&#21477;</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26908;&#32034;&#12391;&#22823;&#25991;&#23383;&#23567;&#25991;&#23383;&#12434;&#21306;&#21029;&#12375;&#12394;&#12356;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-keyword-case-fold-search t)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">grep &#12398; &#20195;&#12431;&#12426;&#12395; rg (ripgrep) &#12434;&#20351;&#12358;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-view-use-grep t
        howm-view-grep-command <span style="color: #7FFF7F;">"rg"</span>
        howm-view-grep-option <span style="color: #7FFF7F;">"-nH --no-heading --color never"</span>
        howm-view-grep-extended-option nil
        howm-view-grep-fixed-option <span style="color: #7FFF7F;">"-F"</span>
        howm-view-grep-expr-option nil
        howm-view-grep-file-stdin-option nil)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26908;&#32034;&#23550;&#35937;&#12398;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#36861;&#21152;...&#12392;&#12426;&#12354;&#12360;&#12378;&#36861;&#21152;&#12375;&#12394;&#12356;&#12371;&#12392;&#12395;&#65294;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-search-other-dir nil)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26908;&#32034;&#23550;&#35937;&#22806;&#12398;&#12501;&#12449;&#12452;&#12523;: ad hoc &#12395;&#12393;&#12435;&#12393;&#12435;&#22679;&#12360;&#12390;&#12356;&#12367;&#12394;&#12353;...</span>
  (<span style="color: #FF7F7F;">setq</span> howm-excluded-file-regexp
        <span style="color: #7FFF7F;">"/\\.#</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">[~#]$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.bak$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">/CVS/</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.doc</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.pdf</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.txt$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.html$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.tex$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.dvi$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.fdb_latexmk$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.ppt$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.xls$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.howm-menu$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">.howm-keys$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.png$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.gif$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.tif$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.tiff$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.jpg$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.jpeg$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.el$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.aux$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.log$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">Makefile</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.txt$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">EUC-UCS2</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.fdb_latexmk$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">latexmkrc</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.gpg$</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\\.org$"</span>)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">org-mode &#12398;&#26085;&#20184;&#26908;&#32034;&#29992;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-reminder-regexp-grep-format
        (concat <span style="color: #7FFF7F;">"&lt;"</span> howm-date-regexp-grep <span style="color: #7FFF7F;">"[ :0-9]*&gt;%s"</span>))
  (<span style="color: #FF7F7F;">setq</span> howm-reminder-regexp-format
        (concat <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">&lt;"</span> howm-date-regexp <span style="color: #7FFF7F;">"[ :0-9]*&gt;</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">%s</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">[0-9]*</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>))
  <span style="color: #a5a5a6;">;;; </span><span style="color: #a5a5a6;">&#34920;&#31034;&#35373;&#23450;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-top nil
        howm-menu-lang 'ja)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#19968;&#35239;&#12395;&#12479;&#12452;&#12488;&#12523;&#34920;&#31034;&#12375;&#12394;&#12356;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-list-title nil)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">save &#26178;&#12395;&#12513;&#12491;&#12517;&#12540;&#12434;&#26356;&#26032;&#12375;&#12394;&#12356;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-refresh-after-save nil)
  (<span style="color: #FF7F7F;">setq</span> howm-refresh-after-save nil)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#26032;&#35215;&#12513;&#12514;&#12434;&#19978;&#12395;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-prepend t)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#20840;&#12513;&#12514;&#19968;&#35239;&#26178;&#12395;&#12479;&#12452;&#12488;&#12523;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-list-all-title t)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12300;&#26368;&#36817;&#12398;&#12513;&#12514;&#12301;&#19968;&#35239;&#26178;&#12395;&#12479;&#12452;&#12488;&#12523;&#34920;&#31034;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-list-recent-title t)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12300;&#26368;&#36817;&#12398;&#12513;&#12514;&#12301;&#12398;&#34920;&#31034;&#20214;&#25968;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-recent-num 20)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#12513;&#12491;&#12517;&#12540;&#12434; 2 &#26178;&#38291;&#12461;&#12515;&#12483;&#12471;&#12517;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-menu-expiry-hours 2)
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">RET &#12391;&#12501;&#12449;&#12452;&#12523;&#12434;&#38283;&#12367;&#38555;, &#19968;&#35239;&#12496;&#12483;&#12501;&#12449;&#12434;&#28040;&#12377;. C-u RET &#12394;&#12425;&#27531;&#12427;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-view-summary-persistent nil)
  <span style="color: #a5a5a6;">;;; </span><span style="color: #a5a5a6;">&#12513;&#12491;&#12517;&#12540;&#34920;&#31034;&#29992;&#12398;&#38306;&#25968;&#23450;&#32681;</span>
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#27491;&#35215;&#34920;&#29694;&#12391;&#26908;&#32034;, &#36870;&#38918;,  &#34920;&#31034;&#20214;&#25968;&#12399; =howm-menu-recent-num=, &#12392;&#12356;&#12358; ad hoc &#12394;&#38306;&#25968;</span>
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:howm-menu-search</span> (key <span style="color: #FFFF7F;">&amp;optional</span> formatter regexp-p)
    <span style="color: #7FFF7F;">"Embed search result of KEY into menu, reverse-order, howm-menu-recent-num"</span>
    (<span style="color: #FF7F7F;">let</span> ((fixed-p (not regexp-p)))
      (howm-menu-general <span style="color: #7FFF7F;">"menu-search"</span>
                         formatter
                         (howm-first-n
                          (howm-sort-items-by-reverse-date
                           (howm-view-search-folder-items key (howm-folder) nil fixed-p)
                           ) <span style="color: #FF7FBF; font-weight: bold;">howm-menu-recent-num)</span>
                         )))
  (<span style="color: #FF7F7F;">setq</span> howm-menu-allow
        (append '(my:howm-menu-search) howm-menu-allow))
  <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">&#32232;&#38598;&#12486;&#12531;&#12503;&#12524;&#12540;&#12488;&#12398;</span>
  (<span style="color: #FF7F7F;">setq</span> howm-dtime-format (concat <span style="color: #7FFF7F;">"&lt;"</span> howm-dtime-body-format <span style="color: #7FFF7F;">"&gt;"</span>)
        howm-insert-date-format <span style="color: #7FFF7F;">"&lt;%s&gt;"</span>
        howm-template-date-format <span style="color: #7FFF7F;">"&lt;%Y-%m-%d %a %H:%M:%S&gt;"</span>
        howm-template-file-format <span style="color: #7FFF7F;">"==&gt;%s"</span>
        howm-template <span style="color: #7FFF7F;">"* MEMO %date %cursor\n%file\n"</span>
        howm-reminder-today-format (format howm-insert-date-format howm-date-format))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf23518a" class="outline-2">
<h2 id="orgf23518a">フォントと色</h2>
<div class="outline-text-2" id="text-orgf23518a">
<p>
そろそろテーマにした方が良い，とは思ってはいる．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:load-window-config</span> ()
  <span style="color: #7FFF7F;">"load window-system specific settings"</span>
  (<span style="color: #FF7F7F;">interactive</span>)
  (<span style="color: #FF7F7F;">when</span> window-system
    (<span style="color: #FF7F7F;">progn</span>
      (set-face-attribute 'default nil
                          <span style="color: #7FBFFF;">:family</span> <span style="color: #7FFF7F;">"SeptemberMMono"</span>
                          <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">:family "Ricty Discord for Powerline"</span>
                          <span style="color: #7FBFFF;">:height</span> 135) <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">135pt</span>
      <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(set-fontset-font nil 'japanese-jisx0208</span>
      <span style="color: #a5a5a6;">;;                   </span><span style="color: #a5a5a6;">(font-spec :family "SeptemberMMono"))</span>
      <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(setq face-font-rescale-alist '(("September.*" . 1)))</span>
      (set-background-color <span style="color: #7FFF7F;">"#242424"</span>)
      )))
(<span style="color: #FF7F7F;">setq</span> frame-background-mode (frame-parameter nil 'background-mode))
(<span style="color: #FF7F7F;">setq</span> default-frame-alist
      '(
        (foreground-color . <span style="color: #7FFF7F;">"#F6F3E8"</span>)
        (scroll-bar-foreground-color . <span style="color: #7FFF7F;">"red"</span>)
        (vertical-scroll-bars . right)
        ))
(<span style="color: #FF7F7F;">when</span> (window-system)
  (my:load-window-config))
</pre>
</div>
<p>
現在修正中．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(custom-set-faces
 '(default                             ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> ))))
 <span style="color: #a5a5a6;">;;</span>
 '(cursor                              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#4CFF4C"</span> ))))
 '(font-lock-builtin-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FBFFF"</span> ))))
 '(font-lock-comment-delimiter-face    ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#a5a5a6"</span> ))))
 '(font-lock-comment-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#a5a5a6"</span> ))))
 '(font-lock-constant-face             ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFBF7F"</span> ))))
 '(font-lock-doc-face                  ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span> ))))
 '(font-lock-doc-string-face           ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span> ))))
 '(font-lock-function-name-face        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#BF7FFF"</span>))))
 '(font-lock-keyword-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7F7F"</span>))))
 '(font-lock-link-face                 ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span> ))))
 '(font-lock-negation-char-face        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span> <span style="color: #7FBFFF;">:bold</span> t   <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-preprocessor-face         ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:bold</span> nil <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-regexp-grouping-backslash ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#A5EE4C"</span> <span style="color: #7FBFFF;">:bold</span> t   <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-regexp-grouping-construct ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> <span style="color: #7FBFFF;">:bold</span> t   <span style="color: #7FBFFF;">:italic</span> nil))))
 '(font-lock-string-face               ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFF7F"</span> ))))
 '(font-lock-type-face                 ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF7F"</span> ))))
 '(font-lock-variable-name-face        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> ))))
 '(font-lock-warning-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7FBF"</span> <span style="color: #7FBFFF;">:bold</span> t ))))
 '(fringe                              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#666666"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#282828"</span> ))))
 '(hl-line                             ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#4C4C4C"</span> ))))
 '(highlight                           ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#4C4C4C"</span> ))))
 '(minibuffer-prompt                   ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#BF7FFF"</span> ))))
 '(mode-line                           ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> ))))
 '(mode-line-inactive                  ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#666666"</span> <span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#999999"</span> <span style="color: #7FBFFF;">:bold</span> nil ))))
 '(region                              ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">custom-set-faces was added by Custom.</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">If you edit it by hand, you could mess it up, so be careful.</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">Your init file should contain only one such instance.</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">If there is more than one, they won't work right.</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(fixed-pitch ((t (:family "Ricty" ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(variable-pitch ((t (:family "Ricty" ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(fixed-pitch ((t (:family "Monospace" :height 135 ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(variable-pitch ((t (:family "Monospace" :height 135 ))))</span>
 <span style="color: #a5a5a6;">;;</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">preview-latex</span>
 '(font-latex-sectioning-0-face ((t (<span style="color: #7FBFFF;">:inherit</span> font-latex-sectioning-1-face))))
 '(font-latex-sectioning-1-face ((t (<span style="color: #7FBFFF;">:inherit</span> font-latex-sectioning-2-face))))
 '(font-latex-sectioning-2-face ((t (<span style="color: #7FBFFF;">:inherit</span> font-latex-sectioning-3-face))))
 '(font-latex-sectioning-3-face ((t (<span style="color: #7FBFFF;">:inherit</span> font-latex-sectioning-4-face))))
 '(font-latex-sectioning-4-face ((t (<span style="color: #7FBFFF;">:inherit</span> font-latex-sectioning-5-face ))))
 '(font-latex-sectioning-5-face ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-type-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(font-latex-slide-title-face  ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-type-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(font-latex-subscript-face    ((t nil)))
 '(font-latex-superscript-face  ((t nil)))
 '(font-latex-math-face         ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-constant-face ))))
 '(font-latex-script-char-face  ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-preprocessor-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(font-latex-verbatim-face     ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-doc-string-face ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">elscreen</span>
 '(elscreen-tab-control-face        ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#f6f3e8"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> t ))))
 '(elscreen-tab-current-screen-face ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#f6f3e8"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> t ))))
 '(elscreen-tab-other-screen-face   ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> nil ))))
 '(elscreen-tab-background-face     ((t (<span style="color: #7FBFFF;">:background</span> <span style="color: #7FFF7F;">"#222244"</span> <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#aaaaaa"</span> <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:bold</span> nil ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">dired</span>
 '(dired-directory                  ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(dired-flagged</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(dired-header</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(dired-ignored</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(dired-mark</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(dired-marked</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(dired-perm-write</span>
 '(dired-symlink                    ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7FFFFF"</span> ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(dired-warning</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(flx-highlight-face               ((t (:bold t :undeline t))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">git-gutter</span>
 '(git-gutter:added                  ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFF4C"</span>))))
 '(git-gutter:deleted                ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7FBF"</span>))))
 '(git-gutter:modified               ((t (<span style="color: #7FBFFF;">:inherit</span> default <span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFF4C"</span>))))
 '(git-gutter:unchanged              ((t (<span style="color: #7FBFFF;">:inherit</span> default ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">helm: header-line</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-source-header               ((t (:foreground "#F6F3E8" :background "#224488" :bold t))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-visible-mark                ((t (:inherit highlight ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-selection                   ((t (:inherit highlight ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-selection-line              ((t (:inherit highlight ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">helm: directory</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-ff-directory                ((t (:inherit dired-directory ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-bookmark-directory          ((t (:inherit helm-ff-directory ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-buffer-directory            ((t (:inherit helm-ff-directory ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-ff-dotted-directory         ((t (:inherit helm-ff-directory ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">helm: file</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-ff-file                     ((t (:inherit default ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-bookmark-file               ((t (:inherit helm-ff-file ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-buffer-file                 ((t (:inherit helm-ff-file ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-grep-file                   ((t (:inherit helm-ff-file ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-etags-file                  ((t (:inherit helm-ff-file ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">helm: file + executable</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-ff-executable               ((t (:inherit helm-ff-file :foreground "#7FFF7F" :bold t))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">helm: symlink</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-ff-symlink                  ((t (:inherit default :foreground "#7FFFFF" :bold t))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-ff-dotted-symlink-directory ((t (:inherit helm-ff-symlink ))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(helm-ff-invalid-symlink          ((t (:inherit default :foreground "#FF7F7F" ))))</span>
 <span style="color: #a5a5a6;">;;; </span><span style="color: #a5a5a6;">howm</span>
 '(howm-mode-keyword-face            ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-mode-title-face              ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4CFFFF"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-deadline-face       ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF4C4C"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-late-deadline-face  ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:underline</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF0000"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-today-face          ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFBF7F"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 '(howm-reminder-tomorrow-face       ((t (<span style="color: #7FBFFF;">:bold</span> t <span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7FBF"</span> <span style="color: #7FBFFF;">:background</span> nil ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">ido</span>
 '(ido-subdir          ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#7F7FFF"</span> <span style="color: #7FBFFF;">:bold</span> t))))
 '(ido-only-match      ((t (<span style="color: #7FBFFF;">:underline</span> t))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">outline</span>
 '(outline-1 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-function-name-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-2 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-string-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-3 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-keyword-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-4 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-type-face <span style="color: #7FBFFF;">:bold</span> t ))))
 '(outline-5 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-constant-face <span style="color: #7FBFFF;">:bold</span> t ))))
 '(outline-6 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-variable-name-face <span style="color: #7FBFFF;">:bold</span> t))))
 '(outline-7 ((t (<span style="color: #7FBFFF;">:inherit</span> font-lock-builtin-face <span style="color: #7FBFFF;">:bold</span> t ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(outline-8 ((t (:inherit font-lock-comment-face :bold t ))))</span>
 <span style="color: #a5a5a6;">;;</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">org</span>
 '(org-agenda-date-today           ((t (<span style="color: #7FBFFF;">:underline</span> t ))))
 '(org-agenda-date                 ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FFFFFF"</span> ))))
 '(org-agenda-date-weekend         ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#FF7F7F"</span> <span style="color: #7FBFFF;">:bold</span> t))))
 '(org-agenda-calendar-event       ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#F6F3E8"</span> ))))
 '(org-hide                        ((t (<span style="color: #7FBFFF;">:foreground</span> <span style="color: #7FFF7F;">"#4C4C4C"</span> ))))
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">review</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(review-mode-header1-face  ((t (:inherit outline-1))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(review-mode-header2-face  ((t (:inherit outline-2))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(review-mode-header3-face  ((t (:inherit outline-3))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(review-mode-header4-face  ((t (:inherit outline-4))))</span>
 <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">'(review-mode-header5-face  ((t (:inherit outline-5))))</span>
 )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc4a9493" class="outline-2">
<h2 id="orgc4a9493">日記: <code>tDiary</code></h2>
<div class="outline-text-2" id="text-orgc4a9493">
<p>
tdiary-mode をちまちまと弄っている所
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">unless</span> (locate-library <span style="color: #7FFF7F;">"tdiary-mode"</span>)
  (quelpa '(tdiary-mode
            <span style="color: #7FBFFF;">:fetcher</span> github
            <span style="color: #7FBFFF;">:repo</span> <span style="color: #7FFF7F;">"uwabami/tdiary-mode"</span>)))
(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">tdiary-mode</span>
  <span style="color: #7FBFFF;">:if</span> (file-directory-p <span style="color: #7FFF7F;">"~/Dropbox/tdiary"</span>)
  <span style="color: #7FBFFF;">:commands</span> (tdiary-mode tdiary-new tdiary-new-directory tdiary-replace)
  <span style="color: #7FBFFF;">:config</span>
  (load (expand-file-name <span style="color: #7FFF7F;">"emacs/tdiary-mode.gpg"</span> my:d:password-store))
  (<span style="color: #FF7F7F;">setq</span> tdiary-browser-function 'browser-url
        tdiary-coding-system 'utf-8-dos
        tdiary-style-mode 'rd-mode
        tdiary-hour-offset 2
        tdiary-text-save-p t
        tdiary-text-suffix <span style="color: #7FFF7F;">".rd"</span>)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org155c83d" class="outline-2">
<h2 id="org155c83d">プログラム環境</h2>
<div class="outline-text-2" id="text-org155c83d">
</div><div id="outline-container-orgc3455b7" class="outline-3">
<h3 id="orgc3455b7">VCS: <code>magit</code></h3>
<div class="outline-text-3" id="text-orgc3455b7">
<p>
magit は Emacs の Git Frontend.
結局の所 CUI でコマンド叩く事も多いけれど，これはこれで重宝している．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">magit</span>
  <span style="color: #7FBFFF;">:bind</span> ((<span style="color: #7FFF7F;">"C-x g"</span> . magit-status))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> magit-completing-read-function 'magit-ido-completing-read)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc435948" class="outline-3">
<h3 id="orgc435948">rainbow-mode</h3>
<div class="outline-text-3" id="text-orgc435948">
<p>
<code>#RRGGBB</code> のカラーコードに勝手に色が付く．CSS の編集中なんかで地味に便利．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rainbow-mode</span>
  <span style="color: #7FBFFF;">:diminish</span> rainbow-mode
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org35095d6" class="outline-3">
<h3 id="org35095d6">Textile</h3>
<div class="outline-text-3" id="text-org35095d6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">textile-mode</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:diminish</span> textile-mode
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org32a2966" class="outline-3">
<h3 id="org32a2966">Markdown</h3>
<div class="outline-text-3" id="text-org32a2966">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">markdown-mode</span>
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"pandoc"</span>)
  <span style="color: #7FBFFF;">:mode</span> (<span style="color: #7FFF7F;">"\\.</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">md</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">markdown</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">\\'"</span> . gfm-mode)
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'markdown-mode-hook
            '(lambda ()
               (electric-indent-local-mode -1)))
  (add-hook 'gfm-mode-hook
            '(lambda ()
               (electric-indent-local-mode -1)))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> markdown-command
        <span style="color: #7FFF7F;">"pandoc --from markdown_github -t html5 --mathjax --highlight-style pygments"</span>)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc4bc4d1" class="outline-3">
<h3 id="orgc4bc4d1">SCSS</h3>
<div class="outline-text-3" id="text-orgc4bc4d1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">scss-mode</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:if</span> (executable-find <span style="color: #7FFF7F;">"sass"</span>)
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"\\.scss\\'"</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> scss-sass-command (executable-find <span style="color: #7FFF7F;">"sass"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org8d3ecba" class="outline-3">
<h3 id="org8d3ecba">YAML</h3>
<div class="outline-text-3" id="text-org8d3ecba">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">yaml-mode</span>
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">\.yml</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">|</span><span style="color: #7FFF7F;">\.yaml</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">"</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org8512260" class="outline-3">
<h3 id="org8512260">設定ファイル: <code>generic-x</code></h3>
<div class="outline-text-3" id="text-org8512260">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">generic-x</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org6c5fc81" class="outline-3">
<h3 id="org6c5fc81">Ruby</h3>
<div class="outline-text-3" id="text-org6c5fc81">
<p>
素の <code>ruby-mode</code>. <code>Gemfile</code> も ruby-mode で扱う
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ruby-mode</span>
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"\\.rb\\'"</span>
  <span style="color: #7FBFFF;">:interpreter</span> <span style="color: #7FFF7F;">"ruby"</span>
  <span style="color: #7FBFFF;">:init</span>
  (add-to-list 'auto-mode-alist '(<span style="color: #7FFF7F;">"Gemfile$"</span> . ruby-mode)))
</pre>
</div>
<p>
<code>ruby-electric</code>: 括弧や <code>do ... end</code> の補完
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ruby-electric</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'ruby-mode-hook (<span style="color: #FF7F7F;">lambda</span> () (ruby-electric-mode t)))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> ruby-electric-expand-delimiters-list nil))
</pre>
</div>
<p>
<code>ruby-block</code>: <code>do...end</code> の対応をハイライト
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">ruby-block</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:diminish</span> ruby-block-mode
  <span style="color: #7FBFFF;">:config</span>
  (ruby-block-mode t)
  (<span style="color: #FF7F7F;">setq</span> ruby-block-highlight-toggle 'overlay)
  )
</pre>
</div>
<p>
<code>rspec-mode</code>:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rspec-mode</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> rspec-use-rake-flag nil))
</pre>
</div>
<p>
<code>rabbit-mode</code>: <a href="http://rabbit-shocker.org/ja/">Rabbit</a> 編集用
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">rabbit-mode</span>
  <span style="color: #7FBFFF;">:mode</span> <span style="color: #7FFF7F;">"\\.rab$"</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org8712e7f" class="outline-3">
<h3 id="org8712e7f">C</h3>
<div class="outline-text-3" id="text-org8712e7f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">cc-mode</span>
  <span style="color: #7FBFFF;">:init</span>
  (c-add-style <span style="color: #7FFF7F;">"my:bsd-like"</span>
               '(<span style="color: #7FFF7F;">"bsd"</span>
                 (c-basic-offset . 2)
                 (c-hanging-braces-alist . ((inline-open       before after)
                                            (block-open        before after)
                                            (substatement-open before after)))
                 (c-offsets-alist . ((brace-list-entry . +)))
                 ))
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq-default</span> c-default-style <span style="color: #7FFF7F;">"my:bsd-like"</span>)
  (add-hook 'c-mode-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (c-set-style <span style="color: #7FFF7F;">"my:bsd-like"</span>)
              (electric-indent-local-mode -1)
              (set (make-local-variable 'eldoc-idle-delay) 0.20)
              (c-turn-on-eldoc-mode)
              ))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org3d4000d" class="outline-3">
<h3 id="org3d4000d">Fortran</h3>
<div class="outline-text-3" id="text-org3d4000d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">f90</span>
  <span style="color: #7FBFFF;">:mode</span> (<span style="color: #7FFF7F;">"\\.</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">f|F</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">(</span><span style="color: #7FFF7F;">90|95|03|08</span><span style="color: #A5EE4C; font-weight: bold;">\\</span><span style="color: #7F7FFF; font-weight: bold;">)</span><span style="color: #7FFF7F;">$"</span> . f90-mode)
  <span style="color: #7FBFFF;">:config</span>
  (add-hook 'f90-mode-hook
            (<span style="color: #FF7F7F;">lambda</span> ()
              (<span style="color: #FF7F7F;">setq</span> f90-do-indent 2
                    f90-if-indent 2
                    f90-type-indent 2
                    f90-program-indent 2
                    f90-continuation-indent 2
                    f90-directive-comment-re <span style="color: #7FFF7F;">"!omp\\$"</span>
                    f90-indented-comment-re <span style="color: #7FFF7F;">"!"</span>
                    f90-break-delimiters <span style="color: #7FFF7F;">"[-+\\*/&gt;&lt;=,% \t]"</span>
                    f90-break-before-delimiters t
                    f90-beginning-ampersand nil
                    f90-smart-end 'blink
                    f90-auto-keyword-case nil
                    f90-leave-line-no nil
                    f90-comment-region <span style="color: #7FFF7F;">"!! "</span>
                    f90-indent-comment <span style="color: #7FFF7F;">"! "</span>
                    indent-tabs-mode nil
                    f90-font-lock-keywords f90-font-lock-keywords-2)
              (ggtags-mode 1)))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org6d6deb2" class="outline-3">
<h3 id="org6d6deb2">AUCTeX</h3>
<div class="outline-text-3" id="text-org6d6deb2">
<p>
Debian パッケージ版を使う．やっている事は
</p>
<ul class="org-ul">
<li><code>japanese-latex-mode</code> において, 幾つかのコマンドが追加/上書きされているが，
あまり使うことの無いコマンドが表示されるのが嫌なのでそれらを削除．</li>
<li><p>
コンパイルには <code>latexmk</code> を使う，です．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">tex-jp</span>
  <span style="color: #7FBFFF;">:if</span> (<span style="color: #FF7F7F;">and</span> (executable-find <span style="color: #7FFF7F;">"uplatex"</span>)
           (my:dpkg-status <span style="color: #7FFF7F;">"auctex"</span>))
  <span style="color: #7FBFFF;">:config</span>
  (add-hook 'LaTeX-mode-hook 'TeX-source-correlate-mode)
  (add-hook 'LaTeX-mode-hook 'TeX-PDF-mode)
  (add-hook 'LaTeX-mode-hook 'turn-on-reftex)
  (add-hook 'LaTeX-mode-hook
            (<span style="color: #FF7F7F;">function</span>
             (<span style="color: #FF7F7F;">lambda</span> ()
               (<span style="color: #FF7F7F;">dolist</span> (command '(<span style="color: #7FFF7F;">"pTeX"</span> <span style="color: #7FFF7F;">"LaTeX"</span> <span style="color: #7FFF7F;">"pLaTeX"</span> <span style="color: #7FFF7F;">"pBibTeX"</span> <span style="color: #7FFF7F;">"jTeX"</span> <span style="color: #7FFF7F;">"jLaTeX"</span> <span style="color: #7FFF7F;">"jBibTeX"</span>))
                 (delq (assoc command TeX-command-list) TeX-command-list))
               (<span style="color: #FF7F7F;">setq</span> TeX-command-default <span style="color: #7FFF7F;">"LaTeX"</span>
                     japanese-LaTeX-command-default <span style="color: #7FFF7F;">"LaTeX"</span>
                     TeX-PDF-mode t
                     TeX-command-output-list '((<span style="color: #7FFF7F;">"LaTeX"</span> (<span style="color: #7FFF7F;">"pdf"</span>)))
                     )
               (add-to-list 'TeX-expand-list
                            '(<span style="color: #7FFF7F;">"%(LATEXENC)"</span>
                              (<span style="color: #FF7F7F;">lambda</span> ()
                                (<span style="color: #FF7F7F;">let</span> ((str (japanese-TeX-get-encoding-string)))
                                  (<span style="color: #FF7F7F;">if</span> str (format <span style="color: #7FFF7F;">"%s"</span> str) <span style="color: #7FFF7F;">""</span>)))))
               (add-to-list 'TeX-command-list
                            '(<span style="color: #7FFF7F;">"LaTeX"</span>
                              <span style="color: #7FFF7F;">"LATEXENC=%(LATEXENC) latexmk -gg %t"</span>
                              TeX-run-TeX nil (latex-mode) <span style="color: #7FBFFF;">:help</span> <span style="color: #7FFF7F;">"Run Latexmk"</span>)))))
  (<span style="color: #FF7F7F;">setq</span> TeX-source-correlate-method 'synctex
        TeX-source-correlate-start-server t
        TeX-auto-save t
        TeX-auto-local  (expand-file-name <span style="color: #7FFF7F;">"auctex/auto"</span> my:d:tmp)
        TeX-style-local (expand-file-name <span style="color: #7FFF7F;">"auctex/style"</span> my:d:tmp)
        TeX-parse-self t
        TeX-auto-untabify t
        font-latex-fontify-script nil
        font-latex-fontify-sectioning 1.0
        font-latex-script-display nil
        reftex-plug-into-AUCTeX t
        )
  )
</pre>
</div></li>
</ul>
<p>
<code>~/.latexmkrc</code> の設定は以下の通り．
</p>
<div class="org-src-container">
<pre class="src src-perl">      <span style="color: #a5a5a6;">#!/usr/bin/env perl</span>
      $<span style="color: #7F7FFF;">kanji</span>  = defined $<span style="color: #7F7FFF;">ENV</span>{<span style="color: #7FFF7F;">"LATEXENC"</span>} ? <span style="color: #7FFF7F;">"-kanji=$ENV{\"LATEXENC\"}"</span> : <span style="color: #7FFF7F;">"-kanjii=utf8"</span> ;
      $<span style="color: #7F7FFF;">latex</span>  = <span style="color: #7FFF7F;">"platex -interaction=nonstopmode -src-specials -shell-escape --synctex=1 $kanji"</span>;
      $<span style="color: #7F7FFF;">latex_silent</span> = <span style="color: #7FFF7F;">"platex -interaction=batchmode -src-specials -shell-escape --synctex=1 $kanji"</span>;
      $<span style="color: #7F7FFF;">bibtex</span> = <span style="color: #7FFF7F;">"pbibtex $kanji"</span>;
      $<span style="color: #7F7FFF;">makeindex</span> = <span style="color: #7FFF7F;">"touch -m %D"</span>;
      $<span style="color: #7F7FFF;">dvipdf</span> = <span style="color: #7FFF7F;">"dvipdfmx %O -o %D %S"</span>;
      $<span style="color: #7F7FFF;">dvips</span> = <span style="color: #7FFF7F;">'dvips %O -z -f %S | convbkmk -u &gt; %D'</span>;
      $<span style="color: #7F7FFF;">ps2pdf</span> = <span style="color: #7FFF7F;">'ps2pdfwr %O %S %D'</span>;
      $<span style="color: #7F7FFF;">pdf_mode</span> = 3;
      $<span style="color: #7F7FFF;">pdf_previewer</span> = <span style="color: #7FFF7F;">'start xdg-open'</span>;
      $<span style="color: #7F7FFF;">pdf_update_method</span> = 0;
      $<span style="color: #7F7FFF;">clean_ext</span> = <span style="color: #7FFF7F;">"snm nav vrb synctex.gz"</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org4d21671" class="outline-3">
<h3 id="org4d21671">AUCTeX と Zotero との連携</h3>
<div class="outline-text-3" id="text-org4d21671">
<p>
イマイチ使いこなせてないけれど．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">zotelo</span>
  <span style="color: #7FBFFF;">:ensure</span> t
  <span style="color: #7FBFFF;">:init</span>
  (add-hook 'LaTeX-mode-hook 'zotelo-minor-mode)
  (add-hook 'TeX-mode-hook   'zotelo-minor-mode)
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> zotelo-translator-charsets '((BibTeX . <span style="color: #7FFF7F;">"Unicode"</span>)
                                     (Default . <span style="color: #7FFF7F;">"Unicode"</span>))
        zotelo-use-journal-abbreviation t)
)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org24a422e" class="outline-2">
<h2 id="org24a422e">基本的なキーバインドの設定 <code>[/]</code></h2>
<div class="outline-text-2" id="text-org24a422e">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> 設定が効かない事がある．読み込む順番が関係するのかな&#x2026;?</li>
</ul>
<p>
既に手癖になってしまっているアレコレ．
特に <code>[home]</code> と <code>[end]</code> は無いと途方に暮れます．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">bind-keys*</span>
 (<span style="color: #7FFF7F;">"C-h"</span>     . backward-delete-char)
 (<span style="color: #7FFF7F;">"C-c M-a"</span> . align-regexp)
 (<span style="color: #7FFF7F;">"C-c ;"</span>   . comment-region)
 (<span style="color: #7FFF7F;">"C-c M-;"</span> . uncomment-region)
 (<span style="color: #7FFF7F;">"C-/"</span>     . undo)
 (<span style="color: #7FFF7F;">"C-x M-b"</span> . ibuffer-other-window)
 (<span style="color: #7FFF7F;">"C-c M-r"</span> . replace-regexp)
 (<span style="color: #7FFF7F;">"C-c r"</span>   . replace-string)
 (<span style="color: #7FFF7F;">"&lt;home&gt;"</span>  . beginning-of-buffer)
 (<span style="color: #7FFF7F;">"&lt;end&gt;"</span>   . end-of-buffer)
 (<span style="color: #7FFF7F;">"C-c C-j"</span> . browse-url-at-point)
 )
</pre>
</div>
</div>
</div>
<div id="outline-container-org16ee167" class="outline-2">
<h2 id="org16ee167"><code>diminish</code>: モードラインの短縮表示</h2>
<div class="outline-text-2" id="text-org16ee167">
<p>
<code>use-package</code> で読み込まれているので，可能な限りそちらで指定するように変更．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defmacro</span> <span style="color: #BF7FFF;">my:diminish</span> (file mode <span style="color: #FFFF7F;">&amp;optional</span> new-name)
  <span style="color: #7FFF7F;">"original: </span><span style="text-decoration: underline;"><a href="https://github.com/larstvei/dot-emacs/blob/master/init.org">https://github.com/larstvei/dot-emacs/blob/master/init.org</a></span><span style="color: #7FFF7F;">"</span>
  `(<span style="color: #FF7F7F;">with-eval-after-load</span> ,file
     (diminish ,mode ,new-name)))
(<span style="color: #FF7F7F;">my:diminish</span> <span style="color: #7FFF7F;">"isearch"</span>          'isearch-mode)
(<span style="color: #FF7F7F;">my:diminish</span> <span style="color: #7FFF7F;">""</span>          'develock-mode)
(<span style="color: #FF7F7F;">setq</span> auto-revert-mode-text <span style="color: #7FFF7F;">""</span>)
</pre>
</div>
<p>
メジャーモードは <code>hook</code> で設定.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-lisp-mode-hook '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">"El"</span>)))
(add-hook 'lisp-interaction-mode-hook '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">"Li"</span>)))
(add-hook 'wl-folder-mode-hook  '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
(add-hook 'wl-summary-mode-hook '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
(add-hook 'wl-draft-mode-hook   '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
(add-hook 'mime-view-mode-hook  '(lambda () (<span style="color: #FF7F7F;">setq</span> mode-name <span style="color: #7FFF7F;">""</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3fe91e6" class="outline-2">
<h2 id="org3fe91e6"><code>powerline</code>: モードラインを綺麗に</h2>
<div class="outline-text-2" id="text-org3fe91e6">
<p>
<a href="https://github.com/milkypostman/powerline">milkypostman/powerline: emacs powerline</a> で modeline を良い感じに表示する．
</p>

<p>
SKK の状態がヒョコヒョコ動くのが嫌なので，
<code>skk-modeline-input-mode</code> に常に現在の状況を表示する様にしておく．
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:skk-modeline-input-mode</span> ()
  <span style="color: #7FFF7F;">"skk &#12364;&#35501;&#12415;&#36796;&#12414;&#12428;&#12390;&#12356;&#12394;&#12356;&#22580;&#21512;&#12391;&#12418; skk-modeline-input-mode &#12395;&#25991;&#23383;&#12434;&#20837;&#12428;&#12390;&#36820;&#12377;"</span>
  (<span style="color: #FF7F7F;">unless</span> (boundp 'skk-modeline-inpt-mode)
    (<span style="color: #FF7F7F;">setq</span> skk-modeline-input-mode <span style="color: #7FFF7F;">"--[--]:"</span>)))
(my:skk-modeline-input-mode)
</pre>
</div>
<p>
ddskk そのものに modeline を更新する関数があるので無効化する
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">defadvice</span> <span style="color: #BF7FFF;">skk-setup-modeline</span> (around my:disable-skk-setup-modeline activate)
  <span style="color: #7FFF7F;">"skk-setup-modeline &#12395;&#12424;&#12427; modeline &#12398;&#26356;&#26032;&#12434;&#28961;&#21177;&#21270;"</span>
  (<span style="color: #FF7F7F;">setq</span> skk-indicator-alist (skk-make-indicator-alist))
  (force-mode-line-update t))
</pre>
</div>
<p>
powerline 本体の設定．default-theme をベースに見たい物だけ表示するようにしてみた．
変更点として,
</p>
<ul class="org-ul">
<li>separater は環境によってズレるので，半角スペースに変更</li>
<li>vc-mode でのアイコン表示に U+26A1⚡ High Voltage を使う</li>
</ul>
<p>
といった事をしている. East Asian ambiguous Width char の扱いは面倒ですね
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #FF7F7F;">use-package</span> <span style="color: #FFBF7F;">powerline</span>
  <span style="color: #7FBFFF;">:config</span>
  (<span style="color: #FF7F7F;">setq</span> powerline-default-separator 'utf-8
        powerline-utf-8-separator-left  #x20
        powerline-utf-8-separator-right #x20
        )
(<span style="color: #FF7F7F;">defpowerline</span> my:powerline-vc
  (<span style="color: #FF7F7F;">when</span> (<span style="color: #FF7F7F;">and</span> (buffer-file-name (current-buffer)) vc-mode)
    (format <span style="color: #7FFF7F;">"%s%s"</span>
            <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(char-to-string #x26d3)</span>
            (char-to-string #x26a1)
            (format-mode-line '(vc-mode vc-mode)))))
  (<span style="color: #FF7F7F;">defun</span> <span style="color: #BF7FFF;">my:powerline-theme</span> ()
    <span style="color: #7FFF7F;">"Setup customize theme."</span>
    (<span style="color: #FF7F7F;">interactive</span>)
    (my:skk-modeline-input-mode)
    (<span style="color: #FF7F7F;">setq-default</span>
     mode-line-format
     '(<span style="color: #7FFF7F;">"%e"</span>
       (<span style="color: #7FBFFF;">:eval</span>
        (<span style="color: #FF7F7F;">let*</span> ((active (powerline-selected-window-active))
               (mode-line-buffer-id (<span style="color: #FF7F7F;">if</span> active 'mode-line-buffer-id 'mode-line-buffer-id-inactive))
               (mode-line (<span style="color: #FF7F7F;">if</span> active 'mode-line 'mode-line-inactive))
               (face1 (<span style="color: #FF7F7F;">if</span> active 'powerline-active1 'powerline-inactive1))
               (face2 (<span style="color: #FF7F7F;">if</span> active 'powerline-active2 'powerline-inactive2))
               (separator-left (intern (format <span style="color: #7FFF7F;">"powerline-%s-%s"</span>
                                               (powerline-current-separator)
                                               (car powerline-default-separator-dir))))
               (separator-right (intern (format <span style="color: #7FFF7F;">"powerline-%s-%s"</span>
                                                (powerline-current-separator)
                                                (cdr powerline-default-separator-dir))))
               (lhs (list
                     (powerline-raw (substring skk-modeline-input-mode 2 -1) nil 'l)
                     (powerline-raw <span style="color: #7FFF7F;">"%*"</span> mode-line 'l)
                     (powerline-raw mode-line-mule-info mode-line 'l)
                     (powerline-buffer-id mode-line-buffer-id 'l)
                     (powerline-raw <span style="color: #7FFF7F;">" "</span>)
                     (funcall separator-left mode-line face1)
                     (powerline-major-mode face1 'l)
                     (powerline-process face1)
                     (powerline-narrow face1 'l)
                     (powerline-raw <span style="color: #7FFF7F;">" "</span> face1)
                     (funcall separator-left face1 face2)
                     (my:powerline-vc face2 'r)
                     <span style="color: #a5a5a6;">;; </span><span style="color: #a5a5a6;">(powerline-vc face2 'r)</span>
                     ))
               (rhs (list
                     (powerline-raw global-mode-string face2 'r)
                     (funcall separator-right face2 face1)
                     (powerline-raw <span style="color: #7FFF7F;">" "</span> face1)
                     (powerline-minor-modes face1 'r)
                     (funcall separator-right face1 mode-line)
                     (powerline-raw <span style="color: #7FFF7F;">"  "</span>)
                     (powerline-raw <span style="color: #7FFF7F;">"%6p"</span> mode-line 'r)
                     ))
               )
          (concat (powerline-render lhs)
                  (powerline-fill face2 (powerline-width rhs))
                  (powerline-render rhs)))))))
  (my:powerline-theme)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org599bdcc" class="outline-2">
<h2 id="org599bdcc">起動時間の計測</h2>
<div class="outline-text-2" id="text-org599bdcc">
<p>
<a href="http://memo.sugyan.com/entry/20120120/1327037494">起動時間を計測する 改訂版 - すぎゃーんメモ</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'after-init-hook
          (<span style="color: #FF7F7F;">lambda</span> ()
            (message <span style="color: #7FFF7F;">"init time: %.3f sec"</span>
                     (float-time (time-subtract after-init-time before-init-time)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0f369f0" class="outline-2">
<h2 id="org0f369f0">LICENSE</h2>
<div class="outline-text-2" id="text-org0f369f0">
<p>
幾つかの関数の元ネタとして Emacs 本体のコードを参照したので，GPL-3 or later です．
</p>
<pre class="example">
Copyright (C) 2011--2017 Youhei SASAKI &lt;uwabami@gfd-dennou.org&gt;
.
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
.
This package is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.
You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.
</pre>
</div>
</div>
